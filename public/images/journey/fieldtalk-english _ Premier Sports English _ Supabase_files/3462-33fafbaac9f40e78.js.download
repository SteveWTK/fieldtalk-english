try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="d4ed60b2-5a50-4700-ae5e-6850d7c450a9",e._sentryDebugIdIdentifier="sentry-dbid-d4ed60b2-5a50-4700-ae5e-6850d7c450a9")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3462],{6533:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(81915).A)("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]])},19164:(e,t,s)=>{"use strict";s.d(t,{X:()=>ep});var n=s(80263),a=s(60045),r=s(7005),i=s(50419),l=s(53239),o=s(46491),c=s(86279),d=s(96270),u=s(78741),m=s(69654),x=s(99199),p=s(92589),h=s(84558),g=s(27545),f=s(34763),y=s(60885),j=s(23760),b=s(76834),v=s(75831),w=s(59347),S=s(68997),N=s(16703),R=s(62308),_=s(11509),A=s(51509),E=s(22554),C=s(15745),k=s(77376),L=s(10021),T=s(12111),I=s(95137),D=s.n(I),M=s(32615),z=s(21329),P=s(96196),O=s(50960),F=s(13322),H=s(35485),W=s(80949),B=s(93749),q=s.n(B),V=s(77191),$=s.n(V),Q=s(73969),G=s(65037),U=s(39478),Y=s(90631),J=s(89422),K=s(86092),X=s(91675),Z=s(8462),ee=s(74388),et=s(101),es=s(60195),en=s(45783),ea=s(80127),er=s(68872),ei=s(35741),el=s(64495),eo=s(70979),ec=s(34531);let ed=e=>{let{entity:t,tableHasLints:s,viewHasLints:a,materializedViewHasLints:r,foreignTableHasLints:i}=e,{ref:l}=(0,o.g)(),c=null,d="Data is publicly accessible via API",u=(0,n.jsx)(J.g,{href:"/project/".concat(l,"/editor/").concat(t.id,"?schema=").concat(t.schema,"&showWarning=true"),children:"Learn more"});switch(t.type){case y.z.TABLE:s&&(c=(0,n.jsxs)(n.Fragment,{children:[d," as RLS is disabled. ",u,"."]}));break;case y.z.VIEW:a&&(c=(0,n.jsxs)(n.Fragment,{children:[d," as this is a Security definer view. ",u,"."]}));break;case y.z.MATERIALIZED_VIEW:r&&(c=(0,n.jsxs)(n.Fragment,{children:[d," as this is a Security definer view ",u,"."]}));break;case y.z.FOREIGN_TABLE:i&&(c=(0,n.jsxs)(n.Fragment,{children:[d," as RLS is not enforced on foreign tables. ",u,"."]}))}return c?(0,n.jsxs)(ei.m_,{children:[(0,n.jsx)(ei.k$,{className:"min-w-4",children:(0,n.jsx)(ec.E,{variant:"destructive",children:"Unrestricted"})}),(0,n.jsx)(ei.ZI,{side:"right",className:"max-w-52 text-center",children:c})]}):null},eu=e=>{let{id:t,projectRef:s,item:a,isLocked:r,isActive:i,onExportCLI:l}=e,{data:c}=(0,N.YA)(),d=(0,_.ap)(),{selectedSchema:m}=(0,S.k)(),x=(0,en.lW)(a.type,{id:a.id}),p=(0,en.zv)(),h=p.previewTabId===x,g=Object.values(p.tabsMap).some(e=>{var t;return(null==(t=e.metadata)?void 0:t.tableId)===a.id}),f=Number(t)===a.id,j=f&&!r,{data:v=[]}=(0,X.b)({projectRef:null==c?void 0:c.ref}),w=(0,U.t)(a.name,"rls_disabled_in_public",["ERROR"],v,m).hasLint,R=(0,U.t)(a.name,"security_definer_view",["ERROR","WARN"],v,m).hasLint,A=(0,U.t)(a.name,"materialized_view_in_api",["ERROR","WARN"],v,m).hasLint,C=(0,U.t)(a.name,"foreign_table_in_api",["ERROR","WARN"],v,m).hasLint,k=async()=>{if(o.pe&&!(null==c?void 0:c.connectionString))return console.error("Connection string is required");let e=Q.oR.loading("Exporting ".concat(a.name," as CSV..."));try{let t=await (0,b.Ap)({id:a.id,projectRef:s,connectionString:null==c?void 0:c.connectionString});if((0,ee.KO)(t)&&t.live_rows_estimate>G.Jv)return Q.oR.error((0,n.jsx)("div",{className:"text-foreground prose text-sm",children:G.RH}),{id:e});let r=t&&(0,u.rH)(t);if(!r)return Q.oR.error("Failed to export table: ".concat(a.name),{id:e});let i=(await (0,et.HQ)({projectRef:s,connectionString:null==c?void 0:c.connectionString,table:r})).map(e=>(Object.keys(e).map(t=>{"object"==typeof e[t]&&null!==e[t]&&(e[t]=JSON.stringify(e[t]))}),e));if(i.length>0){let e=$().unparse(i,{columns:r.columns.map(e=>e.name)}),t=new Blob([e],{type:"text/csv;charset=utf-8;"});D()(t,"".concat(a.name,"_rows.csv"))}Q.oR.success("Successfully exported ".concat(a.name," as CSV"),{id:e})}catch(t){Q.oR.error("Failed to export table: ".concat(t.message),{id:e})}},L=async()=>{if(o.pe&&!(null==c?void 0:c.connectionString))return console.error("Connection string is required");let e=Q.oR.loading("Exporting ".concat(a.name," as SQL..."));try{let t=await (0,b.Ap)({id:a.id,projectRef:s,connectionString:null==c?void 0:c.connectionString});if((0,ee.KO)(t)&&t.live_rows_estimate>G.Jv)return Q.oR.error((0,n.jsx)("div",{className:"text-foreground prose text-sm",children:G.RH}),{id:e});let r=t&&(0,u.rH)(t);if(!r)return Q.oR.error("Failed to export table: ".concat(a.name),{id:e});let i=(await (0,et.HQ)({projectRef:s,connectionString:null==c?void 0:c.connectionString,table:r})).map(e=>(Object.keys(e).map(t=>{"object"==typeof e[t]&&null!==e[t]&&(e[t]=JSON.stringify(e[t]))}),e));if(i.length>0){let e=(0,U.S)(r,i),t=new Blob([e],{type:"text/sql;charset=utf-8;"});D()(t,"".concat(a.name,"_rows.sql"))}Q.oR.success("Successfully exported ".concat(a.name," as SQL"),{id:e})}catch(t){Q.oR.error("Failed to export table: ".concat(t.message),{id:e})}};return(0,n.jsx)(Z.tv,{title:a.name,id:String(a.id),href:"/project/".concat(s,"/editor/").concat(a.id,"?schema=").concat(a.schema),role:"button","aria-label":"View ".concat(a.name),className:(0,ea.cn)((0,er.u2)({isSelected:f&&!h,isOpened:g&&!h,isPreview:h}),"pl-4 pr-1"),onDoubleClick:e=>{e.preventDefault();let t=(0,en.lW)(a.type,{id:a.id});p.makeTabPermanent(t)},"data-sentry-element":"EditorTablePageLink","data-sentry-component":"EntityListItem","data-sentry-source-file":"EntityListItem.tsx",children:(0,n.jsxs)(n.Fragment,{children:[f&&(0,n.jsx)("div",{className:"absolute left-0 h-full w-0.5 bg-foreground"}),(0,n.jsxs)(ei.m_,{disableHoverableContent:!0,"data-sentry-element":"Tooltip","data-sentry-source-file":"EntityListItem.tsx",children:[(0,n.jsx)(ei.k$,{className:"min-w-4","data-sentry-element":"TooltipTrigger","data-sentry-source-file":"EntityListItem.tsx",children:(0,n.jsx)(Y.L,{type:a.type,isActive:f,"data-sentry-element":"EntityTypeIcon","data-sentry-source-file":"EntityListItem.tsx"})}),(0,n.jsx)(ei.ZI,{side:"bottom","data-sentry-element":"TooltipContent","data-sentry-source-file":"EntityListItem.tsx",children:(e=>{var t,s,n,a;return null==(a=Object.entries(y.z).find(t=>{let[,s]=t;return s===e}))||null==(n=a[0])||null==(s=n.toLowerCase())||null==(t=s.split("_"))?void 0:t.join(" ")})(a.type)})]}),(0,n.jsxs)("div",{className:(0,ea.cn)("truncate overflow-hidden text-ellipsis whitespace-nowrap flex items-center gap-2 relative w-full",f&&"text-foreground"),children:[(0,n.jsx)("span",{className:(0,ea.cn)(f?"text-foreground":"text-foreground-light group-hover:text-foreground","text-sm transition truncate"),children:a.name}),(0,n.jsx)("div",{children:(0,n.jsx)(ed,{entity:a,tableHasLints:w,viewHasLints:R,materializedViewHasLints:A,foreignTableHasLints:C,"data-sentry-element":"EntityTooltipTrigger","data-sentry-source-file":"EntityListItem.tsx"})})]}),j&&(0,n.jsxs)(el.rI,{children:[(0,n.jsx)(el.ty,{asChild:!0,className:"text-foreground-lighter transition-all text-transparent group-hover:text-foreground data-[state=open]:text-foreground",children:(0,n.jsx)(E.$,{type:"text",className:"w-6 h-6",icon:(0,n.jsx)(M.A,{size:14,strokeWidth:2}),onClick:e=>e.preventDefault()})}),(0,n.jsxs)(el.SQ,{side:"bottom",align:"start",className:"w-44",children:[(0,n.jsxs)(el._2,{className:"space-x-2",onClick:e=>{e.stopPropagation(),(0,eo.l)(a.name)},children:[(0,n.jsx)(z.A,{size:12}),(0,n.jsx)("span",{children:"Copy name"})]},"copy-name"),function(e){return(null==e?void 0:e.type)===y.z.TABLE||(null==e?void 0:e.type)===y.z.PARTITIONED_TABLE}(a)&&(0,n.jsxs)(el._2,{className:"space-x-2",onClick:async e=>{e.stopPropagation();let t=Q.oR.loading("Getting table schema..."),s=await (0,K.I)({id:a.id,projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString});if(!s)return Q.oR.error("Failed to get table schema",{id:t});try{let e=(0,es.A)(s);await (0,eo.l)(e),Q.oR.success("Table schema copied to clipboard",{id:t})}catch(e){Q.oR.error("Failed to copy schema: "+(e.message||e),{id:t})}},children:[(0,n.jsx)(z.A,{size:12}),(0,n.jsx)("span",{children:"Copy table schema"})]},"copy-schema"),a.type===y.z.TABLE&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(el.mB,{}),(0,n.jsxs)(el._2,{className:"space-x-2",onClick:e=>{e.stopPropagation(),d.onEditTable()},children:[(0,n.jsx)(P.A,{size:12}),(0,n.jsx)("span",{children:"Edit table"})]},"edit-table"),(0,n.jsxs)(el._2,{className:"space-x-2",onClick:e=>{e.stopPropagation(),d.onDuplicateTable()},children:[(0,n.jsx)(O.A,{size:12}),(0,n.jsx)("span",{children:"Duplicate table"})]},"duplicate-table"),(0,n.jsx)(el._2,{className:"space-x-2",asChild:!0,children:(0,n.jsxs)(q(),{href:"/project/".concat(s,"/auth/policies?schema=").concat(m,"&search=").concat(a.id),children:[(0,n.jsx)(F.A,{size:12}),(0,n.jsx)("span",{children:"View policies"})]},"view-policies")},"view-policies"),(0,n.jsxs)(el.lv,{children:[(0,n.jsxs)(el.nV,{className:"gap-x-2",children:[(0,n.jsx)(H.A,{size:12}),"Export data"]}),(0,n.jsxs)(el.M5,{children:[(0,n.jsx)(el._2,{className:"space-x-2",onClick:e=>{e.stopPropagation(),k()},children:(0,n.jsx)("span",{children:"Export table as CSV"})},"download-table-csv"),(0,n.jsx)(el._2,{className:"gap-x-2",onClick:e=>{e.stopPropagation(),L()},children:(0,n.jsx)("span",{children:"Export table as SQL"})},"download-table-sql"),(0,n.jsx)(el._2,{className:"gap-x-2",onClick:e=>{e.stopPropagation(),l()},children:(0,n.jsx)("span",{children:"Export table via CLI"})},"download-table-cli")]})]}),(0,n.jsx)(el.mB,{}),(0,n.jsxs)(el._2,{className:"gap-x-2",onClick:e=>{e.stopPropagation(),d.onDeleteTable()},children:[(0,n.jsx)(W.A,{size:12}),(0,n.jsx)("span",{children:"Delete table"})]},"delete-table")]})]})]})]})})};var em=s(12326);let ex=()=>(0,n.jsx)(L.Q5,{title:"No tables or views",description:"Any tables or views you create will be listed here.",className:"mx-4","data-sentry-element":"InnerSideBarEmptyPanel","data-sentry-component":"TableMenuEmptyState","data-sentry-source-file":"TableMenuEmptyState.tsx",children:(0,n.jsx)("div",{className:"top-0 left-6 flex flex-col opacity-50 cursor-not-allowed bg-dash-sidebar h-content -mb-7 pointer-events-none scale-75",children:(0,n.jsxs)("div",{className:"relative h-content",children:[(0,n.jsxs)("div",{className:"absolute inset-0 pointer-events-none z-10",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-transparent from-80% to-100% to-background-surface-100 dark:to-background-surface-75"}),(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent from-50% to-100% to-background-surface-100 dark:to-background-surface-75"})]}),(0,n.jsx)("div",{className:"absolute left-[150px] bottom-[21px] text-foreground-muted z-10 pointer-events-none",children:(0,n.jsx)(em.A,{size:16,className:"text-foreground-light",strokeWidth:1.5,"data-sentry-element":"Pointer","data-sentry-source-file":"TableMenuEmptyState.tsx"})}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsx)("div",{className:"border-l pointer-events-none",children:(0,n.jsxs)("div",{className:(0,ea.cn)("group",(0,er.u2)({isSelected:2===t,isOpened:2===t,isPreview:!1}),"px-4 min-w-40"),"aria-selected":2===t,children:[2===t&&(0,n.jsx)("div",{className:"absolute left-0 h-full w-0.5 bg-foreground"}),(0,n.jsx)(Y.L,{type:"r"}),"postgres_table_".concat(t)]})},"some-".concat(t)))]})})}),ep=()=>{var e,t,s;let{id:I,ref:D}=(0,o.g)(),M=I?Number(I):void 0,z=(0,_.ap)(),{selectedSchema:P,setSelectedSchema:O}=(0,S.k)(),F=(0,c.d)(),[H,W]=(0,l.useState)(""),[B,q]=(0,l.useState)(),[V,$]=(0,l.useState)(Object.values(y.z)),[Q,G]=(0,w.M)("table-editor-sort","alphabetical"),{data:U}=(0,N.YA)(),{data:Y,isLoading:J,isSuccess:K,isError:X,error:Z,hasNextPage:ee,isFetchingNextPage:et,fetchNextPage:es}=(0,j.kD)({projectRef:null==U?void 0:U.ref,connectionString:null==U?void 0:U.connectionString,schemas:[P],search:H.trim()||void 0,sort:Q,filterTypes:V},{keepPreviousData:!!H}),en=(0,l.useMemo)(()=>null==Y?void 0:Y.pages.flatMap(e=>e.data.entities),[null==Y?void 0:Y.pages]),ea=(0,v.SE)(a.aG.TENANT_SQL_ADMIN_WRITE,"tables"),{isSchemaLocked:er,reason:ei}=(0,R.BQ)({schema:P}),{data:el}=(0,b.Pk)({projectRef:null==U?void 0:U.ref,connectionString:null==U?void 0:U.connectionString,id:M}),eo=(0,T.B)(),ec=async e=>{let t=await (0,b.Ap)({id:e,projectRef:D,connectionString:null==U?void 0:U.connectionString});q(t&&(0,u.rH)(t))};return(0,l.useEffect)(()=>{(null==el?void 0:el.schema)&&O(el.schema)},[null==el?void 0:el.schema]),(0,l.useEffect)(()=>{en&&!H&&eo({schemas:[P],entities:en})},[en,H,P,eo]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex flex-col flex-grow gap-5 pt-5 h-full",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-y-1.5",children:[(0,n.jsx)(f.A,{className:"mx-4",selectedSchemaName:P,onSelectSchema:e=>{W(""),O(e)},onSelectCreateSchema:()=>z.onAddSchema(),"data-sentry-element":"SchemaSelector","data-sentry-source-file":"TableEditorMenu.tsx"}),(0,n.jsx)("div",{className:"grid gap-3 mx-4",children:er?(0,n.jsx)(m.i,{size:"sm",schema:P,entity:"table"}):(0,n.jsx)(h.G,{block:!0,title:"Create a new table",name:"New table",disabled:!ea,size:"tiny",icon:(0,n.jsx)(r.A,{size:14,strokeWidth:1.5,className:"text-foreground-muted"}),type:"default",className:"justify-start",onClick:z.onAddTable,tooltip:{content:{side:"bottom",text:ea?void 0:"You need additional permissions to create tables"}},children:"New table"})})]}),(0,n.jsxs)("div",{className:"flex flex-auto flex-col gap-2 pb-4",children:[(0,n.jsxs)(L.a0,{className:"mx-2","data-sentry-element":"InnerSideBarFilters","data-sentry-source-file":"TableEditorMenu.tsx",children:[(0,n.jsx)(L.RK,{autoFocus:!F,name:"search-tables",value:H,placeholder:"Search tables...","aria-labelledby":"Search tables",onChange:e=>W(e.target.value),"data-sentry-element":"InnerSideBarFilterSearchInput","data-sentry-source-file":"TableEditorMenu.tsx",children:(0,n.jsxs)(L.i9,{value:Q,onValueChange:e=>G(e),"data-sentry-element":"InnerSideBarFilterSortDropdown","data-sentry-source-file":"TableEditorMenu.tsx",children:[(0,n.jsx)(L.Pl,{value:"alphabetical",className:"flex gap-2","data-sentry-element":"InnerSideBarFilterSortDropdownItem","data-sentry-source-file":"TableEditorMenu.tsx",children:"Alphabetical"},"alphabetical"),(0,n.jsx)(L.Pl,{value:"grouped-alphabetical","data-sentry-element":"InnerSideBarFilterSortDropdownItem","data-sentry-source-file":"TableEditorMenu.tsx",children:"Entity Type"},"grouped-alphabetical")]})}),(0,n.jsxs)(A.AM,{"data-sentry-element":"Popover_Shadcn_","data-sentry-source-file":"TableEditorMenu.tsx",children:[(0,n.jsx)(A.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"TableEditorMenu.tsx",children:(0,n.jsx)(E.$,{type:5!==V.length?"default":"dashed",className:"h-[32px] md:h-[28px] px-1.5",icon:(0,n.jsx)(i.A,{}),"data-sentry-element":"Button","data-sentry-source-file":"TableEditorMenu.tsx"})}),(0,n.jsx)(A.hl,{className:"p-0 w-56",side:"bottom",align:"center","data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"TableEditorMenu.tsx",children:(0,n.jsxs)("div",{className:"px-3 pt-3 pb-2 flex flex-col gap-y-2",children:[(0,n.jsx)("p",{className:"text-xs",children:"Show entity types"}),(0,n.jsx)("div",{className:"flex flex-col",children:Object.entries(y.z).map(e=>{let[t,s]=e;return(0,n.jsxs)("div",{className:"group flex items-center justify-between py-0.5",children:[(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,n.jsx)(C.S,{id:t,name:t,checked:V.includes(s),onCheckedChange:()=>{V.includes(s)?$(V.filter(e=>e!==s)):$(V.concat([s]))}}),(0,n.jsx)(k.J,{htmlFor:t,className:"capitalize text-xs",children:t.toLowerCase().replace("_"," ")})]}),(0,n.jsx)(E.$,{size:"tiny",type:"default",onClick:()=>$([s]),className:"transition opacity-0 group-hover:opacity-100 h-auto px-1 py-0.5",children:"Select only"})]},t)})})]})})]})]}),J&&(0,n.jsx)(x.A,{}),X&&(0,n.jsx)("div",{className:"mx-4",children:(0,n.jsx)(p.A,{error:null!=Z?Z:null,subject:"Failed to retrieve tables"})}),K&&(0,n.jsxs)(n.Fragment,{children:[0===H.length&&(null!=(e=null==en?void 0:en.length)?e:0)<=0&&(0,n.jsx)(ex,{}),H.length>0&&(null!=(t=null==en?void 0:en.length)?t:0)<=0&&(0,n.jsx)(L.Q5,{className:"mx-2",title:"No results found",description:'Your search for "'.concat(H,'" did not return any results')}),(null!=(s=null==en?void 0:en.length)?s:0)>0&&(0,n.jsx)("div",{className:"flex flex-1 flex-grow","data-testid":"tables-list",children:(0,n.jsx)(g.A,{items:en,ItemComponent:eu,itemProps:{projectRef:null==U?void 0:U.ref,id:Number(M),isSchemaLocked:er,onExportCLI:()=>ec(Number(M))},getItemSize:()=>28,hasNextPage:ee,isLoadingNextPage:et,onLoadNextPage:()=>es()})})]})]})]}),(0,n.jsx)(d.V,{ignoreRoleImpersonation:!0,table:B,open:!!B,onOpenChange:e=>{e||q(void 0)},"data-sentry-element":"ExportDialog","data-sentry-source-file":"TableEditorMenu.tsx"})]})}},24620:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(81915).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},25779:(e,t,s)=>{"use strict";s.d(t,{j:()=>d});var n=s(56947),a=s(23879),r=s(70938),i=s(16703),l=s(74144),o=s(55492);async function c(e,t,s){let{projectRef:n,connectionString:i,schema:l}=e;if(!n)throw Error("projectRef is required");let o=new Headers(s);i&&o.set("x-connection-encrypted",i);let{data:c,error:d}=await (0,r.Jt)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":i,"x-pg-application-name":a.r},path:{ref:n},query:{included_schemas:l||"",excluded_schemas:""}},headers:o,signal:t});return d&&(0,r.H4)(d),c}let d=function(e){let{projectRef:t,connectionString:s,schema:a}=e,{enabled:r=!0,...d}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{data:u}=(0,i.YA)(),m=(null==u?void 0:u.status)===l.BU.ACTIVE_HEALTHY;return(0,n.I)(o.S.list(t,a),e=>{let{signal:n}=e;return c({projectRef:t,connectionString:s,schema:a},n)},{enabled:r&&void 0!==t&&m,...d})}},34763:(e,t,s)=>{"use strict";s.d(t,{A:()=>y});var n=s(80263),a=s(60045),r=s(42872),i=s(24699),l=s(7005),o=s(53239),c=s(15224),d=s(75831),u=s(16703),m=s(22554),x=s(49583),p=s(38112),h=s(51509),g=s(30569),f=s(50033);let y=e=>{let{className:t,disabled:s=!1,size:y="tiny",showError:j=!0,selectedSchemaName:b,supportSelectAll:v=!1,excludedSchemas:w=[],onSelectSchema:S,onSelectCreateSchema:N,portal:R=!0}=e,[_,A]=(0,o.useState)(!1),{can:E}=(0,d.hl)(a.aG.TENANT_SQL_ADMIN_WRITE,"schemas"),{data:C}=(0,u.YA)(),{data:k,isLoading:L,isSuccess:T,isError:I,error:D,refetch:M}=(0,c.w$)({projectRef:null==C?void 0:C.ref,connectionString:null==C?void 0:C.connectionString}),z=(k||[]).filter(e=>!w.includes(e.name)).sort((e,t)=>e.name.localeCompare(t.name));return(0,n.jsxs)("div",{className:t,"data-sentry-component":"SchemaSelector","data-sentry-source-file":"SchemaSelector.tsx",children:[L&&(0,n.jsx)(m.$,{type:"default",className:"w-full [&>span]:w-full",size:y,disabled:!0,children:(0,n.jsx)(x.E,{className:"w-full h-3 bg-foreground-muted"})},"schema-selector-skeleton"),j&&I&&(0,n.jsxs)(p.Fc,{variant:"warning",className:"!px-3 !py-3",children:[(0,n.jsx)(p.XL,{className:"text-xs text-amber-900",children:"Failed to load schemas"}),(0,n.jsxs)(p.TN,{className:"text-xs mb-2 break-words",children:["Error: ",null==D?void 0:D.message]}),(0,n.jsx)(m.$,{type:"default",size:"tiny",onClick:()=>M(),children:"Reload schemas"})]}),T&&(0,n.jsxs)(h.AM,{open:_,onOpenChange:A,modal:!1,children:[(0,n.jsx)(h.Wv,{asChild:!0,children:(0,n.jsx)(m.$,{size:y,disabled:s,type:"default","data-testid":"schema-selector",className:"w-full [&>span]:w-full !pr-1 space-x-1",iconRight:(0,n.jsx)(r.A,{className:"text-foreground-muted",strokeWidth:2,size:14}),children:b?(0,n.jsxs)("div",{className:"w-full flex gap-1",children:[(0,n.jsx)("p",{className:"text-foreground-lighter",children:"schema"}),(0,n.jsx)("p",{className:"text-foreground",children:"*"===b?"All schemas":b})]}):(0,n.jsx)("div",{className:"w-full flex gap-1",children:(0,n.jsx)("p",{className:"text-foreground-lighter",children:"Choose a schemaâ€¦"})})})}),(0,n.jsx)(h.hl,{className:"p-0 min-w-[200px] pointer-events-auto",side:"bottom",align:"start",portal:R,sameWidthAsTrigger:!0,children:(0,n.jsxs)(g.uB,{children:[(0,n.jsx)(g.G7,{placeholder:"Find schema..."}),(0,n.jsxs)(g.oI,{children:[(0,n.jsx)(g.xL,{children:"No schemas found"}),(0,n.jsx)(g.L$,{children:(0,n.jsxs)(f.FK,{className:(z||[]).length>7?"h-[210px]":"",children:[v&&(0,n.jsxs)(g.h_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{S("*"),A(!1)},onClick:()=>{S("*"),A(!1)},children:[(0,n.jsx)("span",{children:"All schemas"}),"*"===b&&(0,n.jsx)(i.A,{className:"text-brand",strokeWidth:2,size:16})]},"select-all"),null==z?void 0:z.map(e=>(0,n.jsxs)(g.h_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{S(e.name),A(!1)},onClick:()=>{S(e.name),A(!1)},children:[(0,n.jsx)("span",{children:e.name}),b===e.name&&(0,n.jsx)(i.A,{className:"text-brand",strokeWidth:2,size:16})]},e.id))]})}),void 0!==N&&E&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g.fx,{}),(0,n.jsx)(g.L$,{children:(0,n.jsxs)(g.h_,{className:"cursor-pointer flex items-center gap-x-2 w-full",onSelect:()=>{N(),A(!1)},onClick:()=>{N(),A(!1)},children:[(0,n.jsx)(l.A,{size:12}),"Create a new schema"]})})]})]})]})})]})]})}},39478:(e,t,s)=>{"use strict";s.d(t,{S:()=>a,t:()=>n});let n=(e,t,s,n,a)=>{let r=(null==n?void 0:n.find(n=>{var r,i;return(null==n||null==(r=n.metadata)?void 0:r.name)===e&&(null==n||null==(i=n.metadata)?void 0:i.schema)===a&&(null==n?void 0:n.name)===t&&s.includes(null==n?void 0:n.level)}))||null;return{hasLint:null!==r,count:+!!r,matchingLint:r}},a=(e,t)=>{if(0===t.length)return"";let s=e.columns.map(e=>'"'.concat(e.name,'"')).join(", "),n=t.map(t=>{let s={...t};"idx"in s&&delete s.idx;let n=Object.entries(s).map(t=>{var s;let[n,a]=t,{dataType:r,format:i}=null!=(s=e.columns.find(e=>e.name===n))?s:{};return null===a?"null":"ARRAY"===r?"'".concat(JSON.stringify(a).replace("[","{").replace(/.$/,"}"),"'"):(null==i?void 0:i.includes("json"))?"".concat(JSON.stringify(a).replace(/\\"/g,'"').replace(/'/g,"''").replace('"',"'").replace(/.$/,"'")):"'".concat(a,"'")});return"(".concat(n.join(", "),")")}).join(", ");return'INSERT INTO "'.concat(e.schema,'"."').concat(e.name,'" (').concat(s,") VALUES ").concat(n,";")}},48095:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(81915).A)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},51502:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(81915).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},61646:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var n=s(80263),a=s(90944),r=s(19335),i=s(22554);let l=e=>{let{section:t}=e,s=(0,r.qM)();return(0,n.jsx)(i.$,{size:"tiny",type:"default",onClick:()=>{t&&s.setActiveDocsSection(t),s.setShowProjectApiDocs(!0)},icon:(0,n.jsx)(a.A,{strokeWidth:1.5,className:"text-foreground-muted"}),"data-sentry-element":"Button","data-sentry-component":"APIDocsButton","data-sentry-source-file":"APIDocsButton.tsx",children:"API Docs"})}},65037:(e,t,s)=>{"use strict";s.d(t,{Jv:()=>ey,RH:()=>ej,Ay:()=>eb});var n=s(80263),a=s(60045),r=s(95137),i=s.n(r),l=s(83759),o=s(37069),c=s(50336),d=s(80949),u=s(93749),m=s.n(u),x=s(53239),p=s(73969),h=s(46491),g=s(98466),f=s(42512),y=s(24620),j=s(13322),b=s(88853);let v=(0,s(81915).A)("MousePointer2",[["path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z",key:"edeuup"}]]);var w=s(39478),S=s(61646),N=s(84558),R=s(25779),_=s(22011),A=s(29512),E=s(91675),C=s(74388),k=s(82819),L=s(86992),T=s(75831),I=s(64084),D=s(52445),M=s(16703),z=s(62308),P=s(49629),O=s(4939),F=s(35741),H=s(22554),W=s(80127),B=s(51509),q=s(87154),V=s(86336),$=s(18587),Q=s(32144),G=s(89057),U=s(94287),Y=s(79980),J=s(50033),K=s(98050),X=s(96827);function Z(e){let{table:t,isAutofixViewSecurityModalOpen:s,setIsAutofixViewSecurityModalOpen:a}=e,{data:r}=(0,M.YA)(),i=(0,Q.jE)(),{isSuccess:l,isLoading:o,data:c}=(0,G.G_)({id:null==t?void 0:t.id,projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString},{enabled:s&&(0,C.b4)(t)}),{mutate:d}=(0,Y.Y)({onSuccess:async()=>{p.oR.success("View security changed successfully"),a(!1),await i.invalidateQueries(U.O.lint(null==r?void 0:r.ref))},onError:e=>{p.oR.error("Failed to autofix view security: ".concat(e.message))}});return(0,C.b4)(t)?(0,n.jsxs)(V.A,{visible:s,size:"xlarge",title:"Confirm autofixing view security",confirmLabel:"Confirm",onCancel:()=>a(!1),onConfirm:()=>(function(){let e='\n	ALTER VIEW "'.concat(t.schema,'"."').concat(t.name,'" SET (security_invoker = on);\n	');d({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,sql:e})})(),"data-sentry-element":"ConfirmationModal","data-sentry-component":"ViewEntityAutofixSecurityModal","data-sentry-source-file":"ViewEntityAutofixSecurityModal.tsx",children:[(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["Setting ",(0,n.jsx)("code",{children:"security_invoker=on"})," ensures the View runs with the permissions of the querying user, reducing the risk of unintended data exposure."]}),(0,n.jsxs)("div",{className:"flex items-center gap-8 mt-8",children:[(0,n.jsxs)("div",{className:" border rounded-md w-1/2",children:[(0,n.jsx)("div",{className:"p-4 pb-0 bg-200 font-mono text-sm font-semibold",children:"Existing query"}),(0,n.jsxs)(J.FK,{className:"h-[225px] px-4 py-2","data-sentry-element":"ScrollArea","data-sentry-source-file":"ViewEntityAutofixSecurityModal.tsx",children:[o&&(0,n.jsx)(X.y,{}),l&&(0,n.jsx)(K.X,{children:"create view ".concat(t.schema,".").concat(t.name," as\n ").concat(c)})]})]}),(0,n.jsxs)("div",{className:" border rounded-md w-1/2",children:[(0,n.jsx)("div",{className:"p-4 pb-0 bg-200 font-mono text-sm font-semibold",children:"Updated query"}),(0,n.jsxs)(J.FK,{className:"h-[225px] px-4 py-2","data-sentry-element":"ScrollArea","data-sentry-source-file":"ViewEntityAutofixSecurityModal.tsx",children:[o&&(0,n.jsx)(X.y,{}),l&&(0,n.jsx)(K.X,{children:"create view ".concat(t.schema,".").concat(t.name," with (security_invoker = on) as\n ").concat(c)})]})]})]})]}):null}let ee=e=>{var t;let{table:s}=e,{ref:r}=(0,h.g)(),{data:i}=(0,M.YA)(),{data:l}=(0,D.s)(),[o,c]=(0,P.ZA)("showWarning",P.cr.withDefault(!1)),{data:d=[]}=(0,E.b)({projectRef:null==i?void 0:i.ref}),u=(0,C.KO)(s),g=(0,C.bL)(s),f=(0,C.eg)(s),Q=(0,C.rW)(s),{realtimeAll:G}=(0,I.x)(["realtime:all"]),{isSchemaLocked:U}=(0,z.BQ)({schema:s.schema}),{mutate:Y}=(0,k.e)({onError:e=>{p.oR.error("Failed to toggle RLS: ".concat(e.message))},onSettled:()=>{eS()}}),[J,K]=(0,x.useState)(!1),[X,ee]=(0,x.useState)(!1),[et,es]=(0,x.useState)(!1),en=0===(0,O.Ir)().selectedRows.size,ea=null==i?void 0:i.ref,{data:er}=(0,R.j)({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString}),ei=(null!=er?er:[]).filter(e=>e.schema===s.schema&&e.table===s.name),{data:el}=(0,_._)({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString}),eo=(null!=el?el:[]).find(e=>"supabase_realtime"===e.name),ec=null!=(t=null==eo?void 0:eo.tables)?t:[],ed=ec.some(e=>e.id===(null==s?void 0:s.id)),{mutate:eu,isLoading:em}=(0,A.H)({onSuccess:()=>{K(!1)},onError:e=>{p.oR.error("Failed to toggle realtime for ".concat(s.name,": ").concat(e.message))}}),{can:ex,isLoading:ep}=(0,T.hl)(a.aG.TENANT_SQL_ADMIN_WRITE,"tables"),{can:eh}=(0,T.hl)(a.aG.TENANT_SQL_ADMIN_WRITE,"columns"),eg="public"===s.schema,{hasLint:ef,matchingLint:ey}=(0,w.t)(s.name,"security_definer_view",["ERROR","WARN"],d,s.schema),{hasLint:ej,matchingLint:eb}=(0,w.t)(s.name,"materialized_view_in_api",["ERROR","WARN"],d,s.schema),{mutate:ev}=(0,L.h)(),ew=async()=>{var e,t;if(!i)return console.error("Project is required");if(!eo)return console.error("Unable to find realtime publication");let n=ec.some(e=>e.id==s.id),a=n?ec.filter(e=>e.id!=s.id).map(e=>"".concat(e.schema,".").concat(e.name)):["".concat(s.schema,".").concat(s.name)].concat(ec.map(e=>"".concat(e.schema,".").concat(e.name)));ev({action:"realtime_toggle_table_clicked",properties:{newState:n?"disabled":"enabled",origin:"tableGridHeader"},groups:{project:null!=(e=null==i?void 0:i.ref)?e:"Unknown",organization:null!=(t=null==l?void 0:l.slug)?t:"Unknown"}}),eu({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString,id:eo.id,tables:a})},eS=()=>{ee(!1)},eN=async()=>{let e={id:s.id,rls_enabled:!(u&&s.rls_enabled)};Y({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString,id:s.id,name:s.name,schema:s.schema,payload:e})};return(0,n.jsxs)("div",{className:"sb-grid-header__inner","data-sentry-component":"GridHeaderActions","data-sentry-source-file":"GridHeaderActions.tsx",children:[en&&(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[!ep&&!ex&&!eh&&(0,n.jsxs)(F.m_,{children:[(0,n.jsx)(F.k$,{asChild:!0,children:(0,n.jsx)("div",{className:"border border-strong rounded bg-overlay-hover px-3 py-1 text-xs",children:"Viewing as read-only"})}),(0,n.jsx)(F.ZI,{side:"bottom",children:"You need additional permissions to manage your project's data"})]}),u&&!U?s.rls_enabled?(0,n.jsx)(n.Fragment,{children:ei.length<1&&!U?(0,n.jsx)(N.G,{asChild:!0,type:"default",className:"group",icon:(0,n.jsx)(y.A,{strokeWidth:1.5,className:"text-foreground-muted"}),tooltip:{content:{side:"bottom",className:"w-[280px]",text:"RLS is enabled for this table, but no policies are set. Select queries may return 0 results."}},children:(0,n.jsx)(m(),{passHref:!0,href:"/project/".concat(ea,"/auth/policies?search=").concat(s.id,"&schema=").concat(s.schema),children:"Add RLS policy"})}):(0,n.jsx)(H.$,{asChild:!0,type:ei.length<1&&!U?"warning":"default",className:"group",icon:U||ei.length>0?(0,n.jsx)("div",{className:(0,W.cn)("flex items-center justify-center rounded-full bg-border-stronger h-[16px]",ei.length>9?" px-1":"w-[16px]",""),children:(0,n.jsx)("span",{className:"text-[11px] text-foreground font-mono text-center",children:ei.length})}):(0,n.jsx)(y.A,{strokeWidth:1.5}),children:(0,n.jsxs)(m(),{passHref:!0,href:"/project/".concat(ea,"/auth/policies?search=").concat(s.id,"&schema=").concat(s.schema),children:["RLS ",ei.length>1?"policies":"policy"]})})}):(0,n.jsxs)(B.AM,{modal:!1,open:o,onOpenChange:c,children:[(0,n.jsx)(B.Wv,{asChild:!0,children:(0,n.jsx)(H.$,{type:"warning",icon:(0,n.jsx)(j.A,{strokeWidth:1.5}),children:"RLS disabled"})}),(0,n.jsxs)(B.hl,{portal:!0,className:"min-w-[395px] text-sm",align:"end",children:[(0,n.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,n.jsx)(j.A,{size:16})," Row Level Security (RLS)"]}),(0,n.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,n.jsx)("p",{children:"You can restrict and control who can read, write and update data in this table using Row Level Security."}),(0,n.jsx)("p",{children:"With RLS enabled, anonymous users will not be able to read/write data in the table."}),!U&&(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)(H.$,{type:"default",onClick:()=>ee(!X),children:"Enable RLS for this table"})})]})]})]}):null,f&&ef&&(0,n.jsxs)(B.AM,{modal:!1,open:o,onOpenChange:c,children:[(0,n.jsx)(B.Wv,{asChild:!0,children:(0,n.jsx)(H.$,{type:"warning",icon:(0,n.jsx)(b.A,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,n.jsxs)(B.hl,{portal:!0,className:"min-w-[395px] text-sm",align:"end",children:[(0,n.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,n.jsx)(b.A,{size:16})," Secure your View"]}),(0,n.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,n.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,n.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,n.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,n.jsx)(H.$,{type:"secondary",onClick:()=>{es(!0)},children:"Autofix"}),(0,n.jsx)(H.$,{type:"default",asChild:!0,children:(0,n.jsx)(m(),{target:"_blank",href:"/project/".concat(r,"/advisors/security?preset=").concat(null==ey?void 0:ey.level,"&id=").concat(null==ey?void 0:ey.cache_key),children:"Learn more"})})]})]})]})]}),Q&&ej&&(0,n.jsxs)(B.AM,{modal:!1,open:o,onOpenChange:c,children:[(0,n.jsx)(B.Wv,{asChild:!0,children:(0,n.jsx)(H.$,{type:"warning",icon:(0,n.jsx)(b.A,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,n.jsxs)(B.hl,{portal:!0,className:"min-w-[395px] text-sm",align:"end",children:[(0,n.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,n.jsx)(b.A,{size:16})," Secure your View"]}),(0,n.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,n.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,n.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)(H.$,{type:"default",asChild:!0,children:(0,n.jsx)(m(),{target:"_blank",href:"/project/".concat(r,"/advisors/security?preset=").concat(null==eb?void 0:eb.level,"&id=").concat(null==eb?void 0:eb.cache_key),children:"Learn more"})})})]})]})]}),g&&"public"===s.schema&&(0,n.jsxs)(B.AM,{modal:!1,open:o,onOpenChange:c,children:[(0,n.jsx)(B.Wv,{asChild:!0,children:(0,n.jsx)(H.$,{type:"warning",icon:(0,n.jsx)(b.A,{strokeWidth:1.5}),children:"Unprotected Data API access"})}),(0,n.jsxs)(B.hl,{portal:!0,className:"min-w-[395px] text-sm",align:"end",children:[(0,n.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,n.jsx)(b.A,{size:16})," Secure Foreign table"]}),(0,n.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,n.jsxs)("p",{children:["Foreign tables do not enforce RLS, which may allow unrestricted access. To secure them, either move foreign tables to a private schema not exposed by PostgREST, or ",(0,n.jsx)("a",{href:"",children:"disable PostgREST access"})," entirely."]}),(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)(H.$,{type:"default",asChild:!0,children:(0,n.jsx)(m(),{target:"_blank",href:"https://supabase.com/docs/guides/database/extensions/wrappers/overview#security",children:"Learn more"})})})]})]})]}),(0,n.jsx)($.g,{serviceRoleLabel:"postgres"}),u&&G&&(0,n.jsxs)(H.$,{type:"default",icon:(0,n.jsx)(v,{strokeWidth:1.5,className:ed?"text-brand":"text-foreground-muted"}),onClick:()=>K(!0),children:["Realtime ",ed?"on":"off"]}),eg&&(0,n.jsx)(S.A,{section:["entities",s.name]})]}),(0,n.jsx)(V.A,{visible:J,loading:em,title:"".concat(ed?"Disable":"Enable"," realtime for ").concat(s.name),confirmLabel:"".concat(ed?"Disable":"Enable"," realtime"),confirmLabelLoading:"".concat(ed?"Disabling":"Enabling"," realtime"),onCancel:()=>K(!1),onConfirm:()=>ew(),"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"GridHeaderActions.tsx",children:(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("p",{className:"text-sm",children:["Once realtime has been ",ed?"disabled":"enabled",", the table will"," ",ed?"no longer ":"","broadcast any changes to authorized subscribers."]}),!ed&&(0,n.jsxs)("p",{className:"text-sm",children:["You may also select which events to broadcast to subscribers on the"," ",(0,n.jsx)(m(),{href:"/project/".concat(r,"/database/publications"),className:"text-brand",children:"database publications"})," ","settings."]})]})}),(0,n.jsx)(Z,{table:s,isAutofixViewSecurityModalOpen:et,setIsAutofixViewSecurityModalOpen:es,"data-sentry-element":"ViewEntityAutofixSecurityModal","data-sentry-source-file":"GridHeaderActions.tsx"}),u&&(0,n.jsx)(q.A,{danger:s.rls_enabled,visible:X,title:"Confirm to enable Row Level Security",description:"Are you sure you want to enable Row Level Security for this table?",buttonLabel:"Enable RLS",buttonLoadingLabel:"Updating",onSelectCancel:eS,onSelectConfirm:eN})]})};var et=s(14875),es=s(101),en=s(25400),ea=s(11509),er=s(64495),ei=s(70979),el=s(57993),eo=s(39119),ec=s(96270),ed=s(78741),eu=s(62527);let em=e=>{let{portal:t=!0}=e,{urlFilters:s,onApplyFilters:a}=(0,g.M)(),r=(0,x.useMemo)(()=>(0,ed.hl)(null!=s?s:[]),[s]);return(0,n.jsx)(eu.b,{portal:t,filters:r,onApplyFilters:a,"data-sentry-element":"FilterPopoverPrimitive","data-sentry-component":"FilterPopover","data-sentry-source-file":"FilterPopover.tsx"})};var ex=s(77191),ep=s.n(ex);let eh=e=>{let{rows:t,columns:s}=e,n=t.map(e=>(Object.keys(e).map(t=>{"object"==typeof e[t]&&null!==e[t]&&(e[t]=JSON.stringify(e[t]))}),e));return ep().unparse(n,{columns:s})};var eg=s(85227);let ef=e=>{var t;let{portal:s=!0}=e,{urlSorts:a,onApplySorts:r}=(0,f.G)(),i=(0,O.Ir)(),l=(null==i||null==(t=i.table)?void 0:t.name)||"",o=(0,x.useMemo)(()=>l&&a?(0,ed.FU)(l,a):[],[l,a]);return(0,n.jsx)(eg.l,{portal:s,sorts:o,onApplySorts:r,"data-sentry-element":"SortPopoverPrimitive","data-sentry-component":"SortPopover","data-sentry-source-file":"SortPopover.tsx"})},ey=5e5,ej=(0,n.jsxs)(n.Fragment,{children:["Sorry! We're unable to support exporting row counts larger than $",ey.toLocaleString()," at the moment. Alternatively, you may consider using",(0,n.jsx)(m(),{href:"https://supabase.com/docs/reference/cli/supabase-db-dump",target:"_blank",children:"pg_dump"})," ","via our CLI instead."]}),eb=e=>{let{customHeader:t}=e,s=(0,O.Ir)();return(0,n.jsx)("div",{"data-sentry-component":"Header","data-sentry-source-file":"Header.tsx",children:(0,n.jsxs)("div",{className:"flex h-10 items-center justify-between bg-dash-sidebar dark:bg-surface-100 px-1.5 py-1.5 gap-2 overflow-x-auto ",children:[t||(s.selectedRows.size>0?(0,n.jsx)(ew,{}):(0,n.jsx)(ev,{})),(0,n.jsx)(ee,{table:s.originalTable,"data-sentry-element":"GridHeaderActions","data-sentry-source-file":"Header.tsx"})]})})},ev=()=>{var e;let{ref:t}=(0,h.g)(),{data:s}=(0,D.s)(),r=(0,O.Ir)(),i=(0,ea.ap)(),{can:d}=(0,T.hl)(a.aG.TENANT_SQL_ADMIN_WRITE,"columns"),{mutate:u}=(0,L.h)(),m=r.editable&&(null!=(e=r.table.columns)?e:[]).length>0?i.onAddRow:void 0,x=r.editable?i.onAddColumn:void 0,p=r.editable?i.onImportData:void 0;return(0,n.jsxs)("div",{className:"flex items-center gap-4","data-sentry-component":"DefaultHeader","data-sentry-source-file":"Header.tsx",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(em,{"data-sentry-element":"FilterPopover","data-sentry-source-file":"Header.tsx"}),(0,n.jsx)(ef,{"data-sentry-element":"SortPopover","data-sentry-source-file":"Header.tsx"})]}),(void 0!==m||void 0!==x)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"h-[20px] w-px border-r border-control"}),(0,n.jsx)("div",{className:"flex items-center gap-2",children:d&&(0,n.jsxs)(er.rI,{children:[(0,n.jsx)(er.ty,{asChild:!0,children:(0,n.jsx)(H.$,{"data-testid":"table-editor-insert-new-row",type:"primary",size:"tiny",icon:(0,n.jsx)(l.A,{strokeWidth:1.5}),children:"Insert"})}),(0,n.jsx)(er.SQ,{side:"bottom",align:"start",children:[...void 0!==m?[(0,n.jsxs)(er._2,{className:"group space-x-2",onClick:m,children:[(0,n.jsxs)("div",{className:"-mt-2 pr-1.5",children:[(0,n.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px]"}),(0,n.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px] my-[2px]"}),(0,n.jsx)("div",{className:(0,W.cn)(["border border-foreground-light w-[15px] h-[4px] translate-x-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-x-0"])})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:"Insert row"}),(0,n.jsxs)("p",{className:"text-foreground-light",children:["Insert a new row into ",r.table.name]})]})]},"add-row")]:[],...void 0!==x?[(0,n.jsxs)(er._2,{className:"group space-x-2",onClick:x,children:[(0,n.jsxs)("div",{className:"flex -mt-2 pr-1.5",children:[(0,n.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px]"}),(0,n.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px] mx-[2px]"}),(0,n.jsx)("div",{className:(0,W.cn)(["border border-foreground-light w-[4px] h-[15px] -translate-y-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-y-0"])})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:"Insert column"}),(0,n.jsxs)("p",{className:"text-foreground-light",children:["Insert a new column into ",r.table.name]})]})]},"add-column")]:[],...void 0!==p?[(0,n.jsxs)(er._2,{className:"group space-x-2",onClick:()=>{var e;p(),u({action:"import_data_button_clicked",properties:{tableType:"Existing Table"},groups:{project:null!=t?t:"Unknown",organization:null!=(e=null==s?void 0:s.slug)?e:"Unknown"}})},children:[(0,n.jsxs)("div",{className:"relative -mt-2",children:[(0,n.jsx)(o.A,{size:18,strokeWidth:1.5,className:"-translate-x-[2px]"}),(0,n.jsx)(c.A,{className:(0,W.cn)("transition duration-200 absolute bottom-0 right-0 translate-y-1 opacity-0 bg-brand-400 rounded-full","group-data-[highlighted]:translate-y-0 group-data-[highlighted]:text-brand group-data-[highlighted]:opacity-100"),strokeWidth:3,size:12})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:"Import data from CSV"}),(0,n.jsx)("p",{className:"text-foreground-light",children:"Insert new rows from a CSV"})]})]},"import-data")]:[]]})]})})]})]})},ew=()=>{var e,t;let{data:s}=(0,M.YA)(),a=(0,ea.ap)(),r=(0,O.Ir)(),o=(0,en.RY)(),c=void 0!==o.role,{filters:u}=(0,g.M)(),{sorts:m}=(0,f.G)(),[h,y]=(0,x.useState)(!1),[j,b]=(0,x.useState)(!1),{data:v}=(0,es.vs)({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString,tableId:r.table.id,sorts:m,filters:u,page:r.page,limit:a.rowsPerPage,roleImpersonationState:o}),{data:S}=(0,et.gt)({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString,tableId:r.table.id,filters:u,enforceExactCount:r.enforceExactCount,roleImpersonationState:o},{keepPreviousData:!0}),R=null!=(e=null==v?void 0:v.rows)?e:[],_=null!=(t=null==S?void 0:S.count)?t:0,A=()=>{r.setSelectedRows(new Set(R.map(e=>e.idx)),!0)},E=e=>{let t=R.filter(e=>r.selectedRows.has(e.idx));if("csv"===e){let e=eh({rows:t,columns:r.table.columns.map(e=>e.name)});(0,ei.l)(e)}else if("sql"===e){let e=(0,w.S)(r.table,t);(0,ei.l)(e)}else"json"===e&&(0,ei.l)(JSON.stringify(t));p.oR.success("Copied rows to clipboard")},C=async()=>{if(y(!0),r.allRowsSelected&&_>ey)return p.oR.error((0,n.jsx)("div",{className:"prose text-sm text-foreground",children:ej})),y(!1);if(!s)return p.oR.error("Project is required"),y(!1);let e=r.allRowsSelected?(0,p.oR)((0,n.jsx)(el.t,{progress:0,message:"Exporting all rows from ".concat(r.table.name)}),{closeButton:!1,duration:1/0}):p.oR.loading("Exporting ".concat(r.selectedRows.size," row").concat(r.selectedRows.size>1?"s":""," from ").concat(r.table.name)),t=r.allRowsSelected?await (0,es.HQ)({projectRef:s.ref,connectionString:s.connectionString,table:r.table,filters:u,sorts:m,roleImpersonationState:o,progressCallback:t=>{let s=Math.min(t/_*100,100);(0,p.oR)((0,n.jsx)(el.t,{progress:s,message:"Exporting all rows from ".concat(r.table.name)}),{id:e,closeButton:!1,duration:1/0})}}):R.filter(e=>r.selectedRows.has(e.idx));if(0===t.length){p.oR.dismiss(e),p.oR.error("Export failed, please try exporting again"),y(!1);return}let a=new Blob([eh({rows:t,columns:r.table.columns.map(e=>e.name)})],{type:"text/csv;charset=utf-8;"});p.oR.success("Downloaded ".concat(t.length," rows as CSV"),{id:e,closeButton:!0,duration:4e3}),i()(a,"".concat(r.table.name,"_rows.csv")),y(!1)},k=async()=>{if(y(!0),r.allRowsSelected&&_>ey)return p.oR.error((0,n.jsx)("div",{className:"prose text-sm text-foreground",children:ej})),y(!1);if(!s)return p.oR.error("Project is required"),y(!1);if(r.allRowsSelected&&0===_)return p.oR.error("Export failed, please try exporting again"),y(!1);let e=r.allRowsSelected?(0,p.oR)((0,n.jsx)(el.t,{progress:0,message:"Exporting all rows from ".concat(r.table.name)}),{closeButton:!1,duration:1/0}):p.oR.loading("Exporting ".concat(r.selectedRows.size," row").concat(r.selectedRows.size>1?"s":""," from ").concat(r.table.name)),t=r.allRowsSelected?await (0,es.HQ)({projectRef:s.ref,connectionString:s.connectionString,table:r.table,filters:u,sorts:m,roleImpersonationState:o,progressCallback:t=>{let s=Math.min(t/_*100,100);(0,p.oR)((0,n.jsx)(el.t,{progress:s,message:"Exporting all rows from ".concat(r.table.name)}),{id:e,closeButton:!1,duration:1/0})}}):R.filter(e=>r.selectedRows.has(e.idx));if(0===t.length){p.oR.error("Export failed, please exporting try again"),y(!1);return}let a=new Blob([(0,w.S)(r.table,t)],{type:"text/sql;charset=utf-8;"});p.oR.success("Downloading ".concat(t.length," rows as SQL"),{id:e,closeButton:!0,duration:4e3}),i()(a,"".concat(r.table.name,"_rows.sql")),y(!1)},L=async()=>{if(!s)return p.oR.error("Project is required");y(!0);let e=p.oR.loading("Exporting ".concat(r.selectedRows.size," row").concat(r.selectedRows.size>1?"s":""," from ").concat(r.table.name)),t=R.filter(e=>r.selectedRows.has(e.idx)),n=new Blob([JSON.stringify(t)],{type:"text/sql;charset=utf-8;"});p.oR.success("Downloading ".concat(t.length," rows as JSON"),{id:e,closeButton:!0,duration:4e3}),i()(n,"".concat(r.table.name,"_rows.json")),y(!1)};return(0,en.sc)(()=>{(r.allRowsSelected||r.selectedRows.size>0)&&r.setSelectedRows(new Set)}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[r.editable&&(0,n.jsx)(N.G,{type:"default",size:"tiny",icon:(0,n.jsx)(d.A,{}),onClick:()=>{let e=r.allRowsSelected?_:r.selectedRows.size,t=Array.from(r.selectedRows),s=R.filter(e=>t.includes(e.idx));a.onDeleteRows(s,{allRowsSelected:r.allRowsSelected,numRows:e,callback:()=>{r.setSelectedRows(new Set)}})},disabled:r.allRowsSelected&&c,tooltip:{content:{side:"bottom",text:r.allRowsSelected&&c?"Table truncation is not supported when impersonating a role":void 0}},children:r.allRowsSelected?"Delete all rows in table":r.selectedRows.size>1?"Delete ".concat(r.selectedRows.size," rows"):"Delete ".concat(r.selectedRows.size," row")}),r.allRowsSelected?(0,n.jsx)(N.G,{disabled:!0,type:"default",tooltip:{content:{side:"bottom",className:"w-64 text-center",text:"Copy to clipboard is not supported while all rows in the table are selected"}},children:"Copy"}):(0,n.jsxs)(er.rI,{children:[(0,n.jsx)(er.ty,{asChild:!0,children:(0,n.jsx)(H.$,{type:"default",size:"tiny",iconRight:(0,n.jsx)(l.A,{}),loading:h,disabled:h,children:"Copy"})}),(0,n.jsxs)(er.SQ,{align:"start",className:"w-40",children:[(0,n.jsx)(er._2,{onClick:()=>E("csv"),children:"Copy as CSV"}),(0,n.jsx)(er._2,{onClick:()=>E("sql"),children:"Copy as SQL"}),(0,n.jsx)(er._2,{onClick:()=>E("json"),children:"Copy as JSON"})]})]}),(0,n.jsxs)(er.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"Header.tsx",children:[(0,n.jsx)(er.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"Header.tsx",children:(0,n.jsx)(H.$,{type:"default",size:"tiny",iconRight:(0,n.jsx)(l.A,{}),loading:h,disabled:h,"data-sentry-element":"Button","data-sentry-source-file":"Header.tsx",children:"Export"})}),(0,n.jsxs)(er.SQ,{align:"start",className:r.allRowsSelected?"w-52":"w-40","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"Header.tsx",children:[(0,n.jsx)(er._2,{onClick:C,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"Header.tsx",children:"Export as CSV"}),(0,n.jsx)(er._2,{onClick:k,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"Header.tsx",children:"Export as SQL"}),r.allRowsSelected?(0,n.jsx)(er._2,{className:"group",onClick:()=>b(!0),children:(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"group-hover:text-foreground",children:"Export via CLI"}),(0,n.jsx)("p",{className:"text-foreground-lighter",children:"Recommended for large tables"})]})}):(0,n.jsx)(er._2,{onClick:L,children:"Export as JSON"})]})]}),!r.allRowsSelected&&_>R.length&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"h-6 ml-0.5",children:(0,n.jsx)(eo.w,{orientation:"vertical"})}),(0,n.jsx)(H.$,{type:"text",onClick:()=>A(),children:"Select all rows in table"})]})]}),(0,n.jsx)(ec.V,{table:r.table,filters:u,sorts:m,open:j,onOpenChange:()=>b(!1),"data-sentry-element":"ExportDialog","data-sentry-source-file":"Header.tsx"})]})}},66933:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var n=s(80263),a=s(37838);let r=e=>{let{resourceText:t,isFullPage:s=!1}=e,r=()=>(0,n.jsx)("div",{className:"block w-full rounded border border-opacity-20 py-4 px-6 border-overlay bg-surface-200","data-sentry-component":"NoPermissionMessage","data-sentry-source-file":"NoPermission.tsx",children:(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)(a.A,{size:20,"data-sentry-element":"AlertCircle","data-sentry-source-file":"NoPermission.tsx"})}),(0,n.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("p",{className:"text-sm",children:["You need additional permissions to ",t]}),(0,n.jsx)("div",{children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Contact your organization owner or administrator for assistance."})})]})})]})});return s?(0,n.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,n.jsx)("div",{className:"w-[550px]",children:(0,n.jsx)(r,{})})}):(0,n.jsx)(r,{})}},78561:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var n=s(80263),a=s(60045),r=s(66933),i=s(75831),l=s(33444);let o=e=>{let{children:t}=e,s=(0,i.Lh)(),o=(0,i.SE)(a.aG.TENANT_SQL_ADMIN_READ,"tables");return s&&!o?(0,n.jsx)(l.S,{isBlocking:!1,children:(0,n.jsx)(r.A,{isFullPage:!0,resourceText:"view tables from this project"})}):t}},86092:(e,t,s)=>{"use strict";s.d(t,{$:()=>c,I:()=>o});var n=s(56947),a=s(20305),r=s(47923),i=s(28175);let l=e=>{let{id:t}=e;return"\n    ".concat(r.n,"\n\n    with table_info as (\n      select \n        n.nspname::text as schema,\n        c.relname::text as name\n      from pg_class c\n      join pg_namespace n on n.oid = c.relnamespace\n      where c.oid = ").concat(t,"\n    )\n    select pg_temp.pg_get_tabledef (\n      t.schema,\n      t.name,\n      false,\n      'FKEYS_INTERNAL',\n      'INCLUDE_TRIGGERS'\n    ) as definition\n    from table_info t;\n  ").trim()};async function o(e,t){let{projectRef:s,connectionString:n,id:r}=e;if(!r)throw Error("id is required");let i=l({id:r}),{result:o}=await (0,a.E)({projectRef:s,connectionString:n,sql:i,queryKey:["table-definition",r]},t);return o[0].definition.trim()}let c=function(e){let{projectRef:t,connectionString:s,id:a}=e,{enabled:r=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.I)(i.c.tableDefinition(t,a),e=>{let{signal:n}=e;return o({projectRef:t,connectionString:s,id:a},n)},{enabled:r&&void 0!==t&&void 0!==a&&!isNaN(a),...l})}},87154:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var n=s(80263),a=s(53239),r=s(33924),i=s(91982),l=s(22554);let o=e=>{let{visible:t=!1,danger:s=!1,title:o="",description:c="",size:d="small",buttonLabel:u="",buttonLoadingLabel:m="",onSelectCancel:x=()=>{},onSelectConfirm:p=()=>{}}=e;(0,a.useEffect)(()=>{t&&g(!1)},[t]);let[h,g]=(0,a.useState)(!1),f=()=>{g(!0),p()};return(0,n.jsx)(r.A,{header:o,visible:t,title:o,description:c,size:d,hideFooter:!0,onCancel:x,"data-sentry-element":"Modal","data-sentry-component":"ConfirmModal","data-sentry-source-file":"ConfirmDialog.tsx",children:(0,n.jsx)(i.A,{initialValues:{},validateOnBlur:!0,onSubmit:()=>f(),validate:()=>[],"data-sentry-element":"Form","data-sentry-source-file":"ConfirmDialog.tsx",children:()=>(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(r.A.Content,{children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(l.$,{block:!0,htmlType:"button",type:"default",onClick:x,disabled:h,children:"Cancel"}),(0,n.jsx)(l.$,{htmlType:"submit",block:!0,type:s?"danger":"primary",disabled:h,loading:h,children:m&&h?m:u||"Confirm"})]})})})})})}},89057:(e,t,s)=>{"use strict";s.d(t,{G_:()=>o});var n=s(56947),a=s(20305),r=s(28175);let i=e=>{let{id:t}=e;if(!t)throw Error("id is required");return"\n    with table_info as (\n      select \n        n.nspname::text as schema,\n        c.relname::text as name,\n        to_regclass(concat('\"', n.nspname, '\".\"', c.relname, '\"')) as regclass\n      from pg_class c\n      join pg_namespace n on n.oid = c.relnamespace\n      where c.oid = ".concat(t,"\n    )\n    select pg_get_viewdef(t.regclass, true) as definition\n    from table_info t\n  ").trim()};async function l(e,t){let{projectRef:s,connectionString:n,id:r}=e,l=i({id:r}),{result:o}=await (0,a.E)({projectRef:s,connectionString:n,sql:l,queryKey:["view-definition",r]},t);return o[0].definition.trim()}let o=function(e){let{projectRef:t,connectionString:s,id:a}=e,{enabled:i=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.I)(r.c.viewDefinition(t,a),e=>{let{signal:n}=e;return l({projectRef:t,connectionString:s,id:a},n)},{enabled:i&&void 0!==t&&void 0!==a&&!isNaN(a),...o})}},95137:function(e,t,s){var n,a;void 0===(a="function"==typeof(n=function(){"use strict";function t(e,t,s){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){l(n.response,t,s)},n.onerror=function(){console.error("could not download file")},n.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function a(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(s){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var r="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof s.g&&s.g.global===s.g?s.g:void 0,i=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=r.saveAs||("object"!=typeof window||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!i?function(e,s,i){var l=r.URL||r.webkitURL,o=document.createElement("a");o.download=s=s||e.name||"download",o.rel="noopener","string"==typeof e?(o.href=e,o.origin===location.origin?a(o):n(o.href)?t(e,s,i):a(o,o.target="_blank")):(o.href=l.createObjectURL(e),setTimeout(function(){l.revokeObjectURL(o.href)},4e4),setTimeout(function(){a(o)},0))}:"msSaveOrOpenBlob"in navigator?function(e,s,r){if(s=s||e.name||"download","string"!=typeof e){var i;navigator.msSaveOrOpenBlob((void 0===(i=r)?i={autoBom:!1}:"object"!=typeof i&&(console.warn("Deprecated: Expected third argument to be a object"),i={autoBom:!i}),i.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\uFEFF",e],{type:e.type}):e),s)}else if(n(e))t(e,s,r);else{var l=document.createElement("a");l.href=e,l.target="_blank",setTimeout(function(){a(l)})}}:function(e,s,n,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return t(e,s,n);var l="application/octet-stream"===e.type,o=/constructor/i.test(r.HTMLElement)||r.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||l&&o||i)&&"undefined"!=typeof FileReader){var d=new FileReader;d.onloadend=function(){var e=d.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=e:location=e,a=null},d.readAsDataURL(e)}else{var u=r.URL||r.webkitURL,m=u.createObjectURL(e);a?a.location=m:location.href=m,a=null,setTimeout(function(){u.revokeObjectURL(m)},4e4)}});r.saveAs=l.saveAs=l,e.exports=l})?n.apply(t,[]):n)||(e.exports=a)},95280:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(81915).A)("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]])},96270:(e,t,s)=>{"use strict";s.d(t,{V:()=>y});var n=s(80263),a=s(53239),r=s(46491),i=s(17252),l=s(52280),o=s(101),c=s(46895),d=s(38319),u=s(25400),m=s(19506),x=s(47134),p=s(1399),h=s(80127),g=s(22554),f=s(50922);let y=e=>{let{table:t,filters:s=[],sorts:y=[],ignoreRoleImpersonation:j=!1,open:b,onOpenChange:v}=e,{ref:w}=(0,r.g)(),S=(0,u.RY)(),[N,R]=(0,a.useState)("csv"),{data:_}=(0,l.Vh)({projectRef:w}),A=(null!=_?_:[]).find(e=>e.identifier===w),E=(0,c.Av)(A||{db_user:"",db_host:"",db_port:"",db_name:""},["db_host","db_name","db_port","db_user","inserted_at"]),{db_host:C,db_port:k,db_user:L,db_name:T}=E,I=(0,i.H)({connectionInfo:E,metadata:{projectRef:w},poolingInfo:{connectionString:"",db_host:"",db_name:"",db_port:0,db_user:""}}),D="".concat(null==t?void 0:t.name,"_rows"),M=t?(0,o.PX)({table:t,sorts:y,filters:s}):void 0,z=M?j?M.toSql():(0,d.Nf)(M.toSql(),S):"",P="\n".concat(I.direct.psql,' -c "COPY (').concat(z,") TO STDOUT WITH CSV HEADER DELIMITER ',';\" > ").concat(D,".csv").trim(),O="\npg_dump -h ".concat(C," -p ").concat(k," -d ").concat(T," -U ").concat(L,' --table="').concat(null==t?void 0:t.schema,".").concat(null==t?void 0:t.name,'" --data-only --column-inserts > ').concat(D,".sql\n  ").trim();return(0,n.jsx)(m.lG,{open:b,onOpenChange:v,"data-sentry-element":"Dialog","data-sentry-component":"ExportDialog","data-sentry-source-file":"ExportDialog.tsx",children:(0,n.jsxs)(m.Cf,{"data-sentry-element":"DialogContent","data-sentry-source-file":"ExportDialog.tsx",children:[(0,n.jsx)(m.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"ExportDialog.tsx",children:(0,n.jsx)(m.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"ExportDialog.tsx",children:"Export table data via CLI"})}),(0,n.jsx)(m.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"ExportDialog.tsx"}),(0,n.jsxs)(m.OO,{className:"flex flex-col gap-y-4","data-sentry-element":"DialogSection","data-sentry-source-file":"ExportDialog.tsx",children:[(0,n.jsxs)("p",{className:"text-sm",children:["We highly recommend using ",(0,n.jsx)("code",{children:"csv"===N?"psql":"pg_dump"})," to export your table data, in particular if your table is relatively large. This can be done via the following command that you can run in your terminal:"]}),(0,n.jsxs)(x.tU,{value:N,onValueChange:R,"data-sentry-element":"Tabs_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:[(0,n.jsxs)(x.j7,{className:"gap-x-3","data-sentry-element":"TabsList_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:[(0,n.jsx)(x.Xi,{value:"csv","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:"As CSV"}),(0,n.jsx)(x.Xi,{value:"sql","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:"As SQL"})]}),(0,n.jsx)(x.av,{value:"csv","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:(0,n.jsx)(p.N,{hideLineNumbers:!0,wrapperClassName:(0,h.cn)("[&_pre]:px-4 [&_pre]:py-3"),language:"bash",value:P,className:"[&_code]:text-[12px] [&_code]:text-foreground","data-sentry-element":"CodeBlock","data-sentry-source-file":"ExportDialog.tsx"})}),(0,n.jsxs)(x.av,{value:"sql","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"ExportDialog.tsx",children:[(0,n.jsx)(p.N,{hideLineNumbers:!0,wrapperClassName:(0,h.cn)("[&_pre]:px-4 [&_pre]:py-3"),language:"bash",value:O,className:"[&_code]:text-[12px] [&_code]:text-foreground","data-sentry-element":"CodeBlock","data-sentry-source-file":"ExportDialog.tsx"}),(0,n.jsx)(f.Z,{type:"note",className:"mt-2",title:"Filters are not supported when exporting as SQL via pg_dump",description:"If you'd like to export as SQL, we recommend creating a view first then exporting the data from there via pg_dump instead","data-sentry-element":"Admonition","data-sentry-source-file":"ExportDialog.tsx"})]})]}),(0,n.jsxs)("p",{className:"text-sm",children:["You will be prompted for your database password, and the output file"," ",(0,n.jsxs)("code",{children:[D,".",N]})," ","will be saved in the current directory that your terminal is in."]}),"sql"===N&&(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["Note: ",(0,n.jsx)("code",{children:"pg_dump"})," needs to match your project's Postgres version. If you run into a server version mismatch error, you will need to update ",(0,n.jsx)("code",{children:"pg_dump"})," ","before running the command."]})]}),(0,n.jsx)(m.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"ExportDialog.tsx",children:(0,n.jsx)(g.$,{type:"default",onClick:()=>v(!1),"data-sentry-element":"Button","data-sentry-source-file":"ExportDialog.tsx",children:"Close"})})]})})}}}]);
try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="52c26755-c405-45c2-ad95-ffd22b6b7e23",e._sentryDebugIdIdentifier="sentry-dbid-52c26755-c405-45c2-ad95-ffd22b6b7e23")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2313],{94442:(e,t,a)=>{a.d(t,{rL:()=>ar,vl:()=>as});var r,s,o,i,n,l,u,p,d,c,m,h,f,y,g=a(24316),v=a(86772),I=a(40989),b=Object.defineProperty,E="AI_NoOutputSpecifiedError",w=`vercel.ai.error.${E}`,T=Symbol.for(w),x=class extends v.bD{constructor({message:e="No output specified."}={}){super({name:E,message:e}),this[r]=!0}static isInstance(e){return v.bD.hasMarker(e,w)}};function S(e){return void 0===e?[]:Array.isArray(e)?e:[e]}r=T;var R="AI_InvalidArgumentError",C=`vercel.ai.error.${R}`,A=Symbol.for(C),N=class extends v.bD{constructor({parameter:e,value:t,message:a}){super({name:R,message:`Invalid argument for parameter ${e}: ${a}`}),this[s]=!0,this.parameter=e,this.value=t}static isInstance(e){return v.bD.hasMarker(e,C)}};s=A;var M="AI_RetryError",k=`vercel.ai.error.${M}`,j=Symbol.for(k),_=class extends v.bD{constructor({message:e,reason:t,errors:a}){super({name:M,message:e}),this[o]=!0,this.reason=t,this.errors=a,this.lastError=a[a.length-1]}static isInstance(e){return v.bD.hasMarker(e,k)}};o=j;var O=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:a=2,abortSignal:r}={})=>async s=>D(s,{maxRetries:e,delayInMs:t,backoffFactor:a,abortSignal:r});async function D(e,{maxRetries:t,delayInMs:a,backoffFactor:r,abortSignal:s},o=[]){try{return await e()}catch(u){if(isAbortError(u)||0===t)throw u;let i=getErrorMessage(u),n=[...o,u],l=n.length;if(l>t)throw new _({message:`Failed after ${l} attempts. Last error: ${i}`,reason:"maxRetriesExceeded",errors:n});if(u instanceof Error&&APICallError.isInstance(u)&&!0===u.isRetryable&&l<=t)return await delay(function({error:e,exponentialBackoffDelay:t}){let a,r=e.responseHeaders;if(!r)return t;let s=r["retry-after-ms"];if(s){let e=parseFloat(s);Number.isNaN(e)||(a=e)}let o=r["retry-after"];if(o&&void 0===a){let e=parseFloat(o);a=Number.isNaN(e)?Date.parse(o)-Date.now():1e3*e}return null!=a&&!Number.isNaN(a)&&0<=a&&(a<6e4||a<t)?a:t}({error:u,exponentialBackoffDelay:a}),{abortSignal:s}),D(e,{maxRetries:t,delayInMs:r*a,backoffFactor:r,abortSignal:s},n);if(1===l)throw u;throw new _({message:`Failed after ${l} attempts with non-retryable error: '${i}'`,reason:"errorNotRetryable",errors:n})}}function Y({maxRetries:e,abortSignal:t}){if(null!=e){if(!Number.isInteger(e))throw new N({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new N({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let a=null!=e?e:2;return{maxRetries:a,retry:O({maxRetries:a,abortSignal:t})}}var P=[{mediaType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mediaType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mediaType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mediaType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mediaType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],$=e=>{let t="string"==typeof e?convertBase64ToUint8Array(e):e,a=(127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9];return t.slice(a+10)},U="AI_DownloadError",F=`vercel.ai.error.${U}`,q=Symbol.for(F),L=class extends v.bD{constructor({url:e,statusCode:t,statusText:a,cause:r,message:s=null==r?`Failed to download ${e}: ${t} ${a}`:`Failed to download ${e}: ${r}`}){super({name:U,message:s,cause:r}),this[i]=!0,this.url=e,this.statusCode=t,this.statusText=a}static isInstance(e){return v.bD.hasMarker(e,F)}};async function B({url:e}){var t;let a=e.toString();try{let e=await fetch(a);if(!e.ok)throw new L({url:a,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mediaType:null!=(t=e.headers.get("content-type"))?t:void 0}}catch(e){if(L.isInstance(e))throw e;throw new L({url:a,cause:e})}}i=q;var J="AI_InvalidDataContentError",K=`vercel.ai.error.${J}`,V=Symbol.for(K);v.bD,n=V;var z=I.KC([I.Yj(),I.Nl(Uint8Array),I.Nl(ArrayBuffer),I.Ie(e=>{var t,a;return null!=(a=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&a},{message:"Must be a Buffer"})]);function G(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if("string"==typeof e)try{e=new URL(e)}catch(e){}if(e instanceof URL&&"data:"===e.protocol){let{mediaType:t,base64Content:a}=function(e){try{let[t,a]=e.split(",");return{mediaType:t.split(";")[0].split(":")[1],base64Content:a}}catch(e){return{mediaType:void 0,base64Content:void 0}}}(e.toString());if(null==t||null==a)throw new AISDKError6({name:"InvalidDataContentError",message:`Invalid data URL format in content ${e.toString()}`});return{data:a,mediaType:t}}return{data:e,mediaType:void 0}}var W="AI_InvalidMessageRoleError",H=`vercel.ai.error.${W}`,Z=Symbol.for(H),Q=class extends v.bD{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:W,message:t}),this[l]=!0,this.role=e}static isInstance(e){return v.bD.hasMarker(e,H)}};async function X({prompt:e,supportedUrls:t,downloadImplementation:a=B}){let r=await ee(e.messages,a,t);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>(function({message:e,downloadedAssets:t}){let a=e.role;switch(a){case"system":return{role:"system",content:e.content,providerOptions:e.providerOptions};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions};return{role:"user",content:e.content.map(e=>(function(e,t){var a;let r;if("text"===e.type)return{type:"text",text:e.text,providerOptions:e.providerOptions};let s=e.type;switch(s){case"image":r=e.image;break;case"file":r=e.data;break;default:throw Error(`Unsupported part type: ${s}`)}let{data:o,mediaType:i}=G(r),n=null!=i?i:e.mediaType,l=o;if(l instanceof URL){let e=t[l.toString()];e&&(l=e.data,null!=n||(n=e.mediaType))}switch(s){case"image":return(l instanceof Uint8Array||"string"==typeof l)&&(n=null!=(a=function({data:e,signatures:t}){let a="string"==typeof e&&e.startsWith("SUQz")||"string"!=typeof e&&e.length>10&&73===e[0]&&68===e[1]&&51===e[2]?$(e):e;for(let e of t)if("string"==typeof a?a.startsWith(e.base64Prefix):a.length>=e.bytesPrefix.length&&e.bytesPrefix.every((e,t)=>a[t]===e))return e.mediaType}({data:l,signatures:P}))?a:n),{type:"file",mediaType:null!=n?n:"image/*",filename:void 0,data:l,providerOptions:e.providerOptions};case"file":if(null==n)throw Error("Media type is missing for file part");return{type:"file",mediaType:n,filename:e.filename,data:l,providerOptions:e.providerOptions}}})(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerOptions:e.providerOptions};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text).map(e=>{let t=e.providerOptions;switch(e.type){case"file":{let{data:a,mediaType:r}=G(e.data);return{type:"file",data:a,filename:e.filename,mediaType:null!=r?r:e.mediaType,providerOptions:t}}case"reasoning":return{type:"reasoning",text:e.text,providerOptions:t};case"text":return{type:"text",text:e.text,providerOptions:t};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:t};case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:t}}}),providerOptions:e.providerOptions};case"tool":return{role:"tool",content:e.content.map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:e.providerOptions})),providerOptions:e.providerOptions};default:throw new Q({role:a})}})({message:e,downloadedAssets:r}))]}async function ee(e,t,a){let r=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).map(e=>{var t;let a=null!=(t=e.mediaType)?t:"image"===e.type?"image/*":void 0,r="image"===e.type?e.image:e.data;if("string"==typeof r)try{r=new URL(r)}catch(e){}return{mediaType:a,data:r}}).filter(e=>e.data instanceof URL&&null!=e.mediaType&&!isUrlSupported({url:e.data.toString(),mediaType:e.mediaType,supportedUrls:a})).map(e=>e.data);return Object.fromEntries((await Promise.all(r.map(async e=>({url:e,data:await t({url:e})})))).map(({url:e,data:t})=>[e.toString(),t]))}function et({maxOutputTokens:e,temperature:t,topP:a,topK:r,presencePenalty:s,frequencyPenalty:o,seed:i,stopSequences:n}){if(null!=e){if(!Number.isInteger(e))throw new N({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be an integer"});if(e<1)throw new N({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new N({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=a&&"number"!=typeof a)throw new N({parameter:"topP",value:a,message:"topP must be a number"});if(null!=r&&"number"!=typeof r)throw new N({parameter:"topK",value:r,message:"topK must be a number"});if(null!=s&&"number"!=typeof s)throw new N({parameter:"presencePenalty",value:s,message:"presencePenalty must be a number"});if(null!=o&&"number"!=typeof o)throw new N({parameter:"frequencyPenalty",value:o,message:"frequencyPenalty must be a number"});if(null!=i&&!Number.isInteger(i))throw new N({parameter:"seed",value:i,message:"seed must be an integer"});return{maxOutputTokens:e,temperature:t,topP:a,topK:r,presencePenalty:s,frequencyPenalty:o,stopSequences:n,seed:i}}function ea({tools:e,toolChoice:t,activeTools:a}){return null!=e&&Object.keys(e).length>0?{tools:(null!=a?Object.entries(e).filter(([e])=>a.includes(e)):Object.entries(e)).map(([e,t])=>{let a=t.type;switch(a){case void 0:case"dynamic":case"function":return{type:"function",name:e,description:t.description,inputSchema:asSchema(t.inputSchema).jsonSchema,providerOptions:t.providerOptions};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw Error(`Unsupported tool type: ${a}`)}}),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}l=Z;var er=Symbol.for("vercel.ai.error.AI_InvalidStreamPartError");v.bD;var es="AI_InvalidToolInputError",eo=`vercel.ai.error.${es}`,ei=Symbol.for(eo),en=class extends v.bD{constructor({toolInput:e,toolName:t,cause:a,message:r=`Invalid input for tool ${t}: ${(0,v.u1)(a)}`}){super({name:es,message:r,cause:a}),this[u]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return v.bD.hasMarker(e,eo)}};u=ei;var el="vercel.ai.error.AI_MCPClientError",eu=Symbol.for(el),ep=class extends v.bD{constructor({name:e="MCPClientError",message:t,cause:a}){super({name:e,message:t,cause:a}),this[p]=!0}static isInstance(e){return v.bD.hasMarker(e,el)}};p=eu;var ed="AI_NoImageGeneratedError",ec=`vercel.ai.error.${ed}`,em=Symbol.for(ec);v.bD,d=em;var eh="AI_NoObjectGeneratedError",ef=`vercel.ai.error.${eh}`,ey=Symbol.for(ef),eg=class extends v.bD{constructor({message:e="No object generated.",cause:t,text:a,response:r,usage:s,finishReason:o}){super({name:eh,message:e,cause:t}),this[c]=!0,this.text=a,this.response=r,this.usage=s,this.finishReason=o}static isInstance(e){return v.bD.hasMarker(e,ef)}};c=ey;var ev="AI_NoSuchToolError",eI=`vercel.ai.error.${ev}`,eb=Symbol.for(eI),eE=class extends v.bD{constructor({toolName:e,availableTools:t,message:a=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:ev,message:a}),this[m]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return v.bD.hasMarker(e,eI)}};m=eb;var ew="AI_ToolCallRepairError",eT=`vercel.ai.error.${ew}`,ex=Symbol.for(eT),eS=class extends v.bD{constructor({cause:e,originalError:t,message:a=`Error repairing tool call: ${(0,v.u1)(e)}`}){super({name:ew,message:a,cause:e}),this[h]=!0,this.originalError=t}static isInstance(e){return v.bD.hasMarker(e,eT)}};h=ex;var eR=class extends v.bD{constructor(e){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},eC="AI_MessageConversionError",eA=`vercel.ai.error.${eC}`,eN=Symbol.for(eA);function eM(e){if("string"!=typeof e){if("v2"!==e.specificationVersion)throw new eR({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});return e}let t=globalThis.AI_SDK_DEFAULT_PROVIDER;return(null!=t?t:gateway).languageModel(e)}v.bD,f=eN;var ek=I.RZ(()=>I.KC([I.ch(),I.Yj(),I.ai(),I.zM(),I.g1(I.Yj(),ek),I.YO(ek)])),ej=I.g1(I.Yj(),I.g1(I.Yj(),ek)),e_=I.Ik({type:I.eu("text"),text:I.Yj(),providerOptions:ej.optional()}),eO=I.Ik({type:I.eu("image"),image:I.KC([z,I.Nl(URL)]),mediaType:I.Yj().optional(),providerOptions:ej.optional()}),eD=I.Ik({type:I.eu("file"),data:I.KC([z,I.Nl(URL)]),filename:I.Yj().optional(),mediaType:I.Yj(),providerOptions:ej.optional()}),eY=I.Ik({type:I.eu("reasoning"),text:I.Yj(),providerOptions:ej.optional()}),eP=I.Ik({type:I.eu("tool-call"),toolCallId:I.Yj(),toolName:I.Yj(),input:I.L5(),providerOptions:ej.optional(),providerExecuted:I.zM().optional()}),e$=I.gM("type",[I.Ik({type:I.eu("text"),value:I.Yj()}),I.Ik({type:I.eu("json"),value:ek}),I.Ik({type:I.eu("error-text"),value:I.Yj()}),I.Ik({type:I.eu("error-json"),value:ek}),I.Ik({type:I.eu("content"),value:I.YO(I.KC([I.Ik({type:I.eu("text"),text:I.Yj()}),I.Ik({type:I.eu("media"),data:I.Yj(),mediaType:I.Yj()})]))})]),eU=I.Ik({type:I.eu("tool-result"),toolCallId:I.Yj(),toolName:I.Yj(),output:e$,providerOptions:ej.optional()}),eF=I.Ik({role:I.eu("system"),content:I.Yj(),providerOptions:ej.optional()}),eq=I.Ik({role:I.eu("user"),content:I.KC([I.Yj(),I.YO(I.KC([e_,eO,eD]))]),providerOptions:ej.optional()}),eL=I.Ik({role:I.eu("assistant"),content:I.KC([I.Yj(),I.YO(I.KC([e_,eD,eY,eP,eU]))]),providerOptions:ej.optional()}),eB=I.Ik({role:I.eu("tool"),content:I.YO(eU),providerOptions:ej.optional()}),eJ=I.KC([eF,eq,eL,eB]);async function eK(e){let t;if(null==e.prompt&&null==e.messages)throw new InvalidPromptError2({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new InvalidPromptError2({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new InvalidPromptError2({prompt:e,message:"system must be a string"});if(null!=e.prompt&&"string"==typeof e.prompt)t=[{role:"user",content:e.prompt}];else if(null!=e.prompt&&Array.isArray(e.prompt))t=e.prompt;else if(null!=e.messages)t=e.messages;else throw new InvalidPromptError2({prompt:e,message:"prompt or messages must be defined"});if(0===t.length)throw new InvalidPromptError2({prompt:e,message:"messages must not be empty"});let a=await safeValidateTypes({value:t,schema:z6.array(eJ)});if(!a.success)throw new InvalidPromptError2({prompt:e,message:"The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.",cause:a.error});return{messages:t,system:e.system}}function eV(e){return GatewayAuthenticationError.isInstance(e)||GatewayModelNotFoundError.isInstance(e)?new AISDKError18({name:"GatewayError",message:"Vercel AI Gateway access failed. If you want to use AI SDK providers directly, use the providers, e.g. @ai-sdk/openai, or register a different global default provider.",cause:e}):e}function ez({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}function eG({model:e,settings:t,telemetry:a,headers:r}){var s;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,a])=>(e[`ai.settings.${t}`]=a,e),{}),...Object.entries(null!=(s=null==a?void 0:a.metadata)?s:{}).reduce((e,[t,a])=>(e[`ai.telemetry.metadata.${t}`]=a,e),{}),...Object.entries(null!=r?r:{}).reduce((e,[t,a])=>(void 0!==a&&(e[`ai.request.headers.${t}`]=a),e),{})}}var eW={startSpan:()=>eH,startActiveSpan:(e,t,a,r)=>"function"==typeof t?t(eH):"function"==typeof a?a(eH):"function"==typeof r?r(eH):void 0},eH={spanContext:()=>eZ,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},eZ={traceId:"",spanId:"",traceFlags:0};function eQ({isEnabled:e=!1,tracer:t}={}){return e?t||trace.getTracer("ai"):eW}function eX({name:e,tracer:t,attributes:a,fn:r,endWhenDone:s=!0}){return t.startActiveSpan(e,{attributes:a},async e=>{try{let t=await r(e);return s&&e.end(),t}catch(t){try{e0(e,t)}finally{e.end()}throw t}})}function e0(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:SpanStatusCode.ERROR,message:t.message})):e.setStatus({code:SpanStatusCode.ERROR})}function e1({telemetry:e,attributes:t}){return(null==e?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((t,[a,r])=>{if(null==r)return t;if("object"==typeof r&&"input"in r&&"function"==typeof r.input){if((null==e?void 0:e.recordInputs)===!1)return t;let s=r.input();return null==s?t:{...t,[a]:s}}if("object"==typeof r&&"output"in r&&"function"==typeof r.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let s=r.output();return null==s?t:{...t,[a]:s}}return{...t,[a]:r}},{})}function e2(e){return JSON.stringify(e.map(e=>({...e,content:"string"==typeof e.content?e.content:e.content.map(e=>{var t;return"file"===e.type?{...e,data:e.data instanceof Uint8Array?"string"==typeof(t=e.data)?t:t instanceof ArrayBuffer?convertUint8ArrayToBase64(new Uint8Array(t)):convertUint8ArrayToBase64(t):e.data}:e})})))}function e4(e,t){return{inputTokens:e6(e.inputTokens,t.inputTokens),outputTokens:e6(e.outputTokens,t.outputTokens),totalTokens:e6(e.totalTokens,t.totalTokens),reasoningTokens:e6(e.reasoningTokens,t.reasoningTokens),cachedInputTokens:e6(e.cachedInputTokens,t.cachedInputTokens)}}function e6(e,t){return null==e&&null==t?void 0:(null!=e?e:0)+(null!=t?t:0)}function e7(e){let t=e.filter(e=>"text"===e.type);if(0!==t.length)return t.map(e=>e.text).join("")}var e8=class{constructor({data:e,mediaType:t}){let a=e instanceof Uint8Array;this.base64Data=a?void 0:e,this.uint8ArrayData=a?e:void 0,this.mediaType=t}get base64(){return null==this.base64Data&&(this.base64Data=(0,g.n_)(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=(0,g.Z9)(this.base64Data)),this.uint8ArrayData}},e5=class extends e8{constructor(e){super(e),this.type="file"}};async function e3({toolCall:e,tools:t,repairToolCall:a,system:r,messages:s}){if(null==t)throw new eE({toolName:e.toolName});try{return await e9({toolCall:e,tools:t})}catch(i){if(null==a||!(eE.isInstance(i)||en.isInstance(i)))throw i;let o=null;try{o=await a({toolCall:e,tools:t,inputSchema:({toolName:e})=>{let{inputSchema:a}=t[e];return asSchema2(a).jsonSchema},system:r,messages:s,error:i})}catch(e){throw new eS({cause:e,originalError:i})}if(null==o)throw i;return await e9({toolCall:o,tools:t})}}async function e9({toolCall:e,tools:t}){let a=e.toolName,r=t[a];if(null==r)throw new eE({toolName:e.toolName,availableTools:Object.keys(t)});let s=asSchema2(r.inputSchema),o=""===e.input.trim()?await safeValidateTypes2({value:{},schema:s}):await safeParseJSON({text:e.input,schema:s});if(!1===o.success)throw new en({toolName:a,toolInput:e.input,cause:o.error});return"dynamic"===r.type?{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:o.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0}:{type:"tool-call",toolCallId:e.toolCallId,toolName:a,input:o.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}var te=class{constructor({content:e,finishReason:t,usage:a,warnings:r,request:s,response:o,providerMetadata:i}){this.content=e,this.finishReason=t,this.usage=a,this.warnings=r,this.request=s,this.response=o,this.providerMetadata=i}get text(){return this.content.filter(e=>"text"===e.type).map(e=>e.text).join("")}get reasoning(){return this.content.filter(e=>"reasoning"===e.type)}get reasoningText(){return 0===this.reasoning.length?void 0:this.reasoning.map(e=>e.text).join("")}get files(){return this.content.filter(e=>"file"===e.type).map(e=>e.file)}get sources(){return this.content.filter(e=>"source"===e.type)}get toolCalls(){return this.content.filter(e=>"tool-call"===e.type)}get staticToolCalls(){return this.toolCalls.filter(e=>!1===e.dynamic)}get dynamicToolCalls(){return this.toolCalls.filter(e=>!0===e.dynamic)}get toolResults(){return this.content.filter(e=>"tool-result"===e.type)}get staticToolResults(){return this.toolResults.filter(e=>!1===e.dynamic)}get dynamicToolResults(){return this.toolResults.filter(e=>!0===e.dynamic)}};async function tt({stopConditions:e,steps:t}){return(await Promise.all(e.map(e=>e({steps:t})))).some(e=>e)}function ta({output:e,tool:t,errorMode:a}){return"text"===a?{type:"error-text",value:getErrorMessage4(e)}:"json"===a?{type:"error-json",value:tr(e)}:(null==t?void 0:t.toModelOutput)?t.toModelOutput(e):"string"==typeof e?{type:"text",value:e}:{type:"json",value:tr(e)}}function tr(e){return void 0===e?null:e}function ts({content:e,tools:t}){let a=[],r=e.filter(e=>"source"!==e.type).filter(e=>("tool-result"!==e.type||e.providerExecuted)&&("tool-error"!==e.type||e.providerExecuted)).filter(e=>"text"!==e.type||e.text.length>0).map(e=>{switch(e.type){case"text":return{type:"text",text:e.text,providerOptions:e.providerMetadata};case"reasoning":return{type:"reasoning",text:e.text,providerOptions:e.providerMetadata};case"file":return{type:"file",data:e.file.base64,mediaType:e.file.mediaType,providerOptions:e.providerMetadata};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:e.providerMetadata};case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:ta({tool:null==t?void 0:t[e.toolName],output:e.output,errorMode:"none"}),providerExecuted:!0,providerOptions:e.providerMetadata};case"tool-error":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:ta({tool:null==t?void 0:t[e.toolName],output:e.error,errorMode:"json"}),providerOptions:e.providerMetadata}}});r.length>0&&a.push({role:"assistant",content:r});let s=e.filter(e=>"tool-result"===e.type||"tool-error"===e.type).filter(e=>!e.providerExecuted).map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:ta({tool:null==t?void 0:t[e.toolName],output:"tool-result"===e.type?e.output:e.error,errorMode:"tool-error"===e.type?"text":"none"})}));return s.length>0&&a.push({role:"tool",content:s}),a}var to=(0,g.hK)({prefix:"aitxt",size:24});async function ti({toolCalls:e,tools:t,tracer:a,telemetry:r,messages:s,abortSignal:o}){return(await Promise.all(e.map(async({toolCallId:e,toolName:i,input:n})=>{let l=t[i];if((null==l?void 0:l.execute)!=null)return eX({name:"ai.toolCall",attributes:e1({telemetry:r,attributes:{...ez({operationId:"ai.toolCall",telemetry:r}),"ai.toolCall.name":i,"ai.toolCall.id":e,"ai.toolCall.args":{output:()=>JSON.stringify(n)}}}),tracer:a,fn:async t=>{try{let a=await l.execute(n,{toolCallId:e,messages:s,abortSignal:o});try{t.setAttributes(e1({telemetry:r,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(a)}}}))}catch(e){}return{type:"tool-result",toolCallId:e,toolName:i,input:n,output:a,dynamic:"dynamic"===l.type}}catch(a){return e0(t,a),{type:"tool-error",toolCallId:e,toolName:i,input:n,error:a,dynamic:"dynamic"===l.type}}}})}))).filter(e=>null!=e)}var tn=class{constructor(e){this.steps=e.steps,this.resolvedOutput=e.resolvedOutput}get finalStep(){return this.steps[this.steps.length-1]}get content(){return this.finalStep.content}get text(){return this.finalStep.text}get files(){return this.finalStep.files}get reasoningText(){return this.finalStep.reasoningText}get reasoning(){return this.finalStep.reasoning}get toolCalls(){return this.finalStep.toolCalls}get staticToolCalls(){return this.finalStep.staticToolCalls}get dynamicToolCalls(){return this.finalStep.dynamicToolCalls}get toolResults(){return this.finalStep.toolResults}get staticToolResults(){return this.finalStep.staticToolResults}get dynamicToolResults(){return this.finalStep.dynamicToolResults}get sources(){return this.finalStep.sources}get finishReason(){return this.finalStep.finishReason}get warnings(){return this.finalStep.warnings}get providerMetadata(){return this.finalStep.providerMetadata}get response(){return this.finalStep.response}get request(){return this.finalStep.request}get usage(){return this.finalStep.usage}get totalUsage(){return this.steps.reduce((e,t)=>e4(e,t.usage),{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0,reasoningTokens:void 0,cachedInputTokens:void 0})}get experimental_output(){if(null==this.resolvedOutput)throw new x;return this.resolvedOutput}};function tl(e){let t=e.filter(e=>"tool-call"===e.type);if(0!==t.length)return t.map(e=>({toolCallId:e.toolCallId,toolName:e.toolName,input:e.input}))}function tu(e,t){let a=new Headers(null!=e?e:{});for(let[e,r]of Object.entries(t))a.has(e)||a.set(e,r);return a}function tp({status:e,statusText:t,headers:a,textStream:r}){return new Response(r.pipeThrough(new TextEncoderStream),{status:null!=e?e:200,statusText:t,headers:tu(a,{"content-type":"text/plain; charset=utf-8"})})}function td({response:e,status:t,statusText:a,headers:r,stream:s}){e.writeHead(null!=t?t:200,a,r);let o=s.getReader();(async()=>{try{for(;;){let{done:t,value:a}=await o.read();if(t)break;e.write(a)}}catch(e){throw e}finally{e.end()}})()}function tc({response:e,status:t,statusText:a,headers:r,textStream:s}){td({response:e,status:t,statusText:a,headers:Object.fromEntries(tu(r,{"content-type":"text/plain; charset=utf-8"}).entries()),stream:s.pipeThrough(new TextEncoderStream)})}var tm=class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue("data: [DONE]\n\n")}})}},th={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"},tf=I.KC([I.re({type:I.eu("text-start"),id:I.Yj(),providerMetadata:ej.optional()}),I.re({type:I.eu("text-delta"),id:I.Yj(),delta:I.Yj(),providerMetadata:ej.optional()}),I.re({type:I.eu("text-end"),id:I.Yj(),providerMetadata:ej.optional()}),I.re({type:I.eu("error"),errorText:I.Yj()}),I.re({type:I.eu("tool-input-start"),toolCallId:I.Yj(),toolName:I.Yj(),providerExecuted:I.zM().optional(),dynamic:I.zM().optional()}),I.re({type:I.eu("tool-input-delta"),toolCallId:I.Yj(),inputTextDelta:I.Yj()}),I.re({type:I.eu("tool-input-available"),toolCallId:I.Yj(),toolName:I.Yj(),input:I.L5(),providerExecuted:I.zM().optional(),providerMetadata:ej.optional(),dynamic:I.zM().optional()}),I.re({type:I.eu("tool-output-available"),toolCallId:I.Yj(),output:I.L5(),providerExecuted:I.zM().optional(),dynamic:I.zM().optional()}),I.re({type:I.eu("tool-output-error"),toolCallId:I.Yj(),errorText:I.Yj(),providerExecuted:I.zM().optional(),dynamic:I.zM().optional()}),I.re({type:I.eu("reasoning"),text:I.Yj(),providerMetadata:ej.optional()}),I.re({type:I.eu("reasoning-start"),id:I.Yj(),providerMetadata:ej.optional()}),I.re({type:I.eu("reasoning-delta"),id:I.Yj(),delta:I.Yj(),providerMetadata:ej.optional()}),I.re({type:I.eu("reasoning-end"),id:I.Yj(),providerMetadata:ej.optional()}),I.re({type:I.eu("reasoning-part-finish")}),I.re({type:I.eu("source-url"),sourceId:I.Yj(),url:I.Yj(),title:I.Yj().optional(),providerMetadata:ej.optional()}),I.re({type:I.eu("source-document"),sourceId:I.Yj(),mediaType:I.Yj(),title:I.Yj(),filename:I.Yj().optional(),providerMetadata:ej.optional()}),I.re({type:I.eu("file"),url:I.Yj(),mediaType:I.Yj(),providerMetadata:ej.optional()}),I.re({type:I.Yj().startsWith("data-"),id:I.Yj().optional(),data:I.L5(),transient:I.zM().optional()}),I.re({type:I.eu("start-step")}),I.re({type:I.eu("finish-step")}),I.re({type:I.eu("start"),messageId:I.Yj().optional(),messageMetadata:I.L5().optional()}),I.re({type:I.eu("finish"),messageMetadata:I.L5().optional()}),I.re({type:I.eu("abort")}),I.re({type:I.eu("message-metadata"),messageMetadata:I.L5()})]);async function ty(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=await (0,g.N8)({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await (0,g.N8)({text:function(e){let t=["ROOT"],a=-1,r=null;function s(e,s,o){switch(e){case'"':a=s,t.pop(),t.push(o),t.push("INSIDE_STRING");break;case"f":case"t":case"n":a=s,r=s,t.pop(),t.push(o),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(o),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=s,t.pop(),t.push(o),t.push("INSIDE_NUMBER");break;case"{":a=s,t.pop(),t.push(o),t.push("INSIDE_OBJECT_START");break;case"[":a=s,t.pop(),t.push(o),t.push("INSIDE_ARRAY_START")}}function o(e,r){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=r,t.pop()}}function i(e,r){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=r,t.pop()}}for(let n=0;n<e.length;n++){let l=e[n];switch(t[t.length-1]){case"ROOT":s(l,n,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":a=n,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":s(l,n,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":o(l,n);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),a=n;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:a=n}break;case"INSIDE_ARRAY_START":"]"===l?(a=n,t.pop()):(a=n,s(l,n,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=n,t.pop();break;default:a=n}break;case"INSIDE_ARRAY_AFTER_COMMA":s(l,n,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),a=n;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=n;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,n),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&o(l,n);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&o(l,n);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,n);break;default:t.pop()}break;case"INSIDE_LITERAL":{let s=e.substring(r,n+1);"false".startsWith(s)||"true".startsWith(s)||"null".startsWith(s)?a=n:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?o(l,n):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,n))}}}let n=e.slice(0,a+1);for(let a=t.length-1;a>=0;a--)switch(t[a]){case"INSIDE_STRING":n+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":n+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":n+="]";break;case"INSIDE_LITERAL":{let t=e.substring(r,e.length);"true".startsWith(t)?n+="true".slice(t.length):"false".startsWith(t)?n+="false".slice(t.length):"null".startsWith(t)&&(n+="null".slice(t.length))}}return n}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}function tg(e){return e.type.startsWith("tool-")}function tv(e){return e.type.split("-").slice(1).join("-")}function tI({lastMessage:e,messageId:t}){return{message:(null==e?void 0:e.role)==="assistant"?e:{id:t,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function tb({stream:e,messageMetadataSchema:t,dataPartSchemas:a,runUpdateMessageJob:r,onError:s,onToolCall:o,onData:i}){return e.pipeThrough(new TransformStream({async transform(e,n){await r(async({state:r,write:l})=>{var u,p,d,c;function m(e){let t=r.message.parts.filter(tg).find(t=>t.toolCallId===e);if(null==t)throw Error("tool-output-error must be preceded by a tool-input-available");return t}function h(e){let t=r.message.parts.filter(e=>"dynamic-tool"===e.type).find(t=>t.toolCallId===e);if(null==t)throw Error("tool-output-error must be preceded by a tool-input-available");return t}function f(e){var t;let a=r.message.parts.find(t=>tg(t)&&t.toolCallId===e.toolCallId);null!=a?(a.state=e.state,a.input=e.input,a.output=e.output,a.errorText=e.errorText,a.providerExecuted=null!=(t=e.providerExecuted)?t:a.providerExecuted,null!=e.providerMetadata&&"input-available"===a.state&&(a.callProviderMetadata=e.providerMetadata)):r.message.parts.push({type:`tool-${e.toolName}`,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,errorText:e.errorText,providerExecuted:e.providerExecuted,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}function y(e){let t=r.message.parts.find(t=>"dynamic-tool"===t.type&&t.toolCallId===e.toolCallId);null!=t?(t.state=e.state,t.toolName=e.toolName,t.input=e.input,t.output=e.output,t.errorText=e.errorText,null!=e.providerMetadata&&"input-available"===t.state&&(t.callProviderMetadata=e.providerMetadata)):r.message.parts.push({type:"dynamic-tool",toolName:e.toolName,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,errorText:e.errorText,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}async function v(e){if(null!=e){let a=null!=r.message.metadata?function e(t,a){if(void 0===t&&void 0===a)return;if(void 0===t)return a;if(void 0===a)return t;let r={...t};for(let s in a)if(Object.prototype.hasOwnProperty.call(a,s)){let o=a[s];if(void 0===o)continue;let i=s in t?t[s]:void 0,n=null!==o&&"object"==typeof o&&!Array.isArray(o)&&!(o instanceof Date)&&!(o instanceof RegExp),l=null!=i&&"object"==typeof i&&!Array.isArray(i)&&!(i instanceof Date)&&!(i instanceof RegExp);n&&l?r[s]=e(i,o):r[s]=o}return r}(r.message.metadata,e):e;null!=t&&await (0,g.k5)({value:a,schema:t}),r.message.metadata=a}}switch(e.type){case"text-start":{let t={type:"text",text:"",providerMetadata:e.providerMetadata,state:"streaming"};r.activeTextParts[e.id]=t,r.message.parts.push(t),l();break}case"text-delta":{let t=r.activeTextParts[e.id];t.text+=e.delta,t.providerMetadata=null!=(u=e.providerMetadata)?u:t.providerMetadata,l();break}case"text-end":{let t=r.activeTextParts[e.id];t.state="done",t.providerMetadata=null!=(p=e.providerMetadata)?p:t.providerMetadata,delete r.activeTextParts[e.id],l();break}case"reasoning-start":{let t={type:"reasoning",text:"",providerMetadata:e.providerMetadata,state:"streaming"};r.activeReasoningParts[e.id]=t,r.message.parts.push(t),l();break}case"reasoning-delta":{let t=r.activeReasoningParts[e.id];t.text+=e.delta,t.providerMetadata=null!=(d=e.providerMetadata)?d:t.providerMetadata,l();break}case"reasoning-end":{let t=r.activeReasoningParts[e.id];t.providerMetadata=null!=(c=e.providerMetadata)?c:t.providerMetadata,t.state="done",delete r.activeReasoningParts[e.id],l();break}case"file":r.message.parts.push({type:"file",mediaType:e.mediaType,url:e.url}),l();break;case"source-url":r.message.parts.push({type:"source-url",sourceId:e.sourceId,url:e.url,title:e.title,providerMetadata:e.providerMetadata}),l();break;case"source-document":r.message.parts.push({type:"source-document",sourceId:e.sourceId,mediaType:e.mediaType,title:e.title,filename:e.filename,providerMetadata:e.providerMetadata}),l();break;case"tool-input-start":{let t=r.message.parts.filter(tg);r.partialToolCalls[e.toolCallId]={text:"",toolName:e.toolName,index:t.length,dynamic:e.dynamic},e.dynamic?y({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0}):f({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0,providerExecuted:e.providerExecuted}),l();break}case"tool-input-delta":{let t=r.partialToolCalls[e.toolCallId];t.text+=e.inputTextDelta;let{value:a}=await ty(t.text);t.dynamic?y({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:a}):f({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:a}),l();break}case"tool-input-available":e.dynamic?y({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerMetadata:e.providerMetadata}):f({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),l(),o&&!e.providerExecuted&&await o({toolCall:e});break;case"tool-output-available":if(e.dynamic){let t=h(e.toolCallId);y({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-available",input:t.input,output:e.output})}else{let t=m(e.toolCallId);f({toolCallId:e.toolCallId,toolName:tv(t),state:"output-available",input:t.input,output:e.output,providerExecuted:e.providerExecuted})}l();break;case"tool-output-error":if(e.dynamic){let t=h(e.toolCallId);y({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-error",input:t.input,errorText:e.errorText})}else{let t=m(e.toolCallId);f({toolCallId:e.toolCallId,toolName:tv(t),state:"output-error",input:t.input,errorText:e.errorText})}l();break;case"start-step":r.message.parts.push({type:"step-start"});break;case"finish-step":r.activeTextParts={},r.activeReasoningParts={};break;case"start":null!=e.messageId&&(r.message.id=e.messageId),await v(e.messageMetadata),(null!=e.messageId||null!=e.messageMetadata)&&l();break;case"finish":case"message-metadata":await v(e.messageMetadata),null!=e.messageMetadata&&l();break;case"error":null==s||s(Error(e.errorText));break;default:if(e.type.startsWith("data-")){if((null==a?void 0:a[e.type])!=null&&await (0,g.k5)({value:e.data,schema:a[e.type]}),e.transient){null==i||i(e);break}let t=null!=e.id?r.message.parts.find(t=>e.type===t.type&&e.id===t.id):void 0;null!=t?t.data=e.data:r.message.parts.push(e),null==i||i(e),l()}}n.enqueue(e)})}}))}function tE(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{let e=t.getReader();return{async next(){let{done:t,value:a}=await e.read();return t?{done:!0,value:void 0}:{done:!1,value:a}}}},t}async function tw({stream:e,onError:t}){let a=e.getReader();try{for(;;){let{done:e}=await a.read();if(e)break}}catch(e){null==t||t(e)}finally{a.releaseLock()}}function tT(){let e,t;return{promise:new Promise((a,r)=>{e=a,t=r}),resolve:e,reject:t}}function tx(){let e=[],t=null,a=!1,r=tT(),s=()=>{a=!0,r.resolve(),e.forEach(e=>e.cancel()),e=[],null==t||t.close()},o=async()=>{if(a&&0===e.length){null==t||t.close();return}if(0===e.length)return r=tT(),await r.promise,o();try{let{value:r,done:s}=await e[0].read();s?(e.shift(),e.length>0?await o():a&&(null==t||t.close())):null==t||t.enqueue(r)}catch(a){null==t||t.error(a),e.shift(),s()}};return{stream:new ReadableStream({start(e){t=e},pull:o,async cancel(){for(let t of e)await t.cancel();e=[],a=!0}}),addStream:t=>{if(a)throw Error("Cannot add inner stream: outer stream is closed");e.push(t.getReader()),r.resolve()},close:()=>{a=!0,r.resolve(),0===e.length&&(null==t||t.close())},terminate:s}}var tS=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise||(this._promise=new Promise((e,t)=>{"resolved"===this.status.type?e(this.status.value):"rejected"===this.status.type&&t(this.status.error),this._resolve=e,this._reject=t})),this._promise}resolve(e){var t;this.status={type:"resolved",value:e},this._promise&&(null==(t=this._resolve)||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this._promise&&(null==(t=this._reject)||t.call(this,e))}};(0,g.hK)({prefix:"aitxt",size:24});var tR={type:"no-schema",jsonSchema:void 0,validatePartialResult:async({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:async(e,t)=>void 0===e?{success:!1,error:new eg({message:"No object generated: response did not match schema.",text:t.text,response:t.response,usage:t.usage,finishReason:t.finishReason})}:{success:!0,value:e},createElementStream(){throw new v.b8({functionality:"element streams in no-schema mode"})}},tC=e=>({type:"object",jsonSchema:e.jsonSchema,validatePartialResult:async({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:async t=>safeValidateTypes3({value:t,schema:e}),createElementStream(){throw new UnsupportedFunctionalityError2({functionality:"element streams in object mode"})}}),tA=e=>{let{$schema:t,...a}=e.jsonSchema;return{type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:a}},required:["elements"],additionalProperties:!1},async validatePartialResult({value:t,latestObject:a,isFirstDelta:r,isFinalDelta:s}){var o;if(!isJSONObject(t)||!isJSONArray(t.elements))return{success:!1,error:new TypeValidationError2({value:t,cause:"value must be an object that contains an array of elements"})};let i=t.elements,n=[];for(let t=0;t<i.length;t++){let a=i[t],r=await safeValidateTypes3({value:a,schema:e});if(t!==i.length-1||s){if(!r.success)return r;n.push(r.value)}}let l=null!=(o=null==a?void 0:a.length)?o:0,u="";return r&&(u+="["),l>0&&(u+=","),u+=n.slice(l).map(e=>JSON.stringify(e)).join(","),s&&(u+="]"),{success:!0,value:{partial:n,textDelta:u}}},async validateFinalResult(t){if(!isJSONObject(t)||!isJSONArray(t.elements))return{success:!1,error:new TypeValidationError2({value:t,cause:"value must be an object that contains an array of elements"})};let a=t.elements;for(let t of a){let a=await safeValidateTypes3({value:t,schema:e});if(!a.success)return a}return{success:!0,value:a}},createElementStream(e){let t=0;return tE(e.pipeThrough(new TransformStream({transform(e,a){switch(e.type){case"object":{let r=e.object;for(;t<r.length;t++)a.enqueue(r[t]);break}case"text-delta":case"finish":case"error":break;default:throw Error(`Unsupported chunk type: ${e}`)}}})))}}},tN=e=>({type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},async validateFinalResult(t){if(!isJSONObject(t)||"string"!=typeof t.result)return{success:!1,error:new TypeValidationError2({value:t,cause:'value must be an object that contains a string in the "result" property.'})};let a=t.result;return e.includes(a)?{success:!0,value:a}:{success:!1,error:new TypeValidationError2({value:t,cause:"value must be a string in the enum"})}},async validatePartialResult({value:t,textDelta:a}){if(!isJSONObject(t)||"string"!=typeof t.result)return{success:!1,error:new TypeValidationError2({value:t,cause:'value must be an object that contains a string in the "result" property.'})};let r=t.result,s=e.filter(e=>e.startsWith(r));return 0===t.result.length||0===s.length?{success:!1,error:new TypeValidationError2({value:t,cause:"value must be a string in the enum"})}:{success:!0,value:{partial:s.length>1?r:s[0],textDelta:a}}},createElementStream(){throw new UnsupportedFunctionalityError2({functionality:"element streams in enum mode"})}});async function tM(e,t,a){let r=await safeParseJSON3({text:e});if(!r.success)throw new eg({message:"No object generated: could not parse the response.",cause:r.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});let s=await t.validateFinalResult(r.value,{text:e,response:a.response,usage:a.usage});if(!s.success)throw new eg({message:"No object generated: response did not match schema.",cause:s.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});return s.value}async function tk(e,t,a,r){try{return await tM(e,t,r)}catch(s){if(null!=a&&eg.isInstance(s)&&(JSONParseError2.isInstance(s.cause)||TypeValidationError3.isInstance(s.cause))){let o=await a({text:e,error:s.cause});if(null===o)throw s;return await tM(o,t,r)}throw s}}function tj(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if("object"!=typeof e&&"object"!=typeof t)return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(!tj(e[a],t[a]))return!1;return!0}let a=Object.keys(e),r=Object.keys(t);if(a.length!==r.length)return!1;for(let s of a)if(!r.includes(s)||!tj(e[s],t[s]))return!1;return!0}(0,g.hK)({prefix:"aiobj",size:24});var t_=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(e){return new Promise((t,a)=>{this.queue.push(async()=>{try{await e(),t()}catch(e){a(e)}}),this.processQueue()})}};(0,g.hK)({prefix:"aiobj",size:24}),v.bD,((e,t)=>{for(var a in t)b(e,a,{get:t[a],enumerable:!0})})({},{object:()=>tD,text:()=>tO});var tO=()=>({type:"text",responseFormat:{type:"text"},parsePartial:async({text:e})=>({partial:e}),parseOutput:async({text:e})=>e}),tD=({schema:e})=>{let t=(0,g.mD)(e);return{type:"object",responseFormat:{type:"json",schema:t.jsonSchema},async parsePartial({text:e}){let t=await ty(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},async parseOutput({text:e},a){let r=await (0,g.N8)({text:e});if(!r.success)throw new eg({message:"No object generated: could not parse the response.",cause:r.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});let s=await (0,g.ZZ)({value:r.value,schema:t});if(!s.success)throw new eg({message:"No object generated: response did not match schema.",cause:s.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});return s.value}}},tY=({model:e,middleware:t,modelId:a,providerId:r})=>S(t).reverse().reduce((e,t)=>tP({model:e,middleware:t,modelId:a,providerId:r}),e),tP=({model:e,middleware:{transformParams:t,wrapGenerate:a,wrapStream:r,overrideProvider:s,overrideModelId:o,overrideSupportedUrls:i},modelId:n,providerId:l})=>{var u,p,d;async function c({params:a,type:r}){return t?await t({params:a,type:r,model:e}):a}return{specificationVersion:"v2",provider:null!=(u=null!=l?l:null==s?void 0:s({model:e}))?u:e.provider,modelId:null!=(p=null!=n?n:null==o?void 0:o({model:e}))?p:e.modelId,supportedUrls:null!=(d=null==i?void 0:i({model:e}))?d:e.supportedUrls,async doGenerate(t){let r=await c({params:t,type:"generate"}),s=async()=>e.doGenerate(r),o=async()=>e.doStream(r);return a?a({doGenerate:s,doStream:o,params:r,model:e}):s()},async doStream(t){let a=await c({params:t,type:"stream"}),s=async()=>e.doGenerate(a),o=async()=>e.doStream(a);return r?r({doGenerate:s,doStream:o,params:a,model:e}):o()}}},t$="AI_NoSuchProviderError",tU=`vercel.ai.error.${t$}`,tF=Symbol.for(tU),tq=class extends v.eM{constructor({modelId:e,modelType:t,providerId:a,availableProviders:r,message:s=`No such provider: ${a} (available providers: ${r.join()})`}){super({errorName:t$,modelId:e,modelType:t,message:s}),this[y]=!0,this.providerId=a,this.availableProviders=r}static isInstance(e){return v.bD.hasMarker(e,tU)}};y=tF;var tL="2025-06-18",tB=[tL,"2025-03-26","2024-11-05"],tJ=I._H({name:I.Yj(),version:I.Yj()}),tK=I._H({_meta:I.lq(I.Ik({}).loose())}),tV=I.Ik({method:I.Yj(),params:I.lq(tK)}),tz=I._H({experimental:I.lq(I.Ik({}).loose()),logging:I.lq(I.Ik({}).loose()),prompts:I.lq(I._H({listChanged:I.lq(I.zM())})),resources:I.lq(I._H({subscribe:I.lq(I.zM()),listChanged:I.lq(I.zM())})),tools:I.lq(I._H({listChanged:I.lq(I.zM())}))}),tG=tK.extend({protocolVersion:I.Yj(),capabilities:tz,serverInfo:tJ,instructions:I.lq(I.Yj())}),tW=tK.extend({nextCursor:I.lq(I.Yj())}),tH=I.Ik({name:I.Yj(),description:I.lq(I.Yj()),inputSchema:I.Ik({type:I.eu("object"),properties:I.lq(I.Ik({}).loose())}).loose()}).loose(),tZ=tW.extend({tools:I.YO(tH)}),tQ=I.Ik({type:I.eu("text"),text:I.Yj()}).loose(),tX=I.Ik({type:I.eu("image"),data:I.K3(),mimeType:I.Yj()}).loose(),t0=I.Ik({uri:I.Yj(),mimeType:I.lq(I.Yj())}).loose(),t1=t0.extend({text:I.Yj()}),t2=t0.extend({blob:I.K3()}),t4=I.Ik({type:I.eu("resource"),resource:I.KC([t1,t2])}).loose(),t6=tK.extend({content:I.YO(I.KC([tQ,tX,t4])),isError:I.zM().default(!1).optional()}).or(tK.extend({toolResult:I.L5()})),t7=I.Ik({jsonrpc:I.eu("2.0"),id:I.KC([I.Yj(),I.ai().int()])}).merge(tV).strict(),t8=I.Ik({jsonrpc:I.eu("2.0"),id:I.KC([I.Yj(),I.ai().int()]),result:tK}).strict(),t5=I.Ik({jsonrpc:I.eu("2.0"),id:I.KC([I.Yj(),I.ai().int()]),error:I.Ik({code:I.ai().int(),message:I.Yj(),data:I.lq(I.L5())})}).strict(),t3=I.Ik({jsonrpc:I.eu("2.0")}).merge(I.Ik({method:I.Yj(),params:I.lq(tK)})).strict(),t9=I.KC([t7,t3,t8,t5]),ae=class{constructor({url:e,headers:t}){this.connected=!1,this.url=new URL(e),this.headers=t}async start(){return new Promise((e,t)=>{if(this.connected)return e();this.abortController=new AbortController,(async()=>{var a,r,s;try{let s=new Headers(this.headers);s.set("Accept","text/event-stream");let o=await fetch(this.url.href,{headers:s,signal:null==(a=this.abortController)?void 0:a.signal});if(!o.ok||!o.body){let e=new ep({message:`MCP SSE Transport Error: ${o.status} ${o.statusText}`});return null==(r=this.onerror)||r.call(this,e),t(e)}let i=o.body.pipeThrough(new TextDecoderStream).pipeThrough(new EventSourceParserStream).getReader(),n=async()=>{var a,r,s;try{for(;;){let{done:t,value:s}=await i.read();if(t){if(this.connected)throw this.connected=!1,new ep({message:"MCP SSE Transport Error: Connection closed unexpectedly"});return}let{event:o,data:n}=s;if("endpoint"===o){if(this.endpoint=new URL(n,this.url),this.endpoint.origin!==this.url.origin)throw new ep({message:`MCP SSE Transport Error: Endpoint origin does not match connection origin: ${this.endpoint.origin}`});this.connected=!0,e()}else if("message"===o)try{let e=t9.parse(JSON.parse(n));null==(a=this.onmessage)||a.call(this,e)}catch(t){let e=new ep({message:"MCP SSE Transport Error: Failed to parse message",cause:t});null==(r=this.onerror)||r.call(this,e)}}}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;null==(s=this.onerror)||s.call(this,e),t(e)}};this.sseConnection={close:()=>i.cancel()},n()}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;null==(s=this.onerror)||s.call(this,e),t(e)}})()})}async close(){var e,t,a;this.connected=!1,null==(e=this.sseConnection)||e.close(),null==(t=this.abortController)||t.abort(),null==(a=this.onclose)||a.call(this)}async send(e){var t,a,r;if(!this.endpoint||!this.connected)throw new ep({message:"MCP SSE Transport Error: Not connected"});try{let r=new Headers(this.headers);r.set("Content-Type","application/json");let s={method:"POST",headers:r,body:JSON.stringify(e),signal:null==(t=this.abortController)?void 0:t.signal},o=await fetch(this.endpoint,s);if(!o.ok){let e=await o.text().catch(()=>null),t=new ep({message:`MCP SSE Transport Error: POSTing to endpoint (HTTP ${o.status}): ${e}`});null==(a=this.onerror)||a.call(this,t);return}}catch(e){null==(r=this.onerror)||r.call(this,e);return}}};v.bD;async function at(e){if(null==e)return[];if(!globalThis.FileList||!(e instanceof globalThis.FileList))throw Error("FileList is not supported in the current environment");return Promise.all(Array.from(e).map(async e=>{let{name:t,type:a}=e;return{type:"file",mediaType:a,filename:t,url:await new Promise((t,a)=>{let r=new FileReader;r.onload=e=>{var a;t(null==(a=e.target)?void 0:a.result)},r.onerror=e=>a(e),r.readAsDataURL(e)})}}))}var aa=class{constructor({api:e="/api/chat",credentials:t,headers:a,body:r,fetch:s,prepareSendMessagesRequest:o,prepareReconnectToStreamRequest:i}){this.api=e,this.credentials=t,this.headers=a,this.body=r,this.fetch=s,this.prepareSendMessagesRequest=o,this.prepareReconnectToStreamRequest=i}async sendMessages({abortSignal:e,...t}){var a,r,s,o,i;let n=await (0,g.hd)(this.body),l=await (0,g.hd)(this.headers),u=await (0,g.hd)(this.credentials),p=await (null==(a=this.prepareSendMessagesRequest)?void 0:a.call(this,{api:this.api,id:t.chatId,messages:t.messages,body:{...n,...t.body},headers:{...l,...t.headers},credentials:u,requestMetadata:t.metadata,trigger:t.trigger,messageId:t.messageId})),d=null!=(r=null==p?void 0:p.api)?r:this.api,c=(null==p?void 0:p.headers)!==void 0?p.headers:{...l,...t.headers},m=(null==p?void 0:p.body)!==void 0?p.body:{...n,...t.body,id:t.chatId,messages:t.messages,trigger:t.trigger,messageId:t.messageId},h=null!=(s=null==p?void 0:p.credentials)?s:u,f=null!=(o=this.fetch)?o:globalThis.fetch,y=await f(d,{method:"POST",headers:{"Content-Type":"application/json",...c},body:JSON.stringify(m),credentials:h,signal:e});if(!y.ok)throw Error(null!=(i=await y.text())?i:"Failed to fetch the chat response.");if(!y.body)throw Error("The response body is empty.");return this.processResponseStream(y.body)}async reconnectToStream(e){var t,a,r,s,o;let i=await (0,g.hd)(this.body),n=await (0,g.hd)(this.headers),l=await (0,g.hd)(this.credentials),u=await (null==(t=this.prepareReconnectToStreamRequest)?void 0:t.call(this,{api:this.api,id:e.chatId,body:{...i,...e.body},headers:{...n,...e.headers},credentials:l,requestMetadata:e.metadata})),p=null!=(a=null==u?void 0:u.api)?a:`${this.api}/${e.chatId}/stream`,d=(null==u?void 0:u.headers)!==void 0?u.headers:{...n,...e.headers},c=null!=(r=null==u?void 0:u.credentials)?r:l,m=null!=(s=this.fetch)?s:globalThis.fetch,h=await m(p,{method:"GET",headers:d,credentials:c});if(204===h.status)return null;if(!h.ok)throw Error(null!=(o=await h.text())?o:"Failed to fetch the chat response.");if(!h.body)throw Error("The response body is empty.");return this.processResponseStream(h.body)}},ar=class extends aa{constructor(e={}){super(e)}processResponseStream(e){return(0,g._Z)({stream:e,schema:tf}).pipeThrough(new TransformStream({async transform(e,t){if(!e.success)throw e.error;t.enqueue(e.value)}}))}},as=class{constructor({generateId:e=g.$C,id:t=e(),transport:a=new ar,messageMetadataSchema:r,dataPartSchemas:s,state:o,onError:i,onToolCall:n,onFinish:l,onData:u,sendAutomaticallyWhen:p}){this.activeResponse=void 0,this.jobExecutor=new t_,this.sendMessage=async(e,t)=>{var a,r,s,o;let i;if(null==e)return void await this.makeRequest({trigger:"submit-message",messageId:null==(a=this.lastMessage)?void 0:a.id,...t});if(i="text"in e||"files"in e?{parts:[...Array.isArray(e.files)?e.files:await at(e.files),..."text"in e&&null!=e.text?[{type:"text",text:e.text}]:[]]}:e,null!=e.messageId){let t=this.state.messages.findIndex(t=>t.id===e.messageId);if(-1===t)throw Error(`message with id ${e.messageId} not found`);if("user"!==this.state.messages[t].role)throw Error(`message with id ${e.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,t+1),this.state.replaceMessage(t,{...i,id:e.messageId,role:null!=(r=i.role)?r:"user",metadata:e.metadata})}else this.state.pushMessage({...i,id:null!=(s=i.id)?s:this.generateId(),role:null!=(o=i.role)?o:"user",metadata:e.metadata});await this.makeRequest({trigger:"submit-message",messageId:e.messageId,...t})},this.regenerate=async({messageId:e,...t}={})=>{let a=null==e?this.state.messages.length-1:this.state.messages.findIndex(t=>t.id===e);if(-1===a)throw Error(`message ${e} not found`);this.state.messages=this.state.messages.slice(0,"assistant"===this.messages[a].role?a:a+1),await this.makeRequest({trigger:"regenerate-message",messageId:e,...t})},this.resumeStream=async(e={})=>{await this.makeRequest({trigger:"resume-stream",...e})},this.clearError=()=>{"error"===this.status&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolResult=async({tool:e,toolCallId:t,output:a})=>this.jobExecutor.run(async()=>{var e,r;let s=this.state.messages,o=s[s.length-1];this.state.replaceMessage(s.length-1,{...o,parts:o.parts.map(e=>tg(e)&&e.toolCallId===t?{...e,state:"output-available",output:a}:e)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(e=>tg(e)&&e.toolCallId===t?{...e,state:"output-available",output:a,errorText:void 0}:e)),"streaming"!==this.status&&"submitted"!==this.status&&(null==(e=this.sendAutomaticallyWhen)?void 0:e.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:null==(r=this.lastMessage)?void 0:r.id})}),this.stop=async()=>{var e;("streaming"===this.status||"submitted"===this.status)&&(null==(e=this.activeResponse)?void 0:e.abortController)&&this.activeResponse.abortController.abort()},this.id=t,this.transport=a,this.generateId=e,this.messageMetadataSchema=r,this.dataPartSchemas=s,this.state=o,this.onError=i,this.onToolCall=n,this.onFinish=l,this.onData=u,this.sendAutomaticallyWhen=p}get status(){return this.state.status}setStatus({status:e,error:t}){this.status!==e&&(this.state.status=e,this.state.error=t)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(e){this.state.messages=e}async makeRequest({trigger:e,metadata:t,headers:a,body:r,messageId:s}){var o,i,n;this.setStatus({status:"submitted",error:void 0});let l=this.lastMessage;try{let i,n={state:tI({lastMessage:this.state.snapshot(l),messageId:this.generateId()}),abortController:new AbortController};if(this.activeResponse=n,"resume-stream"===e){let e=await this.transport.reconnectToStream({chatId:this.id,metadata:t,headers:a,body:r});if(null==e)return void this.setStatus({status:"ready"});i=e}else i=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:n.abortController.signal,metadata:t,headers:a,body:r,trigger:e,messageId:s});await tw({stream:tb({stream:i,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:e=>this.jobExecutor.run(()=>e({state:n.state,write:()=>{var e;this.setStatus({status:"streaming"}),n.state.message.id===(null==(e=this.lastMessage)?void 0:e.id)?this.state.replaceMessage(this.state.messages.length-1,n.state.message):this.state.pushMessage(n.state.message)}})),onError:e=>{throw e}}),onError:e=>{throw e}}),null==(o=this.onFinish)||o.call(this,{message:n.state.message}),this.setStatus({status:"ready"})}catch(e){if("AbortError"===e.name)return this.setStatus({status:"ready"}),null;this.onError&&e instanceof Error&&this.onError(e),this.setStatus({status:"error",error:e})}finally{this.activeResponse=void 0}(null==(i=this.sendAutomaticallyWhen)?void 0:i.call(this,{messages:this.state.messages}))&&await this.makeRequest({trigger:"submit-message",messageId:null==(n=this.lastMessage)?void 0:n.id,metadata:t,headers:a,body:r})}}}}]);
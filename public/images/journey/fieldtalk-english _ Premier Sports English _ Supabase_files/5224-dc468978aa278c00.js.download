try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="b52689c5-439e-4b84-9743-710c142d6148",e._sentryDebugIdIdentifier="sentry-dbid-b52689c5-439e-4b84-9743-710c142d6148")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5224],{9221:(e,t,a)=>{a.d(t,{I:()=>o});var n=a(17702),s=a(70938),r=a(26241),l=a(25934);async function i(e,t){let{projectRef:a,cursor:n,visibility:r,favorite:i,name:o,sort:d}=e;if(void 0===a)throw Error("projectRef is required for getSqlSnippets");let{data:c,error:u}=await (0,s.Jt)("/platform/projects/{ref}/content",{params:{path:{ref:a},query:{type:"sql",cursor:n,visibility:r,favorite:i,name:o,limit:l.c3.toString(),sort_by:d,sort_order:"name"===d?"asc":"desc"}},signal:t});if(u)throw u;return{cursor:c.cursor,contents:c.data}}let o=function(e){let{projectRef:t,sort:a,name:s,visibility:l,favorite:o}=e,{enabled:d=!0,...c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.q)(r.M.sqlSnippets(t,{sort:a,name:s,visibility:l,favorite:o}),e=>{let{signal:n,pageParam:r}=e;return i({projectRef:t,cursor:r,sort:a,name:s,visibility:l,favorite:o},n)},{enabled:d&&void 0!==t,getNextPageParam:e=>e.cursor,...c})}},18187:(e,t,a)=>{a.d(t,{Z:()=>tt});var n=a(80263),s=a(60045),r=a(56404),l=a(46491),i=a(36839),o=a(7005),d=a(24670),c=a(1720),u=a(67908),p=a(53239),m=a(73969),f=a(75831),x=a(59347),h=a(16703),y=a(67285),v=a(19335),g=a(19869),j=a(35741),S=a(64495),b=a(22554),w=a(10021),N=a(21749),M=a(52793),C=a.n(M),q=a(63121),E=a(93749),L=a.n(E),P=a(30382),_=a(33924),Q=a(34106),k=a(1399),I=a(73980),A=a(61684);let D=e=>{var t;let{id:a,...s}=e,r=null==(t=(0,g.aP)().snippets[a])?void 0:t.snippet,l=C()(null==r?void 0:r.name),[i,o]=(0,p.useState)("CLI"),d=[{id:"migration",label:"Migration",title:"Download as migration",description:"Download the snippet in a new migration named `".concat(l,"`"),cli:(0,A.h8)(a,l),npm:(0,A.h8)(a,l,!0)},{id:"seed",label:"Seed file",title:"Download as seed file",description:"If your query consists of sample data, append the snippet to the end of `supabase/seed.sql`",cli:(0,A.mG)(a),npm:(0,A.mG)(a,!0)},{id:"sql",label:"SQL file",title:"Download as SQL file",description:"Download the snippet directly into a new SQL file named `".concat(l,".sql`"),cli:(0,A.xL)(a,l),npm:(0,A.xL)(a,l,!0)}];return(0,n.jsx)(_.A,{hideFooter:!0,showCloseButton:!0,size:"xlarge",header:(0,n.jsx)("p",{children:"Download snippet as local migration file via the Supabase CLI."}),...s,"data-sentry-element":"Modal","data-sentry-component":"DownloadSnippetModal","data-sentry-source-file":"DownloadSnippetModal.tsx",children:(0,n.jsxs)("div",{className:"flex flex-col items-start justify-between gap-4 relative pt-2",children:[(0,n.jsx)(Q.A,{type:"underlined",listClassNames:"pl-5","data-sentry-element":"Tabs","data-sentry-source-file":"DownloadSnippetModal.tsx",children:d.map(e=>(0,n.jsx)(Q.A.Panel,{id:e.id,label:e.label,children:(0,n.jsxs)(_.A.Content,{className:"!py-0",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,n.jsx)("p",{className:"text-base",children:e.title}),(0,n.jsx)(I.o,{className:"text-sm text-scale-1000 [&>p>code]:!break-normal",content:e.description})]}),(0,n.jsx)(P.A,{width:50,options:["CLI","NPM"],activeOption:i,borderOverride:"border-muted",onClickOption:()=>"CLI"===i?o("NPM"):o("CLI")})]}),(0,n.jsx)("pre",{children:(0,n.jsx)(k.N,{language:"bash",className:"language-bash prose dark:prose-dark max-w-none",children:"CLI"===i?e.cli:e.npm})})]})},e.id))}),(0,n.jsxs)(_.A.Content,{className:"w-full flex items-center justify-between pt-0","data-sentry-element":"Modal.Content","data-sentry-source-file":"DownloadSnippetModal.tsx",children:[(0,n.jsx)("p",{className:"text-xs text-lighter",children:"Run this command from your project directory"}),(0,n.jsxs)("div",{className:"flex justify-between items-center gap-x-2",children:[(0,n.jsx)(b.$,{asChild:!0,type:"default",icon:(0,n.jsx)(q.A,{strokeWidth:1.5}),"data-sentry-element":"Button","data-sentry-source-file":"DownloadSnippetModal.tsx",children:(0,n.jsx)(L(),{href:"https://supabase.com/docs/guides/deployment/database-migrations",target:"_blank",rel:"noreferrer","data-sentry-element":"Link","data-sentry-source-file":"DownloadSnippetModal.tsx",children:"About migrations"})}),(0,n.jsx)(b.$,{asChild:!0,type:"default",icon:(0,n.jsx)(q.A,{strokeWidth:1.5}),"data-sentry-element":"Button","data-sentry-source-file":"DownloadSnippetModal.tsx",children:(0,n.jsx)(L(),{href:"https://supabase.com/docs/guides/cli/local-development",target:"_blank",rel:"noreferrer","data-sentry-element":"Link","data-sentry-source-file":"DownloadSnippetModal.tsx",children:"About CLI"})})]})]})]})})};var R=a(72991),F=a(38651),O=a(81257),T=a(26169),z=a(56885),B=a(52445),V=a(45783),W=a(91982),$=a(48192),U=a(15742),G=a(58444);let H=e=>{let{snippet:t={},visible:a,onCancel:s,onComplete:r}=e,{ref:i}=(0,l.g)(),{data:o}=(0,B.s)(),d=(0,g.aP)(),c=(0,V.zv)(),{data:u}=(0,z.j5)({orgSlug:null==o?void 0:o.slug},{enabled:a}),f="sql"===t.type,{data:x}=(0,F.G)({projectRef:i}),h=(0,G.BP)(u)&&(null==x?void 0:x.is_sensitive),{id:y,name:v,description:j}=t,[S,w]=(0,p.useState)(v),[N,M]=(0,p.useState)(j),{mutate:C,isLoading:q}=(0,R.G)({onSuccess:e=>{let{title:t,description:a}=e;w(t),N||M(a)},onError:e=>{m.oR.error("Failed to rename query: ".concat(e.message))}}),E=async()=>{if("content"in t&&f)C({sql:t.content.sql});else try{let{content:e}=await (0,O.Q)({projectRef:i,id:t.id});"sql"in e&&C({sql:e.sql})}catch(e){m.oR.error("Unable to generate title based on query contents")}},{mutateAsync:L}=(0,T.v)(),P=async(e,a)=>{let{setSubmitting:n}=a;if(!i)return console.error("Project ref is required");if(!y)return console.error("Snippet ID is required");n(!0);try{let e=t;"content"in e||(e=await (0,O.Q)({projectRef:i,id:y}),d.addSnippet({projectRef:i,snippet:e})),await L({projectRef:i,payload:{...e,name:S,description:N}}),d.renameSnippet({id:y,name:S,description:N});let a=(0,V.lW)("sql",{id:y});c.updateTab(a,{label:S}),m.oR.success("Successfully renamed snippet!"),r&&r()}catch(e){n(!1),m.oR.error("Failed to rename snippet: ".concat(e.message))}};return(0,p.useEffect)(()=>{w(v),M(j)},[t.id]),(0,n.jsx)(_.A,{visible:a,onCancel:s,hideFooter:!0,header:"Rename",size:"small","data-sentry-element":"Modal","data-sentry-component":"RenameQueryModal","data-sentry-source-file":"RenameQueryModal.tsx",children:(0,n.jsx)(W.A,{onReset:s,validateOnBlur:!0,initialValues:{name:null!=v?v:"",description:null!=j?j:""},validate:()=>{let e={};return S||(e.name="Please enter a query name"),e},onSubmit:P,"data-sentry-element":"Form","data-sentry-source-file":"RenameQueryModal.tsx",children:e=>{let{isSubmitting:t}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(_.A.Content,{className:"space-y-4",children:[(0,n.jsx)($.A,{label:"Name",id:"name",name:"name",value:S,onChange:e=>w(e.target.value)}),(0,n.jsx)("div",{className:"flex w-full justify-end mt-2",children:!h&&(0,n.jsx)(b.$,{type:"default",onClick:()=>E(),size:"tiny",disabled:q,children:(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("div",{className:"scale-75",children:(0,n.jsx)(U.M,{loading:q})}),(0,n.jsx)("span",{children:"Rename with Supabase AI"})]})})}),(0,n.jsx)($.A.TextArea,{label:"Description",id:"description",placeholder:"Describe query",size:"medium",textAreaClassName:"resize-none",value:N,onChange:e=>M(e.target.value)})]}),(0,n.jsx)(_.A.Separator,{}),(0,n.jsxs)(_.A.Content,{className:"flex items-center justify-end gap-2",children:[(0,n.jsx)(b.$,{htmlType:"reset",type:"default",onClick:s,disabled:t,children:"Cancel"}),(0,n.jsx)(b.$,{htmlType:"submit",loading:t,disabled:t,children:"Rename query"})]})]})}})})};var J=a(56947),K=a(70938),Y=a(26241);async function Z(e,t){let{projectRef:a,cumulative:n,type:s,name:r}=e;if(void 0===a)throw Error("projectRef is required");let{data:l,error:i}=await (0,K.Jt)("/platform/projects/{ref}/content/count",{params:{path:{ref:a},query:{...s&&{type:s},...r&&{name:r}}},...n?{}:{headers:{Version:"2"}},signal:t});if(i)throw(0,K.H4)(i);return l}let X=function(e){let{projectRef:t,cumulative:a,type:n,name:s}=e,{enabled:r=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,J.I)(Y.M.count(t,n,{cumulative:a,name:s}),e=>{let{signal:r}=e;return Z({projectRef:t,cumulative:a,type:n,name:s},r)},{enabled:r&&void 0!==t,...l})};var ee=a(17702);async function et(e,t){let{projectRef:a,type:n,name:s,limit:r=10,sort:l,cursor:i}=e;if(void 0===a)throw Error("projectRef is required for getContent");let{data:o,error:d}=await (0,K.Jt)("/platform/projects/{ref}/content",{params:{path:{ref:a},query:{type:n,name:s,sort_by:l,limit:r.toString(),cursor:i}},signal:t});return d&&(0,K.H4)(d),{cursor:o.cursor,content:o.data}}let ea=function(e){let{projectRef:t,type:a,name:n,limit:s,sort:r}=e,{enabled:l=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,ee.q)(Y.M.infiniteList(t,{type:a,name:n,limit:s,sort:r}),e=>{let{signal:l,pageParam:i}=e;return et({projectRef:t,type:a,name:n,limit:s,sort:r,cursor:i},l)},{enabled:l&&void 0!==t,getNextPageParam:e=>e.cursor,...i})};var en=a(25934),es=a(68872),er=a(96827),el=a(25134),ei=a(86336);let eo=e=>{var t,a;let{snippets:s,visible:r,onClose:i}=e,o=(0,u.useRouter)(),{ref:d,id:c}=(0,l.g)(),p=(0,V.zv)(),f=(0,g.aP)(),x=e=>{if(c&&e.includes(c)){let e=p.openTabs.filter(e=>e.startsWith("sql-")&&!e.includes(c));if(e.length>0){let t=e[0].split("sql-")[1];o.push("/project/".concat(d,"/sql/").concat(t))}else o.push("/project/".concat(d,"/sql/new"))}e.length>0&&e.forEach(e=>f.removeSnippet(e))},{mutate:h,isLoading:y}=(0,el.$)({onSuccess:e=>{m.oR.success("Successfully deleted ".concat(s.length.toLocaleString()," quer").concat(s.length>1?"ies":"y"));let t=e.map(e=>(0,V.lW)("sql",{id:e}));p.removeTabs(t),x(e),i()},onError:(e,t)=>{e.message.includes("Contents not found")?(x(t.ids),i()):m.oR.error("Failed to delete query: ".concat(e.message))}});return(0,n.jsx)(ei.A,{size:"small",visible:r,title:"Confirm to delete ".concat(1===s.length?"query":"".concat(s.length.toLocaleString()," quer").concat(s.length>1?"ies":"y")),confirmLabel:"Delete ".concat(s.length.toLocaleString()," quer").concat(s.length>1?"ies":"y"),confirmLabelLoading:"Deleting query",loading:y,variant:"destructive",onCancel:i,onConfirm:()=>{if(!d)return console.error("Project ref is required");h({projectRef:d,ids:s.map(e=>e.id)})},alert:(null==(t=s[0])?void 0:t.visibility)==="project"?{title:"This SQL snippet will be lost forever",description:"Deleting this query will remove it for all members of the project team."}:void 0,"data-sentry-element":"ConfirmationModal","data-sentry-component":"DeleteSnippetsModal","data-sentry-source-file":"DeleteSnippetsModal.tsx",children:(0,n.jsxs)("p",{className:"text-sm",children:["This action cannot be undone."," ",1===s.length?"Are you sure you want to delete '".concat(null==(a=s[0])?void 0:a.name,"'?"):"Are you sure you want to delete the selected ".concat(s.length," quer").concat(s.length>1?"ies":"y","?")]})})},ed={id:0,name:"",parent:null,children:[]},ec=e=>{var t,a;if(void 0===e)return[ed];let{folders:n,contents:s}=e,r=(null==n?void 0:n.map(e=>{var t;let{id:a,name:n}=e;return{id:a,name:n,parent:0,isBranch:!0,children:null!=(t=null==s?void 0:s.filter(e=>e.folder_id===a).map(e=>e.id))?t:[],metadata:e}}))||[],l=(null==s?void 0:s.map(e=>{let{id:t,name:a,folder_id:n}=e;return{id:t,name:a,parent:null!=n?n:0,children:[],metadata:e}}))||[];return[{id:0,name:"",parent:null,children:[...null==(t=n||[])?void 0:t.map(e=>e.id),...null==(a=(s||[]).filter(e=>!e.folder_id))?void 0:a.map(e=>e.id)]},...r,...l]};function eu(e){let t=new Set,a=e.filter(e=>0===e.parent);if(a.length>0){let e=a[a.length-1];"string"==typeof e.id&&t.add(e.id),a.forEach(e=>{if(e.children.length>0){let a=e.children[e.children.length-1];"string"==typeof a&&t.add(a)}})}return t}var ep=a(96196),em=a(80949),ef=a(84163),ex=a(25344),eh=a(13322),ey=a(50960),ev=a(14375),eg=a(35485),ej=a(82463);async function eS(e,t){let{projectRef:a,folderId:n,cursor:s,sort:r,name:l}=e;if(void 0===a)throw Error("projectRef is required");if(void 0===n)throw Error("folderId is required");let{data:i,error:o}=await (0,K.Jt)("/platform/projects/{ref}/content/folders/{id}",{params:{path:{ref:a,id:n},query:{cursor:s,limit:en.c3.toString(),sort_by:r,sort_order:"name"===r?"asc":"desc",name:l}},signal:t});return o&&(0,K.H4)(o),{...i.data,cursor:i.cursor}}let eb=function(e){let{projectRef:t,folderId:a,name:n,sort:s}=e,{enabled:r=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,ee.q)(Y.M.folderContents(t,a,{name:n,sort:s}),e=>{let{signal:r,pageParam:l}=e;return eS({projectRef:t,folderId:a,cursor:l,name:n,sort:s},r)},{enabled:r&&void 0!==t&&void 0!==a,getNextPageParam:e=>e.cursor,...l})};var ew=a(60276),eN=a(12737),eM=a(65789),eC=a(80127);let eq=e=>{let{element:t,isBranch:a,isExpanded:r,level:i,status:d,isSelected:c,isMultiSelected:m,getNodeProps:x,onSelectCreate:v,onSelectDelete:j,onSelectRename:S,onSelectMove:w,onSelectShare:N,onSelectUnshare:M,onSelectDownload:C,onEditSave:E,onMultiSelect:P,isLastItem:_,hasNextPage:Q,fetchNextPage:k,isFetchingNextPage:I,sort:D,name:R,onFolderContentsChange:F,...T}=e,z=(0,u.useRouter)(),{id:B,ref:V}=(0,ej.g)(),{profile:W}=(0,y.xc)(),{data:$}=(0,h.YA)(),{className:U,onClick:G}=x(),H=(0,g.aP)(),J=(null==W?void 0:W.id)===(null==t?void 0:t.metadata.owner_id),K="project"===t.metadata.visibility,Y=t.metadata.favorite,Z="editing"===d,{can:X}=(0,f.hl)(s.aG.CREATE,"user_content",{resource:{type:"sql",owner_id:null==W?void 0:W.id},subject:{id:null==W?void 0:W.id}}),ee=0===t.parent?void 0:t.parent,et=a&&r,{data:ea,isSuccess:en,isLoading:er,isFetchingNextPage:el,hasNextPage:ei,fetchNextPage:eo,isPreviousData:ed,isFetching:ec}=eb({projectRef:V,folderId:null!=ee?ee:t.id,name:R,sort:D},{enabled:et,keepPreviousData:!0});(0,p.useEffect)(()=>{V&&en&&ea.pages.forEach(e=>{var t;null==(t=e.contents)||t.forEach(e=>{H.addSnippet({projectRef:V,snippet:e})})})},[V,null==ea?void 0:ea.pages]);let eu=(0,ew.A)(F);(0,p.useEffect)(()=>{if(et){var e;null==(e=eu.current)||e.call(eu,{isLoading:er||ed&&ec,snippets:null==ea?void 0:ea.pages.flatMap(e=>{var t;return null!=(t=e.contents)?t:[]})})}},[null==ea?void 0:ea.pages,ec,er,ed,et]);let eS=void 0!==ee,eq=()=>{let e=t.metadata.id;e&&(Y?H.removeFavorite(e):H.addFavorite(e))},eE=async()=>{if(!W)return console.error("Profile is required");if(!$)return console.error("Project is required");if(!V)return console.error("Project ref is required");if(!B)return console.error("Snippet ID is required");let e=t.metadata,a="";if(e.content&&e.content.sql)a=e.content.sql;else{let{content:t}=await (0,O.Q)({projectRef:V,id:e.id});"sql"in t&&(a=t.sql)}let n=(0,A.fW)({id:(0,eN.A)(),name:"".concat(e.name," (Duplicate)"),sql:a,owner_id:null==W?void 0:W.id,project_id:null==$?void 0:$.id});H.addSnippet({projectRef:V,snippet:n}),H.addNeedsSaving(n.id),z.push("/project/".concat(V,"/sql/").concat(n.id))};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(eM.tz,{modal:!1,"data-sentry-element":"ContextMenu_Shadcn_","data-sentry-source-file":"SQLEditorTreeViewItem.tsx",children:[(0,n.jsx)(eM.Rc,{asChild:!0,"data-sentry-element":"ContextMenuTrigger_Shadcn_","data-sentry-source-file":"SQLEditorTreeViewItem.tsx",children:(0,n.jsx)(es.Z7,{className:U,level:i,isExpanded:r,isBranch:a,isSelected:c,isPreview:T.isPreview,isEditing:Z,isLoading:et&&er||"saving"===d,onEditSubmit:e=>{void 0!==E&&E(e)},onClick:e=>{a?Z||G(e):e.shiftKey&&"new"!==B?null==P||P(t.id):z.push("/project/".concat(V,"/sql/").concat(t.id))},...T,name:t.name,xPadding:16,"data-sentry-element":"TreeViewItem","data-sentry-source-file":"SQLEditorTreeViewItem.tsx"})}),(0,n.jsx)(eM.Ip,{onCloseAutoFocus:e=>e.stopPropagation(),"data-sentry-element":"ContextMenuContent_Shadcn_","data-sentry-source-file":"SQLEditorTreeViewItem.tsx",children:a?(0,n.jsxs)(n.Fragment,{children:[void 0!==v&&(0,n.jsxs)(eM.kt,{className:"gap-x-2",onSelect:()=>v(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(o.A,{size:14}),"Create new snippet"]}),void 0!==S&&J&&(0,n.jsxs)(eM.kt,{className:"gap-x-2",onSelect:()=>S(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(ep.A,{size:14}),"Rename folder"]}),void 0!==j&&J&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eM.K5,{}),(0,n.jsxs)(eM.kt,{className:"gap-x-2",onSelect:()=>j(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(em.A,{size:14}),"Delete folder"]})]})]}):m?(0,n.jsxs)(n.Fragment,{children:[void 0!==w&&(0,n.jsxs)(eM.kt,{className:"gap-x-2",onSelect:()=>w(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(ef.A,{size:14}),"Move selected queries"]}),(0,n.jsx)(eM.K5,{}),void 0!==j&&(0,n.jsxs)(eM.kt,{className:"gap-x-2",onSelect:()=>j(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(em.A,{size:14}),"Delete selected queries"]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eM.kt,{asChild:!0,className:"gap-x-2",onFocusCapture:e=>e.stopPropagation(),children:(0,n.jsxs)(L(),{target:"_self",rel:"noreferrer",href:"/project/".concat(V,"/sql/").concat(t.id),children:[(0,n.jsx)(q.A,{size:14}),"Open in new tab"]})}),(0,n.jsx)(eM.K5,{}),void 0!==S&&J&&(0,n.jsxs)(eM.kt,{className:"gap-x-2",onSelect:()=>S(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(ep.A,{size:14}),"Rename query"]}),void 0!==w&&J&&(0,n.jsxs)(eM.kt,{className:"gap-x-2",onSelect:()=>w(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(ef.A,{size:14}),"Move query"]}),void 0!==N&&!K&&X&&(0,n.jsxs)(eM.kt,{className:"gap-x-2",onSelect:()=>N(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(ex.A,{size:14}),"Share query with team"]}),void 0!==M&&K&&J&&(0,n.jsxs)(eM.kt,{className:"gap-x-2",onSelect:()=>M(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(eh.A,{size:14}),"Unshare query with team"]}),void 0!==eE&&X&&(0,n.jsxs)(eM.kt,{className:"gap-x-2",onSelect:()=>eE(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(ey.A,{size:14}),"Duplicate query"]}),(0,n.jsxs)(eM.kt,{className:"gap-x-2",onSelect:()=>eq(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(ev.A,{size:14,className:(0,eC.cn)(Y?"fill-brand stroke-none":"fill-none stroke-foreground-light")}),Y?"Remove from":"Add to"," favorites"]}),void 0!==C&&l.pe&&(0,n.jsxs)(eM.kt,{className:"gap-x-2",onSelect:()=>C(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(eg.A,{size:14}),"Download as migration file"]}),void 0!==j&&J&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eM.K5,{}),(0,n.jsxs)(eM.kt,{className:"gap-x-2",onSelect:()=>j(),children:[(0,n.jsx)(em.A,{size:14}),"Delete query"]})]})]})})]}),(eS?ei:Q)&&"string"==typeof t.id&&_&&(0,n.jsx)("div",{className:"px-4 py-1",style:{paddingLeft:!t.isBranch&&t.level>1?48*(t.level-1):void 0},children:(0,n.jsx)(b.$,{type:"outline",size:"tiny",block:!0,loading:eS?el:I,disabled:eS?el:I,onClick:function(){eS?eo():"function"==typeof k&&k()},children:"Load More"})})]})};var eE=a(10426),eL=a(88853);let eP=e=>{let{snippet:t,onClose:a,onSuccess:s}=e,{ref:r}=(0,l.g)(),i=(0,g.aP)(),{mutate:o,isLoading:d}=(0,T.v)({onError:e=>{m.oR.error("Failed to update query: ".concat(e.message))}}),c=async()=>{var e;if(!r)return console.error("Project ref is required");if(!t)return console.error("Snippet ID is required");let n=i.snippets[t.id],l=null==n||null==(e=n.snippet)?void 0:e.content;if(void 0===l){let{content:e}=await (0,O.Q)({projectRef:r,id:t.id});l=e}if(void 0===l)return m.oR.error("Unable to update snippet visibility: Content is missing");o({projectRef:r,payload:{...t,visibility:"project",folder_id:null,content:l}},{onSuccess:()=>{i.updateSnippet({id:t.id,snippet:{visibility:"project",folder_id:null},skipSave:!0}),m.oR.success("Snippet is now shared to the project"),null==s||s(),a()}})};return(0,n.jsx)(ei.A,{size:"medium",loading:d,title:"Confirm to share query: ".concat(null==t?void 0:t.name),confirmLabel:"Share query",confirmLabelLoading:"Sharing query",visible:void 0!==t,onCancel:()=>a(),onConfirm:()=>c(),alert:{title:"This SQL query will become public to all team members",description:"Anyone with access to the project can view it"},"data-sentry-element":"ConfirmationModal","data-sentry-component":"ShareSnippetModal","data-sentry-source-file":"ShareSnippetModal.tsx",children:(0,n.jsxs)("ul",{className:"text-sm text-foreground-light space-y-5",children:[(0,n.jsxs)("li",{className:"flex gap-3 items-center",children:[(0,n.jsx)(eE.A,{size:16,"data-sentry-element":"Eye","data-sentry-source-file":"ShareSnippetModal.tsx"}),(0,n.jsx)("span",{children:"Project members will have read-only access to this query."})]}),(0,n.jsxs)("li",{className:"flex gap-3 items-center",children:[(0,n.jsx)(eL.A,{size:16,"data-sentry-element":"Unlock","data-sentry-source-file":"ShareSnippetModal.tsx"}),(0,n.jsx)("span",{children:"Anyone will be able to duplicate it to their personal snippets."})]})]})})};var e_=a(93102);let eQ=e=>{let{snippet:t,onClose:a,onSuccess:s}=e,{ref:r}=(0,l.g)(),i=(0,g.aP)(),{mutate:o,isLoading:d}=(0,T.v)({onError:e=>{m.oR.error("Failed to update query: ".concat(e.message))}}),c=async()=>{var e;if(!r)return console.error("Project ref is required");if(!t)return console.error("Snippet ID is required");let n=i.snippets[t.id],l=null==n||null==(e=n.snippet)?void 0:e.content;if(void 0===l){let{content:e}=await (0,O.Q)({projectRef:r,id:t.id});l=e}if(void 0===l)return m.oR.error("Unable to update snippet visibility: Content is missing");o({projectRef:r,payload:{...t,visibility:"user",folder_id:null,content:l}},{onSuccess:()=>{i.updateSnippet({id:t.id,snippet:{visibility:"user",folder_id:null},skipSave:!0}),m.oR.success("Snippet is now unshared from the project"),null==s||s(),a()}})};return(0,n.jsx)(ei.A,{size:"medium",title:"Confirm to unshare query: ".concat(null==t?void 0:t.name),confirmLabel:"Unshare query",confirmLabelLoading:"Unsharing query",visible:void 0!==t,onCancel:()=>a(),onConfirm:()=>c(),alert:{title:"This SQL query will no longer be public to all team members",description:"Only you will have access to this query"},"data-sentry-element":"ConfirmationModal","data-sentry-component":"UnshareSnippetModal","data-sentry-source-file":"UnshareSnippetModal.tsx",children:(0,n.jsx)("ul",{className:"text-sm text-foreground-light space-y-5",children:(0,n.jsxs)("li",{className:"flex gap-3",children:[(0,n.jsx)(e_.A,{"data-sentry-element":"EyeOffIcon","data-sentry-source-file":"UnshareSnippetModal.tsx"}),(0,n.jsx)("span",{children:"Project members will no longer be able to view this query."})]})})})},ek=e=>{var t,a;let{search:s}=e,{id:r}=(0,l.g)(),i=(0,V.zv)(),{ref:o}=(0,l.g)(),[d,c]=(0,p.useState)(),[u,m]=(0,p.useState)(),[f,x]=(0,p.useState)(),[h,y]=(0,p.useState)(),[v,g]=(0,p.useState)(),{data:j,isLoading:S,hasNextPage:b,fetchNextPage:w,isFetchingNextPage:M}=ea({projectRef:o,type:"sql",limit:en.c3,name:0===s.length?void 0:s},{keepPreviousData:!0}),{data:C,isLoading:q}=X({projectRef:o,cumulative:!0,type:"sql",name:s},{keepPreviousData:!0}),E=null!=(t=null==C?void 0:C.count)?t:0,L=ec({folders:[],contents:(0,p.useMemo)(()=>null==j?void 0:j.pages.flatMap(e=>e.content),[null==j?void 0:j.pages])}),P=(0,p.useMemo)(()=>eu(L),[L]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex flex-col flex-grow",children:[q?(0,n.jsx)("div",{className:"px-4 py-1 pb-2.5",children:(0,n.jsx)(N.A,{className:"animate-spin",size:14})}):C?(0,n.jsxs)("p",{className:"px-4 pb-2 text-sm text-foreground-lighter",children:[E," result",E>1?"s":""," found"]}):null,S?(0,n.jsxs)("div",{className:"px-4 flex flex-col gap-y-1",children:[(0,n.jsx)(er.A,{className:"py-2.5"}),(0,n.jsx)(er.A,{className:"py-2.5 w-5/6"}),(0,n.jsx)(er.A,{className:"py-2.5 w-3/4"})]}):(0,n.jsx)(es.GS,{multiSelect:!0,togglableSelect:!0,clickAction:"EXCLUSIVE_SELECT",data:L,"aria-label":"private-snippets",nodeRenderer:e=>{var t,a,s,l;let{element:o,...d}=e,u=Object.values(i.tabsMap).some(e=>{var t,a;return(null==(t=e.metadata)?void 0:t.sqlId)===(null==(a=o.metadata)?void 0:a.id)}),p=(0,V.lW)("sql",{id:null==o||null==(t=o.metadata)?void 0:t.id}),f=i.previewTabId===p,h=!f&&(null==(a=o.metadata)?void 0:a.id)===r,v=(null==(s=o.metadata)?void 0:s.visibility)==="user"?"Private":(null==(l=o.metadata)?void 0:l.visibility)==="project"?"Shared":void 0;return(0,n.jsx)(eq,{...d,element:{...o,name:(0,n.jsxs)("span",{className:"flex flex-col py-0.5",children:[(0,n.jsx)("span",{title:o.name,className:"truncate",children:o.name}),!!v&&(0,n.jsx)("span",{title:v,className:"text-foreground-lighter text-xs",children:v})]})},isOpened:u&&!f,isSelected:h,isPreview:f,isLastItem:P.has(o.id),status:"idle",className:"items-start h-[40px] [&>svg]:translate-y-0.5",onSelectDelete:()=>g(o.metadata),onSelectRename:()=>y(o.metadata),onSelectDownload:()=>x(o.metadata),onSelectShare:()=>c(o.metadata),onSelectUnshare:()=>m(o.metadata),hasNextPage:b,fetchNextPage:w,isFetchingNextPage:M,onDoubleClick:e=>{e.preventDefault(),i.makeTabPermanent(p)}})}})]}),(0,n.jsx)(eP,{snippet:d,onClose:()=>c(void 0),"data-sentry-element":"ShareSnippetModal","data-sentry-source-file":"SearchList.tsx"}),(0,n.jsx)(eQ,{snippet:u,onClose:()=>m(void 0),"data-sentry-element":"UnshareSnippetModal","data-sentry-source-file":"SearchList.tsx"}),(0,n.jsx)(D,{id:null!=(a=null==f?void 0:f.id)?a:"",visible:void 0!==f,onCancel:()=>x(void 0),"data-sentry-element":"DownloadSnippetModal","data-sentry-source-file":"SearchList.tsx"}),(0,n.jsx)(H,{snippet:h,visible:!!h,onCancel:()=>y(void 0),onComplete:()=>y(void 0),"data-sentry-element":"RenameQueryModal","data-sentry-source-file":"SearchList.tsx"}),(0,n.jsx)(eo,{visible:!!v,snippets:v?[v]:[],onClose:()=>g(void 0),"data-sentry-element":"DeleteSnippetsModal","data-sentry-source-file":"SearchList.tsx"})]})};var eI=a(32981),eA=a(90944),eD=a(24699),eR=a(87494),eF=a(10663),eO=a(38035),eT=a(19506),ez=a(20704),eB=a(77376),eV=a(51509),eW=a(30569),e$=a(50033),eU=a(20838);let eG=e=>{var t;let{visible:a,snippets:s=[],onClose:r}=e,{ref:i}=(0,l.g)(),d=(0,g.aP)(),[c,u]=(0,p.useState)(!1),[f,x]=(0,p.useState)(),{mutateAsync:h,isLoading:y}=(0,eO.W)(),{mutateAsync:v,isLoading:j}=(0,T.v)({onError:e=>{m.oR.error("Failed to move query: ".concat(e.message))}}),S="new-folder"===f?eF.Ik({name:eF.Yj().min(1,"Please provide a name for the folder")}).refine(e=>!d.allFolderNames.includes(e.name),{message:"This folder name already exists",path:["name"]}):eF.Ik({}),w=(0,eR.mN)({mode:"onSubmit",reValidateMode:"onSubmit",resolver:(0,eI.u)(S),defaultValues:{name:""}}),N=(0,g.mD)(i),M="root"===f?"Root of the editor":"new-folder"===f?"Create a new folder":null==(t=N.find(e=>e.id===f))?void 0:t.name,C=1===s.length&&(!s[0].folder_id&&"root"===f||s[0].folder_id===f),q=1===s.length&&(!s[0].folder_id&&"root"===f||s[0].folder_id===f),E=async e=>{if(!i)return console.error("Project ref is required");try{let t=f;if("new-folder"===f&&"name"in e){let{id:a}=await h({projectRef:i,name:e.name});t=a}await Promise.all(s.map(async e=>{let a=null==e?void 0:e.content;if(void 0===a){let{content:t}=await (0,O.Q)({projectRef:i,id:e.id});"sql"in t&&(a=t)}if(void 0===a)return m.oR.error("Failed to save snippet: Unable to retrieve snippet contents");await v({projectRef:i,payload:{id:e.id,type:"sql",name:e.name,description:e.description,visibility:e.visibility,project_id:e.project_id,owner_id:e.owner_id,folder_id:"root"===f?null:t,content:a}})})),m.oR.success("Successfully moved ".concat(1===s.length?'"'.concat(s[0].name,'"'):"".concat(s.length," snippets")," to ").concat("root"===f?"the root of the editor":M)),s.forEach(e=>{d.updateSnippet({id:e.id,snippet:{...e,folder_id:"root"===f?null:t},skipSave:!0})}),r()}catch(e){m.oR.error("Failed to create new folder: ".concat(e.message))}};return(0,p.useEffect)(()=>{if(a&&void 0!==s){if(1===s.length){var e;x(null!=(e=s[0].folder_id)?e:"root")}else x("root");w.reset({name:""})}},[a,s]),(0,n.jsx)(eT.lG,{open:a,onOpenChange:()=>r(),"data-sentry-element":"Dialog","data-sentry-component":"MoveQueryModal","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,n.jsx)(eT.Cf,{"data-sentry-element":"DialogContent","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,n.jsx)(ez.lV,{...w,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,n.jsxs)("form",{id:"move-snippet",onSubmit:w.handleSubmit(E),children:[(0,n.jsxs)(eT.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsxs)(eT.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"MoveQueryModal.tsx",children:["Move ",1===s.length?'"'.concat(s[0].name,'"'):"".concat(s.length)," ","snippet",s.length>1?"s":""," to a folder"]}),(0,n.jsxs)(eT.rr,{"data-sentry-element":"DialogDescription","data-sentry-source-file":"MoveQueryModal.tsx",children:["Select which folder to move your quer",s.length>1?"ies":"y"," to"]})]}),(0,n.jsx)(eT.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"MoveQueryModal.tsx"}),(0,n.jsxs)(eT.OO,{className:"py-5 flex flex-col gap-y-4","data-sentry-element":"DialogSection","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,n.jsx)(eB.J,{className:"text-foreground-light","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:"Select a folder"}),(0,n.jsxs)(eV.AM,{open:c,onOpenChange:u,modal:!1,"data-sentry-element":"Popover_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsx)(eV.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,n.jsx)(b.$,{block:!0,size:"small",type:"default",className:"pr-2 justify-between",iconRight:(0,n.jsx)(eA.A,{className:"text-foreground-light rotate-90",strokeWidth:2,size:12}),"data-sentry-element":"Button","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[M,C&&" (Current)"]})})}),(0,n.jsx)(eV.hl,{className:"p-0",side:"bottom",align:"start",sameWidthAsTrigger:!0,"data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,n.jsxs)(eW.uB,{"data-sentry-element":"Command_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsx)(eW.G7,{placeholder:"Find folder...","data-sentry-element":"CommandInput_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx"}),(0,n.jsxs)(eW.oI,{"data-sentry-element":"CommandList_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsx)(eW.xL,{"data-sentry-element":"CommandEmpty_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:"No folders found"}),(0,n.jsx)(eW.L$,{"data-sentry-element":"CommandGroup_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,n.jsxs)(e$.FK,{className:(N||[]).length>6?"h-[210px]":"","data-sentry-element":"ScrollArea","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsxs)(eW.h_,{value:"root",className:"cursor-pointer w-full justify-between",onSelect:()=>{u(!1),x("root")},onClick:()=>{u(!1),x("root")},"data-sentry-element":"CommandItem_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsxs)("span",{children:["Root of the editor",1===s.length&&null===s[0].folder_id&&" (Current)"]}),"root"===f&&(0,n.jsx)(eD.A,{size:14})]},"root"),null==N?void 0:N.map(e=>(0,n.jsxs)(eW.h_,{value:e.name,className:"cursor-pointer w-full justify-between",onSelect:()=>{u(!1),x(e.id)},onClick:()=>{u(!1),x(e.id)},children:[(0,n.jsxs)("span",{children:[e.name,1===s.length&&s[0].folder_id===e.id&&" (Current)"]}),e.id===f&&(0,n.jsx)(eD.A,{size:14})]},e.id))]})}),(0,n.jsx)(eW.fx,{"data-sentry-element":"CommandSeparator_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx"}),(0,n.jsx)(eW.L$,{"data-sentry-element":"CommandGroup_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,n.jsxs)(eW.h_,{className:"cursor-pointer w-full justify-start gap-x-2",onSelect:e=>{u(!1),x("new-folder")},onClick:()=>{u(!1),x("new-folder")},"data-sentry-element":"CommandItem_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsx)(o.A,{size:14,strokeWidth:1.5,"data-sentry-element":"Plus","data-sentry-source-file":"MoveQueryModal.tsx"}),(0,n.jsx)("p",{children:"New folder"})]})})]})]})})]})]}),"new-folder"===f&&(0,n.jsx)("div",{className:"flex flex-col gap-y-2",children:(0,n.jsx)(ez.zB,{name:"name",control:w.control,render:e=>{let{field:t}=e;return(0,n.jsxs)(ez.eI,{className:"flex flex-col gap-y-2",children:[(0,n.jsx)(ez.lR,{children:"Provide a name for your new folder"}),(0,n.jsx)(ez.MJ,{children:(0,n.jsx)(eU.p,{autoFocus:!0,...t,autoComplete:"off",disabled:j||y})}),(0,n.jsx)(ez.C5,{})]})}})})]}),(0,n.jsxs)(eT.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsx)(b.$,{type:"default",disabled:j||y,onClick:()=>r(),"data-sentry-element":"Button","data-sentry-source-file":"MoveQueryModal.tsx",children:"Cancel"}),(0,n.jsx)(b.$,{type:"primary",htmlType:"submit",disabled:q,loading:j||y,"data-sentry-element":"Button","data-sentry-source-file":"MoveQueryModal.tsx",children:"Move file"})]})]})})})})};var eH=a(23172),eJ=a(12326);let eK=()=>(0,n.jsx)(w.Q5,{title:"No private queries created yet",description:"Queries will be automatically saved once you start writing in the editor",className:"mx-4","data-sentry-element":"InnerSideBarEmptyPanel","data-sentry-component":"EmptyPrivateQueriesPanel","data-sentry-source-file":"PrivateSqlSnippetEmpty.tsx",children:(0,n.jsx)("div",{className:"top-0 left-6 flex flex-col opacity-50 cursor-not-allowed bg-dash-sidebar h-content -mb-7 pointer-events-none scale-75",children:(0,n.jsxs)("div",{className:"relative h-content",children:[(0,n.jsxs)("div",{className:"absolute inset-0 pointer-events-none z-10",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-transparent from-80% to-100% to-background-surface-100 dark:to-background-surface-75"}),(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent from-50% to-100% to-background-surface-100 dark:to-background-surface-75"})]}),(0,n.jsx)("div",{className:"absolute left-[128px] bottom-[21px] text-foreground-muted z-10 pointer-events-none",children:(0,n.jsx)(eJ.A,{size:16,className:"text-foreground-light",strokeWidth:1.5,"data-sentry-element":"Pointer","data-sentry-source-file":"PrivateSqlSnippetEmpty.tsx"})}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsx)("div",{className:"border-l pointer-events-none",children:(0,n.jsx)(es.Z7,{isSelected:2===t,id:"dummy-".concat(t+1),name:"dummy_query_".concat(t+1),level:1,xPadding:16})},"dummy-".concat(t+1)))]})})});var eY=a(99199),eZ=a(12111),eX=a(32144),e0=a(80251);async function e1(e,t){let{projectRef:a,ids:n}=e,{data:s,error:r}=await (0,K.yH)("/platform/projects/{ref}/content/folders",{params:{path:{ref:a},query:{ids:n}},signal:t});if(r)throw(0,K.H4)(r);return s}let e2=function(){let{onError:e,onSuccess:t,invalidateQueriesOnSuccess:a=!0,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eX.jE)();return(0,e0.n)(e=>e1(e),{async onSuccess(e,n,r){let{projectRef:l}=n;a&&await s.invalidateQueries(Y.M.folders(l)),await (null==t?void 0:t(e,n,r))},async onError(t,a,n){void 0===e?m.oR.error("Failed to delete folder: ".concat(t.message)):e(t,a,n)},...n})};var e4=a(9221),e5=a(96848);let e3={shared:!1,favorite:!1,private:!0,community:!0},e9=["templates","quickstarts"];function e6(){let{ref:e}=(0,l.g)(),t=(0,u.useRouter)(),[a,s]=(0,x.M)(l.rS.SQL_EDITOR_SECTION_STATE(null!=e?e:""),e3),{community:r}=a;return(0,n.jsxs)(w.hm,{className:"px-0",open:r,onOpenChange:e=>{s({...null!=a?a:e3,community:e})},"data-sentry-element":"InnerSideMenuCollapsible","data-sentry-component":"CommunitySnippetsSection","data-sentry-source-file":"CommunitySnippetsSection.tsx",children:[(0,n.jsx)(w.Pq,{title:"Community","data-sentry-element":"InnerSideMenuCollapsibleTrigger","data-sentry-source-file":"CommunitySnippetsSection.tsx"}),(0,n.jsx)(w.qP,{className:"group-data-[state=open]:pt-2","data-sentry-element":"InnerSideMenuCollapsibleContent","data-sentry-source-file":"CommunitySnippetsSection.tsx",children:e9.map(a=>{let s=t.asPath==="/project/".concat(e,"/sql/").concat(a);return(0,n.jsxs)(w.ag,{title:"templates"===a?"Templates":"Quickstarts",isActive:s,isOpened:!1,href:"/project/".concat(e,"/sql/").concat(a),className:"capitalize",children:[(0,n.jsx)(e5.A,{size:16,className:"text-foreground-muted"}),a]},a)})})]})}var e8=a(49583);let e7=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3",children:[(0,n.jsx)(e8.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"}),(0,n.jsx)(e8.E,{className:"w-40 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"})]}),(0,n.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3",children:[(0,n.jsx)(e8.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"}),(0,n.jsx)(e8.E,{className:"w-32 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"})]}),(0,n.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3 opacity-75",children:[(0,n.jsx)(e8.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"}),(0,n.jsx)(e8.E,{className:"w-20 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"})]}),(0,n.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3 opacity-50",children:[(0,n.jsx)(e8.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"}),(0,n.jsx)(e8.E,{className:"w-40 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"})]}),(0,n.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3 opacity-25",children:[(0,n.jsx)(e8.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"}),(0,n.jsx)(e8.E,{className:"w-20 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"})]})]}),te=e=>{var t,a,s,r,i;let{sort:o="inserted_at"}=e,d=(0,u.useRouter)(),{ref:c,id:f}=(0,l.g)(),{profile:v}=(0,y.xc)(),{data:j}=(0,h.YA)(),S=(0,V.zv)(),b=(0,g.aP)(),[N,M]=(0,x.M)(l.rS.SQL_EDITOR_SECTION_STATE(null!=c?c:""),e3),{shared:C,favorite:q,private:E}=N,[L,P]=(0,p.useState)(!1),[_,Q]=(0,p.useState)(!1),[k,I]=(0,p.useState)(!1),[R,F]=(0,p.useState)([]),[O,T]=(0,p.useState)([]),[z,B]=(0,p.useState)(),[W,$]=(0,p.useState)(),[U,G]=(0,p.useState)(),[J,K]=(0,p.useState)(),[Y,Z]=(0,p.useState)(),ee=null==(t=b.snippets[f])?void 0:t.snippet,{data:et,isSuccess:ea,isLoading:er,isPreviousData:ep,isFetching:em,hasNextPage:ef,fetchNextPage:ex,isFetchingNextPage:eh}=(0,en.e9)({projectRef:c,sort:o},{keepPreviousData:!0}),[ey,eg]=(0,p.useState)({}),ej=(0,p.useMemo)(()=>{var e;let t=null!=(e=null==et?void 0:et.pages.flatMap(e=>{var t;return null!=(t=e.contents)?t:[]}))?e:[],a=Object.values(ey).reduce((e,t)=>{var a;let n=(null!=(a=t.snippets)?a:[]).filter(t=>!e.snippetIds.has(t.id)),s=new Set(n.map(e=>e.id));return{snippets:[...e.snippets,...n],isLoading:e.isLoading||t.isLoading,snippetIds:new Set([...e.snippetIds,...s])}},{snippets:t,isLoading:er||ep&&em,snippetIds:new Set(t.map(e=>e.id))});return ee&&"user"===ee.visibility&&!a.snippetIds.has(ee.id)&&(a.snippetIds.add(ee.id),a.snippets=[...a.snippets,ee]),a},[null==et?void 0:et.pages,ey,er,ep,em,ee]),eS=(0,p.useMemo)(()=>{var e,t;return null!=(t=null==(e=ej.snippets)?void 0:e.filter(e=>"user"===e.visibility).sort((e,t)=>"name"===o?e.name.localeCompare(t.name):new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()))?t:[]},[ej.snippets,o]),eb=(0,g.mD)(c),{data:ew}=X({projectRef:c,type:"sql"}),eM=null!=(a=null==ew?void 0:ew.private)?a:0,eC=(0,p.useMemo)(()=>0===eb.length&&0===eS.length?[ed]:ec({folders:eb,contents:eS}),[eb,eS]),eE=(0,p.useMemo)(()=>eu(eC),[eC]),{data:eL,isLoading:e_,hasNextPage:ek,fetchNextPage:eI,isFetchingNextPage:eA,isSuccess:eD}=(0,e4.I)({projectRef:c,favorite:!0,sort:o},{enabled:q,keepPreviousData:!0}),eR=(0,p.useMemo)(()=>{var e,t;let a=null!=(e=null==eL?void 0:eL.pages.flatMap(e=>{var t;return null!=(t=e.contents)?t:[]}))?e:[];return ee&&ee.favorite&&!a.find(e=>e.id===ee.id)&&a.push(ee),null!=(t=a.map(e=>({...e,folder_id:void 0})).sort((e,t)=>"name"===o?e.name.localeCompare(t.name):new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()))?t:[]},[null==eL?void 0:eL.pages,ee,o]),eF=null!=(s=null==ew?void 0:ew.favorites)?s:0,eO=(0,p.useMemo)(()=>0===eR.length?[ed]:ec({contents:eR,folders:[]}),[eR]),eT=(0,p.useMemo)(()=>eu(eO),[eO]),{data:ez,isLoading:eB,hasNextPage:eV,fetchNextPage:eW,isFetchingNextPage:e$,isSuccess:eU}=(0,e4.I)({projectRef:c,visibility:"project",sort:o},{enabled:C,keepPreviousData:!0}),eJ=(0,p.useMemo)(()=>{var e,t;let a=null!=(e=null==ez?void 0:ez.pages.flatMap(e=>{var t;return null!=(t=e.contents)?t:[]}))?e:[];return ee&&"project"===ee.visibility&&!a.find(e=>e.id===ee.id)&&a.push(ee),null!=(t=a.sort((e,t)=>"name"===o?e.name.localeCompare(t.name):new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()))?t:[]},[null==ez?void 0:ez.pages,ee,o]),eX=null!=(r=null==ew?void 0:ew.shared)?r:0,e0=(0,p.useMemo)(()=>0===eJ.length?[ed]:ec({contents:eJ,folders:[]}),[eJ]),e1=(0,p.useMemo)(()=>eu(e0),[e0]),e5=(0,p.useMemo)(()=>{var e,t;return[...null!=(e=null==et?void 0:et.pages.flatMap(e=>e.contents))?e:[],...null!=(t=null==ez?void 0:ez.pages.flatMap(e=>e.contents))?t:[]]},[et,ez]),{mutate:e9}=(0,el.$)({onSuccess:e=>{let t=e.map(e=>(0,V.lW)("sql",{id:e}));S.removeTabs(t)},onError:(e,t)=>{e.message.includes("Contents not found")?tt(t.ids):m.oR.error("Failed to delete query: ".concat(e.message))}}),{mutate:e8,isLoading:te}=e2({onSuccess:(e,t)=>{m.oR.success("Successfully deleted folder");let{ids:a}=t;b.removeFolder(a[0]),Z(void 0)}}),tt=e=>{Q(!1),T([]);let t=Object.keys(b.snippets).filter(t=>!e.includes(t));0===t.length?d.push("/project/".concat(c,"/sql/new")):e.includes(f)&&d.push("/project/".concat(c,"/sql/").concat(t[0])),e.length>0&&e.forEach(e=>b.removeSnippet(e))},ta=async()=>{if(!c)return console.error("Project ref is required");if(void 0===Y)return console.error("No folder is selected");let e=eS.filter(e=>e.folder_id===Y.id);if(e.length>0){let t=e.map(e=>e.id);e9({projectRef:c,ids:t},{onSuccess:()=>{t.forEach(e=>b.removeSnippet(e)),tt(t),e8({projectRef:c,ids:[null==Y?void 0:Y.id]})}})}else e8({projectRef:c,ids:[null==Y?void 0:Y.id]})},tn=e=>{let t=eS.map(e=>e.id),a=t.indexOf(f),n=t.indexOf(e),s=Math.min(a,n),r=Math.max(a,n),l=[],i=eS[s].folder_id===eS[r].folder_id;for(let e=s;e<=r;e++)i&&eS[e].folder_id===eS[s].folder_id&&l.push(eS[e]);T(l)};(0,p.useEffect)(()=>{void 0!==ee&&ea&&("project"===ee.visibility?M({...N,shared:!0}):"user"===ee.visibility&&M({...N,private:!0}),ee.folder_id&&!R.includes(ee.folder_id)&&F([...R,ee.folder_id]))},[ee,o,ea]),(0,p.useEffect)(()=>{T([])},[f]),(0,p.useEffect)(()=>{c&&et&&et.pages.forEach(e=>{var t,a;null==(t=e.contents)||t.forEach(e=>{b.addSnippet({projectRef:c,snippet:e})}),null==(a=e.folders)||a.forEach(e=>b.addFolder({projectRef:c,folder:e}))})},[c,null==et?void 0:et.pages]),(0,p.useEffect)(()=>{void 0!==c&&eD&&eL.pages.forEach(e=>{var t;null==(t=e.contents)||t.forEach(e=>{b.addSnippet({projectRef:c,snippet:e})})})},[c,null==eL?void 0:eL.pages]),(0,p.useEffect)(()=>{void 0!==c&&eU&&ez.pages.forEach(e=>{var t;null==(t=e.contents)||t.forEach(e=>{b.addSnippet({projectRef:c,snippet:e})})})},[c,null==ez?void 0:ez.pages]);let ts=(0,eZ.x)();return(0,p.useEffect)(()=>{ea&&ts({snippets:e5})},[e5,ea,ts]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(w.OJ,{"data-sentry-element":"InnerSideMenuSeparator","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsxs)(w.hm,{className:"px-0",open:C,onOpenChange:e=>{M({...null!=N?N:e3,shared:e})},"data-sentry-element":"InnerSideMenuCollapsible","data-sentry-source-file":"SQLEditorNav.tsx",children:[(0,n.jsx)(w.Pq,{title:"Shared ".concat(eX>0?" (".concat(eX,")"):""),"data-sentry-element":"InnerSideMenuCollapsibleTrigger","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(w.qP,{className:"group-data-[state=open]:pt-2","data-sentry-element":"InnerSideMenuCollapsibleContent","data-sentry-source-file":"SQLEditorNav.tsx",children:eB?(0,n.jsx)(e7,{}):0===eJ.length?(0,n.jsx)(w.Q5,{className:"mx-2",title:"No shared queries",description:"Share queries with your team by right-clicking on the query."}):(0,n.jsx)(es.GS,{data:e0,"aria-label":"project-level-snippets",nodeRenderer:e=>{var t,a;let{element:s,...r}=e,l=Object.values(S.tabsMap).some(e=>{var t,a;return(null==(t=e.metadata)?void 0:t.sqlId)===(null==(a=s.metadata)?void 0:a.id)}),i=(0,V.lW)("sql",{id:null==s||null==(t=s.metadata)?void 0:t.id}),o=S.previewTabId===i,d=!o&&(null==(a=s.metadata)?void 0:a.id)===f,c=O.some(e=>{var t;return e.id===(null==(t=s.metadata)?void 0:t.id)});return(0,n.jsx)(eq,{...r,isOpened:l&&!o,isSelected:d||c,isPreview:o,onDoubleClick:e=>{e.preventDefault(),S.makeTabPermanent(i)},element:s,onSelectDelete:()=>{Q(!0),T([s.metadata])},onSelectRename:()=>{I(!0),G(s.metadata)},onSelectDownload:()=>{K(s.metadata)},onSelectUnshare:()=>{$(s.metadata)},isLastItem:e1.has(s.id),hasNextPage:eV,fetchNextPage:eW,isFetchingNextPage:e$})}})})]}),(0,n.jsx)(w.OJ,{"data-sentry-element":"InnerSideMenuSeparator","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsxs)(w.hm,{className:"px-0",open:q,onOpenChange:e=>{M({...null!=N?N:e3,favorite:e})},"data-sentry-element":"InnerSideMenuCollapsible","data-sentry-source-file":"SQLEditorNav.tsx",children:[(0,n.jsx)(w.Pq,{title:"Favorites ".concat(eF>0?" (".concat(eF,")"):""),"data-sentry-element":"InnerSideMenuCollapsibleTrigger","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(w.qP,{className:"group-data-[state=open]:pt-2","data-sentry-element":"InnerSideMenuCollapsibleContent","data-sentry-source-file":"SQLEditorNav.tsx",children:e_?(0,n.jsx)(e7,{}):0===eR.length?(0,n.jsx)(w.Q5,{title:"No favorite queries",className:"mx-2 px-3",description:(0,n.jsxs)(n.Fragment,{children:["Save a query to favorites for easy accessibility by clicking the"," ",(0,n.jsx)(ev.A,{size:12,className:"inline-block relative align-center -top-[1px]"})," ","icon."]})}):(0,n.jsx)(es.GS,{data:eO,"aria-label":"favorite-snippets",nodeRenderer:e=>{var t,a;let{element:s,...r}=e,l=Object.values(S.tabsMap).some(e=>{var t,a;return(null==(t=e.metadata)?void 0:t.sqlId)===(null==(a=s.metadata)?void 0:a.id)}),i=(0,V.lW)("sql",{id:null==s||null==(t=s.metadata)?void 0:t.id}),o=S.previewTabId===i,d=!o&&(null==(a=s.metadata)?void 0:a.id)===f,c=O.some(e=>{var t;return e.id===(null==(t=s.metadata)?void 0:t.id)});return(0,n.jsx)(eq,{...r,isSelected:d||c,isOpened:l&&!o,isPreview:o,onDoubleClick:e=>{e.preventDefault(),S.makeTabPermanent(i)},element:s,onSelectDelete:()=>{Q(!0),T([s.metadata])},onSelectRename:()=>{I(!0),G(s.metadata)},onSelectDownload:()=>{K(s.metadata)},onSelectShare:()=>B(s.metadata),onSelectUnshare:()=>{$(s.metadata)},isLastItem:eT.has(s.id),hasNextPage:ek,fetchNextPage:eI,isFetchingNextPage:eA})}})})]}),(0,n.jsx)(w.OJ,{"data-sentry-element":"InnerSideMenuSeparator","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsxs)(w.hm,{open:E,onOpenChange:e=>{M({...null!=N?N:e3,private:e})},className:"px-0","data-sentry-element":"InnerSideMenuCollapsible","data-sentry-source-file":"SQLEditorNav.tsx",children:[(0,n.jsx)(w.Pq,{title:"PRIVATE\n            ".concat(eM>0?" (".concat(eM,")"):""),"data-sentry-element":"InnerSideMenuCollapsibleTrigger","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(w.qP,{className:"group-data-[state=open]:pt-2","data-sentry-element":"InnerSideMenuCollapsibleContent","data-sentry-source-file":"SQLEditorNav.tsx",children:er?(0,n.jsx)(eY.A,{}):0===eb.length&&0===eS.length?(0,n.jsx)(eK,{}):(0,n.jsx)(es.GS,{multiSelect:!0,togglableSelect:!0,clickAction:"EXCLUSIVE_SELECT",data:eC,selectedIds:O.map(e=>e.id),"aria-label":"private-snippets",onExpand:e=>{let t=e.element.id.toString();e.isExpanded&&!R.includes(t)&&F([...R,t]),!e.isExpanded&&R.includes(t)&&F(R.filter(e=>e!==t))},expandedIds:R,nodeRenderer:e=>{var t,a;let{element:s,...r}=e,l=Object.values(S.tabsMap).some(e=>{var t,a;return(null==(t=e.metadata)?void 0:t.sqlId)===(null==(a=s.metadata)?void 0:a.id)}),i=(0,V.lW)("sql",{id:null==s||null==(t=s.metadata)?void 0:t.id}),u=S.previewTabId===i,p=!u&&(null==(a=s.metadata)?void 0:a.id)===f,m=O.some(e=>{var t;return e.id===(null==(t=s.metadata)?void 0:t.id)});return(0,n.jsx)(eq,{...r,element:s,isOpened:l&&!u,isSelected:p||m,isPreview:u,isMultiSelected:O.length>1,isLastItem:eE.has(s.id),status:r.isBranch?b.folders[s.id].status:"idle",onMultiSelect:tn,onSelectCreate:()=>{if(v&&j){let e=(0,A.fW)({id:(0,eN.A)(),name:eH.tO,owner_id:null==v?void 0:v.id,project_id:null==j?void 0:j.id,folder_id:s.id,sql:""});b.addSnippet({projectRef:j.ref,snippet:e}),d.push("/project/".concat(c,"/sql/").concat(e.id))}},onSelectDelete:()=>{r.isBranch?Z(s.metadata):(Q(!0),0===O.length&&T([s.metadata]))},onSelectRename:()=>{r.isBranch?b.editFolder(s.id):(I(!0),G(s.metadata))},onSelectMove:()=>{P(!0),0===O.length&&T([s.metadata])},onSelectDownload:()=>K(s.metadata),onSelectShare:()=>B(s.metadata),onEditSave:e=>{0===e.length&&"new-folder"===s.id?b.removeFolder(s.id):e.length>0&&b.saveFolder({id:s.id,name:e})},hasNextPage:ef,fetchNextPage:ex,isFetchingNextPage:eh,sort:o,onFolderContentsChange:e=>{let{isLoading:t,snippets:a}=e;eg(e=>({...e,[s.id]:{snippets:a,isLoading:t}}))},onDoubleClick:e=>{e.preventDefault(),S.makeTabPermanent(i)}})}})})]}),(0,n.jsx)(w.OJ,{"data-sentry-element":"InnerSideMenuSeparator","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(e6,{"data-sentry-element":"CommunitySnippetsSection","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(w.OJ,{"data-sentry-element":"InnerSideMenuSeparator","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(H,{snippet:U,visible:k,onCancel:()=>I(!1),onComplete:()=>I(!1),"data-sentry-element":"RenameQueryModal","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(eG,{snippets:O,visible:L,onClose:()=>{P(!1),T([])},"data-sentry-element":"MoveQueryModal","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(D,{id:null!=(i=null==J?void 0:J.id)?i:"",visible:void 0!==J,onCancel:()=>K(void 0),"data-sentry-element":"DownloadSnippetModal","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(eP,{snippet:z,onClose:()=>B(void 0),onSuccess:()=>M({...N,shared:!0}),"data-sentry-element":"ShareSnippetModal","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(eQ,{snippet:W,onClose:()=>$(void 0),onSuccess:()=>M({...N,private:!0}),"data-sentry-element":"UnshareSnippetModal","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(eo,{visible:_,snippets:O,onClose:()=>{Q(!1),T([])},"data-sentry-element":"DeleteSnippetsModal","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(ei.A,{size:"small",title:"Confirm to delete folder",confirmLabel:"Delete folder",confirmLabelLoading:"Deleting folder",loading:te,visible:void 0!==Y,variant:"destructive",onCancel:()=>Z(void 0),onConfirm:ta,alert:{title:"This action cannot be undone",description:"All SQL snippets within the folder will be permanently removed, and cannot be recovered."},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"SQLEditorNav.tsx",children:(0,n.jsxs)("p",{className:"text-sm",children:["Are you sure you want to delete the folder '",null==Y?void 0:Y.name,"'?"]})})]})},tt=()=>{let e=(0,u.useRouter)(),{ref:t}=(0,l.g)(),{profile:a}=(0,y.xc)(),{data:N}=(0,h.YA)(),M=(0,g.aP)(),[C,q]=(0,p.useState)(""),[E,L]=(0,p.useState)(!1),[P,_]=(0,x.M)(l.rS.SQL_EDITOR_SORT(null!=t?t:""),"inserted_at"),Q=(0,v.Nj)(),k=(0,r.d7)(C,500),I=(0,f.SE)(s.aG.CREATE,"user_content",{resource:{type:"sql",owner_id:null==a?void 0:a.id},subject:{id:null==a?void 0:a.id}}),A=()=>{if(!t)return console.error("Project ref is required");q(""),L(!1),M.addNewFolder({projectRef:t})},D=async()=>{if(!t)return console.error("Project ref is required");if(!N)return console.error("Project is required");if(!a)return console.error("Profile is required");if(!I)return(0,m.oR)("Your queries will not be saved as you do not have sufficient permissions");try{e.push("/project/".concat(t,"/sql/new?skip=true")),q(""),L(!1)}catch(e){m.oR.error("Failed to create new query: ".concat(e.message))}};return(0,p.useEffect)(()=>{L(k.length>0)},[k]),(0,n.jsxs)("div",{className:"h-full flex flex-col justify-between","data-sentry-component":"SQLEditorMenu","data-sentry-source-file":"SQLEditorMenu.tsx",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-y-4 flex-grow",children:[(0,n.jsxs)("div",{className:"mt-4 mx-4 flex items-center justify-between gap-x-2",children:[(0,n.jsx)(w.a0,{className:"w-full p-0 gap-0","data-sentry-element":"InnerSideBarFilters","data-sentry-source-file":"SQLEditorMenu.tsx",children:(0,n.jsx)(w.RK,{name:"search-queries",placeholder:"Search queries...","aria-labelledby":"Search queries",value:C,onChange:e=>{let t=e.target.value;q(t),0===t.length&&L(!1)},onKeyDown:e=>{"Escape"===e.code&&(q(""),L(!1))},"data-sentry-element":"InnerSideBarFilterSearchInput","data-sentry-source-file":"SQLEditorMenu.tsx",children:E?(0,n.jsxs)(j.m_,{children:[(0,n.jsx)(j.k$,{className:"absolute right-1 top-[.4rem] md:top-[.3rem] transition-colors text-foreground-light hover:text-foreground",onClick:()=>{q(""),L(!1)},children:(0,n.jsx)(i.A,{size:18})}),(0,n.jsx)(j.ZI,{children:"Clear search"})]}):(0,n.jsxs)(w.i9,{value:P,onValueChange:e=>_(e),children:[(0,n.jsx)(w.Pl,{value:"name",children:"Alphabetical"},"name"),(0,n.jsx)(w.Pl,{value:"inserted_at",children:"Created At"},"inserted_at")]})})}),(0,n.jsxs)(S.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"SQLEditorMenu.tsx",children:[(0,n.jsx)(S.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"SQLEditorMenu.tsx",children:(0,n.jsx)(b.$,{"data-testId":"sql-editor-new-query-button",type:"default",icon:(0,n.jsx)(o.A,{className:"text-foreground"}),className:"w-[26px]","data-sentry-element":"Button","data-sentry-source-file":"SQLEditorMenu.tsx"})}),(0,n.jsxs)(S.SQ,{align:"end",side:"bottom",className:"w-48","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"SQLEditorMenu.tsx",children:[(0,n.jsxs)(S._2,{className:"gap-x-2",onClick:()=>D(),"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"SQLEditorMenu.tsx",children:[(0,n.jsx)(d.A,{size:14,"data-sentry-element":"FilePlus","data-sentry-source-file":"SQLEditorMenu.tsx"}),"Create a new snippet"]}),(0,n.jsxs)(S._2,{className:"gap-x-2",onClick:()=>A(),"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"SQLEditorMenu.tsx",children:[(0,n.jsx)(c.A,{size:14,"data-sentry-element":"FolderPlus","data-sentry-source-file":"SQLEditorMenu.tsx"}),"Create a new folder"]})]})]})]}),E?(0,n.jsx)(ek,{search:k}):(0,n.jsx)(te,{sort:P})]}),(0,n.jsx)("div",{className:"p-4 border-t sticky bottom-0 bg-studio",children:(0,n.jsx)(b.$,{block:!0,type:"default",onClick:()=>Q.setOnGoingQueriesPanelOpen(!0),"data-sentry-element":"Button","data-sentry-source-file":"SQLEditorMenu.tsx",children:"View running queries"})})]})}},25134:(e,t,a)=>{a.d(t,{$:()=>d});var n=a(32144),s=a(80251),r=a(73969),l=a(70938),i=a(26241);async function o(e,t){let{projectRef:a,ids:n}=e,{data:s,error:r}=await (0,l.yH)("/platform/projects/{ref}/content",{headers:{Version:"2"},params:{path:{ref:a},query:{ids:n}},signal:t});return r&&(0,l.H4)(r),s.map(e=>e.id)}let d=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,n.jE)();return(0,s.n)(e=>o(e),{async onSuccess(t,a,n){let{projectRef:s}=a;await Promise.all([l.invalidateQueries(i.M.allContentLists(s)),l.invalidateQueries(i.M.infiniteList(s))]),await (null==e?void 0:e(t,a,n))},async onError(e,a,n){void 0===t?r.oR.error("Failed to delete contents: ".concat(e.message)):t(e,a,n)},...a})}},25934:(e,t,a)=>{a.d(t,{c3:()=>l,e9:()=>o});var n=a(17702),s=a(70938),r=a(26241);let l=100;async function i(e,t){let{projectRef:a,cursor:n,sort:r,name:i}=e;if(void 0===a)throw Error("projectRef is required");let{data:o,error:d}=await (0,s.Jt)("/platform/projects/{ref}/content/folders",{params:{path:{ref:a},query:{type:"sql",cursor:n,limit:l.toString(),sort_by:r,sort_order:"name"===r?"asc":"desc",name:i,visibility:"user"}},signal:t});return d&&(0,s.H4)(d),{...o.data,cursor:o.cursor}}let o=function(e){let{projectRef:t,name:a,sort:s}=e,{enabled:l=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.q)(r.M.folders(t,{name:a,sort:s}),e=>{let{signal:n,pageParam:r}=e;return i({projectRef:t,cursor:r,name:a,sort:s},n)},{enabled:l&&void 0!==t,getNextPageParam:e=>e.cursor,...o})}},52842:(e,t,a)=>{a.d(t,{A:()=>A});var n=a(80263),s=a(53434),r=a.n(s),l=a(3049),i=a(55568),o=a(53239),d=a(73969),c=a(46491),u=a(92589),p=a(52280),m=a(32144),f=a(80251),x=a(20305),h=a(24554);async function y(e){let{pid:t,projectRef:a,connectionString:n}=e,{result:s}=await (0,x.E)({projectRef:a,connectionString:n,sql:"select pg_terminate_backend(".concat(t,")")});return s}let v=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,m.jE)();return(0,f.n)(e=>y(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(h.B.ongoingQueries(r)),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?d.oR.error("Failed to abort query: ".concat(e.message)):t(e,a,n)},...a})};var g=a(56947);let j=()=>"\nselect pid, query, query_start from pg_stat_activity where state = 'active' and datname = 'postgres';\n".trim();async function S(e,t){let{projectRef:a,connectionString:n}=e,s=j().trim(),{result:r}=await (0,x.E)({projectRef:a,connectionString:n,sql:s,queryKey:["ongoing-queries"]},t);return(null!=r?r:[]).filter(e=>!e.query.startsWith(s))}let b=function(e){let{projectRef:t,connectionString:a}=e,{enabled:n=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,g.I)(h.B.ongoingQueries(t),e=>{let{signal:n}=e;return S({projectRef:t,connectionString:a},n)},{enabled:n&&void 0!==t,...s})};var w=a(16703),N=a(54887),M=a(74144),C=a(19335),q=a(38534),E=a(20235),L=a(22554),P=a(1399),_=a(80127),Q=a(35741),k=a(86336);let I=()=>{let[e,t]=(0,N.W)({replace:!0}),{viewOngoingQueries:a}=(0,c.g)(),{data:s}=(0,w.YA)(),m=(0,q.RE)(),f=(0,C.qM)(),[x,h]=(0,o.useState)(),{data:y}=(0,p.Vh)({projectRef:null==s?void 0:s.ref}),g=(null!=y?y:[]).find(e=>e.identifier===m.selectedDatabaseId),{data:j,error:S,isError:I,isLoading:A,isFetching:D,refetch:R}=b({projectRef:null==s?void 0:s.ref,connectionString:null==g?void 0:g.connectionString},{enabled:!M.pe||M.pe&&(null==g?void 0:g.connectionString)!==void 0,staleTime:5e3}),F=null!=j?j:[];(0,o.useEffect)(()=>{a&&(f.setOnGoingQueriesPanelOpen(!0),t({viewOngoingQueries:void 0}))},[a]);let{mutate:O,isLoading:T}=v({onSuccess:()=>{d.oR.success("Successfully aborted query (ID: ".concat(x,")")),h(void 0)}}),z=()=>{t({viewOngoingQueries:void 0}),f.setOnGoingQueriesPanelOpen(!1)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(E.cj,{open:f.ongoingQueriesPanelOpen,onOpenChange:()=>z(),"data-sentry-element":"Sheet","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:(0,n.jsxs)(E.h,{size:"lg","data-sentry-element":"SheetContent","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:[(0,n.jsxs)(E.Fm,{"data-sentry-element":"SheetHeader","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:[(0,n.jsxs)(E.qp,{className:"flex items-center gap-x-2","data-sentry-element":"SheetTitle","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:["Running queries on"," ",(null==g?void 0:g.identifier)===(null==s?void 0:s.ref)?"primary database":"read replica",(0,n.jsx)(L.$,{type:"default",className:"px-1.5",loading:A||D,icon:(0,n.jsx)(l.A,{}),onClick:()=>R(),"data-sentry-element":"Button","data-sentry-source-file":"OngoingQueriesPanel.tsx"})]}),(0,n.jsxs)(E.Qs,{"data-sentry-element":"SheetDescription","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:["There ",1===F.length?"is":"are"," ",(0,n.jsx)("span",{className:"text-foreground-light",children:F.length})," quer",1===F.length?"y":"ies"," currently running"," ",(null==g?void 0:g.identifier)!==(null==s?void 0:s.ref)?"on replica ".concat(null==g?void 0:g.identifier):""]})]}),(0,n.jsxs)("div",{className:"max-h-full h-full divide-y overflow-y-auto",children:[I&&(0,n.jsx)("div",{className:"flex items-center justify-center h-full px-16",children:(0,n.jsx)(u.A,{subject:"Failed to retrieve ongoing queries",error:S})}),0===F.length&&(0,n.jsxs)("div",{className:"flex flex-col gap-y-2 items-center justify-center h-full text-foreground-light text-sm",children:[(0,n.jsxs)("span",{children:["No queries are currently running on the"," ",(null==g?void 0:g.identifier)!==(null==s?void 0:s.ref)?"read replica ".concat(null==g?void 0:g.identifier):(null!=y?y:[]).length>1?"primary database":"database"]}),(0,n.jsx)(L.$,{type:"default",loading:A||D,icon:(0,n.jsx)(l.A,{}),onClick:()=>R(),children:"Refresh"})]}),F.map(e=>(0,n.jsxs)(E.Xc,{className:"flex justify-between gap-x-4",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-y-2 w-full",children:[(0,n.jsx)(P.N,{hideLineNumbers:!0,value:e.query,language:"sql",className:(0,_.cn)("max-w-none max-h-52 w-full","!bg-transparent !py-3 !px-3.5 prose dark:prose-dark","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap")}),(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,n.jsxs)("p",{className:"text-foreground-light text-xs",children:["PID: ",e.pid]}),(0,n.jsx)("p",{className:"text-foreground-light text-xs",children:""}),(0,n.jsxs)("p",{className:"text-foreground-light text-xs",children:["Started since: ",r()(e.query_start).format("DD MMM YYYY HH:mm (ZZ)")]})]})]}),(0,n.jsxs)(Q.m_,{children:[(0,n.jsx)(Q.k$,{asChild:!0,children:(0,n.jsx)(L.$,{type:"warning",className:"px-1.5",icon:(0,n.jsx)(i.A,{}),onClick:()=>h(e.pid)})}),(0,n.jsx)(Q.ZI,{side:"bottom",children:"Abort query"})]})]},e.pid))]})]})}),(0,n.jsx)(k.A,{loading:T,variant:"warning",title:"Confirm to abort this query? (ID: ".concat(x,")"),visible:void 0!==x,onCancel:()=>h(void 0),onConfirm:()=>{void 0!==x&&O({pid:x,projectRef:null==s?void 0:s.ref,connectionString:null==g?void 0:g.connectionString})},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:(0,n.jsx)("p",{className:"text-sm",children:"This will force the query to stop running."})})]})},A=(0,a(53405).r)(e=>{let{children:t}=e;return(0,n.jsxs)(n.Fragment,{children:[t,(0,n.jsx)(I,{"data-sentry-element":"OngoingQueriesPanel","data-sentry-source-file":"SQLEditorLayout.tsx"})]})})},68997:(e,t,a)=>{a.d(t,{k:()=>i});var n=a(49629),s=a(53239),r=a(46491);let l=e=>(0,n.ZA)("schema",n.tU.withDefault(e).withOptions({clearOnDefault:!1})),i=()=>{let{ref:e}=(0,r.g)(),t=e&&e.length>0&&window.localStorage.getItem(r.rS.LAST_SELECTED_SCHEMA(e))||"public",[a,n]=l((0,s.useMemo)(()=>t,[e]));return(0,s.useEffect)(()=>{e&&e.length>0&&window.localStorage.setItem(r.rS.LAST_SELECTED_SCHEMA(e),a)},[a,e]),{selectedSchema:a,setSelectedSchema:n}}},81257:(e,t,a)=>{a.d(t,{K:()=>i,Q:()=>l});var n=a(56947),s=a(70938),r=a(26241);async function l(e,t){let{projectRef:a,id:n}=e;if(void 0===a)throw Error("projectRef is required");if(void 0===n)throw Error("Content ID is required");let{data:r,error:l}=await (0,s.Jt)("/platform/projects/{ref}/content/item/{id}",{params:{path:{ref:a,id:n}},signal:t});if(l)throw(0,s.H4)(l);return r}let i=function(e){let{projectRef:t,id:a}=e,{enabled:s=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.I)(r.M.resource(t,a),e=>{let{signal:n}=e;return l({projectRef:t,id:a},n)},{enabled:s&&void 0!==t&&void 0!==a,...i})}},91982:(e,t,a)=>{a.d(t,{A:()=>o});var n=a(80263),s=a(53239),r=a(94844),l=a(38583);function i(e,t){if(!t.error)return delete e[t.key],e;if(t)return{...e,[t.key]:t.error};throw Error()}function o(e){let{validate:t,...a}=e,[o,d]=(0,s.useReducer)(i,null),c=(0,r.Wx)({validateOnBlur:!0,...a,validationSchema:a.validationSchema,initialValues:a.initialValues,onSubmit:a.onSubmit,validate:t||function(){return o}});return(0,n.jsx)("form",{id:a.id,name:a.name,onSubmit:c.handleSubmit,className:a.className,style:a.style,method:"POST","data-sentry-component":"Form","data-sentry-source-file":"Form.tsx",children:(0,n.jsx)(l.h,{values:c.values,errors:c.errors,formContextOnChange:c.handleChange,handleBlur:c.handleBlur,touched:c.touched,fieldLevelValidation:function(e,t){d({key:e,error:t})},"data-sentry-element":"FormContextProvider","data-sentry-source-file":"Form.tsx",children:a.children({errors:c.errors,touched:c.touched,isSubmitting:c.isSubmitting,isValidating:c.isValidating,submitCount:c.submitCount,initialValues:c.initialValues,values:c.values,handleReset:c.handleReset,resetForm:c.resetForm,setFieldValue:c.setFieldValue})})})}}}]);
try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="7cc3baa8-2ed7-46ba-8aff-81a4846fba90",e._sentryDebugIdIdentifier="sentry-dbid-7cc3baa8-2ed7-46ba-8aff-81a4846fba90")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[753],{101:(e,t,n)=>{n.d(t,{HQ:()=>b,PX:()=>v,nk:()=>E,vs:()=>N});var a=n(17769),l=n(48177),s=n(32144),r=n(56947),i=n(46491),o=n(78741),c=n(76834),d=n(38319),u=n(25400),m=n(20305),p=n(26010),h=n(14875),f=n(719);let x=e=>{var t;let n=e.columns.filter(e=>null==e?void 0:e.isPrimaryKey).map(e=>e.name);return 0!==n.length?n:[null==(t=e.columns[0])?void 0:t.name]};async function y(e){return new Promise(t=>setTimeout(t,e))}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500;for(let l=0;l<=t;l++)try{return await e()}catch(e){if((null==e?void 0:e.status)===429&&l<t){var a;let t=null==(a=e.headers)?void 0:a.get("retry-after"),s=t?1e3*parseInt(t):n*Math.pow(2,l);await y(s);continue}throw e}throw Error("Max retries reached without success")}let v=e=>{var t;let{table:n,filters:l=[],sorts:s=[]}=e,r=new a.Query,i=n.columns.filter(e=>{var t;return(null!=(t=null==e?void 0:e.enum)?t:[]).length>0&&"array"===e.dataType.toLowerCase()}).map(e=>'"'.concat(e.name,'"::text[]')),o=r.from(n.name,null!=(t=n.schema)?t:void 0).select(i.length>0?"*,".concat(i.join(",")):"*");if(l.filter(e=>e.value&&""!==e.value).forEach(e=>{let t=(0,f.b)(n,e);o=o.filter(e.column,e.operator,t)}),0===s.length&&n.estimateRowCount<=h.kd){let e=x(n);e.length>0&&e.forEach(e=>{o=o.order(n.name,e)})}else s.forEach(e=>{o=o.order(e.table,e.column,e.ascending,e.nullsFirst)});return o},b=async e=>{let{projectRef:t,connectionString:n,table:a,filters:l=[],sorts:s=[],roleImpersonationState:r,progressCallback:o}=e;if(i.pe&&!n)return console.error("Connection string is required"),[];let c=[],u=v({table:a,sorts:s,filters:l}),p=-1;for(;;){let e=500*(p+=1),a=(p+1)*500-1,l=(0,d.Nf)(u.range(e,a).toSql(),r);try{let{result:e}=await g(async()=>(0,m.E)({projectRef:t,connectionString:n,sql:l}));if(c.push(...e),null==o||o(c.length),e.length<500)break;await y(500)}catch(e){throw Error("Error fetching all table rows: ".concat(e instanceof Error?e.message:"Unknown error"))}}return c.filter(e=>1!==e[d.BO])};async function _(e,t){let{queryClient:n,projectRef:a,connectionString:s,tableId:r,roleImpersonationState:i,filters:p,sorts:h,limit:f,page:x}=e,y=await (0,c.Nj)(n,{projectRef:a,connectionString:s,id:r});if(!y)throw Error("Table not found");let g=(0,o.rH)(y),v=(0,d.Nf)((0,l.yG)({table:y,filters:p,sorts:h,limit:f,page:x}),i);try{let{result:e}=await (0,m.E)({projectRef:a,connectionString:s,sql:v,queryKey:["table-rows",null==g?void 0:g.id],isRoleImpersonationEnabled:(0,u._c)(null==i?void 0:i.role)},t);return{rows:e.map((e,t)=>({idx:t,...e}))}}catch(e){throw Error("Error fetching table rows: ".concat(e instanceof Error?e.message:"Unknown error"))}}let N=function(e){let{projectRef:t,connectionString:n,tableId:a,...l}=e,{enabled:i=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=(0,s.jE)();return(0,r.I)(p.j.tableRows(t,{table:{id:a},...l}),e=>{let{signal:s}=e;return _({queryClient:c,projectRef:t,connectionString:n,tableId:a,...l},s)},{enabled:i&&void 0!==t&&void 0!==a,...o})};function E(e,t){let{projectRef:n,connectionString:a,tableId:l,...s}=t;return e.fetchQuery(p.j.tableRows(n,{table:{id:l},...s}),t=>{let{signal:r}=t;return _({queryClient:e,projectRef:n,connectionString:a,tableId:l,...s},r)})}},719:(e,t,n)=>{n.d(t,{b:()=>s,j:()=>r});var a=n(88503),l=n(74388);function s(e,t){let n=e.columns.find(e=>e.name==t.column);if(n&&(0,a.n0)(n.format)){let e=Number(t.value);if(!Number.isNaN(e)&&!(e>Number.MAX_SAFE_INTEGER))return Number(t.value)}return t.value}function r(e){let{table:t}=e;if(!(0,l.KO)(t))return{error:{message:"Only table rows can be updated or deleted"}};let n=t.primary_keys;return n&&0!=n.length?{primaryKeys:n.map(e=>e.name)}:{error:{message:"Please add a primary key column to your table to update or delete rows"}}}},1095:(e,t,n)=>{n.d(t,{c2:()=>o});var a=n(80251),l=n(73969),s=n(17769),r=n(20305);async function i(e){let{projectRef:t,connectionString:n,table:a,column:l,pkMatch:i}=e,o=function(e){var t;let{table:n,column:a,pkMatch:l}=e;return new s.Query().from(n.name,null!=(t=n.schema)?t:void 0).select('"'.concat(a,'"')).match(l).toSql()}({table:a,column:l,pkMatch:i}),{result:c}=await (0,r.E)({projectRef:t,connectionString:n,sql:o});return null==c?void 0:c[0][l]}let o=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.n)(e=>i(e),{async onSuccess(t,n,a){await (null==e?void 0:e(t,n,a))},async onError(e,n,a){void 0===t?l.oR.error(e.message):t(e,n,a)},...n})}},4043:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(80263),l=n(53239),s=n(65988),r=n(92413),i=n(38583);let o=(0,l.createContext)({parentCallback:e=>{},parentSize:""});function c(e){let{className:t,id:n="",name:l="",label:s,afterLabel:c,beforeLabel:d,description:u,checked:m,value:p,onChange:h,onBlur:f,size:x="medium",disabled:y=!1,...g}=e,{formContextOnChange:v,values:b,handleBlur:_}=(0,i.x)(),N=(0,r.A)("checkbox");return(0,a.jsx)(o.Consumer,{"data-sentry-element":"CheckboxContext.Consumer","data-sentry-component":"Checkbox","data-sentry-source-file":"Checkbox.tsx",children:e=>{let{parentCallback:r,parentSize:i}=e,o=n||l||(s?s.toLowerCase().replace(/^[^A-Z0-9]+/gi,"").replace(/ /g,"-"):void 0);x=i||x;let E=l||o,j=null!=m?m:void 0,S=[N.container];return t&&S.push(t),b&&void 0===m&&(j=b[n||l]),(0,a.jsxs)("div",{className:S.join(" "),children:[(0,a.jsx)("input",{id:o,name:E,type:"checkbox",className:[N.base,N.size[x]].join(" "),onChange:function(e){r&&r(e),h&&h(e),v&&v(e)},onBlur:function(e){_&&setTimeout(()=>{_(e)},100),f&&f(e)},checked:j,value:p||o,disabled:y,...g}),(0,a.jsxs)("label",{className:[N.label.base,N.label[x]].join(" "),htmlFor:o,children:[(0,a.jsxs)("span",{children:[d&&(0,a.jsx)("span",{className:[N.label_before.base,N.label_before[x]].join(" "),children:d}),s,c&&(0,a.jsx)("span",{className:[N.label_after.base,N.label_after[x]].join(" "),children:c})]}),u&&(0,a.jsx)("p",{className:[N.description.base,N.description[x]].join(" "),children:u})]})]})}})}c.Group=function(e){let{id:t,layout:n="vertical",error:l,descriptionText:i,label:d,afterLabel:u,beforeLabel:m,labelOptional:p,children:h,className:f,options:x,onChange:y,size:g="medium"}=e,v=(0,r.A)("checkbox");return(0,a.jsx)(s.H,{label:d,afterLabel:u,beforeLabel:m,labelOptional:p,layout:n,id:t,error:l,descriptionText:i,className:f,size:g,"data-sentry-element":"FormLayout","data-sentry-component":"Group","data-sentry-source-file":"Checkbox.tsx",children:(0,a.jsx)(o.Provider,{value:{parentCallback:e=>{y&&y(e)},parentSize:g},"data-sentry-element":"CheckboxContext.Provider","data-sentry-source-file":"Checkbox.tsx",children:(0,a.jsx)("div",{className:v.group,children:x?x.map(e=>(0,a.jsx)(c,{id:e.id,value:e.value,label:e.label,beforeLabel:e.beforeLabel,afterLabel:e.afterLabel,checked:e.checked,name:e.name,description:e.description,defaultChecked:e.defaultChecked},e.id)):h})})})};let d=c},4939:(e,t,n)=>{n.d(t,{HQ:()=>f,Ir:()=>x});var a=n(80263),l=n(53239),s=n(56028),r=n(12532),i=n(79166),o=n(78741),c=n(51553);function d(e,t){let n=e;if(null==t?void 0:t.gridColumns){n=[];let a=t.gridColumns.filter(e=>(null==e?void 0:e.name)!=="");for(let t=0;t<a.length;t++){let l=a[t],s=e.find(e=>e.key===l.key);s&&n.push({...s,width:l.width,frozen:l.frozen})}let l=e.filter(e=>!a.find(t=>t.key===e.key)&&""!==e.name);n=n.concat(l);let s=e.find(e=>e.key===c.od);s&&(n=[s,...n]);let r=e.find(e=>e.key===c.Hy);r&&n.push(r)}return n}var u=n(30221),m=n(11509);let p=e=>{let{projectRef:t,table:n,editable:a=!0,onAddColumn:l,onExpandJSONEditor:r,onExpandTextEditor:c}=e,m=(0,o.rH)(n),p=(0,o.Tk)(t,m.name,m.schema),h=d((0,u.og)(m,{tableId:m.id,editable:a,onAddColumn:a?l:void 0,onExpandJSONEditor:r,onExpandTextEditor:c}),p),f=(0,s.BX)({table:m,originalTable:n,_originalTableRef:(0,s.KR)(n),updateTable:e=>{let t=(0,o.rH)(e),n=d((0,u.og)(t,{tableId:e.id,editable:f.editable,onAddColumn:f.editable?l:void 0,onExpandJSONEditor:r,onExpandTextEditor:c}),{gridColumns:f.gridColumns});f.table=t,f.gridColumns=n,f.originalTable=e,f._originalTableRef=(0,s.KR)(e)},selectedRows:(0,i.zJ)(),allRowsSelected:!1,setSelectedRows:(e,t)=>{f.allRowsSelected=null!=t&&t,f.selectedRows=(0,i.zJ)(e)},gridColumns:h,moveColumn:(e,t)=>{let n=f.gridColumns.findIndex(t=>t.key===e),a=f.gridColumns.findIndex(e=>e.key===t),l=f.gridColumns[n];f.gridColumns.splice(n,1),f.gridColumns.splice(a,0,l)},updateColumnSize:(e,t)=>{f.gridColumns[e]&&(f.gridColumns[e].width=t)},freezeColumn:e=>{let t=f.gridColumns.findIndex(t=>t.key===e);f.gridColumns[t]&&(f.gridColumns[t].frozen=!0)},unfreezeColumn:e=>{let t=f.gridColumns.findIndex(t=>t.key===e);f.gridColumns[t]&&(f.gridColumns[t].frozen=!1)},updateColumnIdx:(e,t)=>{let n=f.gridColumns.findIndex(t=>t.key===e);f.gridColumns[n]&&(f.gridColumns[n].idx=t),f.gridColumns.sort((e,t)=>e.idx-t.idx)},selectedCellPosition:null,setSelectedCellPosition:e=>{f.selectedCellPosition=e},enforceExactCount:!1,setEnforceExactCount:e=>{f.enforceExactCount=e},page:1,setPage:e=>{f.page=e,f.setSelectedRows(new Set)},editable:a,setEditable:e=>{f.editable=e,f.gridColumns=d((0,u.og)(f.table,{tableId:m.id,editable:e,onAddColumn:e?l:void 0,onExpandJSONEditor:r,onExpandTextEditor:c}),{gridColumns:f.gridColumns})}});return f},h=(0,l.createContext)(void 0),f=e=>{let{children:t,projectRef:n,table:r,...i}=e,c=(0,m.ap)(),d=(0,l.useRef)(p({...i,projectRef:n,table:r,onAddColumn:c.onAddColumn,onExpandJSONEditor:(e,t)=>{c.onExpandJSONEditor({column:e,row:t,value:JSON.stringify(t[e])||""})},onExpandTextEditor:(e,t)=>{c.onExpandTextEditor(e,t)}})).current;return(0,l.useEffect)(()=>(0,s.B1)(d,()=>{(0,o.kz)({gridColumns:d.gridColumns,projectRef:n,tableName:d.table.name,schema:d.table.schema})}),[]),(0,l.useEffect)(()=>{d._originalTableRef!==r&&d.updateTable(r)},[r]),(0,l.useEffect)(()=>{if(d.editable!==i.editable){var e;d.setEditable(null==(e=i.editable)||e)}},[i.editable,d]),(0,a.jsx)(h.Provider,{value:d,"data-sentry-element":"TableEditorTableStateContext.Provider","data-sentry-component":"TableEditorTableStateContextProvider","data-sentry-source-file":"table-editor-table.tsx",children:t})},x=e=>{let t=(0,l.useContext)(h);return(0,r.s)(t,e)}},8462:(e,t,n)=>{n.d(t,{li:()=>f,q3:()=>h,tv:()=>x});var a=n(80263),l=n(32144),s=n(67908),r=n(53239),i=n(78741),o=n(76834),c=n(101),d=n(16703),u=n(25400),m=n(11509),p=n(42375);function h(e){let{queryClient:t,projectRef:n,connectionString:a,id:l,sorts:s,filters:r,roleImpersonationState:d}=e;return(0,o.Nj)(t,{projectRef:n,connectionString:a,id:l}).then(e=>{if(e){var o;let u=(0,i.rH)(e),{sorts:p=[],filters:h=[]}=null!=(o=(0,i.Tk)(n,e.name,e.schema))?o:{};(0,c.nk)(t,{projectRef:n,connectionString:a,tableId:l,sorts:null!=s?s:(0,i.FU)(u.name,p),filters:null!=r?r:(0,i.hl)(h),page:1,limit:m.to,roleImpersonationState:d})}})}function f(){let e=(0,s.useRouter)(),t=(0,l.jE)(),{data:n}=(0,d.YA)(),a=(0,u.RY)();return(0,r.useCallback)(l=>{let{id:s,filters:r,sorts:i}=l,o=s?Number(s):void 0;!n||!o||isNaN(o)||(e.prefetch("/project/".concat(n.ref,"/editor/").concat(o)),h({queryClient:t,projectRef:n.ref,connectionString:n.connectionString,id:o,sorts:i,filters:r,roleImpersonationState:a}).catch(()=>{}))},[n,t,a,e])}function x(e){let{projectRef:t,id:n,sorts:l,filters:s,href:r,children:i,...o}=e,c=f();return(0,a.jsx)(p.A,{href:r||"/project/".concat(t,"/editor/").concat(n),prefetcher:()=>c({id:n,sorts:l,filters:s}),...o,"data-sentry-element":"PrefetchableLink","data-sentry-component":"EditorTablePageLink","data-sentry-source-file":"project.$ref.editor.$id.tsx",children:i})}},8552:(e,t,n)=>{n.d(t,{k:()=>a});let a={list:e=>["projects",e,"views"],listBySchema:(e,t)=>[...a.list(e),t]}},14875:(e,t,n)=>{n.d(t,{gt:()=>y,kd:()=>p});var a=n(17769),l=n(32144),s=n(56947),r=n(78741),i=n(76834),o=n(38319),c=n(25400),d=n(20305),u=n(26010),m=n(719);let p=5e4,h="\nCREATE OR REPLACE FUNCTION pg_temp.count_estimate(\n    query text\n) RETURNS integer LANGUAGE plpgsql AS $$\nDECLARE\n    plan jsonb;\nBEGIN\n    EXECUTE 'EXPLAIN (FORMAT JSON)' || query INTO plan;\n    RETURN plan->0->'Plan'->'Plan Rows';\nEND;\n$$;\n".trim(),f=e=>{var t,n,l;let{table:s,filters:r=[],enforceExactCount:i=!1}=e;if(!s)return"";if(i){let e=new a.Query().from(s.name,null!=(t=s.schema)?t:void 0).count();return r.filter(e=>e.value&&""!==e.value).forEach(t=>{let n=(0,m.b)(s,t);e=e.filter(t.column,t.operator,n)}),"select (".concat(e.toSql().slice(0,-1),"), false as is_estimate;")}{let e=new a.Query().from(s.name,null!=(n=s.schema)?n:void 0).select("*");r.filter(e=>e.value&&""!=e.value).forEach(t=>{let n=(0,m.b)(s,t);e=e.filter(t.column,t.operator,n)});let t=e.toSql(),i=new a.Query().from(s.name,null!=(l=s.schema)?l:void 0).count();r.filter(e=>e.value&&""!=e.value).forEach(e=>{let t=(0,m.b)(s,e);i=i.filter(e.column,e.operator,t)});let o=i.toSql().slice(0,-1);return"\n".concat(h,"\n\nwith approximation as (\n    select reltuples as estimate\n    from pg_class\n    where oid = ").concat(s.id,"\n)\nselect \n  case \n    when estimate = -1 then (select pg_temp.count_estimate('").concat(t.replaceAll("'","''"),"'))\n    when estimate > ").concat(p," then ").concat(r.length>0?"pg_temp.count_estimate('".concat(t.replaceAll("'","''"),"')"):"estimate","\n    else (").concat(o,")\n  end as count,\n  estimate = -1 or estimate > ").concat(p," as is_estimate\nfrom approximation;\n").trim()}};async function x(e,t){var n;let{queryClient:a,projectRef:l,connectionString:s,tableId:u,filters:m,roleImpersonationState:p,enforceExactCount:h}=e,x=await (0,i.Nj)(a,{projectRef:l,connectionString:s,id:u});if(!x)throw Error("Table not found");let y=(0,r.rH)(x),g=(0,o.Nf)(f({table:y,filters:m,enforceExactCount:h}),p),{result:v}=await (0,d.E)({projectRef:l,connectionString:s,sql:g,queryKey:["table-rows-count",y.id],isRoleImpersonationEnabled:(0,c._c)(null==p?void 0:p.role)},t);return{count:v[0].count,is_estimate:null!=(n=v[0].is_estimate)&&n}}let y=function(e){let{projectRef:t,connectionString:n,tableId:a,...r}=e,{enabled:i=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=(0,l.jE)();return(0,s.I)(u.j.tableRowsCount(t,{table:{id:a},...r}),e=>{let{signal:l}=e;return x({queryClient:c,projectRef:t,connectionString:n,tableId:a,...r},l)},{enabled:i&&void 0!==t&&void 0!==a,...o})}},16782:(e,t,n)=>{n.d(t,{A:()=>T});var a=n(80263),l=n(83927),s=n.n(l),r=n(68921),i=n(44295),o=n(99489),c=n(96898),d=n(89388),u=n(42872),m=n(24699),p=n(63121),h=n(93749),f=n.n(h),x=n(53239),y=n(35741),g=n(48192),v=n(80127),b=n(77376),_=n(51509),N=n(22554),E=n(50033),j=n(30569),S=n(38112),C=n(68506),w=n(56230);let T=e=>{var t,n,l,h;let{value:T,className:A,enumTypes:I=[],disabled:R=!1,showLabel:k=!0,layout:L="horizontal",description:O,showRecommendation:F=!1,onOptionSelect:D=s()}=e,[P,H]=(0,x.useState)(!1),M=w.x0.concat(I.map(e=>e.format.replaceAll('"',""))),U=!T||M.includes(T),z=w.wy[T],Y="This column's data type cannot be changed via the Table Editor as it is not supported yet. You can do so through the SQL Editor instead.",W=e=>{switch(e){case"number":return(0,a.jsx)(r.A,{size:14,className:"text-foreground",strokeWidth:1.5});case"time":return(0,a.jsx)(i.A,{size:14,className:"text-foreground",strokeWidth:1.5});case"text":return(0,a.jsx)(o.A,{size:14,className:"text-foreground",strokeWidth:1.5});case"json":case"jsonb":return(0,a.jsx)("div",{className:"text-foreground",style:{padding:"0px 1px"},children:"{ }"});case"bool":return(0,a.jsx)(c.A,{size:14,className:"text-foreground",strokeWidth:1.5});default:return(0,a.jsx)(d.A,{size:16,className:"text-foreground",strokeWidth:1.5})}};return U?R&&!k?(0,a.jsxs)(y.m_,{children:[(0,a.jsx)(y.k$,{children:(0,a.jsx)(g.A,{readOnly:!0,disabled:!0,label:k?"Type":"",layout:k?"horizontal":void 0,className:"md:gap-x-0",size:"small",value:T})}),!k&&O&&(0,a.jsx)(y.ZI,{side:"bottom",children:(0,a.jsx)("div",{className:"w-80",children:O})})]}):(0,a.jsxs)("div",{className:(0,v.cn)("flex flex-col gap-y-2",A),"data-sentry-component":"ColumnType","data-sentry-source-file":"ColumnType.tsx",children:[k&&(0,a.jsx)(b.J,{className:"text-foreground-light",children:"Type"}),(0,a.jsxs)(_.AM,{open:P,onOpenChange:H,"data-sentry-element":"Popover_Shadcn_","data-sentry-source-file":"ColumnType.tsx",children:[(0,a.jsx)(_.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"ColumnType.tsx",children:(0,a.jsx)(N.$,{type:"default",role:"combobox",size:"small","aria-expanded":P,className:(0,v.cn)("w-full justify-between",!T&&"text-foreground-lighter"),iconRight:(0,a.jsx)(u.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"}),"data-sentry-element":"Button","data-sentry-source-file":"ColumnType.tsx",children:T?(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)("span",{children:W(null!=(h=null==(t=(e=>{let t=w.fX.find(t=>t.name===e);if(t)return t;let n=I.find(t=>t.format===e);return n?{...n,type:"enum"}:void 0})(T))?void 0:t.type)?h:"")}),T.replaceAll('"',"")]}):"Choose a column type..."})}),(0,a.jsx)(_.hl,{className:"w-[460px] p-0",side:"bottom",align:"center","data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"ColumnType.tsx",children:(0,a.jsx)(E.FK,{className:"h-[335px]","data-sentry-element":"ScrollArea","data-sentry-source-file":"ColumnType.tsx",children:(0,a.jsxs)(j.uB,{"data-sentry-element":"Command_Shadcn_","data-sentry-source-file":"ColumnType.tsx",children:[(0,a.jsx)(j.G7,{placeholder:"Search types...",className:"!bg-transparent focus:!shadow-none focus:!ring-0","data-sentry-element":"CommandInput_Shadcn_","data-sentry-source-file":"ColumnType.tsx"}),(0,a.jsx)(j.xL,{"data-sentry-element":"CommandEmpty_Shadcn_","data-sentry-source-file":"ColumnType.tsx",children:"Type not found."}),(0,a.jsxs)(j.oI,{"data-sentry-element":"CommandList_Shadcn_","data-sentry-source-file":"ColumnType.tsx",children:[(0,a.jsx)(j.L$,{"data-sentry-element":"CommandGroup_Shadcn_","data-sentry-source-file":"ColumnType.tsx",children:w.fX.map(e=>(0,a.jsxs)(j.h_,{value:e.name,className:(0,v.cn)("relative",e.name===T?"bg-surface-200":""),onSelect:e=>{D(e),H(!1)},children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 pr-6",children:[(0,a.jsx)("span",{children:W(e.type)}),(0,a.jsx)("span",{className:"text-foreground",children:e.name}),(0,a.jsx)("span",{className:"text-foreground-lighter",children:e.description})]}),(0,a.jsx)("span",{className:"absolute right-3 top-2",children:e.name===T?(0,a.jsx)(m.A,{className:"text-brand",size:14}):""})]},e.name))}),I.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.h_,{children:"Other types"}),(0,a.jsx)(j.L$,{children:I.map(e=>{var t;return(0,a.jsx)(j.h_,{value:e.format,className:(0,v.cn)("relative",e.format===T?"bg-surface-200":""),onSelect:t=>{D("public"===e.schema?t.replaceAll('"',""):t),H(!1)},children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{children:(0,a.jsx)(d.A,{size:16,className:"text-foreground",strokeWidth:1.5})}),(0,a.jsx)("span",{className:"text-foreground",children:e.format.replaceAll('"',"")}),void 0!==e.comment&&(0,a.jsx)("span",{title:null!=(t=e.comment)?t:"",className:"text-foreground-lighter",children:e.comment}),e.format===T&&(0,a.jsx)("span",{className:"absolute right-3 top-2",children:(0,a.jsx)(m.A,{className:"text-brand",size:14})})]})},e.id)})})]})]})]})})})]}),F&&void 0!==z&&(0,a.jsxs)(S.Fc,{variant:"warning",className:"mt-2",children:[(0,a.jsx)(C.HV,{}),(0,a.jsxs)(S.XL,{children:[" ","It is recommended to use ",(0,a.jsx)("code",{className:"text-xs",children:z.alternative})," ","instead"]}),(0,a.jsxs)(S.TN,{children:[(0,a.jsxs)("p",{children:["Postgres recommends against using the data type"," ",(0,a.jsx)("code",{className:"text-xs",children:T})," unless you have a very specific use case."]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-3",children:[(0,a.jsx)(N.$,{asChild:!0,type:"default",icon:(0,a.jsx)(p.A,{}),children:(0,a.jsx)(f(),{href:z.reference,target:"_blank",rel:"noreferrer",children:"Read more"})}),(0,a.jsxs)(N.$,{type:"primary",onClick:()=>D(z.alternative),children:["Use ",z.alternative]})]})]})]})]}):(0,a.jsxs)(y.m_,{children:[(0,a.jsx)(y.k$,{children:(0,a.jsx)(g.A,{readOnly:!0,disabled:!0,label:k?"Type":"",layout:k?L:void 0,className:"md:gap-x-0 [&>div>div]:text-left",size:"small",icon:W(null!=(l=null==(n=w.fX.find(e=>e.name===T))?void 0:n.type)?l:""),value:T,descriptionText:k?Y:void 0})}),!k&&(0,a.jsx)(y.ZI,{side:"bottom",className:"w-80",children:Y})]})}},18663:(e,t,n)=>{n.d(t,{Fg:()=>a,M0:()=>l,gh:()=>r,h$:()=>s});let a=["text/csv","text/tab-separated-values","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],l=["csv","tsv"],s=0x6400000,r={headers:[],rows:[],rowCount:0,columnTypeMap:{}}},21941:(e,t,n)=>{n.d(t,{F:()=>i});var a=n(53239),l=n(78741),s=n(16703),r=n(4939);function i(){let{data:e}=(0,s.YA)(),t=(0,r.Ir)(),n=(0,a.useCallback)(n=>{let a=null==e?void 0:e.ref;if(!a)return console.warn("[useSaveTableEditorState] ProjectRef missing, cannot save or trigger side effects.");try{var s,r;t.setPage(1),t.setEnforceExactCount(!1);let e=null==(s=t.table)?void 0:s.name,i=null==(r=t.table)?void 0:r.schema;e?(0,l.$S)({projectRef:a,tableName:e,schema:i,...n}):console.warn("[useSaveTableEditorState] Table name missing, skipping localStorage save.")}catch(e){console.error("[useSaveTableEditorState] Error during interaction with snapshot:",e)}},[t,e]);return{saveFiltersAndTriggerSideEffects:(0,a.useCallback)(e=>n({filters:e}),[n]),saveSortsAndTriggerSideEffects:(0,a.useCallback)(e=>n({sorts:e}),[n])}}},22011:(e,t,n)=>{n.d(t,{_:()=>o});var a=n(56947),l=n(70938),s=n(48271),r=n(23879);async function i(e,t){let{projectRef:n,connectionString:a}=e;if(!n)throw Error("projectRef is required");let s=new Headers;a&&s.set("x-connection-encrypted",a);let{data:i,error:o}=await (0,l.Jt)("/platform/pg-meta/{ref}/publications",{params:{header:{"x-connection-encrypted":a,"x-pg-application-name":r.r},path:{ref:n}},headers:s,signal:t});return o&&(0,l.H4)(o),i}let o=function(e){let{projectRef:t,connectionString:n}=e,{enabled:l=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)(s.b.list(t),e=>{let{signal:a}=e;return i({projectRef:t,connectionString:n},a)},{enabled:l&&void 0!==t,...r})}},23542:(e,t,n)=>{n.d(t,{X:()=>s});var a=n(80263),l=n(64495);let s=e=>{let{children:t,side:n,align:s,options:r,onSelect:i,className:o}=e;return(0,a.jsxs)(l.rI,{"data-sentry-element":"DropdownMenu","data-sentry-component":"DropdownControl","data-sentry-source-file":"DropdownControl.tsx",children:[(0,a.jsx)(l.ty,{className:o,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"DropdownControl.tsx",children:t}),(0,a.jsx)(l.SQ,{side:n,align:s,"data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"DropdownControl.tsx",children:(0,a.jsxs)("div",{className:"dropdown-control",style:{maxHeight:"30vh"},children:[0===r.length&&(0,a.jsx)("p",{className:"dropdown-control__empty-text",children:"No more items"}),r.map(e=>(0,a.jsx)(l._2,{onClick:()=>i(e.value),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.preLabel&&(0,a.jsx)("span",{className:"grow text-foreground-lighter",children:e.preLabel}),(0,a.jsx)("span",{children:e.label}),e.postLabel&&(0,a.jsx)("span",{className:"text-foreground-lighter",children:e.postLabel})]})},e.value))]})})]})}},26010:(e,t,n)=>{n.d(t,{j:()=>a});let a={tableRows:function(e){let{table:t,roleImpersonationState:n,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return["projects",e,"table-rows",null==t?void 0:t.id,"rows",{roleImpersonation:null==n?void 0:n.role,...a}]},tableRowsCount:function(e){let{table:t,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return["projects",e,"table-rows",null==t?void 0:t.id,"count",n]},tableRowsAndCount:(e,t)=>["projects",e,"table-rows",t]}},29503:(e,t,n)=>{n.d(t,{p:()=>m});var a=n(80263),l=n(50960),s=n(53239),r=n(70979),i=n(80127),o=n(20838),c=n(22554),d=n(92413);function u(e){let{icon:t,className:n}=e;return(0,a.jsx)("div",{className:(0,i.cn)("absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-foreground-light",n),"data-sentry-component":"InputIconContainer","data-sentry-source-file":"InputIconContainer.tsx",children:t})}let m=(0,s.forwardRef)((e,t)=>{let{copy:n,showCopyOnHover:m=!1,icon:p,reveal:h=!1,actions:f,onCopy:x,iconContainerClassName:y,containerClassName:g,...v}=e,[b,_]=(0,s.useState)("Copy"),[N,E]=(0,s.useState)(!0),j=(0,d.A)("input"),S=[];return p&&S.push(j.with_icon),(0,a.jsxs)("div",{className:(0,i.cn)("relative group",g),children:[(0,a.jsx)(o.p,{ref:t,...v,onCopy:x,value:h&&N?"**** **** **** ****":v.value,className:(0,i.cn)(...S,v.className)}),p&&(0,a.jsx)(u,{icon:p,className:y}),n||f?(0,a.jsxs)("div",{className:j.actions_container,children:[n&&!(h&&N)?(0,a.jsx)(c.$,{size:"tiny",type:"default",className:(0,i.cn)(m&&"opacity-0 group-hover:opacity-100 transition"),icon:(0,a.jsx)(l.A,{size:16,className:"text-foreground-muted"}),onClick:()=>{var e;return e=v.value,void(0,r.l)(e,()=>{_("Copied"),setTimeout(function(){_("Copy")},3e3),null==x||x()})},children:b}):null,h&&N?(0,a.jsx)(c.$,{size:"tiny",type:"default",onClick:function(){E(!1)},children:"Reveal"}):null,f&&f]}):null]})})},29512:(e,t,n)=>{n.d(t,{H:()=>d});var a=n(22990),l=n(32144),s=n(80251),r=n(73969),i=n(20305),o=n(48271);async function c(e){let{projectRef:t,connectionString:n,id:l,tables:s,publish_insert:r,publish_update:o,publish_delete:c,publish_truncate:d}=e,{sql:u}=a.A.publications.update(l,{tables:s,publish_insert:r,publish_update:o,publish_delete:c,publish_truncate:d}),{result:m}=await (0,i.E)({projectRef:t,connectionString:n,sql:u,queryKey:["publication","update",l]});return m}let d=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,l.jE)();return(0,s.n)(e=>c(e),{async onSuccess(t,n,l){let{projectRef:s}=n;await a.invalidateQueries(o.b.list(s)),await (null==e?void 0:e(t,n,l))},async onError(e,n,a){void 0===t?r.oR.error("Failed to update database publication: ".concat(e.message)):t(e,n,a)},...n})}},29785:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(80263),l=n(83927),s=n.n(l),r=n(53239),i=n(22554);let o=e=>{let{loading:t=!1,disableApply:n=!1,hideApply:l=!1,children:o,applyButtonLabel:c="Apply",backButtonLabel:d="Back",applyFunction:u,closePanel:m=s(),formId:p}=e,[h,f]=(0,r.useState)(!1),x=()=>new Promise(e=>u(e)),y=async()=>{f(!0),await x(),f(!1)};return(0,a.jsxs)("div",{className:"flex w-full justify-end space-x-3 border-t border-default px-3 py-4","data-sentry-component":"ActionBar","data-sentry-source-file":"ActionBar.tsx",children:[(0,a.jsx)(i.$,{type:"default",htmlType:"button",onClick:m,disabled:h||t,"data-sentry-element":"Button","data-sentry-source-file":"ActionBar.tsx",children:d}),o,void 0!==u?(0,a.jsx)(i.$,{onClick:y,disabled:n||h||t,loading:h||t,children:c}):l?(0,a.jsx)("div",{}):(0,a.jsx)(i.$,{disabled:t||n,loading:t,"data-testid":"action-bar-save-row",htmlType:"submit",form:p,children:c})]})}},30221:(e,t,n)=>{n.d(t,{lu:()=>ek,AM:()=>eO,og:()=>eL});var a=n(80263),l=n(51553),s=n(33358);let r=e=>{let{row:t,column:n,isNullable:l,onRowChange:r,onClose:i}=e,o=t[n.key];return(0,a.jsxs)(s.Ay,{autoFocus:!0,id:"boolean-editor",name:"boolean-editor",size:"small",onBlur:()=>i(!1),onChange:e=>{let a=e.target.value;"null"===a?r({...t,[n.key]:null},!0):r({...t,[n.key]:"true"===a},!0)},defaultValue:null===o?"null":o.toString(),style:{width:"".concat(n.width,"px")},"data-sentry-element":"Select","data-sentry-component":"BooleanEditor","data-sentry-source-file":"BooleanEditor.tsx",children:[(0,a.jsx)(s.Ay.Option,{value:"true","data-sentry-element":"Select.Option","data-sentry-source-file":"BooleanEditor.tsx",children:"TRUE"}),(0,a.jsx)(s.Ay.Option,{value:"false","data-sentry-element":"Select.Option","data-sentry-source-file":"BooleanEditor.tsx",children:"FALSE"}),l&&(0,a.jsx)(s.Ay.Option,{value:"null",children:"NULL"})]})};var i=n(53434),o=n.n(i),c=n(83759),d=n(53239),u=n(51509),m=n(80127),p=n(22554),h=n(64495),f=n(92737),x=n(29503);let y=e=>{let[t,n]=(0,d.useState)(!1);return(0,d.useEffect)(()=>{let t=t=>{e.current&&!e.current.contains(t.target)?n(!0):n(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[e]),t},g=e=>{let{value:t,children:n,onEscape:l,onEnter:s,ignoreOutsideClicks:r=!1}=e,i=(0,d.useRef)(null),o=y(i),c=(0,d.useCallback)(e=>{switch(e.key){case"Escape":e.stopPropagation(),l&&l(t);break;case"Enter":e.stopPropagation(),!e.shiftKey&&s&&(e.preventDefault(),s(t))}},[t]);return(0,d.useEffect)(()=>{!r&&o&&void 0!==s&&s(t)},[o]),(0,a.jsx)("div",{ref:i,onKeyDown:c,"data-sentry-component":"BlockKeys","data-sentry-source-file":"BlockKeys.tsx",children:n})},v={date:"YYYY-MM-DD",datetime:"YYYY-MM-DD HH:mm:ss",datetimetz:"YYYY-MM-DD HH:mm:ss+ZZ"};function b(e){let{row:t,column:n,type:l,isNullable:s,onRowChange:r,onClose:i}=e,y=(0,d.useRef)(null),b=v[l],_=t[n.key],[N,E]=(0,d.useState)(_),j=N?Number(o()(N,b)):N,S=e=>{("string"!=typeof e||0!==e.length)&&"Invalid Date"!==j&&r({...t,[n.key]:e},!0)},C=()=>{S(o()().format("date"===l?"YYYY-MM-DD":"datetimetz"===l?"YYYY-MM-DDTHH:mm:ssZ":"YYYY-MM-DDTHH:mm:ss"))};return(0,d.useEffect)(()=>{var e,t;try{null==(e=y.current)||e.focus({preventScroll:!0})}catch(e){null==(t=y.current)||t.focus()}},[]),(0,a.jsxs)(u.AM,{open:!0,"data-sentry-element":"Popover_Shadcn_","data-sentry-component":"BaseEditor","data-sentry-source-file":"DateTimeEditor.tsx",children:[(0,a.jsx)(u.Wv,{"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"DateTimeEditor.tsx",children:(0,a.jsx)("div",{className:(0,m.cn)("px-[8px]",null===_?"text-foreground-lighter":""),children:null===_?"NULL":_})}),(0,a.jsxs)(u.hl,{align:"start",className:"p-0 rounded-none w-64","data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"DateTimeEditor.tsx",children:[(0,a.jsx)(g,{ignoreOutsideClicks:!0,value:N,onEscape:()=>i(!1),onEnter:S,"data-sentry-element":"BlockKeys","data-sentry-source-file":"DateTimeEditor.tsx",children:(0,a.jsx)(x.p,{ref:y,value:null!=N?N:"",placeholder:b,onChange:e=>E(e.target.value),className:"border-0 rounded-none bg-dash-sidebar outline-none !ring-0 !ring-offset-0","data-sentry-element":"Input","data-sentry-source-file":"DateTimeEditor.tsx"})}),(0,a.jsxs)("div",{className:"px-3 py-1 flex flex-col gap-y-0.5",children:[(0,a.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Formatted value:"}),0===(null!=N?N:"").length?(0,a.jsx)("p",{className:"text-sm font-mono text-foreground-light",children:"Enter a valid date format"}):"Invalid Date"===j?(0,a.jsx)("p",{className:"text-sm font-mono text-foreground-light",children:"Invalid date format"}):"datetimetz"===l?(0,a.jsx)(f.T,{displayAs:"utc",utcTimestamp:j,labelFormat:"DD MMM YYYY HH:mm:ss (ZZ)",className:"text-left !text-sm font-mono tracking-tight"}):(0,a.jsx)("p",{className:"text-sm font-mono tracking-tight",children:(0,f.K)({utcTimestamp:j,format:"date"===l?"DD MMM YYYY":"datetime"===l?"DD MMM YYYY HH:mm:ss":void 0})})]}),(0,a.jsxs)("div",{className:"px-3 pt-1 pb-2 flex justify-between gap-x-1",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"px-1.5 h-[22px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-[10px]",children:"⏎"})}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Save changes"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"px-1 h-[22px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-[10px]",children:"Esc"})}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Cancel changes"})]})]}),(0,a.jsx)("div",{className:"flex",children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.$,{type:"default",className:"rounded-r-none",onClick:()=>S(null),children:"Set NULL"}),(0,a.jsxs)(h.rI,{children:[(0,a.jsx)(h.ty,{asChild:!0,children:(0,a.jsx)(p.$,{type:"default",icon:(0,a.jsx)(c.A,{}),className:"px-1 rounded-l-none border-l-0"})}),(0,a.jsx)(h.SQ,{className:"w-20",align:"end",children:(0,a.jsx)(h._2,{onClick:C,children:"Set to NOW"})})]})]}):(0,a.jsx)(p.$,{type:"default",onClick:C,children:"Set to NOW"})})]})]})]})}function _(e,t){return n=>(0,a.jsx)(b,{...n,type:e,isNullable:t})}var N=n(81247),E=n(73969),j=n(46491),S=n(94887),C=n(76834),w=n(74388),T=n(1095),A=n(16703),I=n(46895),R=n(97128),k=n(35741),L=n(75338),O=n(53469),F=n(48177);let D=e=>{let{isLoading:t,loadFullValue:n}=e;return(0,a.jsxs)("div",{className:(0,m.cn)("absolute top-0 left-0 flex items-center justify-center flex-col gap-y-3","text-xs w-full h-full px-3 text-center","bg-default/80 backdrop-blur-[1.5px]"),"data-sentry-component":"TruncatedWarningOverlay","data-sentry-source-file":"TruncatedWarningOverlay.tsx",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,a.jsxs)("p",{children:["Value is larger than ",F.SF.toLocaleString()," characters"]}),(0,a.jsx)("p",{className:"text-foreground-light",children:"You may try to render the entire value, but your browser may run into performance issues"})]}),(0,a.jsx)(p.$,{type:"default",loading:t,onClick:n,"data-sentry-element":"Button","data-sentry-source-file":"TruncatedWarningOverlay.tsx",children:"Load full value"})]})},P=e=>{try{return JSON.parse(e),!0}catch(e){return!1}},H=e=>{try{let t=JSON.parse(e);return JSON.stringify(t)}catch(t){if("string"==typeof e)return e.replaceAll('"','"');return JSON.stringify(e)}},M=e=>{let{row:t,column:n,isEditable:l=!0,onRowChange:s,onExpandEditor:r}=e,{id:i}=(0,j.g)(),o=i?Number(i):void 0,{data:c}=(0,A.YA)(),{data:u}=(0,C.Pk)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString,id:o}),m=t[n.key],p=null==m||"string"==typeof m?m:JSON.stringify(m),h=(0,I.G1)(p?H(p):""),f=(0,S.Mr)(p),[x,y]=(0,d.useState)(!0),[v,b]=(0,d.useState)(h),{mutate:_,isLoading:F,isSuccess:M}=(0,T.c2)(),U=(0,d.useCallback)(()=>{l&&s(t,!0),y(!1)},[]),z=(0,d.useCallback)(e=>{(null!==e?(0,I.Cf)(e):e)!==v?W(e):y(!1)},[M]),Y=()=>{U(),r(n.key,{...t,[n.key]:(0,I.Bl)(v)||t[n.key]})},W=e=>{if(l)if(e)if(P(e)){let a=JSON.parse(e);s({...t,[n.key]:a},!0),y(!1)}else E.oR.error("Please enter a valid JSON");else s({...t,[n.key]:null},!0),y(!1)};return(0,a.jsx)(R.A,{open:x,side:"bottom",align:"start",sideOffset:-35,className:"rounded-none",overlay:f&&!M?(0,a.jsxs)("div",{style:{width:"".concat(n.width,"px")},className:"flex items-center justify-center flex-col relative",children:[(0,a.jsx)(L.T,{readOnly:!0,onChange:()=>{},width:"".concat(n.width,"px"),value:null!=v?v:"",language:"markdown"}),(0,a.jsx)(D,{isLoading:F,loadFullValue:()=>{if(void 0===u||void 0===c||!(0,w.KO)(u))return;if(0===u.primary_keys.length)return(0,E.oR)("Unable to load value as table has no primary keys");let e=u.primary_keys.reduce((e,n)=>({...e,[n.name]:t[n.name]}),{});_({table:{schema:u.schema,name:u.name},column:n.name,pkMatch:e,projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString},{onSuccess:e=>{b(JSON.stringify(e))}})}})]}):(0,a.jsxs)(g,{value:v,onEscape:U,onEnter:z,children:[(0,a.jsx)(L.T,{width:"".concat(n.width,"px"),value:null!=v?v:"",language:"json",readOnly:!l,onChange:e=>{l&&(e&&""!=e?b(e):b(null))}}),(0,a.jsxs)("div",{className:"flex items-start justify-between p-2 bg-surface-200 gap-x-2",children:[l&&(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"px-1.5 py-[2.5px] rounded bg-selection border border-strong flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-[10px]",children:"⏎"})}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Save changes"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"px-1 py-[2.5px] rounded bg-selection border border-strong flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-[10px]",children:"Esc"})}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Cancel changes"})]})]}),(0,a.jsxs)(k.m_,{children:[(0,a.jsx)(k.k$,{asChild:!0,children:(0,a.jsx)("div",{className:"border border-strong rounded p-1 flex items-center justify-center transition cursor-pointer bg-selection hover:bg-border-strong",onClick:()=>Y(),children:(0,a.jsx)(N.A,{size:12,strokeWidth:2})})}),(0,a.jsx)(k.ZI,{side:"bottom",align:"center",children:(0,a.jsx)("span",{children:"Expand editor"})})]})]})]}),"data-sentry-element":"Popover","data-sentry-component":"JsonEditor","data-sentry-source-file":"JsonEditor.tsx",children:(0,a.jsx)("div",{className:"".concat(v&&0==h.trim().length?"sb-grid-fill-container":""," sb-grid-json-editor__trigger"),onClick:()=>y(!x),children:null===v||""===v?(0,a.jsx)(O.X,{}):h})})};function U(e){null==e||e.focus(),null==e||e.select()}function z(e){let{row:t,column:n,onRowChange:l,onClose:s}=e,r=t[n.key];return(0,a.jsx)("input",{className:"sb-grid-number-editor",ref:U,value:null!=r?r:"",onChange:function(e){let a=e.target.value;""===a?l({...t,[n.key]:null}):l({...t,[n.key]:a})},onBlur:function(){s(!0)},type:"number","data-sentry-component":"NumberEditor","data-sentry-source-file":"NumberEditor.tsx"})}function Y(e){let{row:t,column:n,onRowChange:l,onClose:r,options:i,isNullable:o}=e,c=t[n.key];return(0,a.jsxs)(s.Ay,{autoFocus:!0,id:"select-editor",name:"select-editor",size:"small",defaultValue:null!=c?c:"",className:"sb-grid-select-editor !gap-2",style:{width:"".concat(n.width,"px")},onChange:function(e){e.target.value&&""!=e.target.value?l({...t,[n.key]:e.target.value},!0):l({...t,[n.key]:null},!0)},onBlur:function(){r(!1)},"data-sentry-element":"Select","data-sentry-component":"SelectEditor","data-sentry-source-file":"SelectEditor.tsx",children:[o&&(0,a.jsx)(s.Ay.Option,{value:"",children:"NULL"}),i.map(e=>{let{label:t,_value:n}=e;return(0,a.jsx)(s.Ay.Option,{value:n,selected:n===c,children:t},n)})]})}var W=n(86336);let K=()=>(0,a.jsx)("span",{className:"sb-grid-empty-value opacity-50","data-sentry-component":"EmptyValue","data-sentry-source-file":"EmptyValue.tsx",children:"EMPTY"}),B=e=>{let{row:t,column:n,isNullable:l,isEditable:s,onRowChange:r,onExpandEditor:i}=e,{id:o}=(0,j.g)(),c=o?Number(o):void 0,{data:u}=(0,A.YA)(),{data:h}=(0,C.Pk)({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString,id:c}),f=t[n.key],x=f||""===f?String(f):null,[y,v]=(0,d.useState)(!0),[b,_]=(0,d.useState)(x),[I,F]=(0,d.useState)(!1),{mutate:P,isLoading:H,isSuccess:M}=(0,T.c2)(),U=(0,S.Mr)(x),z=(0,d.useCallback)(()=>{s&&r(t,!0),v(!1)},[]),Y=(0,d.useCallback)(e=>{s&&e!==b&&r({...t,[n.key]:e},!0),v(!1)},[M]),B=()=>{z(),i(n.key,{...t,[n.key]:b||t[n.key]})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.A,{open:y,side:"bottom",align:"start",sideOffset:-35,className:"rounded-none",overlay:U&&!M?(0,a.jsxs)("div",{style:{width:"".concat(n.width,"px")},className:"flex items-center justify-center flex-col relative",children:[(0,a.jsx)(L.T,{readOnly:!0,onChange:()=>{},width:"".concat(n.width,"px"),value:null!=b?b:"",language:"markdown"}),(0,a.jsx)(D,{isLoading:H,loadFullValue:()=>{if(void 0===h||void 0===u||!(0,w.KO)(h))return;if(0===h.primary_keys.length)return(0,E.oR)("Unable to load value as table has no primary keys");let e=h.primary_keys.reduce((e,n)=>({...e,[n.name]:t[n.name]}),{});P({table:{schema:h.schema,name:h.name},column:n.name,pkMatch:e,projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString},{onSuccess:e=>_(e)})}})]}):(0,a.jsxs)(g,{value:b,onEscape:z,onEnter:Y,ignoreOutsideClicks:I,children:[(0,a.jsx)(L.T,{width:"".concat(n.width,"px"),value:null!=b?b:"",readOnly:!s,onChange:e=>{s&&(e?_(e):_(""))}}),s&&(0,a.jsxs)("div",{className:"flex items-start justify-between p-2 bg-surface-200 space-x-2",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"px-1.5 py-[2.5px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-[10px]",children:"⏎"})}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Save changes"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"px-1 py-[2.5px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-[10px]",children:"Esc"})}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Cancel changes"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end gap-y-1",children:[(0,a.jsxs)(k.m_,{children:[(0,a.jsx)(k.k$,{asChild:!0,children:(0,a.jsx)(p.$,{type:"default",className:"px-1",onClick:()=>B(),icon:(0,a.jsx)(N.A,{size:12,strokeWidth:2})})}),(0,a.jsx)(k.ZI,{side:"bottom",children:"Expand editor"})]}),l&&(0,a.jsx)(p.$,{size:"tiny",type:"default",htmlType:"button",onClick:()=>F(!0),children:"Set to NULL"})]})]})]}),"data-sentry-element":"Popover","data-sentry-source-file":"TextEditor.tsx",children:(0,a.jsx)("div",{className:(0,m.cn)(!!b&&0===b.toString().trim().length&&"sb-grid-fill-container","sb-grid-text-editor__trigger"),onClick:()=>v(!y),children:null===b?(0,a.jsx)(O.X,{}):""===b?(0,a.jsx)(K,{}):b})}),(0,a.jsx)(W.A,{visible:I,title:"Confirm setting value to NULL",confirmLabel:"Confirm",onCancel:()=>F(!1),onConfirm:()=>{Y(null)},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"TextEditor.tsx",children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you wish to set this value to NULL? This action cannot be undone."})})]})};var q=n(79054),V=n.n(q);function G(e){null==e||e.focus(),null==e||e.select()}o().extend(V());let $="HH:mm:ss";function J(e){let{row:t,column:n,format:l,onRowChange:s,onClose:r}=e,i=t[n.key],c=i?o()(i,l).format($):i;return(0,a.jsx)("input",{className:"sb-grid-time-editor",ref:G,value:null!=c?c:"",onChange:function(e){let a=e.target.value;if(""==a)s({...t,[n.key]:null});else{let e=o()(a,$).format(l);s({...t,[n.key]:e})}},onBlur:()=>r(!0),type:"time",step:"1","data-sentry-component":"BaseEditor","data-sentry-source-file":"TimeEditor.tsx"})}function Q(e){return(0,a.jsx)(J,{...e,format:"HH:mm:ss","data-sentry-element":"BaseEditor","data-sentry-component":"TimeEditor","data-sentry-source-file":"TimeEditor.tsx"})}function X(e){return(0,a.jsx)(J,{...e,format:"HH:mm:ssZZ","data-sentry-element":"BaseEditor","data-sentry-component":"TimeWithTimezoneEditor","data-sentry-source-file":"TimeEditor.tsx"})}let Z=e=>{let t=e.row[e.column.key];if(!t)return(0,a.jsx)(O.X,{});let n=(0,S.ds)(t);return(0,a.jsx)(a.Fragment,{children:n})},ee=e=>{let t=e.row[e.column.key];return null===t?(0,a.jsx)(O.X,{}):(0,a.jsx)(a.Fragment,{children:t?"TRUE":"FALSE"})},et=e=>{let t=e.row[e.column.key];return null===t?(0,a.jsx)(O.X,{}):""===t?(0,a.jsx)(K,{}):(("object"==typeof t||Array.isArray(t))&&(t=JSON.stringify(t)),(0,a.jsx)(a.Fragment,{children:t}))};var en=n(32513),ea=n(84558),el=n(4107),es=n(10208),er=n(24560),ei=n(8462),eo=n(101),ec=n(96827);let ed=e=>{var t,n;let{table:s,column:r,value:i}=e,{ref:o}=(0,j.g)(),{data:c}=(0,A.YA)(),{data:d,error:u,isSuccess:h,isError:f,isLoading:x}=(0,eo.vs)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString,tableId:s.id,filters:[{column:r,operator:"=",value:i}],page:1,limit:10},{keepPreviousData:!0}),y=s.primary_keys.map(e=>e.name),g=(null!=(t=null==s?void 0:s.columns)?t:[]).map(e=>{let t=eO({dataType:e.data_type,format:e.format}),n=(e.name.length+e.format.length)*ek,s=y.includes(e.name);return{key:e.name,name:e.name,resizable:!1,draggable:!1,sortable:!1,width:t<n?n:t,minWidth:l.T_,headerCellClass:"outline-none !shadow-none",renderHeaderCell:()=>(0,a.jsxs)("div",{className:"flex h-full items-center justify-center gap-x-2",children:[s&&(0,a.jsxs)(k.m_,{children:[(0,a.jsx)(k.k$,{children:(0,a.jsx)(es.A,{size:14,strokeWidth:2,className:"text-brand rotate-45"})}),(0,a.jsx)(k.ZI,{side:"bottom",children:"Primary key"})]}),(0,a.jsx)("span",{className:"text-xs truncate",children:e.name}),(0,a.jsx)("span",{className:"text-xs text-foreground-light font-normal",children:e.format})]}),renderCell:t=>{let{column:n,row:l}=t,s=l[n.name],r="bytea"===e.format?(0,S.ds)(s):s;return(0,a.jsx)("div",{className:(0,m.cn)("flex items-center h-full w-full whitespace-pre",null===r&&"text-foreground-lighter"),children:null===r?"NULL":r})}}});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"px-2 py-2 text-xs text-foreground-light border-b",children:["Referencing record from"," ",(0,a.jsxs)("span",{className:"text-foreground",children:[s.schema,".",s.name]}),":"]}),(0,a.jsx)(er.Ay,{className:"h-32 rounded-b border-0",columns:g,rows:null!=(n=null==d?void 0:d.rows)?n:[],onCellDoubleClick:(e,t)=>{t.preventDefault(),t.stopPropagation()},renderers:{noRowsFallback:(0,a.jsxs)("div",{className:"w-96 px-2",children:[x&&(0,a.jsx)("div",{className:"py-2",children:(0,a.jsx)(ec.A,{})}),f&&(0,a.jsxs)("p",{className:"text-foreground-light",children:["Failed to find referencing row: ",u.message]}),h&&(0,a.jsx)("p",{className:"text-foreground-light",children:"No results were returned"})]})},"data-sentry-element":"DataGrid","data-sentry-source-file":"ReferenceRecordPeek.tsx"}),(0,a.jsx)("div",{className:"flex items-center justify-end px-2 py-1",children:(0,a.jsx)(ei.tv,{href:"/project/".concat(o,"/editor/").concat(s.id,"?schema=").concat(s.schema,"&filter=").concat(r,"%3Aeq%3A").concat(i),projectRef:o,id:String(s.id),filters:[{column:r,operator:"=",value:String(i)}],"data-sentry-element":"EditorTablePageLink","data-sentry-source-file":"ReferenceRecordPeek.tsx",children:(0,a.jsx)(p.$,{type:"default","data-sentry-element":"Button","data-sentry-source-file":"ReferenceRecordPeek.tsx",children:"Open table"})})})]})},eu=e=>{var t;let{tableId:n,row:l,column:s}=e,{data:r}=(0,A.YA)(),{data:i}=(0,C.Pk)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,id:n}),o=null==i?void 0:i.columns.find(e=>e.name===s.key),c=(0,w.KO)(i)?i:void 0,d=(null!=(t=null==c?void 0:c.relationships)?t:[]).find(e=>e.source_schema===(null==c?void 0:c.schema)&&e.source_table_name===(null==c?void 0:c.name)&&e.source_column_name===s.name),{data:m}=(0,el.LW)({projectRef:null==r?void 0:r.ref,includeColumns:!0,connectionString:null==r?void 0:r.connectionString,schema:null==d?void 0:d.target_table_schema}),p=null==m?void 0:m.find(e=>e.schema===(null==d?void 0:d.target_table_schema)&&e.name===d.target_table_name),h=l[s.key],f=(null==o?void 0:o.format)==="bytea"&&h?(0,S.ds)(h):h;return(0,a.jsxs)("div",{className:"sb-grid-foreign-key-formatter flex justify-between","data-sentry-component":"ForeignKeyFormatter","data-sentry-source-file":"ForeignKeyFormatter.tsx",children:[(0,a.jsx)("span",{className:"sb-grid-foreign-key-formatter__text",children:null===f?(0,a.jsx)(O.X,{}):f}),void 0!==d&&void 0!==p&&null!==f&&(0,a.jsxs)(u.AM,{children:[(0,a.jsx)(u.Wv,{asChild:!0,children:(0,a.jsx)(ea.G,{type:"default",className:"w-6 h-6",icon:(0,a.jsx)(en.A,{}),onClick:e=>e.stopPropagation(),tooltip:{content:{side:"bottom",text:"View referencing record"}}})}),(0,a.jsx)(u.hl,{portal:!0,align:"end",className:"p-0 w-96",children:(0,a.jsx)(ed,{table:p,column:d.target_column_name,value:f})})]})]})},em=e=>{let t=e.row[e.column.key];if(null===t)return(0,a.jsx)(O.X,{});if(""===t)return(0,a.jsx)(K,{});if("string"==typeof t&&t.endsWith("..."))return(0,a.jsx)(a.Fragment,{children:t});try{let e=JSON.parse(t);return(0,a.jsx)(a.Fragment,{children:JSON.stringify(e)})}catch(e){return(0,a.jsx)(a.Fragment,{children:JSON.stringify(t)})}};var ep=n(7005),eh=n(11509);let ef={key:l.Hy,name:"",idx:999,width:100,maxWidth:100,resizable:!1,sortable:!1,frozen:!1,isLastFrozenColumn:!1,renderHeaderCell:()=>(0,a.jsx)(ex,{"aria-label":"Add New Row"}),renderCell:et,parent:void 0,level:0,minWidth:0,draggable:!1},ex=()=>{let e=(0,eh.ap)();return(0,a.jsx)("div",{className:"flex h-full w-full py-1.5 flex items-center","data-sentry-component":"AddColumnHeader","data-sentry-source-file":"AddColumn.tsx",children:(0,a.jsx)(p.$,{block:!0,type:"text",onClick:e.onAddColumn,icon:(0,a.jsx)(ep.A,{}),"data-sentry-element":"Button","data-sentry-source-file":"AddColumn.tsx"})})};var ey=n(13322),eg=n(97485),ev=n(25212),eb=n(30068),e_=n(59955),eN=n(47923),eE=n(4939),ej=n(60627);function eS(e){var t,n;let{column:l,columnType:s,isPrimaryKey:r,isEncrypted:i,format:o,foreignKey:c}=e,u=(0,d.useRef)(null),m=l.idx,p=l.key,h=(t=s,n=o,"array"==t?"".concat(n.replace("_",""),"[]"):n),f=(0,eE.Ir)(),x=l.name;(0,d.useEffect)(()=>{f.gridColumns[m].key!=p&&f.updateColumnIdx(p,m)},[p,m,f.gridColumns]);let[{isDragging:y},g]=(0,ev.i)({type:"column-header",item:()=>({key:p,index:m}),canDrag:()=>!l.frozen,collect:e=>({isDragging:e.isDragging()})}),[{handlerId:v},b]=(0,eb.H)({accept:"column-header",collect:e=>({handlerId:e.getHandlerId()}),hover(e,t){var n;if(!u.current||l.frozen)return;let a=e.index,s=e.key;if(a===m)return;let r=null==(n=u.current)?void 0:n.getBoundingClientRect(),i=(r.right-r.left)/2,o=t.getClientOffset().x-r.left;(!(a<m)||!(o<i))&&(a>m&&o>i||(f.moveColumn(s,p),e.index=m))}}),_=l.frozen?"sb-grid-column-header--cursor":"";return g(b(u)),(0,a.jsx)("div",{ref:u,"data-handler-id":v,style:{opacity:+!y},className:"w-full","data-sentry-component":"ColumnHeader","data-sentry-source-file":"ColumnHeader.tsx",children:(0,a.jsxs)("div",{className:"sb-grid-column-header ".concat(_),children:[(0,a.jsxs)("div",{className:"sb-grid-column-header__inner",children:[function(e,t){let{name:n,foreignKey:l}=t;return"foreign_key"===e?(0,a.jsxs)(k.m_,{children:[(0,a.jsx)(k.k$,{children:(0,a.jsx)(eg.A,{size:14,strokeWidth:2})}),(0,a.jsx)(k.ZI,{side:"bottom",children:(0,a.jsxs)("div",{className:"font-normal",children:[(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Foreign key relation:"}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("p",{className:"text-xs !text-foreground",children:n}),(0,a.jsx)(en.A,{size:14,strokeWidth:1.5,className:"!text-foreground-light"}),(0,a.jsxs)("p",{className:"text-xs !text-foreground",children:[null==l?void 0:l.targetTableSchema,".",null==l?void 0:l.targetTableName,".",null==l?void 0:l.targetColumnName]})]}),(null==l?void 0:l.updateAction)!==eN.P.NO_ACTION&&(0,a.jsxs)("p",{className:"text-xs !text-foreground mt-1",children:["On update: ",(0,e_.Er)(null==l?void 0:l.updateAction)]}),(null==l?void 0:l.deletionAction)!==eN.P.NO_ACTION&&(0,a.jsxs)("p",{className:"text-xs !text-foreground mt-1",children:["On delete: ",(0,e_.Er)(null==l?void 0:l.deletionAction)]})]})})]}):null}(s,{name:l.name,foreignKey:c}),r&&(0,a.jsxs)(k.m_,{children:[(0,a.jsx)(k.k$,{children:(0,a.jsx)("div",{className:"sb-grid-column-header__inner__primary-key",children:(0,a.jsx)(es.A,{size:14,strokeWidth:2})})}),(0,a.jsx)(k.ZI,{side:"bottom",className:"font-normal",children:"Primary key"})]}),(0,a.jsx)("span",{className:"sb-grid-column-header__inner__name",title:x,children:l.name}),(0,a.jsxs)("span",{className:"sb-grid-column-header__inner__format",children:[h,"bytea"===h?" (hex)":""]}),i&&(0,a.jsxs)(k.m_,{children:[(0,a.jsx)(k.k$,{children:(0,a.jsx)(ey.A,{size:14,strokeWidth:2})}),(0,a.jsx)(k.ZI,{side:"bottom",className:"font-normal",children:"Encrypted column"})]})]}),(0,a.jsx)(ej.WS,{column:l,isEncrypted:i,"data-sentry-element":"ColumnMenu","data-sentry-source-file":"ColumnHeader.tsx"})]})})}var eC=n(51968);let ew={key:l.od,name:"",idx:0,width:65,maxWidth:65,resizable:!1,sortable:!1,frozen:!0,isLastFrozenColumn:!1,renderHeaderCell:e=>{let[t,n]=(0,er.Uk)();return(0,a.jsx)(eI,{"aria-label":"Select All",tabIndex:e.tabIndex,value:t,onChange:e=>n({type:"HEADER",checked:e})})},renderCell:e=>{let[t,n]=(0,er.Uk)();return(0,a.jsx)(eA,{"aria-label":"Select",tabIndex:e.tabIndex,value:t,row:e.row,onChange:(t,a)=>{n({type:"ROW",row:e.row,checked:t,isShiftClick:a})},onClick:eT})},renderGroupCell:e=>{let[t,n]=(0,er.Uk)();return(0,a.jsx)(eA,{"aria-label":"Select Group",tabIndex:e.tabIndex,value:t,onChange:t=>{n({type:"ROW",row:e.row,checked:t,isShiftClick:!1})},onClick:eT})},parent:void 0,level:0,minWidth:0,draggable:!1};function eT(e){e.stopPropagation()}function eA(e){let{row:t,value:n,tabIndex:l,disabled:s,onClick:r,onChange:i,"aria-label":o,"aria-labelledby":c}=e,d=(0,eh.ap)();return(0,a.jsxs)("div",{className:"sb-grid-select-cell__formatter","data-sentry-component":"SelectCellFormatter","data-sentry-source-file":"SelectColumn.tsx",children:[(0,a.jsx)("input",{"aria-label":o,"aria-labelledby":c,tabIndex:l,type:"checkbox",className:"rdg-row__select-column__select-action",disabled:s,checked:n,onChange:function(e){i(e.target.checked,e.nativeEvent.shiftKey)},onClick:r}),t&&(0,a.jsx)(ea.G,{type:"text",size:"tiny",className:"px-1 rdg-row__select-column__edit-action",icon:(0,a.jsx)(eC.A,{}),onClick:function(e){e.stopPropagation(),t&&d.onEditRow(t)},tooltip:{content:{side:"bottom",text:"Expand row"}}})]})}function eI(e){let{disabled:t,tabIndex:n,value:l,onChange:s,onClick:r,"aria-label":i,"aria-labelledby":o}=e,c=(0,eE.Ir)(),u=(0,d.useRef)(null),m=c.selectedRows.size>0&&!c.allRowsSelected;return(0,d.useEffect)(()=>{u.current&&(u.current.indeterminate=m)},[m]),(0,a.jsx)("div",{className:"sb-grid-select-cell__header","data-sentry-component":"SelectCellHeader","data-sentry-source-file":"SelectColumn.tsx",children:(0,a.jsx)("input",{ref:u,"aria-label":i,"aria-labelledby":o,tabIndex:n,type:"checkbox",className:"sb-grid-select-cell__header__input",disabled:t,checked:l,onChange:function(e){s(e.target.checked,e.nativeEvent.shiftKey)},onClick:r})})}var eR=n(88503);let ek=9;function eL(e,t){let n=[ew,...e.columns.map((e,n)=>{var s;let i=function(e){if((0,eR.e2)(e))return"foreign_key";if((0,eR.n0)(e.dataType))return"number";if((0,eR.ao)(e.dataType))return"array";if((0,eR.Lj)(e.dataType))return"json";if((0,eR.cx)(e.dataType))return"text";else if((0,eR._c)(e.format))return"citext";else if((0,eR.hB)(e.format))return"date";else if((0,eR.I)(e.format))return"time";else if((0,eR.KV)(e.format))return"datetime";else if((0,eR.th)(e.dataType))return"boolean";else if((0,eR.AM)(e.dataType))return"enum";else if((0,eR.yB)(e.dataType))return"binary";else return"unknown"}(e),o=eO(e),c=(e.name.length+e.format.length)*ek,d=(null==t?void 0:t.defaultWidth)?t.defaultWidth:o<c?c:o;return{key:e.name,name:e.name,idx:n+1,resizable:!0,sortable:!0,width:d,minWidth:l.T_,frozen:e.isPrimaryKey||!1,isLastFrozenColumn:!1,renderHeaderCell:t=>(0,a.jsx)(eS,{...t,columnType:i,isPrimaryKey:e.isPrimaryKey,isEncrypted:e.isEncrypted,format:e.format,foreignKey:e.foreignKey}),renderEditCell:t?function(e,t,n,l,s){if(!n)if(["array","json"].includes(t))return e=>(0,a.jsx)(M,{...e,isEditable:n,onExpandEditor:l});else if(!["number","boolean"].includes(t))return e=>(0,a.jsx)(B,{...e,isEditable:n,onExpandEditor:s});else return;if(!e.isPrimaryKey&&e.isUpdatable)switch(t){case"boolean":return t=>(0,a.jsx)(r,{...t,isNullable:e.isNullable});case"date":return _("date",e.isNullable||!1);case"datetime":return e.format.endsWith("z")?_("datetimetz",e.isNullable||!1):_("datetime",e.isNullable||!1);case"time":return e.format.endsWith("z")?X:Q;case"enum":{let t=e.enum.map(e=>({label:e,value:e}));return n=>(0,a.jsx)(Y,{...n,options:t,isNullable:e.isNullable})}case"array":case"json":return e=>(0,a.jsx)(M,{...e,onExpandEditor:l});case"number":return z;case"citext":case"text":return t=>(0,a.jsx)(B,{...t,isEditable:n,isNullable:e.isNullable,onExpandEditor:s});default:return}}(e,i,null!=(s=null==t?void 0:t.editable)&&s,t.onExpandJSONEditor,t.onExpandTextEditor):void 0,renderCell:function(e,t,n){switch(t){case"boolean":return ee;case"foreign_key":if(!e.isUpdatable)return et;return e=>(0,a.jsx)(eu,{...e,tableId:n.tableId});case"binary":return Z;case"json":return em;default:return et}}(e,i,{tableId:null==t?void 0:t.tableId}),parent:void 0,level:0,maxWidth:void 0,draggable:!1}})];return(null==t?void 0:t.onAddColumn)&&n.push(ef),n}function eO(e){return(0,eR.n0)(e.dataType)?120:(0,eR.KV)(e.format)||(0,eR.hB)(e.format)||(0,eR.I)(e.format)?150:(0,eR.th)(e.dataType)?120:(0,eR.AM)(e.dataType)?150:250}},33358:(e,t,n)=>{n.d(t,{Ay:()=>u});var a=n(80263),l=n(53239),s=n(65988),r=n(74512),i=n(30069),o=n(92413),c=n(38583);function d(e){let{autoComplete:t,autofocus:n,children:d,className:u,descriptionText:m,disabled:p,error:h,icon:f,id:x="",inputRef:y,label:g,afterLabel:v,beforeLabel:b,labelOptional:_,layout:N,name:E="",onChange:j,onBlur:S,placeholder:C,required:w,value:T,defaultValue:A,style:I,size:R="medium",borderless:k=!1,validation:L,...O}=e,{formContextOnChange:F,values:D,errors:P,handleBlur:H,touched:M,fieldLevelValidation:U}=(0,c.x)();D&&!T&&(T=D[x]),h||(P&&!h&&(h=P[x||E]),h=M&&M[x||E]?h:void 0),(0,l.useEffect)(()=>{L&&U(x,L(T))},[]);let z=(0,o.A)("select"),Y=[z.container];u&&Y.push(u);let W=[z.base];return h&&W.push(z.variants.error),h||W.push(z.variants.standard),f&&W.push(z.with_icon),R&&W.push(z.size[R]),p&&W.push(z.disabled),(0,a.jsx)(s.H,{label:g,afterLabel:v,beforeLabel:b,labelOptional:_,layout:N,id:x,error:h,descriptionText:m,className:u,style:I,size:R,"data-sentry-element":"FormLayout","data-sentry-component":"Select","data-sentry-source-file":"Select.tsx",children:(0,a.jsxs)("div",{className:z.container,children:[(0,a.jsx)("select",{id:x,name:E,"data-size":R,defaultValue:A,autoComplete:t,autoFocus:n,className:W.join(" "),onChange:function(e){j&&j(e),F&&F(e),L&&U(x,L(e.target.value))},onBlur:function(e){H&&H(e),S&&S(e)},ref:y,value:T,disabled:p,required:w,placeholder:C,...O,children:d}),f&&(0,a.jsx)(i.A,{size:R,icon:f}),h&&(0,a.jsx)("div",{className:z.actions_container,children:h&&(0,a.jsx)(r.A,{size:R})}),(0,a.jsx)("span",{className:z.chevron_container,children:(0,a.jsx)("svg",{className:z.chevron,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-sentry-element":"svg","data-sentry-source-file":"Select.tsx",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd","data-sentry-element":"path","data-sentry-source-file":"Select.tsx"})})})]})})}d.Option=function(e){let{value:t,children:n,selected:l}=e;return(0,a.jsx)("option",{value:t,selected:l,"data-sentry-component":"Option","data-sentry-source-file":"Select.tsx",children:n})},d.OptGroup=function(e){let{label:t,children:n}=e;return(0,a.jsx)("optgroup",{label:t,"data-sentry-component":"OptGroup","data-sentry-source-file":"Select.tsx",children:n})};let u=d},34071:(e,t,n)=>{n.d(t,{o:()=>s});var a=n(67908),l=n(53239);let s=()=>{let e=(0,a.useRouter)(),t=(0,l.useMemo)(()=>new URLSearchParams(e.asPath.split("?")[1]),[e.asPath]),n=(0,l.useMemo)(()=>t.getAll("filter"),[t]),s=(0,l.useMemo)(()=>t.getAll("sort"),[t]);return{filters:n,sorts:s,setParams:t=>{let a=t({filter:n,sort:s}),l=void 0!==a.filter,r=void 0!==a.sort;e.push({query:{...e.query,...l?{filter:a.filter}:{},...r?{sort:a.sort}:{}}})}}}},41336:(e,t,n)=>{n.d(t,{F:()=>m});var a=n(80263),l=n(53239),s=n(92413),r=n(20835),i=n(80551),o=n(92818),c=n(80797),d=n(36839);let u={danger:(0,a.jsx)(r.A,{strokeWidth:1.5,size:18}),success:(0,a.jsx)(i.A,{strokeWidth:1.5,size:18}),warning:(0,a.jsx)(o.A,{strokeWidth:1.5,size:18}),info:(0,a.jsx)(c.A,{strokeWidth:1.5,size:18}),neutral:(0,a.jsx)(a.Fragment,{})};function m(e){let{variant:t="neutral",className:n,title:r,withIcon:i,closable:o,children:c,icon:m,actions:p}=e,h=(0,s.A)("alert"),[f,x]=(0,l.useState)(!0),y=[h.base];y.push(h.variant[t].base),n&&y.push(n);let g=[h.description,h.variant[t].description],v=[h.close];return(0,a.jsx)(a.Fragment,{children:f&&(0,a.jsxs)("div",{className:y.join(" "),children:[i?(0,a.jsx)("div",{className:h.variant[t].icon,children:i&&u[t]}):null,m&&m,(0,a.jsxs)("div",{className:"flex flex-1 items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:[h.variant[t].header,h.header].join(" "),children:r}),(0,a.jsx)("div",{className:g.join(" "),children:c})]}),p]}),o&&(0,a.jsx)("button",{"aria-label":"Close alert",onClick:()=>x(!1),className:v.join(" "),children:(0,a.jsx)(d.A,{strokeWidth:2,size:16})})]})})}},41622:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(80263),l=n(53239),s=n(73969),r=n(80832),i=n(48192),o=n(65881),c=n(16703);let d=e=>{let{visible:t,onSuccess:n,closePanel:d}=e,{data:u}=(0,c.YA)(),[m,p]=(0,l.useState)({name:void 0}),[h,f]=(0,l.useState)(""),{mutateAsync:x,isLoading:y}=(0,o.C)();(0,l.useEffect)(()=>{t&&(f(""),p({name:void 0}))},[t]);let g=async()=>{let e={};if(0===h.length&&(e.name="Please provide a name for your schema"),Object.keys(e).length>0)return p(e);if(void 0===u)return console.error("Project is required");try{await x({projectRef:u.ref,connectionString:u.connectionString,name:h}),n(h),s.oR.success('Successfully created schema "'.concat(h,'"'))}catch(e){s.oR.error("Failed to create schema: ".concat(e))}};return(0,a.jsx)(r.Ay,{size:"medium",visible:t,header:"Create a new schema",className:"transition-all duration-100 ease-in",onCancel:d,onConfirm:g,loading:y,cancelText:"Cancel",confirmText:"Save","data-sentry-element":"SidePanel","data-sentry-component":"SchemaEditor","data-sentry-source-file":"SchemaEditor.tsx",children:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(r.Ay.Content,{"data-sentry-element":"SidePanel.Content","data-sentry-source-file":"SchemaEditor.tsx",children:(0,a.jsx)("div",{className:"space-y-10 py-6",children:(0,a.jsx)(i.A,{label:"Schema name",layout:"vertical",type:"text",error:null==m?void 0:m.name,value:h,onChange:e=>f(e.target.value),"data-sentry-element":"Input","data-sentry-source-file":"SchemaEditor.tsx"})})})})},"SchemaEditor")}},42512:(e,t,n)=>{n.d(t,{G:()=>o});var a=n(53239),l=n(78741),s=n(34071),r=n(4939),i=n(21941);function o(){let{sorts:e,setParams:t}=(0,s.o)(),n=(0,r.Ir)(),{saveSortsAndTriggerSideEffects:o}=(0,i.F)(),c=(0,a.useMemo)(()=>{var e;return(null==(e=n.table)?void 0:e.name)||""},[n]),d=(0,a.useMemo)(()=>(0,l.FU)(c,e),[c,e]),u=(0,a.useCallback)(e=>{if(!c)return console.warn("[useTableSort] Table name missing in callback, cannot apply sort correctly.");let n=e.map(e=>({...e,table:c})),a=(0,l.Aw)(n);t(e=>({...e,sort:a})),o(a)},[n,t,o]),m=(0,a.useCallback)((e,t)=>{if(!c||!e)return;let n=d.findIndex(t=>t.column===e),a=[...d];-1!==n?a[n]={...a[n],ascending:t}:a.unshift({table:c,column:e,ascending:t}),u(a)},[c,d,u]),p=(0,a.useCallback)(e=>{c&&e&&u(d.filter(t=>t.column!==e))},[c,d,u]);return{sorts:d,urlSorts:e,onApplySorts:u,addOrUpdateSort:m,removeSort:p}}},47923:(e,t,n)=>{n.d(t,{n:()=>l,P:()=>s});var a=n(26616);let l=n.n(a)()("\n      DROP TYPE IF EXISTS pg_temp.tabledefs CASCADE;\n      CREATE TYPE pg_temp.tabledefs AS ENUM ('PKEY_INTERNAL','PKEY_EXTERNAL','FKEYS_INTERNAL', 'FKEYS_EXTERNAL', 'COMMENTS', 'FKEYS_NONE', 'INCLUDE_TRIGGERS', 'NO_TRIGGERS');\n\n      -- SELECT * FROM pg_temp.pg_get_coldef('sample','orders','id');\n      -- DROP FUNCTION pg_temp.pg_get_coldef(text,text,text,boolean);\n      CREATE OR REPLACE FUNCTION pg_temp.pg_get_coldef(\n        in_schema text,\n        in_table  text,\n        in_column text,\n        oldway    boolean default False\n      )\n      RETURNS text\n      LANGUAGE plpgsql VOLATILE\n      AS\n      $$\n      DECLARE\n      v_coldef     text;\n      v_dt1        text;\n      v_dt2        text;\n      v_dt3        text;\n      v_nullable   boolean;\n      v_position   int;\n      v_identity   text;\n      v_generated  text;\n      v_hasdflt    boolean;\n      v_dfltexpr   text;\n\n      BEGIN\n        IF oldway THEN\n          SELECT pg_catalog.format_type(a.atttypid, a.atttypmod) INTO v_coldef FROM pg_namespace n, pg_class c, pg_attribute a, pg_type t\n          WHERE n.nspname = in_schema AND n.oid = c.relnamespace AND c.relname = in_table AND a.attname = in_column and a.attnum > 0 AND a.attrelid = c.oid AND a.atttypid = t.oid ORDER BY a.attnum;\n          -- RAISE NOTICE 'DEBUG: oldway=%',v_coldef;\n        ELSE\n          -- a.attrelid::regclass::text, a.attname\n          SELECT CASE WHEN a.atttypid = ANY ('{int,int8,int2}'::regtype[]) AND EXISTS (SELECT FROM pg_attrdef ad WHERE ad.adrelid = a.attrelid AND ad.adnum   = a.attnum AND\n          pg_get_expr(ad.adbin, ad.adrelid) = 'nextval(''' || (pg_get_serial_sequence (a.attrelid::regclass::text, a.attname))::regclass || '''::regclass)') THEN CASE a.atttypid\n          WHEN 'int'::regtype  THEN 'serial' WHEN 'int8'::regtype THEN 'bigserial' WHEN 'int2'::regtype THEN 'smallserial' END ELSE format_type(a.atttypid, a.atttypmod) END AS data_type\n          INTO v_coldef FROM pg_namespace n, pg_class c, pg_attribute a, pg_type t\n          WHERE n.nspname = in_schema AND n.oid = c.relnamespace AND c.relname = in_table AND a.attname = in_column and a.attnum > 0 AND a.attrelid = c.oid AND a.atttypid = t.oid ORDER BY a.attnum;\n          -- RAISE NOTICE 'DEBUG: newway=%',v_coldef;\n\n          -- Issue#24: not implemented yet\n          -- might replace with this below to do more detailed parsing...\n          -- SELECT a.atttypid::regtype AS dt1, format_type(a.atttypid, a.atttypmod) as dt2, t.typname as dt3, CASE WHEN not(a.attnotnull) THEN True ELSE False END AS nullable,\n          -- a.attnum, a.attidentity, a.attgenerated, a.atthasdef, pg_get_expr(ad.adbin, ad.adrelid) dfltexpr\n          -- INTO v_dt1, v_dt2, v_dt3, v_nullable, v_position, v_identity, v_generated, v_hasdflt, v_dfltexpr\n          -- FROM pg_attribute a JOIN pg_class c ON (a.attrelid = c.oid) JOIN pg_type t ON (a.atttypid = t.oid) LEFT JOIN pg_attrdef ad ON (a.attrelid = ad.adrelid AND a.attnum = ad.adnum)\n          -- WHERE c.relkind in ('r','p') AND a.attnum > 0 AND NOT a.attisdropped AND c.relnamespace::regnamespace::text = in_schema AND c.relname = in_table AND a.attname = in_column;\n          -- RAISE NOTICE 'schema=%  table=%  column=%  dt1=%  dt2=%  dt3=%  nullable=%  pos=%  identity=%   generated=%  HasDefault=%  DeftExpr=%', in_schema, in_table, in_column, v_dt1,v_dt2,v_dt3,v_nullable,v_position,v_identity,v_generated,v_hasdflt,v_dfltexpr;\n        END IF;\n        RETURN v_coldef;\n      END;\n      $$;\n\n      -- SELECT * FROM pg_temp.pg_get_tabledef('sample', 'address', false);\n      DROP FUNCTION IF EXISTS pg_temp.pg_get_tabledef(character varying,character varying,boolean,tabledefs[]);\n      CREATE OR REPLACE FUNCTION pg_temp.pg_get_tabledef(\n        in_schema varchar,\n        in_table varchar,\n        _verbose boolean,\n        VARIADIC arr pg_temp.tabledefs[] DEFAULT '{}':: pg_temp.tabledefs[]\n      )\n      RETURNS text\n      LANGUAGE plpgsql VOLATILE\n      AS\n      $$\n        DECLARE\n          v_qualified text := '';\n          v_table_ddl text;\n          v_table_oid int;\n          v_colrec record;\n          v_constraintrec record;\n          v_trigrec       record;\n          v_indexrec record;\n          v_rec           record;\n          v_constraint_name text;\n          v_constraint_def  text;\n          v_pkey_def        text := '';\n          v_fkey_def        text := '';\n          v_fkey_defs       text := '';\n          v_trigger text := '';\n          v_partition_key text := '';\n          v_partbound text;\n          v_parent text;\n          v_parent_schema text;\n          v_persist text;\n          v_temp  text := '';\n          v_temp2 text;\n          v_relopts text;\n          v_tablespace text;\n          v_pgversion int;\n          bSerial boolean;\n          bPartition boolean;\n          bInheritance boolean;\n          bRelispartition boolean;\n          constraintarr text[] := '{}';\n          constraintelement text;\n          bSkip boolean;\n          bVerbose boolean := False;\n          v_cnt1   integer;\n          v_cnt2   integer;\n          search_path_old text := '';\n          search_path_new text := '';\n          v_partial    boolean;\n          v_pos        integer;\n\n          -- assume defaults for ENUMs at the getgo\n          pkcnt            int := 0;\n          fkcnt            int := 0;\n          trigcnt          int := 0;\n          cmtcnt           int := 0;\n          pktype           pg_temp.tabledefs := 'PKEY_INTERNAL';\n          fktype           pg_temp.tabledefs := 'FKEYS_INTERNAL';\n          trigtype         pg_temp.tabledefs := 'NO_TRIGGERS';\n          arglen           integer;\n          vargs            text;\n          avarg            pg_temp.tabledefs;\n\n          -- exception variables\n          v_ret            text;\n          v_diag1          text;\n          v_diag2          text;\n          v_diag3          text;\n          v_diag4          text;\n          v_diag5          text;\n          v_diag6          text;\n\n        BEGIN\n          SET client_min_messages = 'notice';\n          IF _verbose THEN bVerbose = True; END IF;\n\n          -- v17 fix: handle case-sensitive\n          -- v_qualified = in_schema || '.' || in_table;\n\n          arglen := array_length($4, 1);\n          IF arglen IS NULL THEN\n              -- nothing to do, so assume defaults\n              NULL;\n          ELSE\n              -- loop thru args\n              -- IF 'NO_TRIGGERS' = ANY ($4)\n              -- select array_to_string($4, ',', '***') INTO vargs;\n              IF bVerbose THEN RAISE NOTICE 'arguments=%', $4; END IF;\n              FOREACH avarg IN ARRAY $4 LOOP\n                  IF bVerbose THEN RAISE NOTICE 'arg=%', avarg; END IF;\n                  IF avarg = 'FKEYS_INTERNAL' OR avarg = 'FKEYS_EXTERNAL' OR avarg = 'FKEYS_NONE' THEN\n                      fkcnt = fkcnt + 1;\n                      fktype = avarg;\n                  ELSEIF avarg = 'INCLUDE_TRIGGERS' OR avarg = 'NO_TRIGGERS' THEN\n                      trigcnt = trigcnt + 1;\n                      trigtype = avarg;\n                  ELSEIF avarg = 'PKEY_EXTERNAL' THEN\n                      pkcnt = pkcnt + 1;\n                      pktype = avarg;\n                  ELSEIF avarg = 'COMMENTS' THEN\n                      cmtcnt = cmtcnt + 1;\n\n                  END IF;\n              END LOOP;\n              IF fkcnt > 1 THEN\n                  RAISE WARNING 'Only one foreign key option can be provided. You provided %', fkcnt;\n                  RETURN '';\n              ELSEIF trigcnt > 1 THEN\n                  RAISE WARNING 'Only one trigger option can be provided. You provided %', trigcnt;\n                  RETURN '';\n              ELSEIF pkcnt > 1 THEN\n                  RAISE WARNING 'Only one pkey option can be provided. You provided %', pkcnt;\n                  RETURN '';\n              ELSEIF cmtcnt > 1 THEN\n                  RAISE WARNING 'Only one comments option can be provided. You provided %', cmtcnt;\n                  RETURN '';\n\n              END IF;\n          END IF;\n\n          SELECT c.oid, (select setting from pg_settings where name = 'server_version_num') INTO v_table_oid, v_pgversion FROM pg_catalog.pg_class c LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n          WHERE c.relkind in ('r','p') AND c.relname = in_table AND n.nspname = in_schema;\n\n        -- set search_path = public before we do anything to force explicit schema qualification but dont forget to set it back before exiting...\n          SELECT setting INTO search_path_old FROM pg_settings WHERE name = 'search_path';\n\n          -- RAISE NOTICE 'DEBUG tableddl: saving old search_path: ***%***', search_path_old;\n          EXECUTE 'SET search_path = \"public\"';\n          SELECT setting INTO search_path_new FROM pg_settings WHERE name = 'search_path';\n          -- RAISE NOTICE 'DEBUG tableddl: using new search path=***%***', search_path_new;\n\n          -- throw an error if table was not found\n          IF (v_table_oid IS NULL) THEN\n            RAISE EXCEPTION 'table does not exist';\n          END IF;\n\n          -- get user-defined tablespaces if applicable\n          SELECT tablespace INTO v_temp FROM pg_tables WHERE schemaname = in_schema and tablename = in_table and tablespace IS NOT NULL;\n          IF v_temp IS NULL THEN\n            v_tablespace := 'TABLESPACE pg_default';\n          ELSE\n            v_tablespace := 'TABLESPACE ' || v_temp;\n          END IF;\n\n          -- also see if there are any SET commands for this table, ie, autovacuum_enabled=off, fillfactor=70\n          WITH relopts AS (SELECT unnest(c.reloptions) relopts FROM pg_class c, pg_namespace n WHERE n.nspname = in_schema and n.oid = c.relnamespace and c.relname = in_table)\n          SELECT string_agg(r.relopts, ', ') as relopts INTO v_temp from relopts r;\n          IF v_temp IS NULL THEN\n            v_relopts := '';\n          ELSE\n            v_relopts := ' WITH (' || v_temp || ')';\n          END IF;\n\n          -- -----------------------------------------------------------------------------------\n          -- Create table defs for partitions/children using inheritance or declarative methods.\n          -- inheritance: pg_class.relkind = 'r'   pg_class.relispartition=false   pg_class.relpartbound is NULL\n          -- declarative: pg_class.relkind = 'r'   pg_class.relispartition=true    pg_class.relpartbound is NOT NULL\n          -- -----------------------------------------------------------------------------------\n          v_partbound := '';\n          bPartition := False;\n          bInheritance := False;\n          IF v_pgversion < 100000 THEN\n            -- Issue#11: handle parent schema\n            SELECT c2.relname parent, c2.relnamespace::regnamespace INTO v_parent, v_parent_schema from pg_class c1, pg_namespace n, pg_inherits i, pg_class c2\n            WHERE n.nspname = in_schema and n.oid = c1.relnamespace and c1.relname = in_table and c1.oid = i.inhrelid and i.inhparent = c2.oid and c1.relkind = 'r';\n            IF (v_parent IS NOT NULL) THEN\n              bPartition   := True;\n              bInheritance := True;\n            END IF;\n          ELSE\n            -- Issue#11: handle parent schema\n            SELECT c2.relname parent, c1.relispartition, pg_get_expr(c1.relpartbound, c1.oid, true), c2.relnamespace::regnamespace INTO v_parent, bRelispartition, v_partbound, v_parent_schema from pg_class c1, pg_namespace n, pg_inherits i, pg_class c2\n            WHERE n.nspname = in_schema and n.oid = c1.relnamespace and c1.relname = in_table and c1.oid = i.inhrelid and i.inhparent = c2.oid and c1.relkind = 'r';\n            IF (v_parent IS NOT NULL) THEN\n              bPartition   := True;\n              IF bRelispartition THEN\n                bInheritance := False;\n              ELSE\n                bInheritance := True;\n              END IF;\n            END IF;\n          END IF;\n          IF bPartition THEN\n            --Issue#17 fix for case-sensitive tables\n            -- SELECT count(*) INTO v_cnt1 FROM information_schema.tables t WHERE EXISTS (SELECT REGEXP_MATCHES(s.table_name, '([A-Z]+)','g') FROM information_schema.tables s\n            -- WHERE t.table_schema=s.table_schema AND t.table_name=s.table_name AND t.table_schema = quote_ident(in_schema) AND t.table_name = quote_ident(in_table) AND t.table_type = 'BASE TABLE');\n            SELECT count(*) INTO v_cnt1 FROM information_schema.tables t WHERE EXISTS (SELECT REGEXP_MATCHES(s.table_name, '([A-Z]+)','g') FROM information_schema.tables s\n            WHERE t.table_schema=s.table_schema AND t.table_name=s.table_name AND t.table_schema = in_schema AND t.table_name = in_table AND t.table_type = 'BASE TABLE');\n\n            --Issue#19 put double-quotes around SQL keyword column names\n            -- Issue#121: fix keyword lookup for table name not column name that does not apply here\n            -- SELECT COUNT(*) INTO v_cnt2 FROM pg_get_keywords() WHERE word = v_colrec.column_name AND catcode = 'R';\n            SELECT COUNT(*) INTO v_cnt2 FROM pg_get_keywords() WHERE word = in_table AND catcode = 'R';\n\n            IF bInheritance THEN\n              -- inheritance-based\n              IF v_cnt1 > 0 OR v_cnt2 > 0 THEN\n                v_table_ddl := 'CREATE TABLE ' || in_schema || '.\"' || in_table || '\"( '|| E'\\n';\n              ELSE\n                v_table_ddl := 'CREATE TABLE ' || in_schema || '.' || in_table || '( '|| E'\\n';\n              END IF;\n\n              -- Jump to constraints section to add the check constraints\n            ELSE\n              -- declarative-based\n              IF v_relopts <> '' THEN\n                IF v_cnt1 > 0 OR v_cnt2 > 0 THEN\n                  v_table_ddl := 'CREATE TABLE ' || in_schema || '.\"' || in_table || '\" PARTITION OF ' || in_schema || '.' || v_parent || ' ' || v_partbound || v_relopts || ' ' || v_tablespace || '; ' || E'\\n';\n                ELSE\n                  v_table_ddl := 'CREATE TABLE ' || in_schema || '.' || in_table || ' PARTITION OF ' || in_schema || '.' || v_parent || ' ' || v_partbound || v_relopts || ' ' || v_tablespace || '; ' || E'\\n';\n                END IF;\n              ELSE\n                IF v_cnt1 > 0 OR v_cnt2 > 0 THEN\n                  v_table_ddl := 'CREATE TABLE ' || in_schema || '.\"' || in_table || '\" PARTITION OF ' || in_schema || '.' || v_parent || ' ' || v_partbound || ' ' || v_tablespace || '; ' || E'\\n';\n                ELSE\n                  v_table_ddl := 'CREATE TABLE ' || in_schema || '.' || in_table || ' PARTITION OF ' || in_schema || '.' || v_parent || ' ' || v_partbound || ' ' || v_tablespace || '; ' || E'\\n';\n                END IF;\n              END IF;\n              -- Jump to constraints and index section to add the check constraints and indexes and perhaps FKeys\n            END IF;\n          END IF;\n          IF bVerbose THEN RAISE NOTICE '(1)tabledef so far: %', v_table_ddl; END IF;\n\n          IF NOT bPartition THEN\n            -- see if this is unlogged or temporary table\n            select c.relpersistence into v_persist from pg_class c, pg_namespace n where n.nspname = in_schema and n.oid = c.relnamespace and c.relname = in_table and c.relkind = 'r';\n            IF v_persist = 'u' THEN\n              v_temp := 'UNLOGGED';\n            ELSIF v_persist = 't' THEN\n              v_temp := 'TEMPORARY';\n            ELSE\n              v_temp := '';\n            END IF;\n          END IF;\n\n          -- start the create definition for regular tables unless we are in progress creating an inheritance-based child table\n          IF NOT bPartition THEN\n            --Issue#17 fix for case-sensitive tables\n            -- SELECT count(*) INTO v_cnt1 FROM information_schema.tables t WHERE EXISTS (SELECT REGEXP_MATCHES(s.table_name, '([A-Z]+)','g') FROM information_schema.tables s\n            -- WHERE t.table_schema=s.table_schema AND t.table_name=s.table_name AND t.table_schema = quote_ident(in_schema) AND t.table_name = quote_ident(in_table) AND t.table_type = 'BASE TABLE');\n            SELECT count(*) INTO v_cnt1 FROM information_schema.tables t WHERE EXISTS (SELECT REGEXP_MATCHES(s.table_name, '([A-Z]+)','g') FROM information_schema.tables s\n            WHERE t.table_schema=s.table_schema AND t.table_name=s.table_name AND t.table_schema = in_schema AND t.table_name = in_table AND t.table_type = 'BASE TABLE');\n            IF v_cnt1 > 0 THEN\n              v_table_ddl := 'CREATE ' || v_temp || ' TABLE ' || in_schema || '.\"' || in_table || '\" (' || E'\\n';\n            ELSE\n              v_table_ddl := 'CREATE ' || v_temp || ' TABLE ' || in_schema || '.' || in_table || ' (' || E'\\n';\n            END IF;\n          END IF;\n          -- RAISE NOTICE 'DEBUG2: tabledef so far: %', v_table_ddl;\n          -- define all of the columns in the table unless we are in progress creating an inheritance-based child table\n          IF NOT bPartition THEN\n            FOR v_colrec IN\n              SELECT c.column_name, c.data_type, c.udt_name, c.udt_schema, c.character_maximum_length, c.is_nullable, c.column_default, c.numeric_precision, c.numeric_scale, c.is_identity, c.identity_generation, c.is_generated, c.generation_expression\n              FROM information_schema.columns c WHERE (table_schema, table_name) = (in_schema, in_table) ORDER BY ordinal_position\n            LOOP\n              IF bVerbose THEN RAISE NOTICE '(col loop) name=%  type=%  udt_name=%  default=%  is_generated=%  gen_expr=%', v_colrec.column_name, v_colrec.data_type, v_colrec.udt_name, v_colrec.column_default, v_colrec.is_generated, v_colrec.generation_expression; END IF;\n\n              -- v17 fix: handle case-sensitive for pg_get_serial_sequence that requires SQL Identifier handling\n              -- SELECT CASE WHEN pg_get_serial_sequence(v_qualified, v_colrec.column_name) IS NOT NULL THEN True ELSE False END into bSerial;\n              SELECT CASE WHEN pg_get_serial_sequence(quote_ident(in_schema) || '.' || quote_ident(in_table), v_colrec.column_name) IS NOT NULL THEN True ELSE False END into bSerial;\n              IF bVerbose THEN\n                -- v17 fix: handle case-sensitive for pg_get_serial_sequence that requires SQL Identifier handling\n                -- SELECT pg_get_serial_sequence(v_qualified, v_colrec.column_name) into v_temp;\n                SELECT pg_get_serial_sequence(quote_ident(in_schema) || '.' || quote_ident(in_table), v_colrec.column_name) into v_temp;\n                IF v_temp IS NULL THEN v_temp = 'NA'; END IF;\n                SELECT pg_temp.pg_get_coldef(in_schema, in_table,v_colrec.column_name) INTO v_diag1;\n                RAISE NOTICE 'DEBUG table: %  Column: %  datatype: %  Serial=%  serialval=%  coldef=%', v_qualified, v_colrec.column_name, v_colrec.data_type, bSerial, v_temp, v_diag1;\n                RAISE NOTICE 'DEBUG tabledef: %', v_table_ddl;\n              END IF;\n\n              --Issue#17 put double-quotes around case-sensitive column names\n              SELECT COUNT(*) INTO v_cnt1 FROM information_schema.columns t WHERE EXISTS (SELECT REGEXP_MATCHES(s.column_name, '([A-Z]+)','g') FROM information_schema.columns s\n              WHERE t.table_schema=s.table_schema and t.table_name=s.table_name and t.column_name=s.column_name AND t.table_schema = quote_ident(in_schema) AND column_name = v_colrec.column_name);\n\n              --Issue#19 put double-quotes around SQL keyword column names\n              SELECT COUNT(*) INTO v_cnt2 FROM pg_get_keywords() WHERE word = v_colrec.column_name AND catcode = 'R';\n\n              IF v_cnt1 > 0 OR v_cnt2 > 0 THEN\n                v_table_ddl := v_table_ddl || '  \"' || v_colrec.column_name || '\" ';\n              ELSE\n                v_table_ddl := v_table_ddl || '  ' || v_colrec.column_name || ' ';\n              END IF;\n\n              -- Issue#23: Handle autogenerated columns and rewrite as a simpler IF THEN ELSE branch instead of a much more complex embedded CASE STATEMENT\n              IF v_colrec.is_generated = 'ALWAYS' and v_colrec.generation_expression IS NOT NULL THEN\n                  -- searchable tsvector GENERATED ALWAYS AS (to_tsvector('simple'::regconfig, COALESCE(translate(email, '@.-'::citext, ' '::text), ''::text)) ) STORED\n                  v_temp = v_colrec.data_type || ' GENERATED ALWAYS AS (' || v_colrec.generation_expression || ') STORED ';\n              ELSEIF v_colrec.udt_name in ('geometry', 'box2d', 'box2df', 'box3d', 'geography', 'geometry_dump', 'gidx', 'spheroid', 'valid_detail') THEN\n                  v_temp = v_colrec.udt_name;\n              ELSEIF v_colrec.data_type = 'USER-DEFINED' THEN\n                  v_temp = v_colrec.udt_schema || '.' || v_colrec.udt_name;\n              ELSEIF v_colrec.data_type = 'ARRAY' THEN\n                    -- Issue#6 fix: handle arrays\n                  v_temp = pg_temp.pg_get_coldef(in_schema, in_table,v_colrec.column_name);\n                  -- v17 fix: handle case-sensitive for pg_get_serial_sequence that requires SQL Identifier handling\n                  -- WHEN pg_get_serial_sequence(v_qualified, v_colrec.column_name) IS NOT NULL\n              ELSEIF pg_get_serial_sequence(quote_ident(in_schema) || '.' || quote_ident(in_table), v_colrec.column_name) IS NOT NULL THEN\n                  -- Issue#8 fix: handle serial. Note: NOT NULL is implied so no need to declare it explicitly\n                  v_temp = pg_temp.pg_get_coldef(in_schema, in_table,v_colrec.column_name);\n              ELSE\n                  v_temp = v_colrec.data_type;\n              END IF;\n              -- RAISE NOTICE 'column def1=%', v_temp;\n\n              -- handle IDENTITY columns\n              IF v_colrec.is_identity = 'YES' THEN\n                  IF v_colrec.identity_generation = 'ALWAYS' THEN\n                      v_temp = v_temp || ' GENERATED ALWAYS AS IDENTITY';\n                  ELSE\n                      v_temp = v_temp || ' GENERATED BY DEFAULT AS IDENTITY';\n                  END IF;\n              ELSEIF v_colrec.character_maximum_length IS NOT NULL THEN\n                  v_temp = v_temp || ('(' || v_colrec.character_maximum_length || ')');\n              ELSEIF v_colrec.numeric_precision > 0 AND v_colrec.numeric_scale > 0 THEN\n                  v_temp = v_temp || '(' || v_colrec.numeric_precision || ',' || v_colrec.numeric_scale || ')';\n              END IF;\n\n              -- Handle NULL/NOT NULL\n              IF bSerial THEN\n                  v_temp = v_temp || ' NOT NULL';\n              ELSEIF v_colrec.is_nullable = 'NO' THEN\n                  v_temp = v_temp || ' NOT NULL';\n              ELSEIF v_colrec.is_nullable = 'YES' THEN\n                  v_temp = v_temp || ' NULL';\n              END IF;\n\n              -- Handle defaults\n              IF v_colrec.column_default IS NOT null AND NOT bSerial THEN\n                  -- RAISE NOTICE 'Setting default for column, %', v_colrec.column_name;\n                  v_temp = v_temp || (' DEFAULT ' || v_colrec.column_default);\n              END IF;\n              v_temp = v_temp || ',' || E'\\n';\n              -- RAISE NOTICE 'column def2=%', v_temp;\n              v_table_ddl := v_table_ddl || v_temp;\n              -- RAISE NOTICE 'tabledef=%', v_table_ddl;\n\n            END LOOP;\n          END IF;\n          IF bVerbose THEN RAISE NOTICE '(2)tabledef so far: %', v_table_ddl; END IF;\n\n          -- define all the constraints: conparentid does not exist pre PGv11\n          IF v_pgversion < 110000 THEN\n            FOR v_constraintrec IN\n              SELECT con.conname as constraint_name, con.contype as constraint_type,\n                CASE\n                  WHEN con.contype = 'p' THEN 1 -- primary key constraint\n                  WHEN con.contype = 'u' THEN 2 -- unique constraint\n                  WHEN con.contype = 'f' THEN 3 -- foreign key constraint\n                  WHEN con.contype = 'c' THEN 4\n                  ELSE 5\n                END as type_rank,\n                pg_get_constraintdef(con.oid) as constraint_definition\n              FROM pg_catalog.pg_constraint con JOIN pg_catalog.pg_class rel ON rel.oid = con.conrelid JOIN pg_catalog.pg_namespace nsp ON nsp.oid = connamespace\n              WHERE nsp.nspname = in_schema AND rel.relname = in_table ORDER BY type_rank\n            LOOP\n              v_constraint_name := v_constraintrec.constraint_name;\n              v_constraint_def  := v_constraintrec.constraint_definition;\n              IF v_constraintrec.type_rank = 1 THEN\n                  IF pkcnt = 0 OR pktype = 'PKEY_INTERNAL' THEN\n                      -- internal def\n                      v_constraint_name := v_constraintrec.constraint_name;\n                      v_constraint_def  := v_constraintrec.constraint_definition;\n                      v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                        || 'CONSTRAINT' || ' '\n                        || v_constraint_name || ' '\n                        || v_constraint_def\n                        || ',' || E'\\n';\n                  ELSE\n                    -- Issue#16 handle external PG def\n                    SELECT 'ALTER TABLE ONLY ' || in_schema || '.' || c.relname || ' ADD CONSTRAINT ' || r.conname || ' ' || pg_catalog.pg_get_constraintdef(r.oid, true) || ';' INTO v_pkey_def\n                    FROM pg_catalog.pg_constraint r, pg_class c, pg_namespace n where r.conrelid = c.oid and  r.contype = 'p' and n.oid = r.connamespace and n.nspname = in_schema AND c.relname = in_table and r.conname = v_constraint_name;\n                  END IF;\n                  IF bPartition THEN\n                    continue;\n                  END IF;\n              ELSIF v_constraintrec.type_rank = 3 THEN\n                  -- handle foreign key constraints\n                  --Issue#22 fix: added FKEY_NONE check\n                  IF fktype = 'FKEYS_NONE' THEN\n                      -- skip\n                      continue;\n                  ELSIF fkcnt = 0 OR fktype = 'FKEYS_INTERNAL' THEN\n                      -- internal def\n                      v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                        || 'CONSTRAINT' || ' '\n                        || v_constraint_name || ' '\n                        || v_constraint_def\n                        || ',' || E'\\n';\n                  ELSE\n                      -- external def\n                      SELECT 'ALTER TABLE ONLY ' || n.nspname || '.' || c2.relname || ' ADD CONSTRAINT ' || r.conname || ' ' || pg_catalog.pg_get_constraintdef(r.oid, true) || ';' INTO v_fkey_def\n                      FROM pg_constraint r, pg_class c1, pg_namespace n, pg_class c2 where r.conrelid = c1.oid and  r.contype = 'f' and n.nspname = in_schema and n.oid = r.connamespace and r.conrelid = c2.oid and c2.relname = in_table;\n                      v_fkey_defs = v_fkey_defs || v_fkey_def || E'\\n';\n                  END IF;\n              ELSE\n                  -- handle all other constraints besides PKEY and FKEYS as internal defs by default\n                  v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                    || 'CONSTRAINT' || ' '\n                    || v_constraint_name || ' '\n                    || v_constraint_def\n                    || ',' || E'\\n';\n              END IF;\n              if bVerbose THEN RAISE NOTICE 'DEBUG4: constraint name=% constraint_def=%', v_constraint_name,v_constraint_def; END IF;\n              constraintarr := constraintarr || v_constraintrec.constraint_name:: text;\n\n            END LOOP;\n          ELSE\n            -- handle PG versions 11 and up\n            -- Issue#20: Fix logic for external PKEY and FKEYS\n            FOR v_constraintrec IN\n              SELECT con.conname as constraint_name, con.contype as constraint_type,\n                CASE\n                  WHEN con.contype = 'p' THEN 1 -- primary key constraint\n                  WHEN con.contype = 'u' THEN 2 -- unique constraint\n                  WHEN con.contype = 'f' THEN 3 -- foreign key constraint\n                  WHEN con.contype = 'c' THEN 4\n                  ELSE 5\n                END as type_rank,\n                pg_get_constraintdef(con.oid) as constraint_definition\n              FROM pg_catalog.pg_constraint con JOIN pg_catalog.pg_class rel ON rel.oid = con.conrelid JOIN pg_catalog.pg_namespace nsp ON nsp.oid = connamespace\n              WHERE nsp.nspname = in_schema AND rel.relname = in_table\n                    --Issue#13 added this condition:\n                    AND con.conparentid = 0\n                    ORDER BY type_rank\n            LOOP\n              v_constraint_name := v_constraintrec.constraint_name;\n              v_constraint_def  := v_constraintrec.constraint_definition;\n              IF v_constraintrec.type_rank = 1 THEN\n                  IF pkcnt = 0 OR pktype = 'PKEY_INTERNAL' THEN\n                      -- internal def\n                      v_constraint_name := v_constraintrec.constraint_name;\n                      v_constraint_def  := v_constraintrec.constraint_definition;\n                      v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                        || 'CONSTRAINT' || ' '\n                        || v_constraint_name || ' '\n                        || v_constraint_def\n                        || ',' || E'\\n';\n                  ELSE\n                    -- Issue#16 handle external PG def\n                    SELECT 'ALTER TABLE ONLY ' || in_schema || '.' || c.relname || ' ADD CONSTRAINT ' || r.conname || ' ' || pg_catalog.pg_get_constraintdef(r.oid, true) || ';' INTO v_pkey_def\n                    FROM pg_catalog.pg_constraint r, pg_class c, pg_namespace n where r.conrelid = c.oid and  r.contype = 'p' and n.oid = r.connamespace and n.nspname = in_schema AND c.relname = in_table;\n                  END IF;\n                  IF bPartition THEN\n                    continue;\n                  END IF;\n              ELSIF v_constraintrec.type_rank = 3 THEN\n                  -- handle foreign key constraints\n                  --Issue#22 fix: added FKEY_NONE check\n                  IF fktype = 'FKEYS_NONE' THEN\n                      -- skip\n                      continue;\n                  ELSIF fkcnt = 0 OR fktype = 'FKEYS_INTERNAL' THEN\n                      -- internal def\n                      v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                        || 'CONSTRAINT' || ' '\n                        || v_constraint_name || ' '\n                        || v_constraint_def\n                        || ',' || E'\\n';\n                  ELSE\n                      -- external def\n                      SELECT 'ALTER TABLE ONLY ' || n.nspname || '.' || c2.relname || ' ADD CONSTRAINT ' || r.conname || ' ' || pg_catalog.pg_get_constraintdef(r.oid, true) || ';' INTO v_fkey_def\n                      FROM pg_constraint r, pg_class c1, pg_namespace n, pg_class c2 where r.conrelid = c1.oid and  r.contype = 'f' and n.nspname = in_schema and n.oid = r.connamespace and r.conrelid = c2.oid and c2.relname = in_table and\n                      r.conname = v_constraint_name and r.conparentid = 0;\n                      v_fkey_defs = v_fkey_defs || v_fkey_def || E'\\n';\n                  END IF;\n              ELSE\n                  -- handle all other constraints besides PKEY and FKEYS as internal defs by default\n                  v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                    || 'CONSTRAINT' || ' '\n                    || v_constraint_name || ' '\n                    || v_constraint_def\n                    || ',' || E'\\n';\n              END IF;\n              if bVerbose THEN RAISE NOTICE 'DEBUG4: constraint name=% constraint_def=%', v_constraint_name,v_constraint_def; END IF;\n              constraintarr := constraintarr || v_constraintrec.constraint_name:: text;\n\n            END LOOP;\n          END IF;\n\n          -- drop the last comma before ending the create statement, which should be right before the carriage return character\n          -- Issue#24: make sure the comma is there before removing it\n          select substring(v_table_ddl, length(v_table_ddl) - 1, 1) INTO v_temp;\n          IF v_temp = ',' THEN\n              v_table_ddl = substr(v_table_ddl, 0, length(v_table_ddl) - 1) || E'\\n';\n          END IF;\n          IF bVerbose THEN RAISE NOTICE '(3)tabledef so far: %', trim(v_table_ddl); END IF;\n\n          -- ---------------------------------------------------------------------------\n          -- at this point we have everything up to the last table-enclosing parenthesis\n          -- ---------------------------------------------------------------------------\n          IF bVerbose THEN RAISE NOTICE '(4)tabledef so far: %', v_table_ddl; END IF;\n\n          -- See if this is an inheritance-based child table and finish up the table create.\n          IF bPartition and bInheritance THEN\n            -- Issue#11: handle parent schema\n            -- v_table_ddl := v_table_ddl || ') INHERITS (' || in_schema || '.' || v_parent || ') ' || E'\\n' || v_relopts || ' ' || v_tablespace || ';' || E'\\n';\n            IF v_parent_schema = '' OR v_parent_schema IS NULL THEN v_parent_schema = in_schema; END IF;\n            v_table_ddl := v_table_ddl || ') INHERITS (' || v_parent_schema || '.' || v_parent || ') ' || E'\\n' || v_relopts || ' ' || v_tablespace || ';' || E'\\n';\n          END IF;\n\n          IF v_pgversion >= 100000 AND NOT bPartition and NOT bInheritance THEN\n            -- See if this is a partitioned table (pg_class.relkind = 'p') and add the partitioned key\n            SELECT pg_get_partkeydef(c1.oid) as partition_key INTO v_partition_key FROM pg_class c1 JOIN pg_namespace n ON (n.oid = c1.relnamespace) LEFT JOIN pg_partitioned_table p ON (c1.oid = p.partrelid)\n            WHERE n.nspname = in_schema and n.oid = c1.relnamespace and c1.relname = in_table and c1.relkind = 'p';\n\n            IF v_partition_key IS NOT NULL AND v_partition_key <> '' THEN\n              -- add partition clause\n              -- NOTE:  cannot specify default tablespace for partitioned relations\n              -- v_table_ddl := v_table_ddl || ') PARTITION BY ' || v_partition_key || ' ' || v_tablespace || ';' || E'\\n';\n              v_table_ddl := v_table_ddl || ') PARTITION BY ' || v_partition_key || ';' || E'\\n';\n            ELSEIF v_relopts <> '' THEN\n              v_table_ddl := v_table_ddl || ') ' || v_relopts || ' ' || v_tablespace || ';' || E'\\n';\n            ELSE\n              -- end the create definition\n              v_table_ddl := v_table_ddl || ') ' || v_tablespace || ';' || E'\\n';\n            END IF;\n          END IF;\n\n          IF bVerbose THEN RAISE NOTICE '(5)tabledef so far: %', v_table_ddl; END IF;\n\n          -- Add closing paren for regular tables\n          -- IF NOT bPartition THEN\n          -- v_table_ddl := v_table_ddl || ') ' || v_relopts || ' ' || v_tablespace || E';\\n';\n          -- END IF;\n          -- RAISE NOTICE 'ddlsofar3: %', v_table_ddl;\n\n          -- Issue#16 create the external PKEY def if indicated\n          IF v_pkey_def <> '' THEN\n              v_table_ddl := v_table_ddl || v_pkey_def || E'\\n';\n          END IF;\n\n          -- Issue#20\n          IF v_fkey_defs <> '' THEN\n                v_table_ddl := v_table_ddl || v_fkey_defs || E'\\n';\n          END IF;\n\n          IF bVerbose THEN RAISE NOTICE '(6)tabledef so far: %', v_table_ddl; END IF;\n\n          -- create indexes\n          FOR v_indexrec IN\n            SELECT indexdef, COALESCE(tablespace, 'pg_default') as tablespace, indexname FROM pg_indexes WHERE (schemaname, tablename) = (in_schema, in_table)\n          LOOP\n            -- RAISE NOTICE 'DEBUG6: indexname=%  indexdef=%', v_indexrec.indexname, v_indexrec.indexdef;\n            -- loop through constraints and skip ones already defined\n            bSkip = False;\n            FOREACH constraintelement IN ARRAY constraintarr\n            LOOP\n              IF constraintelement = v_indexrec.indexname THEN\n                  -- RAISE NOTICE 'DEBUG7: skipping index, %', v_indexrec.indexname;\n                  bSkip = True;\n                  EXIT;\n              END IF;\n            END LOOP;\n            if bSkip THEN CONTINUE; END IF;\n\n            -- Add IF NOT EXISTS clause so partition index additions will not be created if declarative partition in effect and index already created on parent\n            v_indexrec.indexdef := REPLACE(v_indexrec.indexdef, 'CREATE INDEX', 'CREATE INDEX IF NOT EXISTS');\n            -- Fix Issue#26: do it for unique/primary key indexes as well\n            v_indexrec.indexdef := REPLACE(v_indexrec.indexdef, 'CREATE UNIQUE INDEX', 'CREATE UNIQUE INDEX IF NOT EXISTS');\n            -- RAISE NOTICE 'DEBUG8: adding index, %', v_indexrec.indexname;\n\n            -- NOTE:  cannot specify default tablespace for partitioned relations\n            IF v_partition_key IS NOT NULL AND v_partition_key <> '' THEN\n                v_table_ddl := v_table_ddl || v_indexrec.indexdef || ';' || E'\\n';\n            ELSE\n                -- Issue#25: see if partial index or not\n                select CASE WHEN i.indpred IS NOT NULL THEN True ELSE False END INTO v_partial\n                FROM pg_index i JOIN pg_class c1 ON (i.indexrelid = c1.oid) JOIN pg_class c2 ON (i.indrelid = c2.oid)\n                WHERE c1.relnamespace::regnamespace::text = in_schema AND c2.relnamespace::regnamespace::text = in_schema AND c2.relname = in_table AND c1.relname = v_indexrec.indexname;\n                IF v_partial THEN\n                    -- Put tablespace def before WHERE CLAUSE\n                    v_temp = v_indexrec.indexdef;\n                    v_pos = POSITION(' WHERE ' IN v_temp);\n                    v_temp2 = SUBSTRING(v_temp, v_pos);\n                    v_temp  = SUBSTRING(v_temp, 1, v_pos);\n                    v_table_ddl := v_table_ddl || v_temp || ' TABLESPACE ' || v_indexrec.tablespace || v_temp2 || ';' || E'\\n';\n                ELSE\n                    v_table_ddl := v_table_ddl || v_indexrec.indexdef || ' TABLESPACE ' || v_indexrec.tablespace || ';' || E'\\n';\n                END IF;\n            END IF;\n\n          END LOOP;\n          IF bVerbose THEN RAISE NOTICE '(7)tabledef so far: %', v_table_ddl; END IF;\n\n          -- Issue#20: added logic for table and column comments\n          IF  cmtcnt > 0 THEN\n              FOR v_rec IN\n                SELECT c.relname, 'COMMENT ON ' || CASE WHEN c.relkind in ('r','p') AND a.attname IS NULL THEN 'TABLE ' WHEN c.relkind in ('r','p') AND a.attname IS NOT NULL THEN 'COLUMN ' WHEN c.relkind = 'f' THEN 'FOREIGN TABLE '\n                      WHEN c.relkind = 'm' THEN 'MATERIALIZED VIEW ' WHEN c.relkind = 'v' THEN 'VIEW ' WHEN c.relkind = 'i' THEN 'INDEX ' WHEN c.relkind = 'S' THEN 'SEQUENCE ' ELSE 'XX' END || n.nspname || '.' ||\n                      CASE WHEN c.relkind in ('r','p') AND a.attname IS NOT NULL THEN quote_ident(c.relname) || '.' || a.attname ELSE quote_ident(c.relname) END || ' IS '   || quote_literal(d.description) || ';' as ddl\n                FROM pg_class c JOIN pg_namespace n ON (n.oid = c.relnamespace) LEFT JOIN pg_description d ON (c.oid = d.objoid) LEFT JOIN pg_attribute a ON (c.oid = a.attrelid AND a.attnum > 0 and a.attnum = d.objsubid)\n                WHERE d.description IS NOT NULL AND n.nspname = in_schema AND c.relname = in_table ORDER BY 2 desc, ddl\n              LOOP\n                  --RAISE NOTICE 'comments:%', v_rec.ddl;\n                  v_table_ddl = v_table_ddl || v_rec.ddl || E'\\n';\n              END LOOP;\n          END IF;\n          IF bVerbose THEN RAISE NOTICE '(8)tabledef so far: %', v_table_ddl; END IF;\n\n          IF trigtype = 'INCLUDE_TRIGGERS' THEN\n            -- Issue#14: handle multiple triggers for a table\n            FOR v_trigrec IN\n                select pg_get_triggerdef(t.oid, True) || ';' as triggerdef FROM pg_trigger t, pg_class c, pg_namespace n\n                WHERE n.nspname = in_schema and n.oid = c.relnamespace and c.relname = in_table and c.relkind = 'r' and t.tgrelid = c.oid and NOT t.tgisinternal\n            LOOP\n                v_table_ddl := v_table_ddl || v_trigrec.triggerdef;\n                v_table_ddl := v_table_ddl || E'\\n';\n                IF bVerbose THEN RAISE NOTICE 'triggerdef = %', v_trigrec.triggerdef; END IF;\n            END LOOP;\n          END IF;\n\n          IF bVerbose THEN RAISE NOTICE '(9)tabledef so far: %', v_table_ddl; END IF;\n          -- add empty line\n          v_table_ddl := v_table_ddl || E'\\n';\n          IF bVerbose THEN RAISE NOTICE '(10)tabledef so far: %', v_table_ddl; END IF;\n\n          -- reset search_path back to what it was\n          IF search_path_old = '' THEN\n            SELECT set_config('search_path', '', false) into v_temp;\n          ELSE\n            EXECUTE 'SET search_path = ' || search_path_old;\n          END IF;\n\n          RETURN v_table_ddl;\n\n          EXCEPTION\n          WHEN others THEN\n          BEGIN\n            GET STACKED DIAGNOSTICS v_diag1 = MESSAGE_TEXT, v_diag2 = PG_EXCEPTION_DETAIL, v_diag3 = PG_EXCEPTION_HINT, v_diag4 = RETURNED_SQLSTATE, v_diag5 = PG_CONTEXT, v_diag6 = PG_EXCEPTION_CONTEXT;\n            -- v_ret := 'line=' || v_diag6 || '. '|| v_diag4 || '. ' || v_diag1 || ' .' || v_diag2 || ' .' || v_diag3;\n            v_ret := 'line=' || v_diag6 || '. '|| v_diag4 || '. ' || v_diag1;\n            RAISE EXCEPTION '%', v_ret;\n            -- put additional coding here if necessarY\n            RETURN '';\n          END;\n\n        END;\n      $$;",{compress:!0,removeAll:!0});var s=function(e){return e.NO_ACTION="a",e.RESTRICT="r",e.CASCADE="c",e.SET_NULL="n",e.SET_DEFAULT="d",e}({})},48177:(e,t,n)=>{n.d(t,{BA:()=>r,SF:()=>s,yG:()=>p});var a=n(53444),l=n(82665);let s=10240,r=50,i=["text","varchar","char","character varying","character"],o=["json","jsonb"],c=new Set(o),d=new Set([...i,...o,"bytea","xml","hstore","clob","vector","geometry","geography","tsvector","tsquery","daterange","tsrange","tstzrange","numrange","int4range","int8range","cube","ltree","lquery","jsonpath","citext"]),u=e=>{var t;let n=null==(t=e.primary_keys)?void 0:t.map(e=>e.name);return n&&n.length>0?n:e.columns&&e.columns.length>0?[e.columns[0].name]:[]},m=e=>d.has(e.toLowerCase()),p=e=>{let{table:t,filters:n=[],sorts:o=[],page:d,limit:p,maxCharacters:h=s,maxArraySize:f=r}=e;if(!t||!t.columns)return"";let x=new l.X().from(t.name,t.schema).select();n.forEach(e=>{var n;let a=null==(n=t.columns)?void 0:n.find(t=>t.name===e.column),l=!a||i.includes(a.format);x=x.filter(e.column,e.operator,l||""!==e.value?e.value:null)});let y=t.live_rows_estimate||0;if(0===o.length&&y<=1e5&&t.columns.length>0){let e=u(t);e.length>0&&e.forEach(e=>{x=x.order(t.name,e)})}else o.forEach(e=>{x=x.order(e.table,e.column,e.ascending,e.nullsFirst)});let{from:g,to:v}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=e?e*t:0;return{from:n,to:e?n+t-1:t-1}}((null!=d?d:1)-1,p),b="with _base_query as (".concat(x.range(g,v).toSql({isCTE:!1,isFinal:!1}),")"),_=t.columns.sort((e,t)=>e.ordinal_position-t.ordinal_position).map(e=>({name:e.name,format:e.format.toLowerCase()})),N=t.columns.filter(e=>m(e.format)).map(e=>e.name),E=_.map(e=>{let{name:t}=e,n=(0,a.bD)(t);return N.includes(t)?"case\n        when octet_length(".concat(n,"::text) > ").concat(h," \n        then left(").concat(n,"::text, ").concat(h,") || '...'\n        else ").concat(n,"::text\n      end as ").concat(n):n});t.columns.filter(e=>"array"===e.data_type.toLowerCase()).map(e=>({name:e.name,format:e.format.toLowerCase().slice(1)})).forEach(e=>{let{name:t,format:n}=e,l=E.findIndex(e=>e===(0,a.bD)(t)),s=c.has(n)?"".concat(n,"[]"):"text[]",r="text[]"===s?"array['...']":"array['{\"truncated\": true}'::json]";l>=0&&(E[l]="\n        case \n          when octet_length(".concat((0,a.bD)(t),"::text) > ").concat(h," \n          then\n            case\n              when array_ndims(").concat((0,a.bD)(t),") = 1\n              then\n                (select array_cat(").concat((0,a.bD)(t),"[1:").concat(f,"]::").concat(s,", ").concat(r,"::").concat(s,"))::").concat(s,"\n              else\n                ").concat((0,a.bD)(t),"[1:").concat(f,"]::").concat(s,"\n            end\n          else ").concat((0,a.bD)(t),"::").concat(s,"\n        end\n      "))});let j=E.join(","),S=new l.X().from("_base_query").select(j);return"".concat(b,"\n  ").concat(S.toSql({isCTE:!0,isFinal:!0}))}},48271:(e,t,n)=>{n.d(t,{b:()=>a});let a={list:e=>["projects",e,"database-publications"]}},50676:(e,t,n)=>{n.d(t,{Pz:()=>E,d2:()=>v,wg:()=>b});var a=n(80263),l=n(53434),s=n.n(l),r=n(14685),i=n.n(r),o=n(86926),c=n.n(o),d=n(63121),u=n(93749),m=n.n(u),p=n(77191),h=n.n(p),f=n(73969),x=n(46895),y=n(22554),g=n(18663);let v=e=>{let t={},n=[];return new Promise(n=>{h().parse(e,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,complete:e=>{let a=e.meta.fields||[],l=e.data,s=e.errors;a.forEach(n=>{let a=_(n,e.data);i()(t,n)?t[n]!==a&&(t[n]="text"):t[n]=a}),n({headers:a,rows:l,previewRows:e.data.slice(0,20),columnTypeMap:t,errors:s})}})})},b=(e,t)=>{let n=[],a=0,l=0,s=[],r={},o=[];return new Promise(c=>{h().parse(e,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,worker:!0,quoteChar:"text/tab-separated-values"===e.type?"":'"',chunkSize:262144,chunk:c=>{if((n=c.meta.fields).forEach(e=>{let t=_(e,c.data);i()(r,e)?r[e]!==t&&(r[e]="text"):r[e]=t}),l+=c.data.length,s=c.data.slice(0,20),c.errors.length>0){let e=c.errors.map(e=>({...e,data:c.data[e.row]}));o.push(...e)}let d=262144*(a+=1)/e.size;t(d>1?100:Number((100*d).toFixed(2)))},complete:()=>{c({headers:n,rowCount:l,previewRows:s,columnTypeMap:r,errors:o})}})})},_=(e,t)=>{if(0===t.length)return"text";let n=t[0][e],a=t.map(t=>t[e]);if(null==n)return"text";if(Number(n)){let n=t.map(t=>Number(t[e]));return n.includes(NaN)?"text":n.map(e=>e%1).every(e=>0===e)?"int8":"float8"}return c()(["true","false"],n.toString().toLowerCase())&&a.every(e=>null==e||c()(["true","false"],e.toString().toLowerCase()))?"bool":(0,x.Bl)(n)&&a.every(e=>(0,x.Bl)(n))?"jsonb":Date.parse(n)&&a.every(e=>s()(e,"YYYY-MM-DD hh:mm:ss").isValid())?"timestamptz":"text"},N=e=>{let t=null==e?void 0:e.name.split(".").pop().toLowerCase();return g.M0.includes(t)};function E(e){return e&&g.Fg.includes(e.type)&&N(e)?e.size>g.h$&&(f.oR.error((0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{children:"The dashboard currently only supports importing of CSVs below 100MB."}),(0,a.jsx)("p",{children:"For bulk data loading, we recommend doing so directly through the database."}),(0,a.jsx)(y.$,{asChild:!0,type:"default",icon:(0,a.jsx)(d.A,{}),className:"!mt-2",children:(0,a.jsx)(m(),{href:"https://supabase.com/docs/guides/database/tables#bulk-data-loading",target:"_blank",rel:"noreferrer",children:"Learn more"})})]}),{duration:1/0}),!0):(f.oR.error("Couldn't import file: only CSV files are accepted"),!0)}},51081:(e,t,n)=>{n.d(t,{oG:()=>m});var a=n(32144),l=n(80251),s=n(73969),r=n(17769),i=n(20305),o=n(38319),c=n(25400),d=n(26010);async function u(e){let{projectRef:t,connectionString:n,table:a,payload:l,configuration:s,enumArrayColumns:d,returning:u,roleImpersonationState:m}=e,p=(0,o.Nf)(function(e){var t;let{table:n,configuration:a,payload:l,returning:s=!1,enumArrayColumns:i}=e;return new r.Query().from(n.name,null!=(t=n.schema)?t:void 0).update(l,{returning:s,enumArrayColumns:i}).match(a.identifiers).toSql()}({table:a,configuration:s,payload:l,enumArrayColumns:d,returning:u}),m),{result:h}=await (0,i.E)({projectRef:t,connectionString:n,sql:p,isRoleImpersonationEnabled:(0,c._c)(null==m?void 0:m.role),queryKey:["table-row-update",a.id]});return h}let m=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,a.jE)();return(0,l.n)(e=>u(e),{async onSuccess(t,n,a){let{projectRef:l,table:s}=n;await r.invalidateQueries(d.j.tableRows(l,{table:{id:s.id}})),await (null==e?void 0:e(t,n,a))},async onError(e,n,a){void 0===t?s.oR.error("Failed to update table row: ".concat(e.message)):t(e,n,a)},...n})}},53469:(e,t,n)=>{n.d(t,{X:()=>l});var a=n(80263);let l=()=>(0,a.jsx)("span",{className:"null-value opacity-50","data-sentry-component":"NullValue","data-sentry-source-file":"NullValue.tsx",children:"NULL"})},59955:(e,t,n)=>{n.d(t,{Eb:()=>d,Er:()=>y,MG:()=>h,Oj:()=>m,Pe:()=>g,f9:()=>p,h6:()=>u});var a=n(84305),l=n.n(a),s=n(70350),r=n.n(s),i=n(47923),o=n(46895);let c=e=>{if(["CURRENT_DATE"].includes(e)||"("===e[0]&&")"===e[e.length-1])return!0;let t=e.indexOf("("),n=e.indexOf(")");return!(e.indexOf(" ")>=0)&&!!(t>=0)&&!!(n>t)},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{name:t,table:n,schema:a,format:l}=e;return{id:(0,o.gZ)(),name:t||"",table:n||"",schema:a||"",comment:"",format:l||"",defaultValue:null,foreignKey:void 0,check:null,isNullable:!0,isUnique:!1,isArray:!1,isPrimaryKey:!1,isIdentity:!1,isNewColumn:!0,isEncrypted:!1}},u=(e,t,n)=>{var a,l;let{primary_keys:s}=t,r=s.map(e=>e.name),i=f(e,t,n),c=(null==e?void 0:e.data_type)==="ARRAY";return{foreignKey:i,id:null!=(a=null==e?void 0:e.id)?a:(0,o.gZ)(),table:e.table,schema:e.schema,name:e.name,comment:null!=(l=null==e?void 0:e.comment)?l:"",format:c?e.format.slice(1):e.format,defaultValue:null==e?void 0:e.default_value,check:e.check,isArray:c,isNullable:e.is_nullable,isIdentity:e.is_identity,isUnique:e.is_unique,isNewColumn:!1,isEncrypted:!1,isPrimaryKey:r.includes(e.name)}},m=(e,t)=>{var n,a;let l=!!t.format.includes("int")&&t.isIdentity,s=t.defaultValue;return{schema:e.schema,table:e.name,isIdentity:l,name:t.name.trim(),comment:null==(n=t.comment)?void 0:n.trim(),type:t.isArray?"".concat(t.format,"[]"):t.format,check:(null==(a=t.check)?void 0:a.trim())||void 0,isUnique:t.isUnique,isPrimaryKey:t.isPrimaryKey,...!t.isPrimaryKey&&!l&&{isNullable:t.isNullable},...!l&&{defaultValue:t.isArray&&s?x(s):s},...!l&&s&&{defaultValueFormat:r()(s)||c(s)?"expression":"literal"}}},p=(e,t,n)=>{var a,s,i,o;let d=t.primary_keys.map(e=>e.name).includes(e.name),u=n.name.trim(),m=n.isArray?"".concat(n.format,"[]"):n.format,p=null==(a=n.comment)?void 0:a.trim(),h=null==(s=n.check)?void 0:s.trim(),f={};if(l()(e.name.trim(),u)||(f.name=u),l()(null==(i=e.comment)?void 0:i.trim(),p)||(f.comment=p||null),l()(null==(o=e.check)?void 0:o.trim(),h)||(f.check=h||null),l()(e.format,m)||(f.type=m),!l()(e.default_value,n.defaultValue)){let e=n.defaultValue;f.defaultValue=e,f.defaultValueFormat=r()(e)||c(e)?"expression":"literal"}return l()(e.is_identity,n.isIdentity)||(f.isIdentity=n.isIdentity),l()(e.is_nullable,n.isNullable)||(f.isNullable=n.isNullable),l()(e.is_unique,n.isUnique)||(f.isUnique=n.isUnique),l()(d,n.isPrimaryKey)||(f.isPrimaryKey=n.isPrimaryKey),f},h=e=>{let t={};return 0===e.name.length&&(t.name="Please assign a name for your column"),0===e.format.length&&(t.format="Please select a type for your column"),t},f=(e,t,n)=>{let{relationships:a}=t,l=a.find(t=>t.source_schema===e.schema&&t.source_table_name===e.table&&t.source_column_name===e.name);if(void 0===l)return l;{var s,r;let e=n.find(e=>e.id===l.id);return{...l,deletion_action:null!=(s=null==e?void 0:e.deletion_action)?s:i.P.NO_ACTION,update_action:null!=(r=null==e?void 0:e.update_action)?r:i.P.NO_ACTION}}},x=e=>e?e.replaceAll("[","{").replaceAll("]","}"):null,y=e=>{switch(e){case i.P.CASCADE:return"Cascade";case i.P.RESTRICT:return"Restrict";case i.P.SET_DEFAULT:return"Set default";case i.P.SET_NULL:return"Set NULL";default:return}},g=(e,t)=>{let n=t||"column_name";switch(e){case"int2":case"int4":case"int8":case"numeric":return'"'.concat(n,'" > 0');case"float4":case"float8":return'"'.concat(n,'" > 0.0');case"text":case"varchar":return'length("'.concat(n,'") <= 50');case"json":case"jsonb":return'jsonb_typeof("'.concat(n,"\"->'active') = 'boolean'");case"bool":return'"'.concat(n,'" in (true, false)');case"date":return'"'.concat(n,"\" > '2024-01-01'");case"time":return'"'.concat(n,"\" between '09:00:00' and '12:00:00'");case"timetz":return'"'.concat(n,"\" at time zone 'UTC' between '09:00:00+00' and '17:00:00+00'");case"uuid":return'"'.concat(n,"\" '00000000-0000-0000-0000-000000000000'");case"timestamp":return'"'.concat(n,"\" > '2023-01-01 00:00' and \"").concat(n,"\" < '2025-01-01 00:00'");case"timestamptz":return'"'.concat(n,"\" > '2023-01-01 00:00:00+00' and \"").concat(n,"\" < '2025-01-01 00:00:00+00'");default:return'length("'.concat(n,'") < 500')}}},60627:(e,t,n)=>{n.d(t,{WS:()=>g,JY:()=>w,Td:()=>C});var a=n(80263),l=n(50336),s=n(93569),r=n(96196),i=n(88853),o=n(13322),c=n(80949),d=n(83759),u=n(42512),m=n(11509),p=n(4939),h=n(64495),f=n(80127),x=n(35741),y=n(22554);let g=e=>{let{column:t,isEncrypted:n}=e,g=(0,m.ap)(),v=(0,p.Ir)(),{sorts:b,addOrUpdateSort:_,removeSort:N}=(0,u.G)(),E=t.key;function j(){v.freezeColumn(E)}function S(){v.unfreezeColumn(E)}function C(){let e=v.originalTable.columns.find(e=>e.name===t.name);e&&g.onEditColumn(e)}function w(){let e=v.originalTable.columns.find(e=>e.name===t.name);e&&g.onDeleteColumn(e)}function T(e){if(!E)return;let t=b.find(e=>e.column===E);t&&t.ascending===e?N(E):_(E,e)}return t.name,(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(h.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"ColumnMenu.tsx",children:[(0,a.jsx)(h.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"ColumnMenu.tsx",children:(0,a.jsx)(y.$,{className:"opacity-50 flex",type:"text",style:{padding:"3px"},onClick:e=>{e.stopPropagation()},icon:(0,a.jsx)(d.A,{}),"data-sentry-element":"Button","data-sentry-source-file":"ColumnMenu.tsx"})}),(0,a.jsx)(h.SQ,{align:"end",side:"bottom","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"ColumnMenu.tsx",children:function(){let e=b.find(e=>e.column===E);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(h._2,{className:(0,f.cn)("space-x-2",(null==e?void 0:e.ascending)&&"bg-surface-200 dark:bg-surface-400 text-foreground"),onClick:()=>T(!0),"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"ColumnMenu.tsx",children:[(0,a.jsx)(l.A,{size:14,strokeWidth:(null==e?void 0:e.ascending)?3:1.5,"data-sentry-element":"ArrowUp","data-sentry-source-file":"ColumnMenu.tsx"}),(0,a.jsx)("span",{children:"Sort Ascending"})]}),(0,a.jsxs)(h._2,{className:(0,f.cn)("space-x-2",e&&!e.ascending&&"bg-surface-200 dark:bg-surface-400 text-foreground"),onClick:()=>T(!1),"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"ColumnMenu.tsx",children:[(0,a.jsx)(s.A,{size:14,strokeWidth:e&&!e.ascending?3:1.5,"data-sentry-element":"ArrowDown","data-sentry-source-file":"ColumnMenu.tsx"}),(0,a.jsx)("span",{children:"Sort Descending"})]}),v.editable&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.mB,{}),(0,a.jsxs)(x.m_,{children:[(0,a.jsx)(x.k$,{asChild:!0,className:"".concat(n?"opacity-50":""),children:(0,a.jsxs)(h._2,{className:"space-x-2",onClick:C,disabled:n,children:[(0,a.jsx)(r.A,{size:14,strokeWidth:1.5}),(0,a.jsx)("span",{children:"Edit column"})]})}),n&&(0,a.jsx)(x.ZI,{side:"bottom",children:"Encrypted columns cannot be edited"})]})]}),(0,a.jsx)(h._2,{className:"space-x-2",onClick:t.frozen?S:j,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"ColumnMenu.tsx",children:t.frozen?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.A,{size:14,strokeWidth:1.5}),(0,a.jsx)("span",{children:"Unfreeze column"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.A,{size:14,strokeWidth:1.5}),(0,a.jsx)("span",{children:"Freeze column"})]})}),v.editable&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.mB,{}),(0,a.jsxs)(h._2,{className:"space-x-2",onClick:w,children:[(0,a.jsx)(c.A,{size:14,className:"text-destructive"}),(0,a.jsx)("span",{children:"Delete column"})]})]})]})}()})]})})};var v=n(21329),b=n(72343),_=n(53239),N=n(9711),E=n(73969),j=n(70979),S=n(37359);let C=e=>{let{rows:t}=e,n=(0,m.ap)(),l=(0,p.Ir)(),s=(0,_.useCallback)(e=>{let{props:n}=e;if(!l.selectedCellPosition||!n)return;let{rowIdx:a}=n,s=t[a][l.gridColumns[l.selectedCellPosition.idx].key],r=(0,S.x)(s);(0,j.l)(r),E.oR.success("Copied cell value to clipboard")},[t,l.gridColumns,l.selectedCellPosition]),i=(0,_.useCallback)(e=>{let{props:n}=e,{rowIdx:a}=n,l=t[a];(0,j.l)(JSON.stringify(l)),E.oR.success("Copied row to clipboard")},[t]);return(0,a.jsxs)(N.W1,{id:w,animation:!1,className:"!min-w-36","data-sentry-element":"Menu","data-sentry-component":"RowContextMenu","data-sentry-source-file":"RowContextMenu.tsx",children:[(0,a.jsxs)(N.Qw,{label:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(v.A,{size:12}),(0,a.jsx)("span",{className:"text-xs",children:"Copy"})]}),arrow:(0,a.jsx)(b.A,{size:12}),"data-sentry-element":"Submenu","data-sentry-source-file":"RowContextMenu.tsx",children:[(0,a.jsx)(N.q7,{onClick:s,"data-sentry-element":"Item","data-sentry-source-file":"RowContextMenu.tsx",children:(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Copy cell"})}),(0,a.jsx)(N.q7,{onClick:i,"data-sentry-element":"Item","data-sentry-source-file":"RowContextMenu.tsx",children:(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Copy row"})})]}),(0,a.jsxs)(N.q7,{onClick:function(e){let{props:a}=e,{rowIdx:l}=a,s=t[l];n.onEditRow(s)},hidden:!l.editable,data:"edit","data-sentry-element":"Item","data-sentry-source-file":"RowContextMenu.tsx",children:[(0,a.jsx)(r.A,{size:12,"data-sentry-element":"Edit","data-sentry-source-file":"RowContextMenu.tsx"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Edit row"})]}),(0,a.jsx)(N.wv,{"data-sentry-element":"Separator","data-sentry-source-file":"RowContextMenu.tsx"}),(0,a.jsxs)(N.q7,{onClick:function(e){let{props:a}=e,{rowIdx:l}=a,s=t[l];s&&n.onDeleteRows([s])},hidden:!l.editable,data:"delete","data-sentry-element":"Item","data-sentry-source-file":"RowContextMenu.tsx",children:[(0,a.jsx)(c.A,{size:12,"data-sentry-element":"Trash","data-sentry-source-file":"RowContextMenu.tsx"}),(0,a.jsx)("span",{className:"ml-2 text-xs",children:"Delete row"})]})]})},w="row-context-menu-id"},62527:(e,t,n)=>{n.d(t,{b:()=>g});var a=n(80263),l=n(84305),s=n.n(l),r=n(50419),i=n(7005),o=n(53239),c=n(4939),d=n(51509),u=n(22554),m=n(83759),p=n(36839),h=n(23542),f=n(48192),x=n(18041);let y=(0,o.memo)(e=>{var t,n;let{filter:l,filterIdx:s,onChange:r,onDelete:i,onKeyDown:o}=e,d=(0,c.Ir)(),y=d.table.columns.find(e=>e.name===l.column),g=(null==(t=d.table.columns)?void 0:t.map(e=>({value:e.name,label:e.name,postLabel:e.dataType})))||[],v=(null==y?void 0:y.format)==="timestamptz"?"yyyy-mm-dd hh:mm:ss+zz":(null==y?void 0:y.format)==="timestamp"?"yyyy-mm-dd hh:mm:ss":"Enter a value";return(0,a.jsxs)("div",{className:"flex w-full items-center justify-between gap-x-1 px-3","data-sentry-component":"FilterRow","data-sentry-source-file":"FilterRow.tsx",children:[(0,a.jsx)(h.X,{align:"start",options:g,onSelect:e=>r(s,{...l,column:e}),"data-sentry-element":"DropdownControl","data-sentry-source-file":"FilterRow.tsx",children:(0,a.jsx)(u.$,{asChild:!0,type:"outline",icon:(0,a.jsx)("div",{className:"text-foreground-lighter",children:(0,a.jsx)(m.A,{strokeWidth:1.5})}),className:"w-32 justify-start","data-sentry-element":"Button","data-sentry-source-file":"FilterRow.tsx",children:(0,a.jsx)("span",{children:null!=(n=null==y?void 0:y.name)?n:""})})}),(0,a.jsx)(h.X,{align:"start",options:x.D,onSelect:e=>r(s,{...l,operator:e}),"data-sentry-element":"DropdownControl","data-sentry-source-file":"FilterRow.tsx",children:(0,a.jsx)(u.$,{asChild:!0,type:"outline",icon:(0,a.jsx)("div",{className:"text-foreground-lighter",children:(0,a.jsx)(m.A,{strokeWidth:1.5})}),"data-sentry-element":"Button","data-sentry-source-file":"FilterRow.tsx",children:(0,a.jsx)("span",{children:l.operator})})}),(0,a.jsx)(f.A,{size:"tiny",className:"w-full",placeholder:v,value:l.value,onChange:e=>r(s,{...l,value:e.target.value}),onKeyDown:o,"data-sentry-element":"Input","data-sentry-source-file":"FilterRow.tsx"}),(0,a.jsx)(u.$,{type:"text",className:"px-1",icon:(0,a.jsx)(p.A,{strokeWidth:1.5}),onClick:()=>i(s),"data-sentry-element":"Button","data-sentry-source-file":"FilterRow.tsx"})]})}),g=e=>{let{buttonText:t,filters:n,onApplyFilters:l,portal:m=!0}=e,[p,h]=(0,o.useState)(!1),f=(0,c.Ir)(),[x,g]=(0,o.useState)(n);(0,o.useMemo)(()=>{g(n)},[n]);let v=null!=t?t:n.length>0?"Filtered by ".concat(n.length," rule").concat(n.length>1?"s":""):"Filter",b=(0,o.useCallback)((e,t)=>{g(n=>[...n.slice(0,e),t,...n.slice(e+1)])},[]),_=(0,o.useCallback)(e=>{g(t=>[...t.slice(0,e),...t.slice(e+1)])},[]),N=()=>{let e=x.map(e=>{let t=f.table.columns.find(t=>t.name===e.column);return(null==t?void 0:t.format)==="uuid"?{...e,value:e.value.trim()}:e});g(e),l(e)};function E(e){"Enter"===e.key&&N()}return(0,a.jsxs)(d.AM,{open:p,onOpenChange:h,modal:!1,"data-sentry-element":"Popover_Shadcn_","data-sentry-component":"FilterPopoverPrimitive","data-sentry-source-file":"FilterPopoverPrimitive.tsx",children:[(0,a.jsx)(d.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"FilterPopoverPrimitive.tsx",children:(0,a.jsx)(u.$,{type:n.length>0?"link":"text",icon:(0,a.jsx)(r.A,{}),"data-sentry-element":"Button","data-sentry-source-file":"FilterPopoverPrimitive.tsx",children:v})}),(0,a.jsx)(d.hl,{className:"p-0 w-96",side:"bottom",align:"start",portal:m,"data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"FilterPopoverPrimitive.tsx",children:(0,a.jsxs)("div",{className:"space-y-2 py-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[x.map((e,t)=>(0,a.jsx)(y,{filter:e,filterIdx:t,onChange:b,onDelete:_,onKeyDown:E},"filter-".concat(e.column,"-").concat([t]))),0==x.length&&(0,a.jsxs)("div",{className:"space-y-1 px-3",children:[(0,a.jsx)("h5",{className:"text-foreground-light",children:"No filters applied to this view"}),(0,a.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Add a column below to filter the view"})]})]}),(0,a.jsx)(d.zT,{"data-sentry-element":"PopoverSeparator_Shadcn_","data-sentry-source-file":"FilterPopoverPrimitive.tsx"}),(0,a.jsxs)("div",{className:"px-3 flex flex-row justify-between",children:[(0,a.jsx)(u.$,{icon:(0,a.jsx)(i.A,{}),type:"text",onClick:()=>{var e;let t=null==(e=f.table.columns[0])?void 0:e.name;t&&g([...x,{column:t,operator:"=",value:""}])},"data-sentry-element":"Button","data-sentry-source-file":"FilterPopoverPrimitive.tsx",children:"Add filter"}),(0,a.jsx)(u.$,{disabled:s()(x,n),type:"default",onClick:()=>N(),"data-sentry-element":"Button","data-sentry-source-file":"FilterPopoverPrimitive.tsx",children:"Apply filter"})]})]})})]})}},72633:(e,t,n)=>{n.d(t,{T:()=>h,z:()=>p});var a=n(22990),l=n(32144),s=n(80251),r=n(73969),i=n(28175),o=n(30021),c=n(20305),d=n(91998),u=n(26010),m=n(8552);async function p(e){let{projectRef:t,connectionString:n,column:l,cascade:s=!1}=e,{sql:r}=a.A.columns.remove(l,{cascade:s}),{result:i}=await (0,c.E)({projectRef:t,connectionString:n,sql:r,queryKey:["column","delete",l.id]});return i}let h=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,l.jE)();return(0,s.n)(e=>p(e),{async onSuccess(t,n,l){let{projectRef:s,column:r}=n;await Promise.all([a.invalidateQueries(o.C.list(s)),a.invalidateQueries(i.c.foreignKeyConstraints(s,r.schema)),a.invalidateQueries(d.i.tableEditor(s,r.table_id)),a.invalidateQueries(i.c.tableDefinition(s,r.table_id)),a.invalidateQueries(m.k.listBySchema(s,r.schema))]),await a.invalidateQueries(u.j.tableRowsAndCount(s,r.table_id)),await (null==e?void 0:e(t,n,l))},async onError(e,n,a){void 0===t?r.oR.error("Failed to delete database column: ".concat(e.message)):t(e,n,a)},...n})}},75338:(e,t,n)=>{n.d(t,{T:()=>s});var a=n(80263),l=n(14360);let s=e=>{let{width:t,height:n,value:s,language:r,readOnly:i=!1,onChange:o,onMount:c}=e;return(0,a.jsx)(l.default,{width:t,height:n||"200px",theme:"supabase",wrapperProps:{className:"grid-monaco-editor-container"},className:"grid-monaco-editor",defaultLanguage:r||"plaintext",defaultValue:s,onChange:o,onMount:function(e){e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})});let t=e.getModel().getPositionAt(null==s?void 0:s.length);e.setPosition(t),setTimeout(()=>{null==e||e.focus()},0),c&&c(e)},options:{readOnly:i,tabSize:2,fontSize:13,minimap:{enabled:!1},glyphMargin:!1,folding:!1,lineNumbers:"off",lineNumbersMinChars:0,scrollBeyondLastLine:!1,wordWrap:"on",unusualLineTerminators:"off"},"data-sentry-element":"Editor","data-sentry-component":"MonacoEditor","data-sentry-source-file":"MonacoEditor.tsx"})}},76834:(e,t,n)=>{n.d(t,{Ap:()=>o,Nj:()=>d,Pk:()=>c});var a=n(56947),l=n(20305),s=n(91998),r=n(26616),i=n.n(r);async function o(e,t){var n,a;let{projectRef:s,connectionString:r,id:o}=e;if(!o)throw Error("id is required");let c=o?i()("\n    with base_table_info as (\n        select \n            c.oid::int8 as id,\n            nc.nspname as schema,\n            c.relname as name,\n            c.relkind,\n            c.relrowsecurity as rls_enabled,\n            c.relforcerowsecurity as rls_forced,\n            c.relreplident,\n            c.relowner,\n            obj_description(c.oid) as comment\n        from pg_class c\n        join pg_namespace nc on nc.oid = c.relnamespace\n        where c.oid = ".concat(o,"\n            and not pg_is_other_temp_schema(nc.oid)\n            and (\n                pg_has_role(c.relowner, 'USAGE')\n                or has_table_privilege(\n                    c.oid,\n                    'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER'\n                )\n                or has_any_column_privilege(c.oid, 'SELECT, INSERT, UPDATE, REFERENCES')\n            )\n    ),\n    table_stats as (\n        select \n            b.id,\n            case\n                when b.relreplident = 'd' then 'DEFAULT'\n                when b.relreplident = 'i' then 'INDEX'\n                when b.relreplident = 'f' then 'FULL'\n                else 'NOTHING'\n            end as replica_identity,\n            pg_total_relation_size(format('%I.%I', b.schema, b.name))::int8 as bytes,\n            pg_size_pretty(pg_total_relation_size(format('%I.%I', b.schema, b.name))) as size,\n            pg_stat_get_live_tuples(b.id) as live_rows_estimate,\n            pg_stat_get_dead_tuples(b.id) as dead_rows_estimate\n        from base_table_info b\n        where b.relkind in ('r', 'p')\n    ),\n    primary_keys as (\n        select \n            i.indrelid as table_id,\n            jsonb_agg(jsonb_build_object(\n                'schema', n.nspname,\n                'table_name', c.relname,\n                'table_id', i.indrelid::int8,\n                'name', a.attname\n            )) as primary_keys\n        from pg_index i\n        join pg_class c on i.indrelid = c.oid\n        join pg_attribute a on (a.attrelid = c.oid and a.attnum = any(i.indkey))\n        join pg_namespace n on c.relnamespace = n.oid\n        where i.indisprimary\n        group by i.indrelid\n    ),\n    relationships as (\n        select \n            c.conrelid as source_id,\n            c.confrelid as target_id,\n            jsonb_build_object(\n                'id', c.oid::int8,\n                'constraint_name', c.conname,\n                'deletion_action', c.confdeltype,\n                'update_action', c.confupdtype,\n                'source_schema', nsa.nspname,\n                'source_table_name', csa.relname,\n                'source_column_name', sa.attname,\n                'target_table_schema', nta.nspname,\n                'target_table_name', cta.relname,\n                'target_column_name', ta.attname\n            ) as rel_info\n        from pg_constraint c\n        join pg_class csa on c.conrelid = csa.oid\n        join pg_namespace nsa on csa.relnamespace = nsa.oid\n        join pg_attribute sa on (sa.attrelid = c.conrelid and sa.attnum = any(c.conkey))\n        join pg_class cta on c.confrelid = cta.oid\n        join pg_namespace nta on cta.relnamespace = nta.oid\n        join pg_attribute ta on (ta.attrelid = c.confrelid and ta.attnum = any(c.confkey))\n        where c.contype = 'f'\n    ),\n    columns as (\n        select \n            a.attrelid as table_id,\n            jsonb_agg(jsonb_build_object(\n                'id', (a.attrelid || '.' || a.attnum),\n                'table_id', c.oid::int8,\n                'schema', nc.nspname,\n                'table', c.relname,\n                'ordinal_position', a.attnum,\n                'name', a.attname,\n                'default_value', case \n                    when a.atthasdef then pg_get_expr(ad.adbin, ad.adrelid)\n                    else null\n                end,\n                'data_type', case \n                    when t.typtype = 'd' then \n                        case \n                            when bt.typelem <> 0::oid and bt.typlen = -1 then 'ARRAY'\n                            when nbt.nspname = 'pg_catalog' then format_type(t.typbasetype, null)\n                            else 'USER-DEFINED'\n                        end\n                    else \n                        case \n                            when t.typelem <> 0::oid and t.typlen = -1 then 'ARRAY'\n                            when nt.nspname = 'pg_catalog' then format_type(a.atttypid, null)\n                            else 'USER-DEFINED'\n                        end\n                end,\n                'format', case\n                    when t.typtype = 'e' then\n                        case\n                            when nt.nspname <> 'public' then concat(nt.nspname, '.', coalesce(bt.typname, t.typname))\n                            else coalesce(bt.typname, t.typname)\n                        end\n                    else\n                        coalesce(bt.typname, t.typname)\n                end,\n                'is_identity', a.attidentity in ('a', 'd'),\n                'identity_generation', case a.attidentity\n                    when 'a' then 'ALWAYS'\n                    when 'd' then 'BY DEFAULT'\n                    else null\n                end,\n                'is_generated', a.attgenerated in ('s'),\n                'is_nullable', not (a.attnotnull or t.typtype = 'd' and t.typnotnull),\n                'is_updatable', (\n                    b.relkind in ('r', 'p') or \n                    (b.relkind in ('v', 'f') and pg_column_is_updatable(b.id, a.attnum, false))\n                ),\n                'is_unique', uniques.table_id is not null,\n                'check', check_constraints.definition,\n                'comment', col_description(c.oid, a.attnum),\n                'enums', coalesce(\n                    (\n                        select jsonb_agg(e.enumlabel order by e.enumsortorder)\n                        from pg_catalog.pg_enum e\n                        where e.enumtypid = coalesce(bt.oid, t.oid)\n                            or e.enumtypid = coalesce(bt.typelem, t.typelem)\n                    ),\n                    '[]'::jsonb\n                )\n            ) order by a.attnum) as columns\n        from pg_attribute a\n        join base_table_info b on a.attrelid = b.id\n        join pg_class c on a.attrelid = c.oid\n        join pg_namespace nc on c.relnamespace = nc.oid\n        left join pg_attrdef ad on (a.attrelid = ad.adrelid and a.attnum = ad.adnum)\n        join pg_type t on a.atttypid = t.oid\n        join pg_namespace nt on t.typnamespace = nt.oid\n        left join pg_type bt on (t.typtype = 'd' and t.typbasetype = bt.oid)\n        left join pg_namespace nbt on bt.typnamespace = nbt.oid\n        left join (\n            select \n                conrelid as table_id,\n                conkey[1] as ordinal_position\n            from pg_catalog.pg_constraint\n            where contype = 'u' and cardinality(conkey) = 1\n            group by conrelid, conkey[1]\n        ) as uniques on uniques.table_id = a.attrelid and uniques.ordinal_position = a.attnum\n        left join (\n            select distinct on (conrelid, conkey[1])\n                conrelid as table_id,\n                conkey[1] as ordinal_position,\n                substring(\n                    pg_get_constraintdef(oid, true),\n                    8,\n                    length(pg_get_constraintdef(oid, true)) - 8\n                ) as definition\n            from pg_constraint\n            where contype = 'c' and cardinality(conkey) = 1\n            order by conrelid, conkey[1], oid asc\n        ) as check_constraints on check_constraints.table_id = a.attrelid \n                            and check_constraints.ordinal_position = a.attnum\n        where a.attnum > 0 \n        and not a.attisdropped\n        group by a.attrelid\n    )\n    select \n        case b.relkind\n            when 'r' then jsonb_build_object(\n                'entity_type', b.relkind,\n                'id', b.id,\n                'schema', b.schema,\n                'name', b.name,\n                'rls_enabled', b.rls_enabled,\n                'rls_forced', b.rls_forced,\n                'replica_identity', ts.replica_identity,\n                'bytes', ts.bytes,\n                'size', ts.size,\n                'live_rows_estimate', ts.live_rows_estimate,\n                'dead_rows_estimate', ts.dead_rows_estimate,\n                'comment', b.comment,\n                'primary_keys', coalesce(pk.primary_keys, '[]'::jsonb),\n                'relationships', coalesce(\n                    (select jsonb_agg(r.rel_info)\n                    from relationships r\n                    where r.source_id = b.id or r.target_id = b.id), \n                    '[]'::jsonb\n                ),\n                'columns', coalesce(c.columns, '[]'::jsonb)\n            )\n            when 'p' then jsonb_build_object(\n                'entity_type', b.relkind,\n                'id', b.id,\n                'schema', b.schema,\n                'name', b.name,\n                'rls_enabled', b.rls_enabled,\n                'rls_forced', b.rls_forced,\n                'replica_identity', ts.replica_identity,\n                'bytes', ts.bytes,\n                'size', ts.size,\n                'live_rows_estimate', ts.live_rows_estimate,\n                'dead_rows_estimate', ts.dead_rows_estimate,\n                'comment', b.comment,\n                'primary_keys', coalesce(pk.primary_keys, '[]'::jsonb),\n                'relationships', coalesce(\n                    (select jsonb_agg(r.rel_info)\n                    from relationships r\n                    where r.source_id = b.id or r.target_id = b.id), \n                    '[]'::jsonb\n                ),\n                'columns', coalesce(c.columns, '[]'::jsonb)\n            )\n            when 'v' then jsonb_build_object(\n                'entity_type', b.relkind,\n                'id', b.id,\n                'schema', b.schema,\n                'name', b.name,\n                'is_updatable', (pg_relation_is_updatable(b.id, false) & 20) = 20,\n                'comment', b.comment,\n                'columns', coalesce(c.columns, '[]'::jsonb)\n            )\n            when 'm' then jsonb_build_object(\n                'entity_type', b.relkind,\n                'id', b.id,\n                'schema', b.schema,\n                'name', b.name,\n                'is_populated', true,\n                'comment', b.comment,\n                'columns', coalesce(c.columns, '[]'::jsonb)\n            )\n            when 'f' then jsonb_build_object(\n                'entity_type', b.relkind,\n                'id', b.id,\n                'schema', b.schema,\n                'name', b.name,\n                'comment', b.comment,\n                'columns', coalesce(c.columns, '[]'::jsonb)\n            )\n        end as entity\n    from base_table_info b\n    left join table_stats ts on b.id = ts.id\n    left join primary_keys pk on b.id = pk.table_id\n    left join columns c on b.id = c.table_id;\n  ")):"",{result:d}=await (0,l.E)({projectRef:s,connectionString:r,sql:c,queryKey:["table-editor",o]},t);return null!=(a=null==(n=d[0])?void 0:n.entity)?a:void 0}let c=function(e){let{projectRef:t,connectionString:n,id:l}=e,{enabled:r=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)(s.i.tableEditor(t,l),e=>{let{signal:a}=e;return o({projectRef:t,connectionString:n,id:l},a)},{enabled:r&&void 0!==t&&void 0!==l&&!isNaN(l),refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:3e5,...i})};function d(e,t){let{projectRef:n,connectionString:a,id:l}=t;return e.fetchQuery(s.i.tableEditor(n,l),e=>{let{signal:t}=e;return o({projectRef:n,connectionString:a,id:l},t)})}},79739:(e,t,n)=>{n.d(t,{Hw:()=>o});var a=n(56947),l=n(20305),s=n(28175);let r=e=>{let{schema:t}=e;if(!t)throw Error("schema is required");return"\nSELECT \n  con.oid as id, \n  con.conname as constraint_name, \n  con.confdeltype as deletion_action,\n  con.confupdtype as update_action,\n  rel.oid as source_id,\n  nsp.nspname as source_schema, \n  rel.relname as source_table, \n  (\n    SELECT \n      array_agg(\n        att.attname \n        ORDER BY \n          un.ord\n      ) \n    FROM \n      unnest(con.conkey) WITH ORDINALITY un (attnum, ord) \n      INNER JOIN pg_attribute att ON att.attnum = un.attnum \n    WHERE \n      att.attrelid = rel.oid\n  ) source_columns, \n  frel.oid as target_id,\n  fnsp.nspname as target_schema, \n  frel.relname as target_table, \n  (\n    SELECT \n      array_agg(\n        att.attname \n        ORDER BY \n          un.ord\n      ) \n    FROM \n      unnest(con.confkey) WITH ORDINALITY un (attnum, ord) \n      INNER JOIN pg_attribute att ON att.attnum = un.attnum \n    WHERE \n      att.attrelid = frel.oid\n  ) target_columns \nFROM \n  pg_constraint con \n  INNER JOIN pg_class rel ON rel.oid = con.conrelid \n  INNER JOIN pg_namespace nsp ON nsp.oid = rel.relnamespace \n  INNER JOIN pg_class frel ON frel.oid = con.confrelid \n  INNER JOIN pg_namespace fnsp ON fnsp.oid = frel.relnamespace \nWHERE \n  con.contype = 'f'\n  AND nsp.nspname = '".concat(t,"'\n").trim()};async function i(e,t){let{projectRef:n,connectionString:a,schema:s}=e,i=r({schema:s}),{result:o}=await (0,l.E)({projectRef:n,connectionString:a,sql:i,queryKey:["foreign-key-constraints",s]},t);return(null!=o?o:[]).map(e=>({...e,source_columns:e.source_columns.replace("{","").replace("}","").split(","),target_columns:e.target_columns.replace("{","").replace("}","").split(",")}))}let o=function(e){let{projectRef:t,connectionString:n,schema:l}=e,{enabled:r=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)(s.c.foreignKeyConstraints(t,l),e=>{let{signal:a}=e;return i({projectRef:t,connectionString:n,schema:l},a)},{enabled:r&&void 0!==t&&void 0!==l,...o})}},82819:(e,t,n)=>{n.d(t,{a:()=>u,e:()=>m});var a=n(22990),l=n(32144),s=n(80251),r=n(73969),i=n(20305),o=n(94287),c=n(91998),d=n(98587);async function u(e){let{projectRef:t,connectionString:n,id:l,name:s,schema:r,payload:o}=e,{sql:c}=a.A.tables.update({id:l,name:s,schema:r},o),{result:d}=await (0,i.E)({projectRef:t,connectionString:n,sql:c,queryKey:["table","update",l]});return d}let m=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,l.jE)();return(0,s.n)(e=>u(e),{async onSuccess(t,n,l){let{projectRef:s,schema:r,id:i}=n;await Promise.all([a.invalidateQueries(c.i.tableEditor(s,i)),a.invalidateQueries(d.v.list(s,r)),a.invalidateQueries(o.O.lint(s))]),await (null==e?void 0:e(t,n,l))},async onError(e,n,a){void 0===t?r.oR.error("Failed to update database table: ".concat(e.message)):t(e,n,a)},...n})}},85227:(e,t,n)=>{n.d(t,{l:()=>v});var a=n(80263),l=n(84305),s=n.n(l),r=n(83759),i=n(46865),o=n(53239),c=n(4939),d=n(51509),u=n(22554),m=n(23542),p=n(52066),h=n(36839),f=n(25212),x=n(30068),y=n(8326);let g=(0,o.memo)(e=>{let{index:t,columnName:n,sort:l,onDelete:s,onToggle:r,onDrag:i}=e,d=(0,c.Ir)().table.columns.find(e=>e.name===n),m=(0,o.useRef)(null),[{isDragging:g},v]=(0,f.i)({type:"sort-row",item:()=>({key:n,index:t}),collect:e=>({isDragging:e.isDragging()})}),[{handlerId:b},_]=(0,x.H)({accept:"sort-row",collect:e=>({handlerId:e.getHandlerId()}),hover(e,n){var a;if(!m.current)return;let l=e.index;if(l===t)return;let s=null==(a=m.current)?void 0:a.getBoundingClientRect(),r=(s.bottom-s.top)/2,i=n.getClientOffset().y-s.top;(!(l<t)||!(i<r))&&(l>t&&i>r||(N(l,t),e.index=t))}}),N=(e,t)=>{e!=t&&i(e,t)};return(v(_(m)),d)?(0,a.jsxs)("div",{className:"flex items-center gap-3 px-3",ref:m,style:{opacity:+!g},"data-handler-id":b,"data-sentry-component":"SortRow","data-sentry-source-file":"SortRow.tsx",children:[(0,a.jsx)("span",{className:"transition-color text-foreground-lighter hover:text-foreground-light",children:(0,a.jsx)(p.A,{strokeWidth:2,size:16,"data-sentry-element":"Menu","data-sentry-source-file":"SortRow.tsx"})}),(0,a.jsx)("div",{className:"grow",children:(0,a.jsxs)("span",{className:"flex grow items-center gap-1 truncate text-sm text-foreground",children:[(0,a.jsx)("span",{className:"text-xs text-foreground-lighter",children:t>0?"then by":"sort by"}),d.name]})}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("label",{className:"text-xs text-foreground-lighter",children:"ascending:"}),(0,a.jsx)(y.A,{size:"tiny",layout:"flex",defaultChecked:l.ascending,onChange:e=>r(n,e),"data-sentry-element":"Toggle","data-sentry-source-file":"SortRow.tsx"})]}),(0,a.jsx)(u.$,{icon:(0,a.jsx)(h.A,{strokeWidth:1.5}),size:"tiny",type:"text",onClick:()=>s(n),"data-sentry-element":"Button","data-sentry-source-file":"SortRow.tsx"})]}):null}),v=e=>{var t;let{buttonText:n,sorts:l,onApplySorts:p,portal:h=!0}=e,[f,x]=(0,o.useState)(!1),y=(0,c.Ir)(),[v,b]=(0,o.useState)(l),_=(0,o.useRef)(l),N=(0,o.useRef)(!1);(0,o.useEffect)(()=>{if(N.current){N.current=!1;return}s()(l,_.current)||(b(l),_.current=l)},[l]);let E=null!=n?n:v.length>0?"Sorted by ".concat(v.length," rule").concat(v.length>1?"s":""):"Sort",j=(0,o.useMemo)(()=>{var e;return(null==y||null==(e=y.table)?void 0:e.columns)?y.table.columns.filter(e=>"json"!==e.dataType&&"jsonb"!==e.dataType&&!v.find(t=>t.column==e.name)):[]},[null==y||null==(t=y.table)?void 0:t.columns,v]),S=(0,o.useMemo)(()=>(null==j?void 0:j.map(e=>({value:e.name,label:e.name})))||[],[j]),C=(0,o.useCallback)(e=>{b(t=>t.filter(t=>t.column!==e))},[]),w=(0,o.useCallback)((e,t)=>{b(n=>{let a=n.findIndex(t=>t.column===e);if(-1===a)return n;let l={...n[a],ascending:t};return[...n.slice(0,a),l,...n.slice(a+1)]})},[]),T=(0,o.useCallback)((e,t)=>{b(n=>{if(e<0||e>=n.length||t<0||t>=n.length)return n;let a=n[e],l=[...n.slice(0,e),...n.slice(e+1)];return[...l.slice(0,t),a,...l.slice(t)]})},[]),A=(0,o.useMemo)(()=>v.length!==l.length||v.some((e,t)=>{let n=l[t];return!n||e.column!==n.column||e.ascending!==n.ascending}),[v,l]),I=(e,t)=>"sort-".concat(e.table,"-").concat(e.column,"-").concat(t),R=(0,a.jsxs)("div",{className:"space-y-2 py-2",children:[v.map((e,t)=>(0,a.jsx)(g,{index:t,columnName:e.column,sort:e,onDelete:C,onToggle:w,onDrag:T},I(e,t))),0===v.length&&(0,a.jsxs)("div",{className:"space-y-1 px-3",children:[(0,a.jsx)("h5",{className:"text-foreground-light",children:"No sorts applied to this view"}),(0,a.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Add a column below to sort the view"})]}),(0,a.jsx)(d.zT,{}),(0,a.jsxs)("div",{className:"px-3 flex flex-row justify-between",children:[S&&S.length>0?(0,a.jsx)(m.X,{options:S,onSelect:e=>{var t;let n=null==(t=y.table)?void 0:t.name;n&&b([...v,{table:n,column:e,ascending:!0}])},side:"bottom",align:"start",children:(0,a.jsx)(u.$,{asChild:!0,type:"text",iconRight:(0,a.jsx)(r.A,{size:"14",className:"text-foreground-light"}),className:"sb-grid-dropdown__item-trigger","data-testid":"table-editor-pick-column-to-sort-button",children:(0,a.jsxs)("span",{children:["Pick ",v.length>1?"another":"a"," column to sort by"]})})}):(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"All columns have been added"}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(u.$,{disabled:!A,type:"default",onClick:()=>{N.current=!0,_.current=[...v],p(v.map(e=>({...e})))},children:"Apply sorting"})})]})]});return(0,a.jsxs)(d.AM,{modal:!1,open:f,onOpenChange:x,"data-sentry-element":"Popover_Shadcn_","data-sentry-component":"SortPopoverPrimitive","data-sentry-source-file":"SortPopoverPrimitive.tsx",children:[(0,a.jsx)(d.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"SortPopoverPrimitive.tsx",children:(0,a.jsx)(u.$,{type:v.length>0?"link":"text",icon:(0,a.jsx)(i.A,{}),"data-sentry-element":"Button","data-sentry-source-file":"SortPopoverPrimitive.tsx",children:E})}),(0,a.jsx)(d.hl,{className:"p-0 w-96",side:"bottom",align:"start",portal:h,"data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"SortPopoverPrimitive.tsx",children:R})]})}},85890:(e,t,n)=>{n.d(t,{C:()=>o,e:()=>c});var a=n(80263),l=n(47923),s=n(70891),r=n(35741),i=n(59955);let o=e=>e.map(e=>({id:e.id,name:e.constraint_name,tableId:e.target_id,schema:e.target_schema,table:e.target_table,columns:e.source_columns.map((t,n)=>({source:t,target:e.target_columns[n]})),deletionAction:e.deletion_action,updateAction:e.update_action})),c=(e,t,n)=>{var o;let c="update"===e?"Updating":"Deleting",d=null!=(o=(0,i.Er)(t))?o:"No action";switch(t){case l.P.NO_ACTION:return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-foreground-light",children:d}),": ",c," a record from"," ",(0,a.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will"," ",(0,a.jsx)("span",{className:"text-amber-900 opacity-75",children:"raise an error"})," if there are records existing in this table that reference it"]});case l.P.CASCADE:return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-foreground-light",children:d}),": ",c," a record from"," ",(0,a.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will"," ",(0,a.jsxs)("span",{className:"text-amber-900 opacity-75",children:["also ",e]})," any records that reference it in this table"]});case l.P.RESTRICT:return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-foreground-light",children:d}),(0,a.jsxs)(r.m_,{children:[(0,a.jsx)(r.k$,{className:"translate-y-[3px] mx-1",children:(0,a.jsx)(s.A,{className:"text-foreground-light",size:16,strokeWidth:1.5})}),(0,a.jsx)(r.ZI,{side:"bottom",className:"w-80",children:"This is similar to no action, but the restrict check cannot be deferred till later in the transaction"})]}),": ",c," a record from"," ",(0,a.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will"," ",(0,a.jsxs)("span",{className:"text-amber-900 opacity-75",children:["prevent ",c.toLowerCase()]})," ","existing referencing rows from this table."]});case l.P.SET_DEFAULT:return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-foreground-light",children:d}),": ",c," a record from"," ",(0,a.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will set the value of any existing records in this table referencing it to their"," ",(0,a.jsx)("span",{className:"text-amber-900 opacity-75",children:"default value"})]});case l.P.SET_NULL:return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-foreground-light",children:d}),": ",c," a record from"," ",(0,a.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will set the value of any existing records in this table referencing it"," ",(0,a.jsx)("span",{className:"text-amber-900 opacity-75",children:"to NULL"})]})}}},86256:(e,t,n)=>{n.d(t,{A:()=>n5});var a=n(80263),l=n(32144),s=n(97344),r=n.n(s),i=n(11021),o=n.n(i),c=n(83927),d=n.n(c),u=n(53239),m=n(73969),p=n(46491),h=n(22990),f=n(80251),x=n(20305),y=n(48271);async function g(e){let{projectRef:t,connectionString:n,name:a,tables:l=[],publish_insert:s=!1,publish_update:r=!1,publish_delete:i=!1,publish_truncate:o=!1}=e,{sql:c}=h.A.publications.create({name:a,tables:l,publish_insert:s,publish_update:r,publish_delete:i,publish_truncate:o}),{result:d}=await (0,x.E)({projectRef:t,connectionString:n,sql:c,queryKey:["publication","create"]});return d}let v=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,l.jE)();return(0,f.n)(e=>g(e),{async onSuccess(t,n,l){let{projectRef:s}=n;await a.invalidateQueries(y.b.list(s)),await (null==e?void 0:e(t,n,l))},async onError(e,n,a){void 0===t?m.oR.error("Failed to create database publication: ".concat(e.message)):t(e,n,a)},...n})};var b=n(22011),_=n(29512),N=n(28175),E=n(60885),j=n(30021),S=n(91998),C=n(74388),w=n(26010),T=n(17769),A=n(38319),I=n(25400);async function R(e){let{projectRef:t,connectionString:n,table:a,payload:l,enumArrayColumns:s,returning:r,roleImpersonationState:i}=e,o=(0,A.Nf)(function(e){var t;let{table:n,payload:a,returning:l=!1,enumArrayColumns:s}=e;return new T.Query().from(n.name,null!=(t=n.schema)?t:void 0).insert([a],{returning:l,enumArrayColumns:s}).toSql()}({table:a,payload:l,enumArrayColumns:s,returning:r}),i),{result:c}=await (0,x.E)({projectRef:t,connectionString:n,sql:o,isRoleImpersonationEnabled:(0,I._c)(null==i?void 0:i.role)});return c}let k=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,l.jE)();return(0,f.n)(e=>R(e),{async onSuccess(t,n,l){let{projectRef:s,table:r}=n;await a.invalidateQueries(w.j.tableRowsAndCount(s,r.id)),await (null==e?void 0:e(t,n,l))},async onError(e,n,a){void 0===t?m.oR.error(e.message):t(e,n,a)},...n})};var L=n(51081),O=n(98587),F=n(4107),D=n(16703),P=n(54887),H=n(11509),M=n(45783),U=n(57993),z=n(86336),Y=n(7005),W=n(63121),K=n(93749),B=n.n(K),q=n(55952),V=n(56947),G=function(e){return e.CHECK_CONSTRAINT="c",e.FOREIGN_KEY_CONSTRAINT="f",e.PRIMARY_KEY_CONSTRAINT="p",e.UNIQUE_CONSTRAINT="u",e.CONSTRAINT_TRIGGER="t",e.EXCLUSION_CONSTRAINT="x",e}({});let $=e=>{let{id:t}=e;return"\n  with table_info as (\n    select \n      n.nspname::text as schema,\n      c.relname::text as name,\n      to_regclass(concat('\"', n.nspname, '\".\"', c.relname, '\"')) as regclass\n    from pg_class c\n    join pg_namespace n on n.oid = c.relnamespace\n    where c.oid = ".concat(t,"\n)\nselect \n    con.oid as id,\n    con.conname as name,\n    con.contype as type\nfrom pg_catalog.pg_constraint con\ninner join pg_catalog.pg_class rel\n        on rel.oid = con.conrelid\ninner join pg_catalog.pg_namespace nsp\n        on nsp.oid = connamespace\ninner join table_info ti\n        on ti.schema = nsp.nspname \n        and ti.name = rel.relname;\n").trim()};async function J(e,t){let{projectRef:n,connectionString:a,id:l}=e,s=$({id:l}),{result:r}=await (0,x.E)({projectRef:n,connectionString:a,sql:s,queryKey:["table-constraints",l]},t);return null!=r?r:[]}let Q=function(e){let{projectRef:t,connectionString:n,id:a}=e,{enabled:l=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,V.I)(N.c.tableConstraints(t,a),e=>{let{signal:l}=e;return J({projectRef:t,connectionString:n,id:a},l)},{enabled:l&&void 0!==t&&void 0!==a,...s})};var X=n(79739),Z=n(30145),ee=n(62308),et=n(80832),en=n(48192),ea=n(22554),el=n(4043),es=n(8326),er=n(29785),ei=n(85890),eo=n(56230),ec=n(33358);let ed=[{name:"now()",value:"now()",description:"Returns the current date and time"},{name:"(now() at time zone 'utc')",value:"(now() at time zone 'utc')",description:"Returns the current date and time based on the specified timezone"}],eu=[{name:"Set as NULL",value:null,description:"Set the default value as NULL value"},{name:"Set as empty string",value:"",description:"Set the default value as an empty string"}],em={uuid:[{name:"auth.uid()",value:"auth.uid()",description:"Returns the user's ID when rows are added or updated through the API"},{name:"gen_random_uuid()",value:"gen_random_uuid()",description:"Generates a version 4 UUID"}],time:[...ed],timetz:[...ed],timestamp:[...ed],timestamptz:[...ed],text:[...eu],varchar:[...eu]};var ep=n(46865),eh=n(84558),ef=n(64495);let ex=e=>{let{label:t,description:n,placeholder:l,size:s,layout:r,disabled:i=!1,className:o="",value:c="",suggestions:m=[],suggestionsTooltip:p,suggestionsHeader:h,onChange:f=d(),onSelectSuggestion:x=d(),"data-testid":y}=e,g=(0,u.useRef)(null),[v,b]=(0,u.useState)(m),_=v.length>0;return(0,u.useEffect)(()=>{b(m.slice(0,3))},[m]),(0,a.jsx)("div",{ref:g,className:"relative","data-sentry-component":"InputWithSuggestions","data-sentry-source-file":"InputWithSuggestions.tsx",children:(0,a.jsx)(en.A,{label:t,descriptionText:n,placeholder:l,size:s,layout:r,disabled:i,className:o,inputClassName:"pr-10",type:"text",value:c,onChange:e=>{f(e);let t=e.target.value;m.length>3&&b((t?m.filter(e=>-1!==e.name.indexOf(t)):m).slice(0,3))},"data-testid":y,actions:_&&(0,a.jsxs)(ef.rI,{children:[(0,a.jsx)(ef.ty,{asChild:!0,children:(0,a.jsx)(eh.G,{type:"default",className:"!px-1 mr-0.5",tooltip:{content:{text:p||"Suggestions",side:"bottom"}},children:(0,a.jsx)(ep.A,{strokeWidth:1.5,size:14})})}),(0,a.jsxs)(ef.SQ,{align:"end",side:"bottom",children:[(0,a.jsx)(ef.lp,{children:h||"Suggestions"}),(0,a.jsx)(ef.mB,{}),v.map(e=>(0,a.jsxs)(ef._2,{className:"space-x-2",onClick:()=>x(e),children:[(0,a.jsx)("div",{children:e.name}),(0,a.jsx)("div",{className:"text-foreground-lighter",children:e.description})]},e.name))]})]}),"data-sentry-element":"Input","data-sentry-source-file":"InputWithSuggestions.tsx"})})},ey=e=>{var t,n,l,s;let{columnFields:r,enumTypes:i=[],onUpdateField:o=d()}=e,c=null!=(t=null==em?void 0:em[r.format])?t:[];if(!eo.x0.includes(r.format)&&i.some(e=>e.name===r.format)){let e=i.find(e=>e.name===r.format),t=null!=(n=null==e?void 0:e.enums)?n:[],s=null!=(l=null==r?void 0:r.defaultValue)?l:"",c=s.includes("::")?s.split("::")[0].slice(1,-1):s;if(void 0!==e)return(0,a.jsxs)(ec.Ay,{label:"Default Value",layout:"vertical",value:c,onChange:e=>o({defaultValue:e.target.value}),children:[(0,a.jsx)(ec.Ay.Option,{value:"",children:"NULL"},"empty-enum"),t.map(e=>(0,a.jsx)(ec.Ay.Option,{value:e,children:e},e))]})}return(0,a.jsx)(ex,{label:"Default Value",layout:"vertical",description:"Can either be a literal or an expression. When using an expression wrap your expression in brackets, e.g. (gen_random_uuid())",placeholder:"string"==typeof r.defaultValue&&0===r.defaultValue.length?"EMPTY":"NULL",value:null!=(s=null==r?void 0:r.defaultValue)?s:"",suggestions:c,suggestionsHeader:"Suggested expressions",suggestionsTooltip:"Suggested expressions",onChange:e=>o({defaultValue:e.target.value}),onSelectSuggestion:e=>o({defaultValue:e.value}),"data-sentry-element":"InputWithSuggestions","data-sentry-component":"ColumnDefaultValue","data-sentry-source-file":"ColumnDefaultValue.tsx"})};var eg=n(59955),ev=n(76834),eb=n(14506),e_=n.n(eb),eN=n(70891),eE=n(85436),ej=n(36251),eS=n(32513),eC=n(36839),ew=n(24344),eT=n(38112),eA=n(86252),eI=n(10540),eR=n(47923),ek=n(15224),eL=n(68997),eO=n(46895);let eF=[{key:"no-action",label:"No action",value:eR.P.NO_ACTION},{key:"cascade",label:"Cascade",value:eR.P.CASCADE},{key:"restrict",label:"Restrict",value:eR.P.RESTRICT},{key:"set-default",label:"Set default",value:eR.P.SET_DEFAULT},{key:"set-null",label:"Set NULL",value:eR.P.SET_NULL}],eD={id:void 0,schema:"public",table:"",columns:[],deletionAction:eR.P.NO_ACTION,updateAction:eR.P.NO_ACTION},eP=e=>{var t,n,l,s,r;let{visible:i,table:o,column:c,foreignKey:d,onClose:m,onSaveRelation:p}=e,{data:h}=(0,D.YA)(),{selectedSchema:f}=(0,eL.k)(),[x,y]=(0,u.useState)(eD),[g,v]=(0,u.useState)({}),b=(null!=(t=null==g?void 0:g.types)?t:[]).filter(e=>void 0!==e).length>0,_=(null!=(n=null==g?void 0:g.typeNotice)?n:[]).filter(e=>void 0!==e).length>0,{data:N}=(0,ek.w$)({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString}),{data:E}=(0,F.LW)({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString,schema:x.schema,includeColumns:!0}),j=(null!=E?E:[]).find(e=>e.name===x.table&&e.schema===x.schema),S=void 0===j||b,C=e=>{y({...eD,id:x.id,schema:e})},w=e=>{v({});let t=(null!=E?E:[]).find(t=>t.id===e);t&&y({...eD,id:x.id,name:x.name,tableId:t.id,schema:t.schema,table:t.name,columns:void 0!==c?[{source:c.name,target:""}]:[{source:"",target:""}]})},T=e=>{y({...x,columns:x.columns.filter((t,n)=>n!==e)})},A=(e,t,n)=>{let a=x.columns.map((a,l)=>{var s,r,i;if(l!==e)return a;if("target"===t){let e=null==j||null==(r=j.columns)||null==(s=r.find(e=>e.name===n))?void 0:s.format;return{...a,[t]:n,targetType:e}}{let e=null==(i=o.columns.find(e=>e.name===n))?void 0:i.format;return{...a,[t]:n,sourceType:e}}});y({...x,columns:a})},I=(e,t)=>{v({}),y({...x,[e]:t})},R=e=>{let t={};if(x.columns.filter(e=>""===e.source||""===e.target).length>0&&(t.columns="Please ensure that columns are selected"),Object.keys(t).length>0){v(t),e();return}""!==x.table&&p(x),m(),e()},k=()=>{let e=[],t=[];x.columns.forEach(n=>{var a,l,s,r;let{source:i,target:c,sourceType:d,targetType:u}=n,m=o.columns.find(e=>e.name===i),p=null!=(s=null!=d?d:null==m?void 0:m.format)?s:"",h=null!=(r=null!=u?u:null==j||null==(l=j.columns)||null==(a=l.find(e=>e.name===c))?void 0:a.format)?r:"";return""===i||""===c?t.push(void 0):(null==m?void 0:m.isNewColumn)&&""!==h?e.push({sourceType:p,targetType:h}):eo.N1.includes(p)&&eo.N1.includes(h)||eo.AL.includes(p)&&eo.AL.includes(h)||eo.AL.includes(p)&&eo.AL.includes(h)||"uuid"===p&&"uuid"===h||p===h?t.push(void 0):void t.push({sourceType:p,targetType:h})}),v({types:t,typeNotice:e})};return(0,u.useEffect)(()=>{i&&(void 0!==d?y(d):y({...eD,id:(0,eO.gZ)()}))},[i]),(0,u.useEffect)(()=>{i&&k()},[x]),(0,a.jsx)(et.Ay,{visible:i,onCancel:m,className:"max-w-[480px]",header:"".concat(void 0===d?"Add":"Manage"," foreign key relationship").concat(void 0===d?" to":"s for"," ").concat(o.name.length>0?o.name:"new table"),customFooter:(0,a.jsx)(er.A,{backButtonLabel:"Cancel",disableApply:S,applyButtonLabel:"Save",closePanel:m,applyFunction:e=>R(e)}),"data-sentry-element":"SidePanel","data-sentry-component":"ForeignKeySelector","data-sentry-source-file":"ForeignKeySelector.tsx",children:(0,a.jsx)(et.Ay.Content,{"data-sentry-element":"SidePanel.Content","data-sentry-source-file":"ForeignKeySelector.tsx",children:(0,a.jsxs)("div",{className:"py-6 space-y-6",children:[(0,a.jsx)(eI.A,{icon:(0,a.jsx)(eN.A,{size:20,strokeWidth:1.5}),title:"What are foreign keys?",description:"Foreign keys help maintain referential integrity of your data by ensuring that no\n                one can insert rows into the table that do not have a matching entry to another\n                table.",url:"https://www.postgresql.org/docs/current/tutorial-fk.html",urlLabel:"Postgres Foreign Key Documentation","data-sentry-element":"InformationBox","data-sentry-source-file":"ForeignKeySelector.tsx"}),(0,a.jsx)(ew.A,{id:"schema",label:"Select a schema",value:x.schema,onChange:e=>C(e),"data-sentry-element":"Listbox","data-sentry-source-file":"ForeignKeySelector.tsx",children:null==N?void 0:N.map(e=>(0,a.jsx)(ew.A.Option,{value:e.name,label:e.name,className:"min-w-96",addOnBefore:()=>(0,a.jsx)(eE.A,{size:16,strokeWidth:1.5}),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"hidden",children:e.name}),(0,a.jsx)("span",{className:"text-foreground",children:e.name})]})},e.id))}),(0,a.jsxs)(ew.A,{id:"table",label:"Select a table to reference to",value:null!=(l=null==j?void 0:j.id)?l:1,onChange:e=>w(Number(e)),"data-sentry-element":"Listbox","data-sentry-source-file":"ForeignKeySelector.tsx",children:[(0,a.jsx)(ew.A.Option,{className:"min-w-96",value:1,label:"---","data-sentry-element":"Listbox.Option","data-sentry-source-file":"ForeignKeySelector.tsx",children:"---"},"empty"),e_()(E,["schema"]).map(e=>(0,a.jsx)(ew.A.Option,{value:e.id,label:e.name,className:"min-w-96",addOnBefore:()=>(0,a.jsx)(ej.A,{size:16,strokeWidth:1.5}),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"hidden",children:e.name}),(0,a.jsx)("span",{className:"text-foreground-lighter",children:e.schema}),(0,a.jsx)("span",{className:"text-foreground",children:e.name})]})},e.id))]}),x.schema&&x.table&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-3",children:[(0,a.jsxs)("label",{className:"text-foreground-light text-sm",children:["Select columns from"," ",(0,a.jsxs)("code",{className:"text-xs",children:[x.schema,".",x.table]})," ","to reference to"]}),(0,a.jsxs)("div",{className:"grid grid-cols-10 gap-y-2",children:[(0,a.jsxs)("div",{className:"col-span-5 text-xs text-foreground-lighter",children:[f,".",o.name.length>0?o.name:"[unnamed table]"]}),(0,a.jsxs)("div",{className:"col-span-4 text-xs text-foreground-lighter text-right",children:[x.schema,".",x.table]}),0===x.columns.length&&(0,a.jsx)(eT.Fc,{className:"col-span-10 py-2 px-3",children:(0,a.jsx)(eT.TN,{children:"There are no foreign key relations between the tables"})}),x.columns.map((e,t)=>{var n,l;return(0,a.jsxs)(u.Fragment,{children:[(0,a.jsx)("div",{className:"col-span-4",children:(0,a.jsxs)(ew.A,{id:"column",value:x.columns[t].source,onChange:e=>A(t,"source",e),children:[(0,a.jsx)(ew.A.Option,{value:"",label:"---",className:"!w-[170px]",children:"---"},"empty"),(null!=(n=null==o?void 0:o.columns)?n:[]).filter(e=>0!==e.name.length).map(e=>(0,a.jsx)(ew.A.Option,{value:e.name,label:e.name,className:"!w-[170px]",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-foreground",children:e.name}),(0,a.jsx)("span",{className:"text-foreground-lighter",children:""===e.format?"-":e.format})]})},e.id))]})}),(0,a.jsx)("div",{className:"col-span-1 flex justify-center items-center",children:(0,a.jsx)(eS.A,{})}),(0,a.jsx)("div",{className:"col-span-4",children:(0,a.jsxs)(ew.A,{id:"column",value:x.columns[t].target,onChange:e=>A(t,"target",e),children:[(0,a.jsx)(ew.A.Option,{value:"",label:"---",className:"!w-[170px]",children:"---"},"empty"),(null!=(l=null==j?void 0:j.columns)?l:[]).map(e=>(0,a.jsx)(ew.A.Option,{value:e.name,label:e.name,className:"!w-[170px]",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-foreground",children:e.name}),(0,a.jsx)("span",{className:"text-foreground-lighter",children:e.format})]})},e.id))]})}),(0,a.jsx)("div",{className:"col-span-1 flex justify-end items-center",children:(0,a.jsx)(ea.$,{type:"default",className:"px-1",icon:(0,a.jsx)(eC.A,{}),disabled:1===x.columns.length,onClick:()=>T(t)})})]},"".concat((0,eO.gZ)()))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ea.$,{type:"default",onClick:()=>{y({...x,columns:x.columns.concat([{source:"",target:""}])})},children:"Add another column"}),g.columns&&(0,a.jsx)("p",{className:"text-red-900 text-sm",children:g.columns}),b&&(0,a.jsxs)(eT.Fc,{variant:"warning",children:[(0,a.jsx)(eT.XL,{children:"Column types do not match"}),(0,a.jsx)(eT.TN,{children:"The following columns cannot be referenced as they are not of the same type:"}),(0,a.jsx)("ul",{className:"list-disc pl-5 mt-2 text-foreground-light",children:(null!=(s=null==g?void 0:g.types)?s:[]).map((e,t)=>{var n,l;return void 0===e?null:(0,a.jsxs)("li",{children:[(0,a.jsx)("code",{className:"text-xs",children:null==(n=x.columns[t])?void 0:n.source})," (",e.sourceType,") and"," ",(0,a.jsx)("code",{className:"text-xs",children:null==(l=x.columns[t])?void 0:l.target}),"(",e.targetType,")"]},"type-error-".concat(t))})})]}),_&&(0,a.jsxs)(eT.Fc,{children:[(0,a.jsx)(eT.XL,{children:"Column types will be updated"}),(0,a.jsx)(eT.TN,{children:"The following columns will have their types updated to match their referenced column"}),(0,a.jsx)("ul",{className:"list-disc pl-5 mt-2 text-foreground-light",children:(null!=(r=null==g?void 0:g.typeNotice)?r:[]).map((e,t)=>{var n;return void 0===e?null:(0,a.jsx)("li",{children:(0,a.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,a.jsx)("code",{className:"text-xs",children:null==(n=x.columns[t])?void 0:n.source})," ",(0,a.jsx)(eS.A,{})," ",e.targetType]})},"type-error-".concat(t))})})]})]})]}),(0,a.jsx)(et.Ay.Separator,{}),(0,a.jsx)(eI.A,{icon:(0,a.jsx)(eN.A,{size:"20",strokeWidth:1.5}),title:"Which action is most appropriate?",description:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:"The choice of the action depends on what kinds of objects the related tables represent:"}),(0,a.jsxs)("ul",{className:"mt-2 list-disc pl-4 space-y-1",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("code",{className:"text-xs",children:"Cascade"}),": if the referencing table represents something that is a component of what is represented by the referenced table and cannot exist independently"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("code",{className:"text-xs",children:"Restrict"})," or"," ",(0,a.jsx)("code",{className:"text-xs",children:"No action"}),": if the two tables represent independent objects"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("code",{className:"text-xs",children:"Set NULL"})," or"," ",(0,a.jsx)("code",{className:"text-xs",children:"Set default"}),": if a foreign-key relationship represents optional information"]})]}),(0,a.jsx)("p",{className:"mt-2",children:"Typically, restricting and cascading deletes are the most common options, but the default behavior is no action"})]}),url:"https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-FK",urlLabel:"More information"}),(0,a.jsx)(ew.A,{id:"updateAction",value:x.updateAction,label:"Action if referenced row is updated",descriptionText:(0,a.jsx)("p",{children:(0,ei.e)("update",x.updateAction,"".concat(x.schema,".").concat(x.table))}),onChange:e=>I("updateAction",e),children:eF.filter(e=>["no-action","cascade","restrict"].includes(e.key)).map(e=>(0,a.jsx)(ew.A.Option,{value:e.value,label:e.label,children:(0,a.jsx)("p",{className:"text-foreground",children:e.label})},e.key))}),(0,a.jsx)(ew.A,{id:"deletionAction",value:x.deletionAction,className:"[&>div>label]:flex [&>div>label]:items-center",label:"Action if referenced row is removed",labelOptional:(0,a.jsx)(eA.A,{href:"https://supabase.com/docs/guides/database/postgres/cascade-deletes"}),descriptionText:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("p",{children:(0,ei.e)("delete",x.deletionAction,"".concat(x.schema,".").concat(x.table))})}),onChange:e=>I("deletionAction",e),children:eF.map(e=>(0,a.jsx)(ew.A.Option,{value:e.value,label:e.label,children:(0,a.jsx)("p",{className:"text-foreground",children:e.label})},e.key))})]})]})})})};var eH=n(16110),eM=n(74144),eU=n(80127),ez=n(34531);let eY=e=>{let{foreignKey:t,disabled:n=!1,status:l,layout:s="horizontal",closePanel:r,onSelectEdit:i,onSelectRemove:o,onSelectUndoRemove:c}=e,{ref:d}=(0,p.g)();return(0,a.jsxs)("div",{className:(0,eU.cn)("horizontal"===s?"items-center justify-between gap-x-2":"flex-col gap-y-3","flex border border-strong px-4 py-4","border-b-0 last:border-b first:rounded-t-md last:rounded-b-md"),"data-sentry-component":"ForeignKeyRow","data-sentry-source-file":"ForeignKeyRow.tsx",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[t.name&&(0,a.jsx)("p",{title:t.name,className:"text-xs text-foreground font-mono",children:t.name}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[void 0!==l&&(0,a.jsx)(ez.E,{variant:"ADD"===l?"brand":"UPDATE"===l?"warning":"destructive",children:l}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:[t.columns.length>1?"Composite foreign":"Foreign"," key relation to:"]}),(0,a.jsx)(ea.$,{asChild:!0,type:"default",title:"".concat(t.schema,".").concat(t.table),className:"py-0.5 px-1.5 font-mono",icon:(0,a.jsx)(eH.A,{className:"table-icon",src:"".concat(eM.o2,"/img/icons/table-icon.svg"),style:{width:"16px",height:"16px",strokeWidth:"1px"},preProcessor:e=>e.replace(/svg/,'svg class="m-auto text-color-inherit"'),loader:(0,a.jsx)("span",{className:"block w-4 h-4 bg-[#133929] rounded-sm"}),cacheRequests:!0}),"data-sentry-element":"Button","data-sentry-source-file":"ForeignKeyRow.tsx",children:(0,a.jsxs)(B(),{target:"_blank",rel:"norefererer",href:"/project/".concat(d,"/editor/").concat(t.tableId),"data-sentry-element":"Link","data-sentry-source-file":"ForeignKeyRow.tsx",children:[t.schema,".",t.table]})})]})]}),(0,a.jsx)("div",{className:"flex flex-col gap-y-1",children:t.columns.map((e,n)=>{var l;return(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)("code",{className:(0,eU.cn)("text-xs",0===(null!=(l=null==e?void 0:e.source)?l:"").length&&"text-foreground-light"),children:e.source||"[column_name]"}),(0,a.jsx)(eS.A,{size:16}),(0,a.jsxs)("code",{className:"text-xs",children:[t.schema,".",t.table,".",e.target]})]},"relation-".concat(n,"}"))})})]}),!n&&(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(ea.$,{type:"default",onClick:i,children:"Edit"}),t.toRemove?(0,a.jsx)(ea.$,{type:"default",onClick:c,children:"Cancel remove"}):(0,a.jsx)(ea.$,{type:"default",onClick:o,children:"Remove"})]})]})};var eW=n(84305),eK=n.n(eW);let eB=(e,t)=>{let n=t.columns.map(e=>e.source),a=t.columns.map(e=>e.target);return e.deletion_action!==t.deletionAction||e.update_action!==t.updateAction||e.target_schema!==t.schema||e.target_table!==t.table||!eK()(e.source_columns,n)||!eK()(e.target_columns,a)},eq=e=>{var t;let{column:n,relations:l,closePanel:s,onUpdateColumnType:r,onUpdateFkRelations:i}=e,{id:o}=(0,p.g)(),[c,d]=(0,u.useState)(!1),[m,h]=(0,u.useState)(),{data:f}=(0,D.YA)(),{data:x}=(0,X.Hw)({projectRef:null==f?void 0:f.ref,connectionString:null==f?void 0:f.connectionString,schema:n.schema}),y=o?Number(o):void 0,{data:g}=(0,ev.Pk)({projectRef:null==f?void 0:f.ref,connectionString:null==f?void 0:f.connectionString,id:y}),v=(null!=(t=null==g?void 0:g.columns)?t:[]).map(e=>({id:e.id,name:e.name,format:n.format||e.format,isNewColumn:!1})),b=e=>{let t=(null!=x?x:[]).find(t=>t.id===e.id),n=l.find(t=>t.id===e.id);return(null==n?void 0:n.toRemove)?"REMOVE":void 0===t&&void 0!==n?"ADD":void 0!==t&&void 0!==n?eB(t,n)?"UPDATE":void 0:void 0};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[l.length>0&&(0,a.jsx)("div",{children:l.map(e=>{let t=b(e);return(0,a.jsx)(eY,{layout:"vertical",status:t,foreignKey:e,closePanel:s,onSelectEdit:()=>{d(!0),h(e)},onSelectRemove:()=>{"ADD"===t?i(l.filter(t=>t.id!==e.id)):i(l.map(t=>t.id===e.id?{...t,toRemove:!0}:t))},onSelectUndoRemove:()=>{i(l.map(t=>t.id===e.id?{...t,toRemove:!1}:t))}},e.id)})}),(0,a.jsx)(ea.$,{type:"default",className:"w-min",onClick:()=>d(!0),"data-sentry-element":"Button","data-sentry-source-file":"ColumnForeignKey.tsx",children:"Add foreign key"})]}),void 0!==g&&(0,a.jsx)(eP,{visible:c,column:n,table:{id:g.id,name:g.name,columns:n.isNewColumn&&n.name?v.concat(n):v.map(e=>e.id===n.id?{...e,name:n.name}:e)},foreignKey:m,onClose:()=>{d(!1),h(void 0)},onSaveRelation:e=>{var t;let a=l.map(e=>e.id);void 0!==e.id&&a.includes(e.id)?i(l.map(t=>t.id===e.id?e:t)):i(l.concat([e]));let s=null==(t=e.columns.find(e=>e.source===n.name))?void 0:t.targetType;s&&r(s)}})]})};var eV=n(16782);let eG=e=>{let{table:t,column:n}=e;return n?(0,a.jsxs)(a.Fragment,{children:["Update column ",(0,a.jsx)("code",{children:n.name})," from ",(0,a.jsx)("code",{children:n.table})]}):(0,a.jsxs)(a.Fragment,{children:["Add new column to ",(0,a.jsx)("code",{children:t.name})]})},e$=e=>{var t,n,l,s,i;let{column:o,selectedTable:c,visible:m=!1,closePanel:h=d(),saveChanges:f=d(),updateEditorDirty:x=d()}=e,{ref:y}=(0,p.g)(),{data:g}=(0,D.YA)(),[v,b]=(0,u.useState)({}),[_,N]=(0,u.useState)(),[E,j]=(0,u.useState)([]),[S,C]=(0,u.useState)((0,eg.Pe)(null==_?void 0:_.format,null==_?void 0:_.name)),{data:w}=(0,Z.p)({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString}),{data:T}=(0,ee.Uu)({excludeSchemas:["extensions"]}),A=(null!=w?w:[]).filter(e=>!T.find(t=>t.name===e.schema)),{data:I}=Q({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString,id:null==c?void 0:c.id}),R=(null!=I?I:[]).find(e=>e.type===G.PRIMARY_KEY_CONSTRAINT),{data:k}=(0,X.Hw)({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString,schema:null==c?void 0:c.schema}),L=void 0===o,O=k||[],F=O.filter(e=>e.source_id===(null==o?void 0:o.table_id)&&e.source_columns.includes(o.name)),P=void 0!==E.find(e=>void 0!==e.columns.find(e=>e.source===(null==_?void 0:_.name))&&!e.toRemove);if((0,u.useEffect)(()=>{m&&(b({}),N(L?(0,eg.Eb)({schema:c.schema,table:c.name}):(0,eg.h6)(o,c,O)),j((0,ei.C)(F)))},[m]),!_)return null;let H=e=>{eo.AL.includes(_.format)||""!==e.defaultValue||(e.defaultValue=null);let t="name"in e&&e.name!==_.name,n="format"in e&&e.format!==_.format;t&&E.find(e=>e.columns.find(e=>{let{source:t}=e;return t===(null==_?void 0:_.name)}))&&j(E.map(t=>({...t,columns:t.columns.map(t=>t.source===(null==_?void 0:_.name)?{...t,source:e.name}:t)}))),(t||n)&&C((0,eg.Pe)(e.format||_.format,e.name||_.name)),N({..._,...e}),x();let a={...v};for(let t of Object.keys(e))delete a[t];b(a)},M=e=>{if(_){let t=(0,eg.MG)(_);(b(t),r()(t))?f(L?(0,eg.Oj)(c,_):(0,eg.f9)(o,c,_),L,{columnId:null==o?void 0:o.id,primaryKey:R,foreignKeyRelations:E,existingForeignKeyRelations:F},e):e()}};return(0,a.jsxs)(et.Ay,{size:"xlarge",visible:m,onConfirm:e=>M(e),header:(0,a.jsx)(eG,{table:c,column:o}),onCancel:h,customFooter:(0,a.jsx)(er.A,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:h,applyFunction:e=>M(e)}),"data-sentry-element":"SidePanel","data-sentry-component":"ColumnEditor","data-sentry-source-file":"ColumnEditor.tsx",children:[(0,a.jsx)(q.y9,{header:(0,a.jsx)(q.sj,{className:"lg:!col-span-4",children:"General"}),"data-sentry-element":"FormSection","data-sentry-source-file":"ColumnEditor.tsx",children:(0,a.jsxs)(q.DE,{loading:!1,className:"lg:!col-span-8","data-sentry-element":"FormSectionContent","data-sentry-source-file":"ColumnEditor.tsx",children:[(0,a.jsx)(en.A,{label:"Name",type:"text",descriptionText:"Recommended to use lowercase and use an underscore to separate words e.g. column_name",placeholder:"column_name",error:v.name,value:null!=(t=null==_?void 0:_.name)?t:"",onChange:e=>H({name:e.target.value}),"data-sentry-element":"Input","data-sentry-source-file":"ColumnEditor.tsx"}),(0,a.jsx)(en.A,{label:"Description",labelOptional:"Optional",type:"text",value:null!=(n=null==_?void 0:_.comment)?n:"",onChange:e=>H({comment:e.target.value}),"data-sentry-element":"Input","data-sentry-source-file":"ColumnEditor.tsx"})]})}),(0,a.jsx)(et.Ay.Separator,{"data-sentry-element":"SidePanel.Separator","data-sentry-source-file":"ColumnEditor.tsx"}),(0,a.jsx)(q.y9,{header:(0,a.jsx)(q.sj,{className:"lg:!col-span-4",description:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ea.$,{asChild:!0,type:"default",size:"tiny",icon:(0,a.jsx)(Y.A,{strokeWidth:2}),children:(0,a.jsx)(B(),{href:"/project/".concat(y,"/database/types"),target:"_blank",rel:"noreferrer",children:"Create enum types"})}),(0,a.jsx)(ea.$,{asChild:!0,type:"default",size:"tiny",icon:(0,a.jsx)(W.A,{size:14,strokeWidth:2}),children:(0,a.jsx)(B(),{href:"https://supabase.com/docs/guides/database/tables#data-types",target:"_blank",rel:"noreferrer",children:"About data types"})})]}),children:"Data Type"}),"data-sentry-element":"FormSection","data-sentry-source-file":"ColumnEditor.tsx",children:(0,a.jsxs)(q.DE,{loading:!1,className:"lg:!col-span-8","data-sentry-element":"FormSectionContent","data-sentry-source-file":"ColumnEditor.tsx",children:[(0,a.jsx)(eV.A,{showRecommendation:!0,value:null!=(l=null==_?void 0:_.format)?l:"",layout:"vertical",enumTypes:A,error:v.format,description:P?"Column type cannot be changed as it has a foreign key relation":"",disabled:P,onOptionSelect:e=>H({format:e,defaultValue:null}),"data-sentry-element":"ColumnType","data-sentry-source-file":"ColumnEditor.tsx"}),void 0===_.foreignKey&&(0,a.jsxs)("div",{className:"space-y-4",children:[_.format.includes("int")&&(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(el.A,{label:"Is Identity",description:"Automatically assign a sequential unique number to the column",checked:_.isIdentity,onChange:()=>{let e=!_.isIdentity,t=!e&&_.isArray;H({isIdentity:e,isArray:t})}})}),!_.isPrimaryKey&&(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(el.A,{label:"Define as Array",description:"Allow column to be defined as variable-length multidimensional arrays",checked:_.isArray,onChange:()=>{let e=!_.isArray,t=!e&&_.isIdentity;H({isArray:e,isIdentity:t})}})})]}),(0,a.jsx)(ey,{columnFields:_,enumTypes:A,onUpdateField:H,"data-sentry-element":"ColumnDefaultValue","data-sentry-source-file":"ColumnEditor.tsx"})]})}),(0,a.jsx)(et.Ay.Separator,{"data-sentry-element":"SidePanel.Separator","data-sentry-source-file":"ColumnEditor.tsx"}),(0,a.jsx)(q.y9,{header:(0,a.jsx)(q.sj,{className:"lg:!col-span-4",children:"Foreign Keys"}),"data-sentry-element":"FormSection","data-sentry-source-file":"ColumnEditor.tsx",children:(0,a.jsx)(q.DE,{loading:!1,className:"lg:!col-span-8","data-sentry-element":"FormSectionContent","data-sentry-source-file":"ColumnEditor.tsx",children:(0,a.jsx)(eq,{column:_,relations:E,closePanel:h,onUpdateColumnType:e=>{"_"===e[0]?H({format:e.slice(1),isArray:!0,isIdentity:!1}):H({format:e})},onUpdateFkRelations:j,"data-sentry-element":"ColumnForeignKey","data-sentry-source-file":"ColumnEditor.tsx"})})}),(0,a.jsx)(et.Ay.Separator,{"data-sentry-element":"SidePanel.Separator","data-sentry-source-file":"ColumnEditor.tsx"}),(0,a.jsx)(q.y9,{header:(0,a.jsx)(q.sj,{className:"lg:!col-span-4",children:"Constraints"}),"data-sentry-element":"FormSection","data-sentry-source-file":"ColumnEditor.tsx",children:(0,a.jsxs)(q.DE,{loading:!1,className:"lg:!col-span-8","data-sentry-element":"FormSectionContent","data-sentry-source-file":"ColumnEditor.tsx",children:[(0,a.jsx)(es.A,{label:"Is Primary Key",descriptionText:"A primary key indicates that a column or group of columns can be used as a unique identifier for rows in the table",checked:null!=(s=null==_?void 0:_.isPrimaryKey)&&s,onChange:()=>H({isPrimaryKey:!(null==_?void 0:_.isPrimaryKey)}),"data-sentry-element":"Toggle","data-sentry-source-file":"ColumnEditor.tsx"}),(0,a.jsx)(es.A,{label:"Allow Nullable",descriptionText:"Allow the column to assume a NULL value if no value is provided",checked:_.isNullable,onChange:()=>H({isNullable:!_.isNullable}),"data-sentry-element":"Toggle","data-sentry-source-file":"ColumnEditor.tsx"}),(0,a.jsx)(es.A,{label:"Is Unique",descriptionText:"Enforce values in the column to be unique across rows",checked:_.isUnique,onChange:()=>H({isUnique:!_.isUnique}),"data-sentry-element":"Toggle","data-sentry-source-file":"ColumnEditor.tsx"}),(0,a.jsx)(en.A,{label:"CHECK Constraint",labelOptional:"Optional",placeholder:S,type:"text",value:null!=(i=null==_?void 0:_.check)?i:"",onChange:e=>H({check:e.target.value}),className:"[&_input]:font-mono","data-sentry-element":"Input","data-sentry-source-file":"ColumnEditor.tsx"})]})})]},"ColumnEditor")};var eJ=n(21749),eQ=n(77395),eX=n(22745),eZ=n(96777),e0=n(62527),e1=n(85227),e2=n(101),e3=n(4939),e5=n(94887),e4=n(96334),e9=n(75820);let e8=e=>{let{page:t,setPage:n,rowsPerPage:l,currentPageRowsCount:s=0,isLoading:r=!1}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-2","data-sentry-component":"Pagination","data-sentry-source-file":"Pagination.tsx",children:[r&&(0,a.jsx)(e4.A,{size:14,className:"animate-spin"}),(0,a.jsx)(ea.$,{icon:(0,a.jsx)(e9.A,{}),type:"outline",disabled:t<=1||r,onClick:()=>{n(e=>e-1)},title:"Previous Page",style:{padding:"3px 10px"},"data-sentry-element":"Button","data-sentry-source-file":"Pagination.tsx"}),(0,a.jsx)(ea.$,{icon:(0,a.jsx)(eS.A,{}),type:"outline",disabled:s<l||r,onClick:()=>{n(e=>e+1)},title:"Next Page",style:{padding:"3px 10px"},"data-sentry-element":"Button","data-sentry-source-file":"Pagination.tsx"})]})};var e6=n(10208),e7=n(24560),te=n(53469),tt=n(51553),tn=n(30221),ta=n(35741);let tl=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,a.jsxs)("div",{className:"flex h-full items-center justify-center gap-2","data-sentry-component":"columnRender","data-sentry-source-file":"SelectorGrid.tsx",children:[t&&(0,a.jsxs)(ta.m_,{children:[(0,a.jsx)(ta.k$,{children:(0,a.jsx)("div",{className:"text-brand",children:(0,a.jsx)(e6.A,{size:14,strokeWidth:2})})}),(0,a.jsx)(ta.ZI,{side:"bottom",children:"Primary key"})]}),(0,a.jsx)("span",{className:"sb-grid-column-header__inner__name",children:e})]})},ts=e=>{let{column:t,format:n,row:l}=e,s="bytea"===n?(0,e5.ds)(l[t]):null===l[t]?null:"object"==typeof l[t]?JSON.stringify(l[t]):l[t];return(0,a.jsx)("div",{className:"group sb-grid-select-cell__formatter overflow-hidden","data-sentry-component":"formatter","data-sentry-source-file":"SelectorGrid.tsx",children:null===s?(0,a.jsx)(te.X,{}):(0,a.jsx)("span",{className:"text-sm truncate",children:s})})},tr=e=>{let{rows:t,onRowSelect:n}=e,l=(0,e3.Ir)().table.columns.map(e=>{let t=(0,tn.AM)(e),n=(e.name.length+e.format.length)*tn.lu;return{key:e.name,name:e.name,renderCell:t=>ts({column:e.name,format:e.format,row:t.row}),renderHeaderCell:()=>tl(e.name,e.isPrimaryKey),resizable:!0,width:t<n?n:t,minWidth:tt.T_}});return(0,a.jsx)(e7.Ay,{columns:l,rows:t,style:{height:"100%"},onCellClick:e=>n(e.row),rowClass:()=>"cursor-pointer","data-sentry-element":"DataGrid","data-sentry-component":"SelectorGrid","data-sentry-source-file":"SelectorGrid.tsx"})},ti=e=>{var t,n;let{visible:l,foreignKey:s,onSelect:r,closePanel:i}=e,{id:o}=(0,p.g)(),{data:c}=(0,D.YA)(),{data:d}=(0,ev.Pk)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString,id:o?Number(o):void 0}),{tableId:m,schema:h,table:f,columns:x}=null!=s?s:{},y=m?Number(m):void 0,g=(null!=(t=null==d?void 0:d.columns)?t:[]).find(e=>e.name===(null==x?void 0:x[0].source)),v=1===(null!=x?x:[]).length&&(null==g?void 0:g.is_nullable),{data:b}=(0,ev.Pk)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString,id:y}),[{sort:_,filter:N},E]=(0,u.useState)({filter:[],sort:[]}),[j,S]=(0,u.useState)(1),C=(0,I.RY)(),{data:w,isLoading:T,isSuccess:A,isError:R,isRefetching:k}=(0,e2.vs)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString,tableId:null==b?void 0:b.id,sorts:_,filters:N,page:j,limit:100,roleImpersonationState:C},{keepPreviousData:!0});return(0,a.jsx)(et.Ay,{visible:l,size:"large",header:(0,a.jsxs)("div",{children:["Select a record to reference from"," ",(0,a.jsxs)("code",{className:"font-mono text-sm",children:[h,".",f]})]}),onCancel:i,customFooter:(0,a.jsx)(er.A,{hideApply:!0,backButtonLabel:"Cancel",closePanel:i}),"data-sentry-element":"SidePanel","data-sentry-component":"ForeignRowSelector","data-sentry-source-file":"ForeignRowSelector.tsx",children:(0,a.jsx)(et.Ay.Content,{className:"h-full !px-0","data-sentry-element":"SidePanel.Content","data-sentry-source-file":"ForeignRowSelector.tsx",children:(0,a.jsxs)("div",{className:"h-full",children:[T&&(0,a.jsxs)("div",{className:"flex h-full py-6 flex-col items-center justify-center space-y-2",children:[(0,a.jsx)(eJ.A,{size:14,className:"animate-spin"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Loading rows"})]}),R&&(0,a.jsx)("div",{className:"flex h-full py-6 flex-col items-center justify-center",children:(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Unable to load rows from"," ",(0,a.jsxs)("code",{children:[h,".",f]}),". Please try again or contact support."]})}),(null==c?void 0:c.ref)&&b&&A&&(0,a.jsx)(e3.HQ,{projectRef:c.ref,table:b,editable:!1,children:(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between my-2 mx-3",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(eZ.A,{tableId:null==b?void 0:b.id,isRefetching:k}),(0,a.jsx)(e0.b,{portal:!1,filters:N,onApplyFilters:e=>{j>1&&S(1),E(t=>({...t,filter:e}))}}),(0,a.jsx)(eQ.Q,{backend:eX.t2,context:window,children:(0,a.jsx)(e1.l,{portal:!1,sorts:_,onApplySorts:e=>{E(t=>({...t,sort:e}))}})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-x-3 divide-x",children:[(0,a.jsx)(e8,{page:j,setPage:S,rowsPerPage:100,currentPageRowsCount:null!=(n=null==w?void 0:w.rows.length)?n:0,isLoading:k}),v&&(0,a.jsx)("div",{className:"pl-3",children:(0,a.jsx)(ea.$,{type:"default",onClick:()=>{(null==x?void 0:x.length)===1&&r({[x[0].source]:null})},children:"Set NULL"})})]})]}),w.rows.length>0?(0,a.jsx)(tr,{rows:w.rows,onRowSelect:e=>{r(null==x?void 0:x.reduce((t,n)=>{let a=null==d?void 0:d.columns.find(e=>e.name===n.target),l=(null==a?void 0:a.format)==="bytea"?(0,e5.ds)(e[n.target]):e[n.target];return{...t,[n.source]:l}},{}))}}):(0,a.jsx)("div",{className:"flex h-full items-center justify-center border-b border-t border-default",children:(0,a.jsx)("span",{className:"text-foreground-light text-sm",children:"No Rows Found"})})]})})]})})})};var to=n(48177),tc=n(9884),td=n(30382),tu=n(1095),tm=n(88491),tp=n.n(tm),th=n(90083),tf=n(72343);let tx=e=>{let{breadcrumbs:t=[],resetBreadcrumbs:n,onSelectBreadcrumb:l}=e;return(0,a.jsxs)("div",{className:"flex items-center space-x-2","data-sentry-component":"DrilldownBreadCrumbs","data-sentry-source-file":"DrilldownBreadCrumbs.tsx",children:[(0,a.jsx)(th.A,{size:16,strokeWidth:2,onClick:()=>n(),className:"cursor-pointer","data-sentry-element":"Home","data-sentry-source-file":"DrilldownBreadCrumbs.tsx"}),t.length>0&&t.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(tf.A,{size:16,strokeWidth:2}),e===tp()(t)?(0,a.jsx)("p",{className:"font-mono text-xs",children:e}):(0,a.jsx)("p",{className:"font-mono text-xs",children:(0,a.jsx)("div",{className:"cursor-pointer",onClick:()=>l(t.slice(0,t.indexOf(e)+1)),children:e})})]},e))]})};var ty=n(70350),tg=n.n(ty);let tv=e=>{let{pane:t,jsonData:n,activeKey:l,onSelectKey:s=d()}=e;if(!n)return(0,a.jsx)("div",{className:"flex-1 ".concat(2===t?"border-l border-default":""),children:(0,a.jsx)("div",{className:"flex space-x-2 py-2 px-5",children:(0,a.jsx)("p",{className:"text-sm",children:"Invalid JSON"})})});if(0===Object.keys(n).length)return(0,a.jsx)("div",{className:"max-w-[50%] flex-1 ".concat(2===t?"border-l border-default":""),children:(0,a.jsx)("div",{className:"flex space-x-2 py-2 px-5",children:(0,a.jsx)("p",{className:"text-sm opacity-50",children:"No data available"})})});let r=Object.keys(n).filter(e=>"object"==typeof n[e]&&!tg()(n[e])),i=Object.keys(n).filter(e=>tg()(n[e])||"object"!=typeof n[e]);return(0,a.jsxs)("div",{className:"max-w-[50%] flex-1 ".concat(2===t?"border-l border-default":""),"data-sentry-component":"DrilldownPane","data-sentry-source-file":"DrilldownPane.tsx",children:[r.map(e=>(0,a.jsxs)("div",{className:"\n              ".concat(e===l?"bg-surface-300":"","\n              group flex cursor-pointer items-center transition\n              justify-between py-2 px-5 hover:bg-surface-200\n            "),onClick:()=>s(e,t),children:[(0,a.jsx)("p",{className:"font-mono text-xs !text-blue-900",children:e}),(0,a.jsx)("div",{className:"".concat(e===l?"opacity-100":"opacity-50"," group-hover:opacity-100 transition"),children:(0,a.jsx)(tf.A,{strokeWidth:2,size:16})})]},e)),i.map(e=>(0,a.jsxs)("div",{className:"flex space-x-2 py-2 px-5",children:[(0,a.jsxs)("p",{className:"font-mono text-xs !text-blue-900",children:[e,":"]}),(0,a.jsx)("p",{className:"break-all font-mono text-xs ".concat("string"!=typeof n[e]?"!text-green-900":"!text-yellow-900"),children:tg()(n[e])?"null":"string"==typeof n[e]?'"'.concat(n[e],'"'):n[e].toString()})]},e))]})},tb=e=>{let{jsonData:t={}}=e,[n,l]=(0,u.useState)(),[s,i]=(0,u.useState)([]),[o,c]=(0,u.useState)(t),[d,m]=(0,u.useState)({}),p=(e,t)=>{l(e);let n=s.slice();1===t&&(m(o[e]),r()(d)||n.pop(),n.push(e),i(n)),2===t&&(c(d),m(d[e]),n.push(e),i(n))};return(0,a.jsxs)("div",{className:"border border-x-0 border-t-0 border-muted","data-sentry-component":"DrilldownViewer","data-sentry-source-file":"DrilldownViewer.tsx",children:[(0,a.jsx)("div",{className:"h-10 px-3 flex-initial flex items-center justify-between",children:(0,a.jsx)(tx,{breadcrumbs:s,onSelectBreadcrumb:e=>{let n=tp()(e)||"";l(n);let a={...t};if(i(s.slice(0,s.indexOf(n)+1)),null===e)c(a),m({});else if(1===e.length)c(a),m(t[s[0]]);else{for(let t of e)a=a[t],e.indexOf(t)===e.length-2&&c(a);m(a)}},resetBreadcrumbs:()=>{l(void 0),i([]),c(t),m({})},"data-sentry-element":"DrilldownBreadCrumbs","data-sentry-source-file":"DrilldownViewer.tsx"})}),(0,a.jsxs)("div",{className:"flex items-stretch flex-auto justify-between border-t border-muted",children:[(0,a.jsx)(tv,{pane:1,jsonData:o,onSelectKey:p,activeKey:n,"data-sentry-element":"DrilldownPane","data-sentry-source-file":"DrilldownViewer.tsx"}),(0,a.jsx)(tv,{pane:2,jsonData:d,onSelectKey:p,"data-sentry-element":"DrilldownPane","data-sentry-source-file":"DrilldownViewer.tsx"})]})]})};var t_=n(14360);let tN=e=>{let{value:t="",readOnly:n=!1,onInputChange:l=d()}=e;return(0,a.jsx)(t_.default,{className:"monaco-editor",theme:"supabase",defaultLanguage:"json",value:t,loading:(0,a.jsx)("h4",{children:"Loading"}),options:{readOnly:n,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,lineNumbersMinChars:4},onMount:e=>{e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),e.focus()},onChange:l,"data-sentry-element":"Editor","data-sentry-component":"JsonEditor","data-sentry-source-file":"JsonCodeEditor.tsx"})},tE=e=>{let{row:t,column:n,visible:l,backButtonLabel:s,applyButtonLabel:r,readOnly:i=!1,closePanel:o,onSaveJSON:c}=e,{id:d}=(0,p.g)(),h=d?Number(d):void 0,{data:f}=(0,D.YA)(),{data:x}=(0,ev.Pk)({projectRef:null==f?void 0:f.ref,connectionString:null==f?void 0:f.connectionString,id:h}),[y,g]=(0,u.useState)("edit"),[v,b]=(0,u.useState)(""),_=null==t?void 0:t[n],N="object"==typeof _?JSON.stringify(_):_,E=(0,e5.Mr)(N),{mutate:j,isLoading:S,isSuccess:w,reset:T}=(0,tu.c2)(),A=async e=>{try{let t=(0,eO.Cf)(v),n=(0,eO.hC)(t);c&&c(n,e)}catch(t){e(),m.oR.error("JSON seems to have an invalid structure.")}},I=()=>{b((0,eO.G1)(v))};(0,u.useEffect)(()=>{l&&b((0,eO.G1)(N))},[l]);let R=(0,u.useCallback)(()=>{T(),o()},[T]);return(0,a.jsx)(et.Ay,{size:"large",header:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:["edit"===y?(0,a.jsxs)("p",{children:[i?"Viewing":"Editing"," value of: ",(0,a.jsx)("code",{children:n})]}):(0,a.jsxs)("p",{children:["Viewing value of: ",(0,a.jsx)("code",{children:n})]}),(!E||E&&w)&&(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:["edit"===y&&(0,a.jsx)(eh.G,{type:"default",icon:(0,a.jsx)(tc.A,{}),className:"px-1",onClick:()=>I(),tooltip:{content:{side:"bottom",text:"Prettify JSON"}}}),(0,a.jsx)(td.A,{options:["view","edit"],activeOption:y,borderOverride:"border-muted",onClickOption:g})]})]}),visible:l,onCancel:R,customFooter:(0,a.jsx)(er.A,{hideApply:i,closePanel:R,backButtonLabel:s,applyButtonLabel:r,applyFunction:i?void 0:A}),"data-sentry-element":"SidePanel","data-sentry-component":"JsonEdit","data-sentry-source-file":"JsonEditor.tsx",children:(0,a.jsxs)("div",{className:"flex flex-auto h-full flex-col gap-y-4 relative",children:["edit"===y?(0,a.jsx)("div",{className:"w-full h-full flex-grow",children:(0,a.jsx)(tN,{readOnly:i,onInputChange:e=>b(null!=e?e:""),value:v.toString()},N)}):(0,a.jsx)(tb,{jsonData:(0,eO.Bl)(v)}),E&&!w&&(0,a.jsxs)("div",{className:(0,eU.cn)("absolute top-0 left-0 flex items-center justify-center flex-col gap-y-3","text-sm w-full h-full px-2 text-center","bg-default/80 backdrop-blur-[1.5px]"),children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-1 w-80",children:[(0,a.jsxs)("p",{children:["JSON value is larger than ",to.SF.toLocaleString()," characters"]}),(0,a.jsx)("p",{className:"text-foreground-light",children:"You may try to render the entire JSON value, but your browser may run into performance issues"})]}),(0,a.jsx)(ea.$,{type:"default",loading:S,onClick:()=>{if(void 0===x||void 0===f||void 0===t||!(0,C.KO)(x))return;if(0===x.primary_keys.length)return(0,m.oR)("Unable to load value as table has no primary keys");let e=x.primary_keys.reduce((e,n)=>({...e,[n.name]:t[n.name]}),{});j({table:{schema:x.schema,name:x.name},column:n,pkMatch:e,projectRef:null==f?void 0:f.ref,connectionString:null==f?void 0:f.connectionString},{onSuccess:e=>{b(JSON.stringify(e))}})},children:"Load full JSON data"})]})]})})};var tj=n(53667),tS=n.n(tj);let tC=e=>{let{isNewRecord:t,tableName:n}=e,l="".concat(t?"Add new":"Update"," row ").concat(t?"to":"from"," ");return(0,a.jsxs)(a.Fragment,{children:[l,n&&(0,a.jsx)("span",{className:"text-code font-mono",children:n})]})};var tw=n(86926),tT=n.n(tw),tA=n(96196),tI=n(10426),tR=n(59130),tk=n(57374),tL=n(53434),tO=n.n(tL);let tF=e=>{let{value:t,onChange:n,name:l,isNullable:s,format:r,description:i,disabled:o=!1}=e,c=function(e){var t,n,a;if(t=e,eo.J5.indexOf(t.toLowerCase())>-1)return"date";if(n=e,eo.mL.indexOf(n.toLowerCase())>-1)return"time";return(a=e,eo.aw.indexOf(a.toLowerCase())>-1)?"datetime-local":"text"}(r);return(0,a.jsx)(en.A,{layout:"horizontal",className:(0,eU.cn)("w-full [&>div>div>div>input]:pr-10"),label:l,descriptionText:(0,a.jsxs)("div",{className:"space-y-1",children:[i,r.includes("tz")&&(0,a.jsxs)("p",{children:["Your local timezone will be automatically applied (",tO()().format("ZZ"),")"]})]}),labelOptional:r,size:"small",value:t,type:c,step:"datetime-local"==c||"time"==c?"1":void 0,actions:!o&&(0,a.jsxs)(ef.rI,{children:[(0,a.jsx)(ef.ty,{asChild:!0,children:(0,a.jsx)(ea.$,{type:"default",icon:(0,a.jsx)(tA.A,{}),className:"px-1.5"})}),(0,a.jsxs)(ef.SQ,{align:"end",className:"w-28 pointer-events-auto",children:[s&&(0,a.jsx)(ef._2,{onClick:()=>n(""),children:"Set to NULL"}),(0,a.jsx)(ef._2,{onClick:()=>n(tO()().format("date"===r?"YYYY-MM-DD":["time","timetz"].includes(r)?"HH:mm:ss":"YYYY-MM-DDTHH:mm:ss")),children:"Set to now"})]})]}),onChange:e=>n(e.target.value),disabled:o,"data-sentry-element":"Input","data-sentry-component":"DateTimeInput","data-sentry-source-file":"DateTimeInput.tsx"})},tD="Note: Value is too large to be rendered in the dashboard. Please expand the editor to edit the value",tP=e=>{var t,n,l,s,r,i,o,c,u;let{field:m,errors:p,isEditable:h=!0,onUpdateField:f=d(),onEditJson:x=d(),onEditText:y=d(),onSelectForeignKey:g=d()}=e;if(m.enums.length>0)return"_"===m.format[0]?(0,a.jsx)("div",{className:"text-area-text-sm",children:(0,a.jsx)(en.A.TextArea,{"data-testid":"".concat(m.name,"-input"),layout:"horizontal",label:m.name,className:"text-sm",descriptionText:m.comment,labelOptional:m.format,disabled:!h,error:p[m.name],rows:5,value:null!=(t=m.value)?t:"",placeholder:null===m.defaultValue?"":"string"==typeof m.defaultValue&&0===m.defaultValue.length?"EMPTY":"Default: ".concat(m.defaultValue),onChange:e=>f({[m.name]:e.target.value})})}):(0,a.jsxs)(ec.Ay,{size:"medium",layout:"horizontal",value:null!=(n=m.value)?n:"",label:m.name,labelOptional:m.format,descriptionText:m.comment,disabled:!h,error:p[m.name],onChange:e=>f({[m.name]:e.target.value}),children:[(0,a.jsx)(ec.Ay.Option,{value:"",children:"---"}),m.enums.map(e=>(0,a.jsx)(ec.Ay.Option,{value:e,children:e},e))]});if(void 0!==m.foreignKey)return(0,a.jsx)(en.A,{"data-testid":"".concat(m.name,"-input"),layout:"horizontal",placeholder:"NULL",label:m.name,value:null!=(l=m.value)?l:"",descriptionText:(0,a.jsxs)(a.Fragment,{children:[m.comment&&(0,a.jsxs)("span",{className:"text-sm text-foreground-lighter",children:[m.comment," "]}),(0,a.jsxs)("span",{className:"text-sm text-foreground-lighter",children:[m.comment&&"(","Has a foreign key relation to"]}),(0,a.jsxs)("span",{className:"text-code font-mono text-xs text-foreground-lighter",children:[m.foreignKey.target_table_schema,".",m.foreignKey.target_table_name,".",m.foreignKey.target_column_name]}),m.comment&&(0,a.jsx)("span",{className:"text-sm text-foreground-lighter",children:")"})]}),labelOptional:m.format,disabled:!h,error:p[m.name],onChange:e=>f({[m.name]:e.target.value}),actions:h&&(0,a.jsxs)(ef.rI,{children:[(0,a.jsx)(ef.ty,{asChild:!0,children:(0,a.jsx)(ea.$,{type:"default",icon:(0,a.jsx)(tA.A,{}),className:"px-1.5"})}),(0,a.jsxs)(ef.SQ,{align:"end",className:"w-28",children:[m.isNullable&&(0,a.jsx)(ef._2,{onClick:()=>f({[m.name]:null}),children:"Set to NULL"}),(0,a.jsx)(ef._2,{onClick:g,children:"Select record"})]})]})});if(tT()(eo.AL,m.format)){let e=(0,e5.Mr)(m.value);return(0,a.jsx)("div",{className:"text-area-text-sm",children:(0,a.jsx)(en.A.TextArea,{"data-testid":"".concat(m.name,"-input"),layout:"horizontal",label:m.name,className:"input-sm",descriptionText:(0,a.jsxs)(a.Fragment,{children:[m.comment&&(0,a.jsx)("p",{children:m.comment}),e&&(0,a.jsx)("p",{children:tD})]}),textAreaClassName:"pr-8",labelOptional:m.format,disabled:!h||e,error:p[m.name],rows:5,value:null!=(s=m.value)?s:"",placeholder:null===m.value&&null===m.defaultValue?"NULL":""===m.value||"string"==typeof m.defaultValue&&0===m.defaultValue.length?"EMPTY":"NULL (Default: ".concat(m.defaultValue,")"),actions:(0,a.jsxs)(ef.rI,{children:[(0,a.jsx)(ef.ty,{asChild:!0,children:(0,a.jsx)(ea.$,{type:"default",icon:(0,a.jsx)(tA.A,{}),className:"px-1.5"})}),(0,a.jsxs)(ef.SQ,{align:"end",className:"w-28",children:[h&&(0,a.jsx)(ef._2,{onClick:()=>f({[m.name]:null}),children:"Set to NULL"}),(0,a.jsx)(ef._2,{onClick:()=>y({column:m.name,value:m.value||""}),children:"Expand editor"})]})]}),onChange:e=>f({[m.name]:e.target.value})})})}if(tT()(eo.J_,m.format)){let e=(0,e5.Mr)(m.value);return(0,a.jsx)(en.A,{"data-testid":"".concat(m.name,"-input"),layout:"horizontal",value:null!=(r=m.value)?r:"",label:m.name,descriptionText:(0,a.jsxs)(a.Fragment,{children:[m.comment&&(0,a.jsx)("p",{children:m.comment}),e&&(0,a.jsx)("p",{children:tD})]}),labelOptional:m.format,disabled:!h||e,placeholder:null!=(i=null==m?void 0:m.defaultValue)?i:"NULL",error:p[m.name],onChange:e=>f({[m.name]:e.target.value}),actions:(0,a.jsx)(ea.$,{type:"default",htmlType:"button",onClick:()=>x({column:m.name,value:m.value}),icon:h?(0,a.jsx)(tA.A,{}):(0,a.jsx)(tI.A,{}),children:h?"Edit":"View JSON"})})}if(tT()(eo.mN,m.format))return(0,a.jsx)(tF,{name:m.name,format:m.format,value:null!=(o=m.value)?o:"",isNullable:m.isNullable,description:(0,a.jsxs)(a.Fragment,{children:[m.defaultValue&&(0,a.jsxs)("p",{children:["Default: ",m.defaultValue]}),m.comment&&(0,a.jsx)("p",{children:m.comment})]}),onChange:e=>f({[m.name]:e}),disabled:!h});if("bool"===m.format){let e=[{value:"true",label:"TRUE"},{value:"false",label:"FALSE"},...m.isNullable?[{value:"null",label:"NULL"}]:[]],t=null===m.value?void 0:m.value;return(0,a.jsx)(tk.M,{isReactForm:!1,layout:"horizontal",label:m.name,labelOptional:m.format,description:m.comment,className:"[&>div:first-child>span]:text-foreground-lighter",children:(0,a.jsxs)(tR.l6,{value:null===t?"null":t,onValueChange:e=>f({[m.name]:e}),disabled:!h,children:[(0,a.jsx)(tR.bq,{children:(0,a.jsx)(tR.yv,{placeholder:"Select a value"})}),(0,a.jsx)(tR.gC,{children:(0,a.jsx)(tR.s3,{children:e.map(e=>(0,a.jsx)(tR.eb,{value:e.value,children:e.label},e.value))})})]})})}if("bytea"===m.format)return(0,a.jsx)(en.A,{"data-testid":"".concat(m.name,"-input"),layout:"horizontal",label:m.name,descriptionText:(0,a.jsxs)(a.Fragment,{children:[m.comment&&(0,a.jsx)("p",{children:m.comment}),(0,a.jsx)("p",{children:"Bytea columns are edited and displayed as hex in the dashboard"})]}),labelOptional:m.format,error:p[m.name],value:null!=(c=m.value)?c:"",placeholder:"\\x",disabled:!h,onChange:e=>f({[m.name]:e.target.value})});let v=(0,e5.Mr)(m.value);return(0,a.jsx)(en.A,{"data-testid":"".concat(m.name,"-input"),layout:"horizontal",label:m.name,descriptionText:(0,a.jsxs)(a.Fragment,{children:[m.comment&&(0,a.jsx)("p",{children:m.comment}),v&&(0,a.jsx)("p",{children:tD})]}),labelOptional:m.format,error:p[m.name],value:null!=(u=m.value)?u:"",placeholder:m.isIdentity?"Automatically generated as identity":null!==m.defaultValue?"Default: ".concat(m.defaultValue):"NULL",disabled:!h||v,onChange:e=>f({[m.name]:e.target.value}),actions:v?(0,a.jsx)(ea.$,{type:"default",htmlType:"button",onClick:()=>x({column:m.name,value:m.value}),icon:h?(0,a.jsx)(tA.A,{}):(0,a.jsx)(tI.A,{}),children:h?"Edit":"View"}):void 0,"data-sentry-element":"Input","data-sentry-component":"InputField","data-sentry-source-file":"InputField.tsx"})};var tH=n(15660),tM=n(73980);let tU=e=>{let{visible:t,readOnly:n=!1,row:l,column:s,closePanel:r,onSaveField:i}=e,{id:o}=(0,p.g)(),c=o?Number(o):void 0,{data:d}=(0,D.YA)(),{data:h}=(0,ev.Pk)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString,id:c}),[f,x]=(0,u.useState)(""),[y,g]=(0,u.useState)("edit"),v=null==l?void 0:l[s],b=(0,e5.Mr)(v),{mutate:_,isLoading:N,isSuccess:E,reset:j}=(0,tu.c2)();(0,u.useEffect)(()=>{t&&(g("edit"),x(v))},[t]);let S=(0,u.useCallback)(()=>{j(),r()},[j]);return(0,a.jsx)(et.Ay,{size:"large",visible:t,onCancel:S,header:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("p",{children:[n?"Viewing":"Editing"," value of: ",(0,a.jsx)("code",{children:s})]}),(!b||b&&E)&&(0,a.jsx)(td.A,{options:["view","edit"],activeOption:y,borderOverride:"border-muted",onClickOption:g})]}),customFooter:(0,a.jsx)(er.A,{hideApply:n,closePanel:S,backButtonLabel:"Cancel",applyButtonLabel:"Save value",applyFunction:n?void 0:e=>{i&&i(f,e)}}),"data-sentry-element":"SidePanel","data-sentry-component":"TextEditor","data-sentry-source-file":"TextEditor.tsx",children:(0,a.jsxs)("div",{className:"relative flex flex-auto h-full flex-col gap-y-4",children:["edit"===y?(0,a.jsx)("div",{className:"w-full h-full flex-grow",children:(0,a.jsx)(t_.Editor,{theme:"supabase",className:"monaco-editor",defaultLanguage:"markdown",value:f,loading:(0,a.jsx)(e4.A,{className:"animate-spin",strokeWidth:2,size:20}),options:{readOnly:n,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,lineNumbersMinChars:4},onMount:e=>{e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),e.focus()},onChange:e=>x(null!=e?e:"")},v)}):(0,a.jsx)(et.Ay.Content,{className:"py-4 bg-default flex-grow",children:(0,a.jsx)(tM.o,{remarkPlugins:[tH.A],className:"bg-default markdown-body",content:f})}),b&&!E&&(0,a.jsxs)("div",{className:(0,eU.cn)("absolute top-0 left-0 flex items-center justify-center flex-col gap-y-3","text-sm w-full h-full px-2 text-center","bg-default/80 backdrop-blur-[1.5px]"),children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-1 w-80",children:[(0,a.jsxs)("p",{children:["Text value is larger than ",to.SF.toLocaleString()," characters"]}),(0,a.jsx)("p",{className:"text-foreground-light",children:"You may try to render the entire text value, but your browser may run into performance issues"})]}),(0,a.jsx)(ea.$,{type:"default",loading:N,onClick:()=>{if(void 0===h||void 0===d||void 0===l||!(0,C.KO)(h))return;if(0===h.primary_keys.length)return(0,m.oR)("Unable to load value as table has no primary keys");let e=h.primary_keys.reduce((e,t)=>({...e,[t.name]:l[t.name]}),{});_({table:{schema:h.schema,name:h.name},column:s,pkMatch:e,projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString},{onSuccess:e=>x(e)})},children:"Load full text data"})]})]})})},tz=e=>{var t,n,l,s;let{row:i,selectedTable:o,visible:c=!1,editable:m=!0,closePanel:p=d(),saveChanges:h=d(),updateEditorDirty:f=d()}=e,[x,y]=(0,u.useState)({}),[g,v]=(0,u.useState)([]),[b,_]=(0,u.useState)(),[N,E]=(0,u.useState)(),[j,S]=(0,u.useState)(!1),[C,w]=(0,u.useState)(),T=void 0===i,A=void 0!==b,I=void 0!==N,[R,k]=(0,u.useState)(!1),[L,O]=tS()(g,e=>!e.isNullable),{data:F}=(0,D.YA)(),{data:P}=(0,X.Hw)({projectRef:null==F?void 0:F.ref,connectionString:null==F?void 0:F.connectionString,schema:o.schema}),H=(0,ei.C)((null!=P?P:[]).filter(e=>e.source_schema===(null==o?void 0:o.schema)&&e.source_table===(null==o?void 0:o.name))),M=(0,u.useMemo)(()=>{var e;return H&&(null==C||null==(e=C.foreignKey)?void 0:e.id)?H.find(e=>{var t;return e.id===(null==(t=C.foreignKey)?void 0:t.id)}):void 0},[H,null==C||null==(t=C.foreignKey)?void 0:t.id]);(0,u.useEffect)(()=>{c&&(y({}),v((0,e5.jm)(i,o,H)))},[c]);let U=e=>{let t=Object.keys(e);v(g.map(n=>t.includes(n.name)?{...n,value:e[n.name]}:n)),f()},z=async e=>{S(!0),w(e)},Y=e=>{e.preventDefault();let t=(0,e5.MG)(g);if(y(t),k(!0),r()(t)){f();let e=T?(0,e5.Gk)(g):(0,e5.F2)(i,g),t={identifiers:{},rowIdx:-1};if(!T){let e=g.filter(e=>e.isPrimaryKey),n={};e.forEach(e=>{n[e.name]="bytea"===e.format?(0,e5.ds)(i[e.name]):i[e.name]}),t.identifiers=n,t.rowIdx=i.idx}h(e,T,t,()=>k(!1))}else k(!1)},W=(0,u.useMemo)(()=>g.reduce((e,t)=>(e[t.name]=t.value,e),{}),[g]);return(0,a.jsxs)(et.Ay,{hideFooter:!0,size:"large",visible:c,header:(0,a.jsx)(tC,{isNewRecord:T,tableName:o.name}),className:"transition-all duration-100 ease-in ".concat(A||I||j?" mr-32":""),onCancel:p,"data-sentry-element":"SidePanel","data-sentry-component":"RowEditor","data-sentry-source-file":"RowEditor.tsx",children:[(0,a.jsx)("form",{onSubmit:e=>Y(e),className:"h-full",children:(0,a.jsxs)("div",{className:"flex h-full flex-col",children:[(0,a.jsxs)("div",{className:"flex flex-grow flex-col",children:[L.length>0&&(0,a.jsx)(et.Ay.Content,{children:(0,a.jsx)("div",{className:"space-y-10 py-6",children:L.map(e=>(0,a.jsx)(tP,{field:e,errors:x,onUpdateField:U,onEditJson:E,onEditText:_,onSelectForeignKey:()=>z(e),isEditable:m},e.id))})}),O.length>0&&(0,a.jsxs)(a.Fragment,{children:[L.length>0&&(0,a.jsx)(et.Ay.Separator,{}),(0,a.jsx)(et.Ay.Content,{children:(0,a.jsxs)("div",{className:"space-y-10 py-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-base text-foreground",children:"Optional Fields"}),(0,a.jsx)("p",{className:"text-sm text-foreground-lighter",children:"These are columns that do not need any value"})]}),O.map(e=>(0,a.jsx)(tP,{field:e,errors:x,onUpdateField:U,onEditText:_,onEditJson:E,onSelectForeignKey:()=>z(e),isEditable:m},e.id))]})})]}),(0,a.jsx)(tU,{visible:A,row:W,column:null!=(n=null==b?void 0:b.column)?n:"",closePanel:()=>_(void 0),onSaveField:e=>{var t;U({[null!=(t=null==b?void 0:b.column)?t:""]:e}),_(void 0)},readOnly:!m,"data-sentry-element":"TextEditor","data-sentry-source-file":"RowEditor.tsx"}),(0,a.jsx)(tE,{visible:I,row:W,column:null!=(l=null==N?void 0:N.column)?l:"",closePanel:()=>E(void 0),onSaveJSON:e=>{var t;U({[null!=(t=null==N?void 0:N.column)?t:""]:e}),E(void 0)},readOnly:!m,"data-sentry-element":"JsonEditor","data-sentry-source-file":"RowEditor.tsx"})]}),(0,a.jsx)("div",{className:"flex-shrink",children:(0,a.jsx)(er.A,{loading:R,backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:p,hideApply:!m,"data-sentry-element":"ActionBar","data-sentry-source-file":"RowEditor.tsx"})})]})}),(0,a.jsx)(ti,{visible:j,foreignKey:M,onSelect:e=>{void 0!==C&&void 0!==e&&U(e),S(!1),w(void 0)},closePanel:()=>{S(!1),w(void 0)},"data-sentry-element":"ForeignRowSelector","data-sentry-source-file":"RowEditor.tsx"},"foreign-row-selector-".concat(null!=(s=null==M?void 0:M.id)?s:"null"))]},"RowEditor")};var tY=n(41622),tW=n(62140),tK=n.n(tW),tB=n(48388),tq=n.n(tB),tV=n(77191),tG=n.n(tV),t$=n(33419);async function tJ(e){let{projectRef:t,connectionString:n,payload:a}=e,{sql:l}=h.A.columns.create({schema:a.schema,table:a.table,name:a.name,type:a.type,default_value:a.defaultValue,default_value_format:a.defaultValueFormat,is_identity:a.isIdentity,identity_generation:a.identityGeneration,is_nullable:a.isNullable,is_primary_key:a.isPrimaryKey,is_unique:a.isUnique,comment:a.comment,check:a.check}),{result:s}=await (0,x.E)({projectRef:t,connectionString:n,sql:l,queryKey:["column","create"]});return s}var tQ=n(72633);async function tX(e){let{projectRef:t,connectionString:n,originalColumn:a,payload:l}=e,{sql:s}=h.A.columns.update(a,{name:l.name,type:l.type,drop_default:l.dropDefault,default_value:l.defaultValue,default_value_format:l.defaultValueFormat,is_identity:l.isIdentity,identity_generation:l.identityGeneration,is_nullable:l.isNullable,is_unique:l.isUnique,comment:l.comment,check:l.check}),{result:r}=await (0,x.E)({projectRef:t,connectionString:n,sql:s,queryKey:["column","update",a.id]});return r}var tZ=n(8462),t0=n(56667);async function t1(e){let{projectRef:t,connectionString:n,payload:a}=e,{sql:l}=h.A.tables.create(a),{result:s}=await (0,x.E)({projectRef:t,connectionString:n,sql:l,queryKey:["table","create"]});return s}var t2=n(99581);async function t3(e,t){let{projectRef:n,connectionString:a,name:l,schema:s}=e,{sql:r,zod:i}=h.A.tables.retrieve({name:l,schema:s}),{result:o}=await (0,x.E)({projectRef:n,connectionString:a,sql:r,queryKey:O.v.retrieve(n,l,s)},t);return i.parse(o[0])}var t5=n(82819);let t4=async(e,t,n,a,l)=>{let s=l.join('","'),r='ALTER TABLE "'.concat(n,'"."').concat(a,'" ADD PRIMARY KEY ("').concat(s,'")');return await (0,x.E)({projectRef:e,connectionString:t,sql:r,queryKey:["primary-keys"]})},t9=async(e,t,n,a,l)=>{let s='ALTER TABLE "'.concat(n,'"."').concat(a,'" DROP CONSTRAINT "').concat(l,'"');return await (0,x.E)({projectRef:e,connectionString:t,sql:s,queryKey:["drop-constraint"]})},t8=e=>{let{table:t,foreignKeys:n}=e,a=e=>e===eR.P.CASCADE?"ON DELETE CASCADE":e===eR.P.RESTRICT?"ON DELETE RESTRICT":e===eR.P.SET_DEFAULT?"ON DELETE SET DEFAULT":e===eR.P.SET_NULL?"ON DELETE SET NULL":"",l=e=>e===eR.P.CASCADE?"ON UPDATE CASCADE":e===eR.P.RESTRICT?"ON UPDATE RESTRICT":"";return n.map(e=>{let{deletionAction:n,updateAction:s}=e,r=a(n),i=l(s);return'\n      ALTER TABLE "'.concat(t.schema,'"."').concat(t.name,'"\n      ADD FOREIGN KEY (').concat(e.columns.map(e=>'"'.concat(e.source,'"')).join(","),')\n      REFERENCES "').concat(e.schema,'"."').concat(e.table,'" (').concat(e.columns.map(e=>'"'.concat(e.target,'"')).join(","),")\n      ").concat(i,"\n      ").concat(r,"\n    ").replace(/\s+/g," ").trim()}).join(";")+";"},t6=async e=>{let{projectRef:t,connectionString:n,table:a,foreignKeys:l}=e,s=t8({table:a,foreignKeys:l});return await (0,x.E)({projectRef:t,connectionString:n,sql:s,queryKey:["foreign-keys"]})},t7=e=>{let{table:t,foreignKeys:n}=e;return n.map(e=>'\nALTER TABLE IF EXISTS "'.concat(t.schema,'"."').concat(t.name,'"\nDROP CONSTRAINT IF EXISTS "').concat(e.name,'"\n').replace(/\s+/g," ").trim()).join(";")+";"},ne=async e=>{let{projectRef:t,connectionString:n,table:a,foreignKeys:l}=e,s=t7({table:a,foreignKeys:l});return await (0,x.E)({projectRef:t,connectionString:n,sql:s,queryKey:["foreign-keys"]})},nt=async e=>{let{projectRef:t,connectionString:n,table:a,foreignKeys:l}=e,s="\n  ".concat(t7({table:a,foreignKeys:l}),"\n  ").concat(t8({table:a,foreignKeys:l}),"\n  ").replace(/\s+/g," ").trim();return await (0,x.E)({projectRef:t,connectionString:n,sql:s,queryKey:["foreign-keys"]})},nn=async e=>{let{projectRef:t,connectionString:n,payload:a,selectedTable:l,primaryKey:s,foreignKeyRelations:r=[],skipSuccessMessage:i=!1,toastId:o}=e,c=null!=o?o:m.oR.loading('Creating column "'.concat(a.name,'"...'));try{let{isPrimaryKey:e,...o}=a;if(await tJ({projectRef:t,connectionString:n,payload:o}),e){m.oR.loading("Assigning primary key to column...",{id:c});let e=l.primary_keys.map(e=>e.name);e.length>0&&void 0!==s&&await t9(t,n,a.schema,a.table,s.name);let r=e.concat([o.name]);await t4(t,n,a.schema,a.table,r)}return r.length>0&&await t6({projectRef:t,connectionString:n,table:{schema:a.schema,name:a.table},foreignKeys:r}),i||m.oR.success('Successfully created column "'.concat(o.name,'"'),{id:c}),{error:void 0}}catch(e){return m.oR.error('An error occurred while creating the column "'.concat(a.name,'"'),{id:c}),{error:e}}},na=async e=>{let{projectRef:t,connectionString:n,originalColumn:a,payload:l,selectedTable:s,primaryKey:r,foreignKeyRelations:i=[],existingForeignKeyRelations:o=[],skipPKCreation:c,skipSuccessMessage:d=!1}=e;try{let{isPrimaryKey:e,...p}=l;if(await tX({projectRef:t,connectionString:n,originalColumn:a,payload:p}),!c&&void 0!==e){var u;let l=s.primary_keys.map(e=>e.name);l.length>0&&void 0!==r&&await t9(t,n,a.schema,a.table,r.name);let i=null!=(u=p.name)?u:a.name,o=e?l.concat([i]):l.filter(e=>e!==i);o.length&&await t4(t,n,a.schema,a.table,o)}i.length>0&&await nd({projectRef:t,connectionString:n,table:{schema:a.schema,name:a.table},foreignKeys:i,existingForeignKeyRelations:o}),d||m.oR.success('Successfully updated column "'.concat(a.name,'"'))}catch(e){return{error:e}}},nl=async(e,t,n,a)=>{let l=(0,t0.S)(),{duplicateTable:s,isRLSEnabled:r,isDuplicateRows:i,foreignKeyRelations:o}=a,{name:c,schema:d}=s,u=n.name;if(await (0,x.E)({projectRef:e,connectionString:t,sql:['CREATE TABLE "'.concat(d,'"."').concat(u,'" (LIKE "').concat(d,'"."').concat(c,'" INCLUDING ALL);'),void 0!==n.comment?'comment on table "'.concat(d,'"."').concat(u,"\" is '").concat(n.comment,"';"):""].join("\n")}),await l.invalidateQueries(O.v.list(e,d)),o.length>0&&await t6({projectRef:e,connectionString:t,table:{...s,name:n.name},foreignKeys:o}),i){var m;await (0,x.E)({projectRef:e,connectionString:t,sql:'INSERT INTO "'.concat(d,'"."').concat(u,'" SELECT * FROM "').concat(d,'"."').concat(c,'";')}),(null!=(m=s.columns)?m:[]).filter(e=>null!==e.identity_generation).map(async n=>{await (0,x.E)({projectRef:e,connectionString:t,sql:"SELECT setval('\"".concat(d,'"."').concat(u,"_").concat(n.name,'_seq"\', (SELECT MAX("').concat(n.name,'") FROM "').concat(d,'"."').concat(c,'"));')})})}let p=await l.fetchQuery({queryKey:O.v.list(e,d),queryFn:n=>{let{signal:a}=n;return(0,F.oI)({projectRef:e,connectionString:t,schema:d},a)}}),h=tq()(p,{schema:d,name:u});return r&&await (0,t5.a)({projectRef:e,connectionString:t,id:null==h?void 0:h.id,name:null==h?void 0:h.name,schema:null==h?void 0:h.schema,payload:{rls_enabled:r}}),h},ns=async e=>{let{projectRef:t,connectionString:n,toastId:l,payload:s,columns:r=[],foreignKeyRelations:i,isRLSEnabled:o,importContent:c}=e,d=(0,t0.S)();await t1({projectRef:t,connectionString:n,payload:s});let u=await d.fetchQuery({queryKey:O.v.retrieve(t,s.name,s.schema),queryFn:e=>{let{signal:a}=e;return t3({projectRef:t,connectionString:n,name:s.name,schema:s.schema},a)}});try{for(let e of(o&&await (0,t5.a)({projectRef:t,connectionString:n,id:u.id,name:u.name,schema:u.schema,payload:{rls_enabled:o}}),m.oR.loading("Adding ".concat(r.length," columns to ").concat(u.name,"..."),{id:l}),r)){let a=(0,eg.Oj)(u,{...e,isPrimaryKey:!1});await tJ({projectRef:t,connectionString:n,payload:a})}let e=r.filter(e=>e.isPrimaryKey).map(e=>e.name);if(e.length>0&&await t4(t,n,u.schema,u.name,e),i.length>0&&await t6({projectRef:t,connectionString:n,table:{schema:u.schema,name:u.name},foreignKeys:i}),void 0!==c)if(c.file&&c.rowCount>0){let{error:e}=await no(t,n,c.file,u,c.selectedHeaders,e=>{m.oR.loading((0,a.jsx)("div",{className:"flex flex-col space-y-2",style:{minWidth:"220px"},children:(0,a.jsx)(t$.A,{value:e,max:100,type:"horizontal",barClass:"bg-brand",labelBottom:"Adding ".concat(c.rowCount.toLocaleString()," rows to ").concat(u.name),labelBottomClass:"",labelTop:"".concat(e.toFixed(2),"%"),labelTopClass:"tabular-nums"})}),{id:l})});for(let e of r.filter(e=>e.isIdentity))await (0,x.E)({projectRef:t,connectionString:n,sql:"SELECT setval('".concat(u.name,"_").concat(e.name,"_seq', (SELECT MAX(\"").concat(e.name,'") FROM "').concat(u.name,'"));')});if(void 0!==e){m.oR.error("Do check your spreadsheet if there are any discrepancies.");let t="Table ".concat(u.name," has been created but we ran into an error while inserting rows: ").concat(e.message);m.oR.error(t),console.error("Error:",{error:e,message:t})}}else for(let e of(await nc(t,n,u,c.rows,c.selectedHeaders,e=>{m.oR.loading((0,a.jsx)("div",{className:"flex flex-col space-y-2",style:{minWidth:"220px"},children:(0,a.jsx)(t$.A,{value:e,max:100,type:"horizontal",barClass:"bg-brand",labelBottom:"Adding ".concat(c.rows.length.toLocaleString()," rows to ").concat(u.name),labelBottomClass:"",labelTop:"".concat(e.toFixed(2),"%"),labelTopClass:"tabular-nums"})}),{id:l})}),r.filter(e=>e.isIdentity)))await (0,x.E)({projectRef:t,connectionString:n,sql:"SELECT setval('".concat(u.name,"_").concat(e.name,"_seq', (SELECT MAX(\"").concat(e.name,'") FROM "').concat(u.name,'"));')});return await (0,tZ.q3)({queryClient:d,projectRef:t,connectionString:n,id:u.id}),u}catch(e){throw(0,t2.k)({projectRef:t,connectionString:n,id:u.id,name:u.name,schema:u.schema}),e}},nr=async e=>{var t,n,a;let{projectRef:l,connectionString:s,toastId:i,table:o,payload:c,columns:d,foreignKeyRelations:u,existingForeignKeyRelations:p,primaryKey:h}=e,f=(0,t0.S)(),x=d.filter(e=>e.isPrimaryKey).map(e=>e.name),y=o.primary_keys.map(e=>e.name),g=!eK()(x,y);g&&void 0!==h&&await t9(l,s,o.schema,o.name,h.name),await (0,t5.a)({projectRef:l,connectionString:s,id:o.id,name:o.name,schema:o.schema,payload:c});let v=await f.fetchQuery({queryKey:O.v.retrieve(l,null!=(t=c.name)?t:o.name,null!=(n=c.schema)?n:o.schema),queryFn:e=>{var t,n;let{signal:a}=e;return t3({projectRef:l,connectionString:s,name:null!=(t=c.name)?t:o.name,schema:null!=(n=c.schema)?n:o.schema},a)}}),b=null!=(a=v.columns)?a:[],_=d.map(e=>e.id);for(let e of b.filter(e=>!_.includes(e.id)))m.oR.loading("Removing column ".concat(e.name," from ").concat(v.name),{id:i}),await (0,tQ.z)({projectRef:l,connectionString:s,column:e});let E=!1;for(let e of d)if(e.id.includes(o.id.toString())){let t=tq()(b,{id:e.id});if(t){let n=(0,eg.f9)(t,v,e);if(!r()(n)){m.oR.loading("Updating column ".concat(e.name," from ").concat(v.name),{id:i});let a=await na({projectRef:l,connectionString:s,originalColumn:t,payload:n,selectedTable:v,skipPKCreation:!0,skipSuccessMessage:!0});(null==a?void 0:a.error)&&(E=!0,m.oR.error('Failed to update column "'.concat(e.name,'": ').concat(a.error.message)))}}}else{m.oR.loading("Adding column ".concat(e.name," to ").concat(v.name),{id:i});let t=(0,eg.Oj)(v,{...e,isPrimaryKey:!1}),{error:n}=await nn({projectRef:l,connectionString:s,payload:t,selectedTable:v,skipSuccessMessage:!0,toastId:i});n&&(E=!0)}return g&&x.length>0&&await t4(l,s,v.schema,v.name,x),await nd({projectRef:l,connectionString:s,table:v,foreignKeys:u,existingForeignKeyRelations:p}),await Promise.all([f.invalidateQueries(S.i.tableEditor(l,o.id)),f.invalidateQueries(N.c.foreignKeyConstraints(l,o.schema)),f.invalidateQueries(N.c.tableDefinition(l,o.id)),f.invalidateQueries(j.C.list(l)),f.invalidateQueries(O.v.list(l,o.schema,!0))]),await f.invalidateQueries(w.j.tableRowsAndCount(l,o.id)),{table:await (0,ev.Nj)(f,{projectRef:l,connectionString:s,id:o.id}),hasError:E}},ni=e=>{let{rows:t,headers:n,columns:a=[]}=e;return t.map(e=>{let t={};return n.forEach(n=>{var l,s;let r=null==a?void 0:a.find(e=>e.name===n),i=e[n];if((null!=(l=null==r?void 0:r.format)?l:"").includes("json"))t[n]=(0,eO.Bl)(i);else if((null!=(s=null==r?void 0:r.data_type)?s:"")==="ARRAY")if("string"==typeof i&&i.startsWith("{")&&i.endsWith("}")){let e="[".concat(i.slice(1,i.length-1),"]");t[n]=(0,eO.Bl)(e)}else t[n]=(0,eO.Bl)(i);else""===i?t[n]=(null==r?void 0:r.is_nullable)?null:"":t[n]=i}),t})},no=async(e,t,n,a,l,s)=>{let r,i=0,o=new Date;return new Promise(c=>{tG().parse(n,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,chunkSize:104857.6,quoteChar:"text/tab-separated-values"===n.type?"":'"',chunk:async(o,c)=>{c.pause();let d=ni({rows:o.data,headers:l,columns:a.columns}),u=new T.Query().from(a.name,a.schema).insert(d).toSql();try{await (0,x.E)({projectRef:e,connectionString:t,sql:u})}catch(e){console.warn(e),r=e,c.abort()}let m=104857.6*(i+=1)/n.size;s(m>1?100:100*m),c.resume()},complete:()=>{let e=new Date;console.log("Total time taken for importing spreadsheet: ".concat((e-o)/1e3," seconds")),c({error:r})}})})},nc=async(e,t,n,a,l,s)=>{let r,i=0,o=ni({rows:a,headers:l,columns:n.columns}),c=tK()(o,1e3).map(l=>()=>Promise.race([new Promise(async(s,o)=>{let c=new T.Query().from(n.name,n.schema).insert(l).toSql();try{await (0,x.E)({projectRef:e,connectionString:t,sql:c})}catch(e){r=e,o(e)}i+=l.length/a.length,s({})}),(0,eO.wR)(3e4)]));for(let e of tK()(c,10)){let t=await Promise.allSettled(e.map(e=>e()));if(tq()(t,{status:"rejected"}))break;s(100*i)}return{error:r}},nd=async e=>{let{projectRef:t,connectionString:n,table:a,foreignKeys:l,existingForeignKeyRelations:s}=e,r=l.filter(e=>"string"==typeof e.id);r.length>0&&await t6({projectRef:t,connectionString:n,table:a,foreignKeys:r});let i=l.filter(e=>e.toRemove);i.length>0&&await ne({projectRef:t,connectionString:n,table:a,foreignKeys:i});let o=l.filter(e=>"number"==typeof e.id&&!e.toRemove).filter(e=>{let t=s.find(t=>e.id===t.id);return void 0!==t&&eB(t,e)});o.length>0&&await nt({projectRef:t,connectionString:n,table:a,foreignKeys:o})};var nu=n(77796),nm=n.n(nu),np=n(86992),nh=n(52445),nf=n(34106),nx=n(37069);let ny=e=>{let{parseProgress:t,uploadedFile:n,onFileUpload:l,removeUploadedFile:s}=e,[r,i]=(0,u.useState)(!1),o=(0,u.useRef)(null),c=e=>{"dragover"!==e.type||r?("dragleave"===e.type||"drop"===e.type)&&i(!1):i(!0),e.stopPropagation(),e.preventDefault()};return(0,a.jsxs)("div",{className:"space-y-4","data-sentry-component":"SpreadSheetFileUpload","data-sentry-source-file":"SpreadSheetFileUpload.tsx",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"mb-2 text-sm text-foreground-light",children:["Upload a CSV or TSV file. The first row should be the headers of the table, and your headers should not include any special characters other than hyphens (",(0,a.jsx)("span",{className:"text-code",children:"-"}),") or underscores (",(0,a.jsx)("span",{className:"text-code",children:"_"}),")."]}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Tip: Datetime columns should be formatted as YYYY-MM-DD HH:mm:ss"})]}),n?(0,a.jsxs)("div",{className:"flex h-28 flex-col items-center justify-center space-y-2 rounded-md border border-dashed border-strong",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(nx.A,{size:14,strokeWidth:1.5}),(0,a.jsx)("p",{className:"text-sm text-foreground",children:n.name})]}),100===t?(0,a.jsx)(ea.$,{type:"outline",onClick:s,children:"Remove File"}):(0,a.jsxs)("div",{className:"flex w-3/5 items-center space-x-2",children:[(0,a.jsx)(e4.A,{className:"h-4 w-4 animate-spin"}),(0,a.jsx)(t$.A,{value:t,max:100,type:"horizontal",barClass:"bg-green-900",labelBottom:"Checking file...",labelTop:"".concat(t,"%")})]})]}):(0,a.jsx)("div",{className:"flex h-48 cursor-pointer items-center justify-center rounded-md border border-dashed border-strong ".concat(r?"bg-gray-500":""),onDragOver:c,onDragLeave:c,onDrop:e=>{c(e),l(e)},onClick:()=>{var e;return null==(e=o.current)?void 0:e.click()},children:(0,a.jsxs)("p",{className:"text-sm",children:["Drag and drop, or ",(0,a.jsx)("span",{className:"text-brand",children:"browse"})," your files"]})}),(0,a.jsx)("input",{ref:o,className:"hidden",type:"file",onChange:l})]})};var ng=n(83759),nv=n(26140);let nb=e=>{let{spreadsheetData:t,selectedHeaders:n,onToggleHeader:l}=e,[s,r]=(0,u.useState)(!1);return(0,a.jsxs)(nv.Ay,{open:s,onOpenChange:r,className:"","data-sentry-element":"Collapsible","data-sentry-component":"SpreadsheetImportConfiguration","data-sentry-source-file":"SpreadSheetImportConfiguration.tsx",children:[(0,a.jsx)(nv.Ay.Trigger,{asChild:!0,"data-sentry-element":"Collapsible.Trigger","data-sentry-source-file":"SpreadSheetImportConfiguration.tsx",children:(0,a.jsx)(et.Ay.Content,{"data-sentry-element":"SidePanel.Content","data-sentry-source-file":"SpreadSheetImportConfiguration.tsx",children:(0,a.jsxs)("div",{className:"py-1 flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-sm",children:"Configure import data"}),(0,a.jsx)(ea.$,{type:"text",icon:(0,a.jsx)(ng.A,{size:18,strokeWidth:2,className:(0,eU.cn)("text-foreground-light",s&&"rotate-180")}),className:"px-1",onClick:()=>r(!s),"data-sentry-element":"Button","data-sentry-source-file":"SpreadSheetImportConfiguration.tsx"})]})})}),(0,a.jsx)(nv.Ay.Content,{"data-sentry-element":"Collapsible.Content","data-sentry-source-file":"SpreadSheetImportConfiguration.tsx",children:(0,a.jsx)(et.Ay.Content,{"data-sentry-element":"SidePanel.Content","data-sentry-source-file":"SpreadSheetImportConfiguration.tsx",children:(0,a.jsxs)("div",{className:"py-2 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Select which columns to import"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"By default, all columns are selected to be imported from your CSV"})]}),(0,a.jsx)("div",{className:"flex items-center flex-wrap gap-2 pl-0.5 pb-0.5",children:t.headers.map(e=>{let t=n.includes(e);return(0,a.jsx)(ea.$,{type:t?"primary":"default",className:(0,eU.cn)("transition",t?"opacity-100":"opacity-75"),onClick:()=>l(e),children:e},e)})})]})})})]})},n_=e=>{let{input:t,onInputChange:n}=e;return(0,a.jsxs)("div",{className:"space-y-10","data-sentry-component":"SpreadSheetTextInput","data-sentry-source-file":"SpreadSheetTextInput.tsx",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"mb-2 text-sm text-foreground-light",children:["Copy a table from a spreadsheet program such as Google Sheets or Excel and paste it in the field below. The first row should be the headers of the table, and your headers should not include any special characters other than hyphens (",(0,a.jsx)("code",{children:"-"}),") or underscores (",(0,a.jsx)("code",{children:"_"}),")."]}),(0,a.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Tip: Datetime columns should be formatted as YYYY-MM-DD HH:mm:ss"})]}),(0,a.jsx)(en.A.TextArea,{size:"tiny",className:"font-mono",rows:15,style:{resize:"none"},value:t,onChange:n,"data-sentry-element":"Input.TextArea","data-sentry-source-file":"SpreadSheetTextInput.tsx"})]})};var nN=n(18663),nE=n(50676),nj=n(37838);let nS=e=>{let{headers:t=[],rows:n=[],height:l}=e,s=t.slice(0,20),r=n.slice(0,20);return(0,a.jsx)(e7.Ay,{columns:s.map(e=>{let t=Math.max(Math.max(...r.map(t=>{var n,a;return null!=(a=null==(n=t[e])?void 0:n.toString())?a:""}).map(e=>e.length)),e.length);return{key:e,name:e,width:t>20?200:10*t,resizable:!0,renderHeaderCell:()=>(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("p",{className:"text-xs",children:e})}),renderCell:t=>{let{row:n}=t,l=!n[e];return(0,a.jsx)("span",{className:(0,eU.cn)("text-sm flex items-center",l&&"text-foreground-light"),children:l?"NULL":n[e]})}}}),rows:r,className:"!border-l !border-r",style:{height:l||"".concat(34+34*(r.length||1),"px")},"data-sentry-element":"DataGrid","data-sentry-component":"SpreadsheetPreviewGrid","data-sentry-source-file":"SpreadsheetPreviewGrid.tsx"})},nC=e=>{let{selectedTable:t,spreadsheetData:n,errors:l=[],selectedHeaders:s,incompatibleHeaders:r}=e,[i,o]=(0,u.useState)(!1),[c,d]=(0,u.useState)([]),{headers:m,rows:p}=n,h=m.filter(e=>s.includes(e)).slice(0,20),f=p.slice(0,20),x=void 0===t||0===r.length;(0,u.useEffect)(()=>{o(!0)},[n]);let y=e=>{c.includes(e)?d(c.filter(t=>t!==e)):d(c.concat([e]))};return(0,a.jsxs)(nv.Ay,{open:i,onOpenChange:o,className:"","data-sentry-element":"Collapsible","data-sentry-component":"SpreadsheetImportPreview","data-sentry-source-file":"SpreadsheetImportPreview.tsx",children:[(0,a.jsx)(nv.Ay.Trigger,{asChild:!0,"data-sentry-element":"Collapsible.Trigger","data-sentry-source-file":"SpreadsheetImportPreview.tsx",children:(0,a.jsx)(et.Ay.Content,{"data-sentry-element":"SidePanel.Content","data-sentry-source-file":"SpreadsheetImportPreview.tsx",children:(0,a.jsxs)("div",{className:"py-1 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("p",{className:"text-sm",children:"Preview data to be imported"}),!x&&(0,a.jsx)(ez.E,{variant:"destructive",children:"Data incompatible"}),l.length>0&&(0,a.jsxs)(ez.E,{variant:"warning",children:[l.length," issues found"]})]}),(0,a.jsx)(ea.$,{type:"text",icon:(0,a.jsx)(ng.A,{size:18,strokeWidth:2,className:(0,eU.cn)("text-foreground-light",i&&"rotate-180")}),className:"px-1",onClick:()=>o(!i),"data-sentry-element":"Button","data-sentry-source-file":"SpreadsheetImportPreview.tsx"})]})})}),(0,a.jsx)(nv.Ay.Content,{"data-sentry-element":"Collapsible.Content","data-sentry-source-file":"SpreadsheetImportPreview.tsx",children:(0,a.jsxs)(et.Ay.Content,{"data-sentry-element":"SidePanel.Content","data-sentry-source-file":"SpreadsheetImportPreview.tsx",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:void 0===t?"Your table will have ".concat(n.rowCount.toLocaleString()," rows and the\n                        following ").concat(n.headers.length," columns."):"A total of ".concat(n.rowCount.toLocaleString(),' rows will be added to the table "').concat(t.name,'"')}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Here is a preview of the data that will be added (up to the first 20 columns and first 20 rows)."})]}),(0,a.jsx)("div",{className:"mb-4",children:h.length>0&&f.length>0?(0,a.jsx)(nS,{height:350,headers:h,rows:f}):(0,a.jsxs)("div",{className:"flex items-center justify-center py-4 border border-control rounded-md space-x-2",children:[(0,a.jsx)(nj.A,{size:16,strokeWidth:1.5,className:"text-foreground-light"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:0===h.length?"No headers have been selected":0===f.length?"Your CSV contains no data":""})]})}),(!x||l.length>0)&&(0,a.jsxs)("div",{className:"space-y-2 my-4",children:[(0,a.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,a.jsx)("p",{className:"text-sm",children:"Issues found in spreadsheet"}),x&&(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:void 0!==t?"This CSV can still be imported into your table despite issues in the following rows.":"Your table can still be created nonetheless despite issues in the following rows."})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[!x&&(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)("div",{className:"w-[14px] h-[14px] flex items-center justify-center translate-y-[3px]",children:(0,a.jsx)("div",{className:"w-[6px] h-[6px] rounded-full bg-foreground-lighter"})}),(0,a.jsxs)("p",{className:"text-sm",children:["This CSV ",(0,a.jsx)("span",{className:"text-red-900",children:"cannot"})," be imported into your table due to incompatible headers:",(0,a.jsx)("br",{}),"The column",r.length>1?"s":""," ",r.map(e=>'"'.concat(e,'"')).join(", ")," ",r.length>1?"are":"is"," not present in your table"]})]})}),l.map((e,t)=>{var l,s;let r="import-error-".concat(t),i=c.includes(r);return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 cursor-pointer",onClick:()=>y(r),children:[void 0!==e.data?(0,a.jsx)(tf.A,{size:14,className:"transform ".concat(i?"rotate-90":"")}):(0,a.jsx)("div",{className:"w-[14px] h-[14px] flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-[6px] h-[6px] rounded-full bg-foreground-lighter"})}),void 0!==e.data&&(0,a.jsxs)("p",{className:"text-sm w-14",children:["Row: ",e.row]}),(0,a.jsx)("p",{className:"text-sm",children:e.message}),(null==(l=e.data)?void 0:l.__parsed_extra)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eS.A,{size:14}),(0,a.jsx)("p",{className:"text-sm",children:"Extra field(s):"}),null==(s=e.data)?void 0:s.__parsed_extra.map((e,t)=>(0,a.jsx)("code",{className:"text-xs",children:e},t))]})]}),void 0!==e.data&&i&&(0,a.jsx)(nS,{headers:n.headers,rows:[e.data]})]},r)})]})]})]})})]})},nw=e=>{var t,n;let{visible:l=!1,debounceDuration:s=250,headers:r=[],rows:i=[],selectedTable:o,saveContent:c,closePanel:h,updateEditorDirty:f=d()}=e,{ref:x}=(0,p.g)(),{data:y}=(0,nh.s)(),g=(0,H.ap)(),v=(null==(t=g.sidePanel)?void 0:t.type)==="csv-import"?g.sidePanel.file:void 0,b=function(e){let t=(0,u.useRef)(),n=t.current!==e;return(0,u.useEffect)(()=>{t.current=e}),n}(l),[_,N]=(0,u.useState)("fileUpload"),[E,j]=(0,u.useState)(""),[S,C]=(0,u.useState)(),[w,T]=(0,u.useState)(0),[A,I]=(0,u.useState)({headers:r,rows:i,rowCount:0,columnTypeMap:{}}),[R,k]=(0,u.useState)([]),[L,O]=(0,u.useState)([]),{mutate:F}=(0,np.h)(),D=(null!=(n=null==o?void 0:o.columns)?n:[]).map(e=>e.name),P=L.filter(e=>!D.includes(e)),M=void 0===o||0===P.length,U=e=>{T(e)},z=(0,u.useCallback)(async e=>{f(!0),C(e),T(0);let{headers:t,rowCount:n,columnTypeMap:a,errors:l,previewRows:s}=await (0,nE.wg)(e,U);l.length>0&&m.oR.error("Some issues have been detected on ".concat(l.length," rows. More details below the content preview.")),k(l),O(t),I({headers:t,rows:s,rowCount:n,columnTypeMap:a})},[f]),Y=(0,u.useCallback)(async e=>{e.persist();let[t]=e.target.files||e.dataTransfer.files;t&&!(0,nE.Pz)(t)?await z(t):e.target.value=""},[z]),W=(0,u.useCallback)(()=>{j(""),I(nN.gh),C(void 0),k([]),f(!1)},[f]),K=async e=>{if(e.length>0){let{headers:t,rows:n,columnTypeMap:a,errors:l}=await (0,nE.d2)(e);l.length>0&&m.oR.error("Some issues have been detected on ".concat(l.length," rows. More details below the content preview.")),k(l),O(t),I({headers:t,rows:n,rowCount:n.length,columnTypeMap:a})}else I(nN.gh)},B=(0,u.useCallback)(nm()(K,s),[]);return(0,u.useEffect)(()=>{b&&l&&(v?z(v):0===r.length&&W())},[b,l,v,z,r.length,W]),(0,a.jsxs)(et.Ay,{size:"large",visible:l,align:"right",header:void 0!==o?(0,a.jsxs)(a.Fragment,{children:["Add data to"," ",(0,a.jsxs)("code",{className:"text-sm",children:[o.schema,".",o.name]})]}):"Add content to new table",onCancel:()=>h(),customFooter:(0,a.jsx)(er.A,{backButtonLabel:"Cancel",applyButtonLabel:void 0===o?"Save":"Import data",closePanel:h,applyFunction:e=>{if("fileUpload"===_&&void 0===S)m.oR.error("Please upload a file to import your data with"),e();else if(0===L.length)m.oR.error("Please select at least one header from your CSV"),e();else if(M){var t;c({file:S,...A,selectedHeaders:L,resolve:e}),F({action:"import_data_added",groups:{project:null!=x?x:"Unknown",organization:null!=(t=null==y?void 0:y.slug)?t:"Unknown"}})}else m.oR.error("The data that you are trying to import is incompatible with your table structure"),e()}}),"data-sentry-element":"SidePanel","data-sentry-component":"SpreadsheetImport","data-sentry-source-file":"SpreadsheetImport.tsx",children:[(0,a.jsx)(et.Ay.Content,{"data-sentry-element":"SidePanel.Content","data-sentry-source-file":"SpreadsheetImport.tsx",children:(0,a.jsx)("div",{className:"pt-6",children:(0,a.jsxs)(nf.A,{block:!0,type:"pills",onChange:N,"data-sentry-element":"Tabs","data-sentry-source-file":"SpreadsheetImport.tsx",children:[(0,a.jsx)(nf.A.Panel,{id:"fileUpload",label:"Upload CSV","data-sentry-element":"Tabs.Panel","data-sentry-source-file":"SpreadsheetImport.tsx",children:(0,a.jsx)(ny,{parseProgress:w,uploadedFile:S,onFileUpload:Y,removeUploadedFile:W,"data-sentry-element":"SpreadSheetFileUpload","data-sentry-source-file":"SpreadsheetImport.tsx"})}),(0,a.jsx)(nf.A.Panel,{id:"pasteText",label:"Paste text","data-sentry-element":"Tabs.Panel","data-sentry-source-file":"SpreadsheetImport.tsx",children:(0,a.jsx)(n_,{input:E,onInputChange:e=>{j(e.target.value),B(e.target.value)},"data-sentry-element":"SpreadSheetTextInput","data-sentry-source-file":"SpreadsheetImport.tsx"})})]})})}),A.headers.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"pt-4",children:(0,a.jsx)(et.Ay.Separator,{})}),(0,a.jsx)(nb,{spreadsheetData:A,selectedHeaders:L,onToggleHeader:e=>{O(L.includes(e)?L.filter(t=>t!==e):L.concat([e]))}}),(0,a.jsx)(et.Ay.Separator,{}),(0,a.jsx)(nC,{selectedTable:o,spreadsheetData:A,errors:R,selectedHeaders:L,incompatibleHeaders:P}),(0,a.jsx)(et.Ay.Separator,{})]})]})};var nT=n(64084),nA=n(50922),nI=n(80949),nR=n(68889),nk=n(68506),nL=n(52066),nO=n(97485),nF=n(9764),nD=n(51509),nP=n(30569),nH=n(7108);let nM=e=>{var t,n;let{column:l=nH.MZ,relations:s=nH.Oj,enumTypes:r=nH.Oj,isNewRecord:i=!1,hasForeignKeys:o=!1,hasImportContent:c=!1,dragHandleProps:d=nH.MZ,onUpdateColumn:m,onRemoveColumn:p,onEditForeignKey:h}=e,{data:f}=(0,D.YA)(),[x,y]=(0,u.useState)(!1),g=null!=(t=null==em?void 0:em[l.format])?t:[],v=[+!!l.isNullable,+!!l.isIdentity,+!!l.isUnique,+!!l.isArray].reduce((e,t)=>e+t,0),{data:b}=(0,X.Hw)({projectRef:null==f?void 0:f.ref,connectionString:null==f?void 0:f.connectionString,schema:l.schema}),_=e=>{let t=(null!=b?b:[]).find(t=>t.id===e.id),n=s.find(t=>t.id===e.id);return(null==n?void 0:n.toRemove)?"REMOVE":void 0===t&&void 0!==n?"ADD":void 0!==t&&void 0!==n?eB(t,n)?"UPDATE":void 0:void 0},N=s.map(e=>_(e)).some(e=>void 0!==e);return(0,a.jsxs)("div",{className:"flex w-full items-center","data-sentry-component":"Column","data-sentry-source-file":"Column.tsx",children:[(0,a.jsx)("div",{className:"w-[5%] ".concat(i?"":"hidden"),children:(0,a.jsx)("div",{className:"cursor-drag",...d,children:(0,a.jsx)(nL.A,{strokeWidth:1,size:16,"data-sentry-element":"Menu","data-sentry-source-file":"Column.tsx"})})}),(0,a.jsx)("div",{className:"w-[25%]",children:(0,a.jsxs)("div",{className:"flex w-[95%] items-center justify-between",children:[(0,a.jsx)(en.A,{size:"small",value:l.name,title:l.name,disabled:c,placeholder:"column_name",className:(0,eU.cn)("[&>div>div>div>input]:py-1.5 [&>div>div>div>input]:border-r-transparent [&>div>div>div>input]:rounded-r-none",c?"opacity-50":""),onChange:e=>m({name:e.target.value}),"data-sentry-element":"Input","data-sentry-source-file":"Column.tsx"}),0===s.filter(e=>!e.toRemove).length?(0,a.jsx)(ea.$,{type:"dashed",className:"rounded-l-none h-[30px] py-0 px-2",onClick:()=>h(),children:(0,a.jsx)(nO.A,{size:12})}):(0,a.jsxs)(nD.AM,{open:x,onOpenChange:y,modal:!1,children:[(0,a.jsx)(nD.Wv,{asChild:!0,children:(0,a.jsx)(ea.$,{type:"default",className:"rounded-l-none h-[30px] py-0 px-2",children:(0,a.jsx)(nO.A,{size:12})})}),(0,a.jsxs)(nD.hl,{className:(0,eU.cn)("p-0",N?"w-96":"w-72"),side:"bottom",align:"end",children:[(0,a.jsxs)("div",{className:"text-xs px-2 pt-2",children:["Involved in ",s.length," foreign key",s.length>1?"s":""]}),(0,a.jsx)(nP.uB,{children:(0,a.jsxs)(nP.oI,{children:[(0,a.jsx)(nP.L$,{children:s.map((e,t)=>{var n;let s=String(null!=(n=null==e?void 0:e.id)?n:"".concat(l.id,"-relation-").concat(t)),r=_(e);return"REMOVE"===r?null:(0,a.jsx)(nP.h_,{value:s,className:"cursor-pointer w-full",onSelect:()=>h(e),onClick:()=>h(e),children:void 0===r?(0,a.jsx)("div",{className:"w-full flex items-center justify-between truncate",children:e.name}):(0,a.jsxs)("div",{className:"flex items-center gap-x-2 truncate",children:[(0,a.jsx)(ez.E,{variant:"ADD"===r?"brand":"warning",children:r}),(0,a.jsx)("p",{className:"truncate",children:e.name||(0,a.jsxs)(a.Fragment,{children:["To"," ",e.columns.filter(e=>e.source===l.name).map(t=>(0,a.jsxs)("code",{children:[e.schema,".",e.table,".",t.target]},"".concat(t.source,"-").concat(t.target))),e.columns.length>1&&(0,a.jsxs)(a.Fragment,{children:["and ",e.columns.length-1," other column",e.columns.length>2?"s":""]})]})})]})},s)})}),(0,a.jsx)(nP.fx,{}),(0,a.jsx)(nP.L$,{children:(0,a.jsxs)(nP.h_,{className:"cursor-pointer w-full gap-x-2",onSelect:()=>h(),onClick:()=>h(),children:[(0,a.jsx)(Y.A,{size:14,strokeWidth:1.5}),(0,a.jsx)("p",{children:"Add foreign key relation"})]})})]})})]})]})]})}),(0,a.jsx)("div",{className:"w-[25%]",children:(0,a.jsx)("div",{className:"w-[95%]",children:(0,a.jsx)(eV.A,{value:l.format,enumTypes:r,showLabel:!1,className:"table-editor-column-type lg:gap-0 ",disabled:o,description:o?"Column type cannot be changed as it has a foreign key relation":"",onOptionSelect:e=>{m({format:e,defaultValue:"uuid"===e?"gen_random_uuid()":null})},"data-sentry-element":"ColumnType","data-sentry-source-file":"Column.tsx"})})}),(0,a.jsx)("div",{className:"".concat(i?"w-[25%]":"w-[30%]"),children:(0,a.jsx)("div",{className:"w-[95%]",children:(0,a.jsx)(ex,{"data-testid":"".concat(l.name,"-default-value"),placeholder:"string"==typeof l.defaultValue&&0===l.defaultValue.length?"EMPTY":"NULL",size:"small",value:null!=(n=l.defaultValue)?n:"",disabled:l.format.includes("int")&&l.isIdentity,className:"rounded bg-surface-100 lg:gap-0 ".concat(l.format.includes("int")&&l.isIdentity?"opacity-50":""),suggestions:g,suggestionsHeader:"Suggested expressions",suggestionsTooltip:"Suggested expressions",onChange:e=>m({defaultValue:e.target.value}),onSelectSuggestion:e=>m({defaultValue:e.value}),"data-sentry-element":"InputWithSuggestions","data-sentry-source-file":"Column.tsx"})})}),(0,a.jsx)("div",{className:"w-[10%]",children:(0,a.jsx)(el.A,{label:"",checked:l.isPrimaryKey,onChange:()=>{let e=!l.isPrimaryKey;m({isPrimaryKey:e,isNullable:!e&&l.isNullable})},"data-sentry-element":"Checkbox","data-sentry-source-file":"Column.tsx"})}),(0,a.jsx)("div",{className:"".concat(c?"w-[10%]":"w-[0%]")}),(0,a.jsx)("div",{className:"flex w-[5%] justify-end",children:(!l.isPrimaryKey||l.format.includes("int"))&&(0,a.jsxs)(nD.AM,{children:[(0,a.jsxs)(nD.Wv,{"data-testid":"".concat(l.name,"-extra-options"),className:"group flex items-center -space-x-1",children:[v>0&&(0,a.jsx)("div",{className:"rounded-full bg-foreground h-4 w-4 flex items-center justify-center text-xs text-background",children:v}),(0,a.jsx)("div",{className:"text-foreground-light transition-colors group-hover:text-foreground",children:(0,a.jsx)(nF.A,{size:16,strokeWidth:1})})]}),(0,a.jsxs)(nD.hl,{align:"end",className:"w-96 p-0",children:[(0,a.jsx)("div",{className:"flex items-center justify-center bg-surface-200 space-y-1 py-1.5 px-3 border-b border-overlay",children:(0,a.jsx)("h5",{className:"text-foreground",children:"Extra options"})}),(0,a.jsxs)("div",{className:"flex flex-col space-y-1",children:[!l.isPrimaryKey&&(0,a.jsx)(el.A,{label:"Is Nullable",description:"Specify if the column can assume a NULL value if no value is provided",checked:l.isNullable,className:"p-4",onChange:()=>m({isNullable:!l.isNullable})}),(0,a.jsx)(el.A,{label:"Is Unique",description:"Enforce if values in the column should be unique across rows",checked:l.isUnique,className:"p-4",onChange:()=>m({isUnique:!l.isUnique})}),l.format.includes("int")&&(0,a.jsx)(el.A,{label:"Is Identity",description:"Automatically assign a sequential unique number to the column",checked:l.isIdentity,className:"p-4",onChange:()=>{let e=!l.isIdentity,t=!e&&l.isArray;m({isIdentity:e,isArray:t})}}),!l.isPrimaryKey&&(0,a.jsx)(el.A,{label:"Define as Array",description:"Define your column as a variable-length multidimensional array",checked:l.isArray,className:"p-4",onChange:()=>{let e=!l.isArray,t=!e&&l.isIdentity;m({isArray:e,isIdentity:t})}})]},"".concat(l.id,"_configuration"))]})]})}),!c&&(0,a.jsx)("div",{className:"flex w-[5%] justify-end",children:(0,a.jsx)("button",{className:"cursor-pointer",onClick:()=>p(),children:(0,a.jsx)(eC.A,{size:16,strokeWidth:1})})})]})},nU=e=>{var t;let{table:n,columns:l=[],relations:s,enumTypes:i=[],importContent:o,isNewRecord:c,onColumnsUpdated:m=d(),onSelectImportData:h=d(),onClearImportContent:f=d(),onUpdateFkRelations:x}=e,{ref:y}=(0,p.g)(),{data:g}=(0,nh.s)(),[v,b]=(0,u.useState)(!1),[_,N]=(0,u.useState)(),[E,j]=(0,u.useState)(),{mutate:S}=(0,np.h)(),C=!r()(o),[w,T]=tS()(l,e=>e.isPrimaryKey),A=e=>void 0!==s.find(t=>t.columns.find(t=>t.source===e.name)),I=(e,t)=>{m(l.map(n=>{if(n.id!==e.id)return n;if(eo.AL.includes(e.format)||""!==t.defaultValue||(t.defaultValue=null),"name"in t&&void 0!==n.foreignKey){var a;let e={...n.foreignKey,source_column_name:null!=(a=null==t?void 0:t.name)?a:""};return{...n,...t,foreignKey:e}}return{...n,...t}}))},R=()=>{let e=(0,eg.Eb)();m(l.concat(e))},k=e=>{m(l.filter(t=>t.id!==e.id))},L=(e,t)=>{if(e.destination){if("pks"===t){let t=w.slice(),[n]=t.splice(e.source.index,1);return t.splice(e.destination.index,0,n),m(t.concat(T))}if("others"===t){let t=T.slice(),[n]=t.splice(e.source.index,1);return t.splice(e.destination.index,0,n),m(w.concat(t))}}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"w-full space-y-4 table-editor-columns",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsx)("h5",{children:"Columns"}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(ea.$,{asChild:!0,type:"default",icon:(0,a.jsx)(W.A,{size:12,strokeWidth:2}),"data-sentry-element":"Button","data-sentry-source-file":"ColumnManagement.tsx",children:(0,a.jsx)("a",{href:"https://supabase.com/docs/guides/database/tables#data-types",target:"_blank",rel:"noreferrer",children:"About data types"})}),c&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"py-3 border-r"}),C?(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(ea.$,{type:"default",icon:(0,a.jsx)(tA.A,{}),onClick:h,children:"Edit content"}),(0,a.jsx)(ea.$,{type:"danger",icon:(0,a.jsx)(nI.A,{}),onClick:f,children:"Remove content"})]}):(0,a.jsx)(ea.$,{type:"default",onClick:()=>{var e;h(),S({action:"import_data_button_clicked",properties:{tableType:"New Table"},groups:{project:null!=y?y:"Unknown",organization:null!=(e=null==g?void 0:g.slug)?e:"Unknown"}})},children:"Import data from CSV"})]})]})]}),C&&(0,a.jsxs)("p",{className:"text-sm text-foreground-light my-2",children:["Your table will be created with ",null==o||null==(t=o.rowCount)?void 0:t.toLocaleString()," rows and the following ",l.length," columns."]}),0===w.length&&(0,a.jsxs)(eT.Fc,{variant:"warning",children:[(0,a.jsx)(nk.id,{}),(0,a.jsx)(eT.XL,{children:"Warning: No primary keys selected"}),(0,a.jsx)(eT.TN,{children:"Tables should have at least one column as the primary key to identify each row. Without a primary key, you will not be able to update or delete rows from the table."})]}),w.length>1&&(0,a.jsx)(eI.A,{block:!0,icon:(0,a.jsx)(e6.A,{size:16}),title:"Composite primary key selected",description:"The columns that you've selected will be grouped as a primary key, and will serve as the unique identifier for the rows in your table"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex w-full px-3",children:[c&&(0,a.jsx)("div",{className:"w-[5%]"}),(0,a.jsxs)("div",{className:"w-[25%] flex items-center space-x-2",children:[(0,a.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Name"}),(0,a.jsxs)(ta.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"ColumnManagement.tsx",children:[(0,a.jsx)(ta.k$,{"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"ColumnManagement.tsx",children:(0,a.jsx)(eN.A,{size:15,strokeWidth:1.5,className:"text-foreground-lighter","data-sentry-element":"HelpCircle","data-sentry-source-file":"ColumnManagement.tsx"})}),(0,a.jsx)(ta.ZI,{side:"bottom",className:"w-[300px]","data-sentry-element":"TooltipContent","data-sentry-source-file":"ColumnManagement.tsx",children:"Recommended to use lowercase and use an underscore to separate words e.g. column_name"})]})]}),(0,a.jsx)("div",{className:"w-[25%]",children:(0,a.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Type"})}),(0,a.jsxs)("div",{className:"".concat(c?"w-[25%]":"w-[30%]"," flex items-center space-x-2"),children:[(0,a.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Default Value"}),(0,a.jsxs)(ta.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"ColumnManagement.tsx",children:[(0,a.jsx)(ta.k$,{"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"ColumnManagement.tsx",children:(0,a.jsx)(eN.A,{size:15,strokeWidth:1.5,className:"text-foreground-lighter","data-sentry-element":"HelpCircle","data-sentry-source-file":"ColumnManagement.tsx"})}),(0,a.jsx)(ta.ZI,{side:"bottom",className:"w-[300px]","data-sentry-element":"TooltipContent","data-sentry-source-file":"ColumnManagement.tsx",children:"Can either be a literal or an expression. When using an expression wrap your expression in brackets, e.g. (gen_random_uuid())"})]})]}),(0,a.jsx)("div",{className:"w-[10%]",children:(0,a.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Primary"})}),(0,a.jsx)("div",{className:"".concat(C?"w-[10%]":"w-0")}),(0,a.jsx)("div",{className:"w-[5%]"}),!C&&(0,a.jsx)("div",{className:"w-[5%]"})]}),w.length>0&&(0,a.jsx)(nR.JY,{onDragEnd:e=>L(e,"pks"),children:(0,a.jsx)(nR.gL,{droppableId:"pk_columns_droppable",children:e=>(0,a.jsxs)("div",{ref:e.innerRef,className:"space-y-2 rounded-md bg-surface-200 px-3 py-2 ".concat(c?"":"-mx-3"),children:[w.map((e,t)=>(0,a.jsx)(nR.sx,{draggableId:e.id,index:t,children:t=>(0,a.jsx)("div",{ref:t.innerRef,...t.draggableProps,children:(0,a.jsx)(nM,{column:e,relations:s.filter(t=>t.columns.some(t=>t.source===e.name)),enumTypes:i,hasForeignKeys:A(e),isNewRecord:c,hasImportContent:C,dragHandleProps:t.dragHandleProps,onUpdateColumn:t=>I(e,t),onRemoveColumn:()=>k(e),onEditForeignKey:t=>{b(!0),N(e),t&&j(t)}})})},e.id)),e.placeholder]})})}),(0,a.jsx)(nR.JY,{onDragEnd:e=>L(e,"others"),"data-sentry-element":"DragDropContext","data-sentry-source-file":"ColumnManagement.tsx",children:(0,a.jsx)(nR.gL,{droppableId:"other_columns_droppable","data-sentry-element":"Droppable","data-sentry-source-file":"ColumnManagement.tsx",children:e=>(0,a.jsxs)("div",{ref:e.innerRef,className:"space-y-2 py-2 ".concat(c?"px-3 ":""),children:[T.map((e,t)=>(0,a.jsx)(nR.sx,{draggableId:e.id,index:t,children:t=>(0,a.jsx)("div",{ref:t.innerRef,...t.draggableProps,children:(0,a.jsx)(nM,{column:e,relations:s.filter(t=>t.columns.some(t=>t.source===e.name)),enumTypes:i,isNewRecord:c,hasForeignKeys:A(e),hasImportContent:C,dragHandleProps:t.dragHandleProps,onUpdateColumn:t=>I(e,t),onRemoveColumn:()=>k(e),onEditForeignKey:t=>{b(!0),N(e),t&&j(t)}})})},e.id)),e.placeholder]})})})]}),!C&&(0,a.jsx)("div",{className:"flex items-center justify-center rounded border border-strong border-dashed py-3",children:(0,a.jsx)(ea.$,{type:"default",onClick:()=>R(),children:"Add column"})})]}),(0,a.jsx)(eP,{visible:v,column:_,table:{id:n.id,name:n.name,columns:n.columns},foreignKey:E,onClose:()=>{b(!1),j(void 0),N(void 0)},onSaveRelation:e=>{let t=s.map(e=>e.id);void 0!==e.id&&t.includes(e.id)?x(s.map(t=>t.id===e.id?e:t)):x(s.concat([e]))},"data-sentry-element":"ForeignKeySelector","data-sentry-source-file":"ColumnManagement.tsx"})]})};var nz=n(92589),nY=n(14132);let nW=e=>{let{table:t,relations:n,closePanel:l,setEditorDirty:s,onUpdateFkRelations:r}=e,{data:i}=(0,D.YA)(),{selectedSchema:o}=(0,eL.k)(),[c,d]=(0,u.useState)(!1),[m,p]=(0,u.useState)(),{data:h,error:f,isLoading:x,isSuccess:y,isError:g}=(0,X.Hw)({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString,schema:o}),v=e=>{let t=(null!=h?h:[]).find(t=>t.id===e.id),a=n.find(t=>t.id===e.id);return(null==a?void 0:a.toRemove)?"REMOVE":void 0===t&&void 0!==a?"ADD":void 0!==t&&void 0!==a?eB(t,a)?"UPDATE":void 0:void 0};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"w-full space-y-4 ",children:[(0,a.jsx)("h5",{children:"Foreign keys"}),x&&(0,a.jsx)(nY.y,{}),g&&(0,a.jsx)(nz.A,{error:f,subject:"Failed to retrieve foreign key relationships"}),y&&(0,a.jsx)("div",{children:n.map(e=>{let t=v(e);return(0,a.jsx)(eY,{status:t,foreignKey:e,closePanel:l,onSelectEdit:()=>{d(!0),p(e)},onSelectRemove:()=>{s(),"ADD"===t?r(n.filter(t=>t.id!==e.id)):r(n.map(t=>t.id===e.id?{...t,toRemove:!0}:t))},onSelectUndoRemove:()=>{s(),r(n.map(t=>t.id===e.id?{...t,toRemove:!1}:t))}},e.id)})}),(0,a.jsx)("div",{className:"flex items-center justify-center rounded border border-strong border-dashed py-3",children:(0,a.jsx)(ea.$,{type:"default",onClick:()=>d(!0),"data-sentry-element":"Button","data-sentry-source-file":"ForeignKeysManagement.tsx",children:"Add foreign key relation"})})]}),(0,a.jsx)(eP,{visible:c,table:{id:t.id,name:t.name,columns:t.columns},foreignKey:m,onClose:()=>{d(!1),p(void 0)},onSaveRelation:e=>{s();let t=n.map(e=>e.id);void 0!==e.id&&t.includes(e.id)?r(n.map(t=>t.id===e.id?e:t)):r(n.concat([e]))},"data-sentry-element":"ForeignKeySelector","data-sentry-source-file":"ForeignKeysManagement.tsx"})]})},nK=e=>{let{schema:t,table:n,isDuplicating:l}=e;return n?l?(0,a.jsxs)(a.Fragment,{children:["Duplicate table ",(0,a.jsx)("code",{className:"text-sm",children:null==n?void 0:n.name})]}):(0,a.jsxs)(a.Fragment,{children:["Update table ",(0,a.jsx)("code",{className:"text-sm",children:null==n?void 0:n.name})]}):(0,a.jsxs)(a.Fragment,{children:["Create a new table under ",(0,a.jsx)("code",{className:"text-sm",children:t})]})};var nB=n(20835),nq=n(95536),nV=n(13322),nG=n(41336);function n$(){return(0,a.jsxs)("div",{className:"text-sm text-foreground-light grid gap-4","data-sentry-component":"RLSDisableModalContent","data-sentry-source-file":"RLSDisableModal.tsx",children:[(0,a.jsxs)("div",{className:"grid gap-1",children:[(0,a.jsx)(nG.F,{variant:"warning",className:"!px-4 !py-3",title:"This table will be publicly readable and writable",withIcon:!0,"data-sentry-element":"Alert","data-sentry-source-file":"RLSDisableModal.tsx",children:(0,a.jsx)("p",{children:"Anyone can edit or delete data in this table."})}),(0,a.jsxs)("ul",{className:"mt-4 space-y-5",children:[(0,a.jsxs)("li",{className:"flex gap-3",children:[(0,a.jsx)(nB.A,{"data-sentry-element":"AlertOctagon","data-sentry-source-file":"RLSDisableModal.tsx"}),(0,a.jsx)("span",{children:"All requests to this table will be accepted."})]}),(0,a.jsxs)("li",{className:"flex gap-3",children:[(0,a.jsx)(nq.A,{"data-sentry-element":"ShieldOff","data-sentry-source-file":"RLSDisableModal.tsx"}),(0,a.jsx)("span",{children:"Auth policies will not be enforced."})]}),(0,a.jsxs)("li",{className:"flex gap-3",children:[(0,a.jsx)(nV.A,{size:14,className:"flex-shrink-0","data-sentry-element":"Lock","data-sentry-source-file":"RLSDisableModal.tsx"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Before you turn off Row Level Security, consider:"}),(0,a.jsxs)("ul",{className:"space-y-2 mt-2",children:[(0,a.jsx)("li",{className:"list-disc ml-4",children:"Any personal information in this table will be publicly accessible."}),(0,a.jsx)("li",{className:"list-disc ml-4",children:"Anyone will be able to modify, add or delete any row in this table."})]})]})]})]})]}),(0,a.jsx)(eA.A,{abbrev:!1,className:"w-min mt-3",href:"https://supabase.com/docs/guides/auth/row-level-security","data-sentry-element":"DocsButton","data-sentry-source-file":"RLSDisableModal.tsx"})]})}let nJ=[{id:(0,eO.gZ)(),name:"id",schema:"",table:"",format:"int8",defaultValue:null,check:null,foreignKey:void 0,isNullable:!1,isUnique:!1,isArray:!1,isPrimaryKey:!0,isIdentity:!0,isNewColumn:!0,isEncrypted:!1},{id:(0,eO.gZ)(),name:"created_at",schema:"",table:"",format:"timestamptz",defaultValue:"now()",check:null,foreignKey:void 0,isNullable:!1,isUnique:!1,isArray:!1,isPrimaryKey:!1,isIdentity:!1,isNewColumn:!0,isEncrypted:!1}];var nQ=n(78779),nX=n.n(nQ);let nZ=e=>{let t={};return 0===e.name.length&&(t.name="Please assign a name for your table"),nX()(e.columns,e=>0===e.format.length)&&(t.columns="Ensure that all your columns are assigned a type"),nX()(e.columns,e=>0===e.name.length)&&(t.columns="Ensure that all your columns are named"),t},n0=()=>({id:0,name:"",comment:"",columns:nJ,isRLSEnabled:!0,isRealtimeEnabled:!1}),n1=function(e,t){var n,a;let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{id:e.id,name:l?"".concat(e.name,"_duplicate"):e.name,comment:l?"This is a duplicate of ".concat(e.name):null!=(n=null==e?void 0:e.comment)?n:"",columns:(null!=(a=e.columns)?a:[]).map(n=>(0,eg.h6)(n,e,t)),isRLSEnabled:e.rls_enabled,isRealtimeEnabled:s}},n2=e=>{let{headers:t,selectedHeaders:n,columnTypeMap:a}=e;return t.filter(e=>n.includes(e)).map(e=>{let t=a[e];return(0,eg.Eb)({name:e,format:t})})},n3=e=>{var t,n;let{table:l,isDuplicating:s,visible:i=!1,closePanel:c=d(),saveChanges:p=d(),updateEditorDirty:h=d()}=e,f=(0,H.ap)(),{data:x}=(0,D.YA)(),{data:y}=(0,nh.s)(),{selectedSchema:g}=(0,eL.k)(),v=o()(l),{realtimeAll:_}=(0,nT.x)(["realtime:all"]),{mutate:N}=(0,np.h)(),[E,j]=(0,P.W)();(0,u.useEffect)(()=>{"table"===E.create&&"none"===f.ui.open&&(f.onAddTable(),j({...E,create:void 0}))},[f,E,j]);let{data:S}=(0,Z.p)({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString}),{data:C}=(0,ee.Uu)({excludeSchemas:["extensions"]}),w=(null!=S?S:[]).filter(e=>!C.find(t=>t.name===e.schema)),{data:T}=(0,b._)({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString}),A=(null!=T?T:[]).find(e=>"supabase_realtime"===e.name),I=null!=(t=null==A?void 0:A.tables)?t:[],R=!v&&I.some(e=>e.id===(null==l?void 0:l.id)),[k,L]=(0,u.useState)({}),[O,F]=(0,u.useState)(),[M,U]=(0,u.useState)([]),[Y,W]=(0,u.useState)(!1),[K,B]=(0,u.useState)(),[q,V]=(0,u.useState)(!1),[$,J]=(0,u.useState)(!1),{data:ea}=Q({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString,id:null==l?void 0:l.id}),es=(null!=ea?ea:[]).find(e=>e.type===G.PRIMARY_KEY_CONSTRAINT),{data:eo,isSuccess:ec}=(0,X.Hw)({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString,schema:null==l?void 0:l.schema}),ed=(null!=eo?eo:[]).filter(e=>e.source_schema===(null==l?void 0:l.schema)&&e.source_table===(null==l?void 0:l.name)),eu=e=>{F({...O,...e}),h();let t={...k};for(let n of Object.keys(e))delete t[n];L(t)},em=e=>{if(void 0===O)return;let t=[];e.forEach(e=>{e.columns.forEach(e=>{let n=O.columns.find(t=>t.name===e.source);(null==n?void 0:n.isNewColumn)&&e.targetType&&t.push({...n,format:e.targetType})})}),t.length>0&&F({...O,columns:O.columns.map(e=>{let n=t.find(t=>t.id===e.id);return n||e})}),U(e)},ep=e=>{if(O){let n=nZ(O);if(n.columns&&m.oR.error(n.columns),L(n),r()(n)){var t;let n={name:O.name.trim(),schema:g,comment:null==(t=O.comment)?void 0:t.trim(),...!v&&{rls_enabled:O.isRLSEnabled}},a={tableId:null==l?void 0:l.id,importContent:K,isRLSEnabled:O.isRLSEnabled,isRealtimeEnabled:O.isRealtimeEnabled,isDuplicateRows:Y,existingForeignKeyRelations:ed,primaryKey:es};p(n,O.columns.map(e=>({...e,name:e.name.trim()})),M,v,a,e)}else e()}};return((0,u.useEffect)(()=>{i&&(L({}),B(void 0),W(!1),v?(F(n0()),U([])):F(n1(l,eo||[],s,R)))},[i]),(0,u.useEffect)(()=>{ec&&U((0,ei.C)(ed))},[ec]),(0,u.useEffect)(()=>{K&&!r()(K)&&eu({columns:n2(K)})},[K]),O)?(0,a.jsxs)(et.Ay,{size:"large",visible:i,header:(0,a.jsx)(nK,{schema:g,table:l,isDuplicating:s}),className:"transition-all duration-100 ease-in ".concat(q?" mr-32":""),onCancel:c,onConfirm:()=>e=>ep(e),customFooter:(0,a.jsx)(er.A,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:c,applyFunction:e=>ep(e)}),"data-sentry-element":"SidePanel","data-sentry-component":"TableEditor","data-sentry-source-file":"TableEditor.tsx",children:[(0,a.jsxs)(et.Ay.Content,{className:"space-y-10 py-6","data-sentry-element":"SidePanel.Content","data-sentry-source-file":"TableEditor.tsx",children:[(0,a.jsx)(en.A,{"data-testid":"table-name-input",label:"Name",layout:"horizontal",type:"text",error:k.name,value:null==O?void 0:O.name,onChange:e=>eu({name:e.target.value}),"data-sentry-element":"Input","data-sentry-source-file":"TableEditor.tsx"}),(0,a.jsx)(en.A,{label:"Description",placeholder:"Optional",layout:"horizontal",type:"text",value:null!=(n=null==O?void 0:O.comment)?n:"",onChange:e=>eu({comment:e.target.value}),"data-sentry-element":"Input","data-sentry-source-file":"TableEditor.tsx"})]}),(0,a.jsx)(et.Ay.Separator,{"data-sentry-element":"SidePanel.Separator","data-sentry-source-file":"TableEditor.tsx"}),(0,a.jsxs)(et.Ay.Content,{className:"space-y-10 py-6","data-sentry-element":"SidePanel.Content","data-sentry-source-file":"TableEditor.tsx",children:[(0,a.jsx)(el.A,{id:"enable-rls",label:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{children:"Enable Row Level Security (RLS)"}),(0,a.jsx)(ez.E,{children:"Recommended"})]}),description:"Restrict access to your table by enabling RLS and writing Postgres policies.",checked:O.isRLSEnabled,onChange:()=>{O.isRLSEnabled?J(!0):eu({isRLSEnabled:!O.isRLSEnabled})},size:"medium","data-sentry-element":"Checkbox","data-sentry-source-file":"TableEditor.tsx"}),O.isRLSEnabled?(0,a.jsx)(nA.Z,{type:"default",className:"!mt-3",title:"Policies are required to query data",description:(0,a.jsxs)(a.Fragment,{children:["You need to create an access policy before you can query data from this table. Without a policy, querying this table will return an"," ",(0,a.jsx)("u",{className:"text-foreground",children:"empty array"})," of results."," ",v?"You can create policies after saving this table.":""]}),children:(0,a.jsx)(eA.A,{abbrev:!1,className:"mt-2",href:"https://supabase.com/docs/guides/auth/row-level-security"})}):(0,a.jsx)(nA.Z,{type:"warning",className:"!mt-3",title:"You are allowing anonymous access to your table",description:(0,a.jsxs)(a.Fragment,{children:[O.name?"The table ".concat(O.name):"Your table"," will be publicly writable and readable"]}),children:(0,a.jsx)(eA.A,{abbrev:!1,className:"mt-2",href:"https://supabase.com/docs/guides/auth/row-level-security"})}),_&&(0,a.jsx)(el.A,{id:"enable-realtime",label:"Enable Realtime",description:"Broadcast changes on this table to authorized subscribers",checked:O.isRealtimeEnabled,onChange:()=>{var e,t;N({action:"realtime_toggle_table_clicked",properties:{newState:O.isRealtimeEnabled?"disabled":"enabled",origin:"tableSidePanel"},groups:{project:null!=(e=null==x?void 0:x.ref)?e:"Unknown",organization:null!=(t=null==y?void 0:y.slug)?t:"Unknown"}}),eu({isRealtimeEnabled:!O.isRealtimeEnabled})},size:"medium"})]}),(0,a.jsx)(et.Ay.Separator,{"data-sentry-element":"SidePanel.Separator","data-sentry-source-file":"TableEditor.tsx"}),(0,a.jsxs)(et.Ay.Content,{className:"space-y-10 py-6","data-sentry-element":"SidePanel.Content","data-sentry-source-file":"TableEditor.tsx",children:[!s&&(0,a.jsx)(nU,{table:O,columns:null==O?void 0:O.columns,relations:M,enumTypes:w,isNewRecord:v,importContent:K,onColumnsUpdated:e=>eu({columns:e}),onSelectImportData:()=>V(!0),onClearImportContent:()=>{eu({columns:nJ}),B(void 0)},onUpdateFkRelations:em}),s&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(el.A,{id:"duplicate-rows",label:"Duplicate table entries",description:"This will copy all the data in the table into the new table",checked:Y,onChange:()=>W(!Y),size:"medium"})}),(0,a.jsx)(nw,{visible:q,headers:null==K?void 0:K.headers,rows:null==K?void 0:K.rows,saveContent:e=>{B(e),V(!1)},closePanel:()=>V(!1),"data-sentry-element":"SpreadsheetImport","data-sentry-source-file":"TableEditor.tsx"}),(0,a.jsx)(z.A,{visible:$,title:"Turn off Row Level Security",confirmLabel:"Confirm",size:"medium",onCancel:()=>J(!1),onConfirm:()=>{eu({isRLSEnabled:!O.isRLSEnabled}),J(!1)},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"TableEditor.tsx",children:(0,a.jsx)(n$,{"data-sentry-element":"RLSDisableModalContent","data-sentry-source-file":"TableEditor.tsx"})})]}),!s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(et.Ay.Separator,{}),(0,a.jsx)(et.Ay.Content,{className:"py-6",children:(0,a.jsx)(nW,{table:O,relations:M,closePanel:c,setEditorDirty:()=>h(),onUpdateFkRelations:em})})]})]},"TableEditor"):null},n5=e=>{var t,n,s,i,c,h,f,x,y,g,T,A,R,Y,W,K,B,q,V,G;let{editable:$=!0,selectedTable:J,includeColumns:Q=!1,onTableCreated:X=d()}=e,{ref:Z}=(0,p.g)(),ee=(0,H.ap)(),et=(0,M.zv)(),[en,ea]=(0,P.W)({arrayKeys:["filter","sort"]}),el=(0,l.jE)(),{data:es}=(0,D.YA)(),[er,ei]=(0,u.useState)(!1),[eo,ec]=(0,u.useState)(!1),ed=(null!=(G=null==J?void 0:J.columns)?G:[]).filter(e=>{var t;return(null!=(t=null==e?void 0:e.enums)?t:[]).length>0&&"array"===e.data_type.toLowerCase()}).map(e=>e.name),{mutateAsync:eu}=k({onSuccess(){m.oR.success("Successfully created row")}}),{mutateAsync:em}=(0,L.oG)({onSuccess(){m.oR.success("Successfully updated row")}}),{data:ep}=(0,b._)({projectRef:null==es?void 0:es.ref,connectionString:null==es?void 0:es.connectionString}),{mutateAsync:eh}=v(),{mutateAsync:ef}=(0,_.H)({onError:()=>{}}),ex=(0,I.Qj)(),ey=async(e,t,n,a)=>{let l;if(!es||void 0===J)return console.error("no project or table selected");if(t)try{await eu({projectRef:es.ref,connectionString:es.connectionString,table:J,payload:e,enumArrayColumns:ed,roleImpersonationState:ex()})}catch(e){l=e}else if(!r()(e))if(J.primary_keys.length>0)try{await em({projectRef:es.ref,connectionString:es.connectionString,table:J,configuration:n,payload:e,enumArrayColumns:ed,roleImpersonationState:ex()})}catch(e){l=e}else l=Error("No primary key"),m.oR.error("We can't make changes to this table because there is no primary key. Please create a primary key and try again.");a(l),l||(ei(!1),ee.closeSidePanel())},eg=async(e,t)=>{var n,a,l,s;let r,i;if(void 0===J)return;let o={};if((null==(n=ee.sidePanel)?void 0:n.type)==="json"){let{row:t,column:n}=ee.sidePanel.jsonValue;r={[n]:null===e?null:JSON.parse(e)},J.primary_keys.forEach(e=>o[e.name]=t[e.name]),i={identifiers:o,rowIdx:t.idx}}else if((null==(a=ee.sidePanel)?void 0:a.type)==="cell"){let t=null==(l=ee.sidePanel.value)?void 0:l.column,n=null==(s=ee.sidePanel.value)?void 0:s.row;if(!t||!n)return;r={[t]:null===e?null:e},J.primary_keys.forEach(e=>o[e.name]=n[e.name]),i={identifiers:o,rowIdx:n.idx}}if(void 0!==r&&void 0!==i)try{await ey(r,!1,i,()=>{})}catch(e){}finally{t()}},ev=async e=>{var t;if(void 0===J||(null==(t=ee.sidePanel)?void 0:t.type)!=="foreign-row-selector")return;let n=ee.sidePanel.foreignKey;try{let{row:t}=n,a={};J.primary_keys.forEach(e=>{var n;let l=null==(n=J.columns)?void 0:n.find(t=>t.name===e.name);a[e.name]=(null==l?void 0:l.format)==="bytea"?(0,e5.ds)(t[e.name]):t[e.name]});let l={identifiers:a,rowIdx:t.idx};ey(e,!1,l,()=>{})}catch(e){}},eb=async(e,t,n,a)=>{var l;let s=(null==(l=ee.sidePanel)?void 0:l.type)==="column"&&ee.sidePanel.column,{primaryKey:r,foreignKeyRelations:i,existingForeignKeyRelations:o}=n;if(!es||void 0===J)return console.error("no project or table selected");let c=t?await nn({projectRef:null==es?void 0:es.ref,connectionString:null==es?void 0:es.connectionString,payload:e,selectedTable:J,primaryKey:r,foreignKeyRelations:i}):await na({projectRef:null==es?void 0:es.ref,connectionString:null==es?void 0:es.connectionString,originalColumn:s,payload:e,selectedTable:J,primaryKey:r,foreignKeyRelations:i,existingForeignKeyRelations:o});(null==c?void 0:c.error)?m.oR.error(c.error.message):(!t&&e.name&&s&&s.name!==e.name&&e_(s.name,e.name),await Promise.all([el.invalidateQueries(S.i.tableEditor(null==es?void 0:es.ref,null==J?void 0:J.id)),el.invalidateQueries(N.c.foreignKeyConstraints(null==es?void 0:es.ref,null==J?void 0:J.schema)),el.invalidateQueries(N.c.tableDefinition(null==es?void 0:es.ref,null==J?void 0:J.id)),el.invalidateQueries(j.C.list(null==es?void 0:es.ref))]),await el.invalidateQueries(w.j.tableRowsAndCount(null==es?void 0:es.ref,null==J?void 0:J.id)),ei(!1),ee.closeSidePanel()),a()},e_=(e,t)=>{ea(n=>{var a,l;let s=null!=(a=null==n?void 0:n.filter)?a:[],r=null!=(l=null==n?void 0:n.sort)?l:[];return{...n,filter:s.map(n=>{let[a]=n.split(":");return a===e?n.replace(a,t):n}),sort:r.map(n=>{let[a]=n.split(":");return a===e?n.replace(a,t):n})}})},eN=async(e,t)=>{if(!es)return console.error("Project is required");let n=null==ep?void 0:ep.find(e=>"supabase_realtime"===e.name);try{if(void 0===n){let n=t?["".concat(e.schema,".").concat(e.name)]:[];await eh({projectRef:es.ref,connectionString:es.connectionString,name:"supabase_realtime",publish_insert:!0,publish_update:!0,publish_delete:!0,tables:n});return}if(null===n.tables){let a=await el.fetchQuery({queryKey:O.v.list(es.ref,"public",Q),queryFn:e=>{let{signal:t}=e;return(0,F.oI)({projectRef:es.ref,connectionString:es.connectionString,schema:"public"},t)}}),l=t?a.map(e=>"".concat(e.schema,".").concat(e.name)):a.filter(t=>t.id!==e.id).map(e=>"".concat(e.schema,".").concat(e.name));await ef({id:n.id,projectRef:es.ref,connectionString:es.connectionString,tables:l});return}let a=n.tables.some(t=>t.id==e.id),l=a&&!t?n.tables.filter(t=>t.id!==e.id).map(e=>"".concat(e.schema,".").concat(e.name)):!a&&t?n.tables.map(e=>"".concat(e.schema,".").concat(e.name)).concat(["".concat(e.schema,".").concat(e.name)]):null;if(null===l)return;await ef({id:n.id,projectRef:es.ref,connectionString:es.connectionString,tables:l})}catch(t){m.oR.error("Failed to update realtime for ".concat(e.name,": ").concat(t.message))}},eE=async(e,t,n,a,l,s)=>{let r,i=!1,{importContent:o,isRLSEnabled:c,isRealtimeEnabled:d,isDuplicateRows:u,existingForeignKeyRelations:p,primaryKey:h}=l;try{var f;if((null==(f=ee.sidePanel)?void 0:f.type)==="table"&&"duplicate"===ee.sidePanel.mode&&J){r=m.oR.loading("Duplicating table: ".concat(J.name,"..."));let t=await nl(null==es?void 0:es.ref,null==es?void 0:es.connectionString,e,{isRLSEnabled:c,isDuplicateRows:u,duplicateTable:J,foreignKeyRelations:n});d&&await eN(t,d),await Promise.all([el.invalidateQueries(O.v.list(null==es?void 0:es.ref,t.schema,Q)),el.invalidateQueries(j.C.list(null==es?void 0:es.ref))]),m.oR.success("Table ".concat(J.name," has been successfully duplicated into ").concat(t.name,"!"),{id:r}),X(t)}else if(a){r=m.oR.loading("Creating new table: ".concat(e.name,"..."));let a=await ns({projectRef:null==es?void 0:es.ref,connectionString:null==es?void 0:es.connectionString,toastId:r,payload:e,columns:t,foreignKeyRelations:n,isRLSEnabled:c,importContent:o});d&&await eN(a,!0),await Promise.all([el.invalidateQueries(O.v.list(null==es?void 0:es.ref,a.schema,Q)),el.invalidateQueries(j.C.list(null==es?void 0:es.ref))]),m.oR.success("Table ".concat(a.name," is good to go!"),{id:r}),X(a)}else if(J){r=m.oR.loading("Updating table: ".concat(null==J?void 0:J.name,"..."));let{table:a,hasError:l}=await nr({projectRef:null==es?void 0:es.ref,connectionString:null==es?void 0:es.connectionString,toastId:r,table:J,payload:e,columns:t,foreignKeyRelations:n,existingForeignKeyRelations:p,primaryKey:h});if(void 0===a)return m.oR.error("Failed to update table");if((0,C.KO)(a)&&await eN(a,d),l)m.oR.warning("Table ".concat(a.name," has been updated but there were some errors. Please check these errors separately."));else{if(Z&&e.name){let t=(0,M.lW)(E.z.TABLE,{id:J.id});et.updateTab(t,{label:e.name})}m.oR.success("Successfully updated ".concat(a.name,"!"),{id:r})}}}catch(e){i=!0,m.oR.error(e.message,{id:r})}i||(ei(!1),ee.closeSidePanel()),s()},ej=async e=>{if(!es||void 0===J)return console.error("no project or table selected");let{file:t,rowCount:n,selectedHeaders:l,resolve:s}=e,r=m.oR.loading("Adding ".concat(n.toLocaleString()," rows to ").concat(J.name));if(t&&n>0){let e=await no(es.ref,es.connectionString,t,J,l,e=>{m.oR.loading((0,a.jsx)(U.t,{progress:e,message:"Adding ".concat(n.toLocaleString()," rows to ").concat(J.name)}),{id:r})});if(e.error)return m.oR.error("Failed to import data: ".concat(e.error.message),{id:r}),s()}else{let t=await nc(es.ref,es.connectionString,J,e.rows,l,t=>{m.oR.loading((0,a.jsx)(U.t,{progress:t,message:"Adding ".concat(e.rows.length.toLocaleString()," rows to ").concat(J.name)}),{id:r})});if(t.error)return m.oR.error("Failed to import data: ".concat(t.error.message),{id:r}),s()}await el.invalidateQueries(w.j.tableRowsAndCount(null==es?void 0:es.ref,null==J?void 0:J.id)),m.oR.success("Successfully imported ".concat(n," rows of data into ").concat(J.name),{id:r}),s(),ee.closeSidePanel()},eS=()=>{er?ec(!0):ee.closeSidePanel()};return(0,a.jsxs)(a.Fragment,{children:[!o()(J)&&(0,a.jsx)(tz,{row:(null==(t=ee.sidePanel)?void 0:t.type)==="row"?ee.sidePanel.row:void 0,selectedTable:J,visible:(null==(n=ee.sidePanel)?void 0:n.type)==="row",editable:$,closePanel:eS,saveChanges:ey,updateEditorDirty:()=>ei(!0)}),!o()(J)&&(0,a.jsx)(e$,{column:(null==(s=ee.sidePanel)?void 0:s.type)==="column"?ee.sidePanel.column:void 0,selectedTable:J,visible:(null==(i=ee.sidePanel)?void 0:i.type)==="column",closePanel:eS,saveChanges:eb,updateEditorDirty:()=>ei(!0)}),(0,a.jsx)(n3,{table:(null==(c=ee.sidePanel)?void 0:c.type)==="table"&&("edit"===ee.sidePanel.mode||"duplicate"===ee.sidePanel.mode)?J:void 0,isDuplicating:(null==(h=ee.sidePanel)?void 0:h.type)==="table"&&"duplicate"===ee.sidePanel.mode,visible:(null==(f=ee.sidePanel)?void 0:f.type)==="table",closePanel:eS,saveChanges:eE,updateEditorDirty:()=>ei(!0),"data-sentry-element":"TableEditor","data-sentry-source-file":"SidePanelEditor.tsx"}),(0,a.jsx)(tY.A,{visible:(null==(x=ee.sidePanel)?void 0:x.type)==="schema",onSuccess:eS,closePanel:eS,"data-sentry-element":"SchemaEditor","data-sentry-source-file":"SidePanelEditor.tsx"}),(0,a.jsx)(tE,{visible:(null==(y=ee.sidePanel)?void 0:y.type)==="json",row:(null==(g=ee.sidePanel)?void 0:g.type)==="json"&&ee.sidePanel.jsonValue.row||{},column:(null==(T=ee.sidePanel)?void 0:T.type)==="json"&&ee.sidePanel.jsonValue.column||"",backButtonLabel:"Cancel",applyButtonLabel:"Save changes",readOnly:!$,closePanel:eS,onSaveJSON:eg,"data-sentry-element":"JsonEditor","data-sentry-source-file":"SidePanelEditor.tsx"}),(0,a.jsx)(tU,{visible:(null==(A=ee.sidePanel)?void 0:A.type)==="cell",column:(null==(R=ee.sidePanel)?void 0:R.type)==="cell"&&(null==(Y=ee.sidePanel.value)?void 0:Y.column)||"",row:(null==(W=ee.sidePanel)?void 0:W.type)==="cell"&&(null==(K=ee.sidePanel.value)?void 0:K.row)||{},closePanel:eS,onSaveField:eg,"data-sentry-element":"TextEditor","data-sentry-source-file":"SidePanelEditor.tsx"}),(0,a.jsx)(ti,{visible:(null==(B=ee.sidePanel)?void 0:B.type)==="foreign-row-selector",foreignKey:(null==(q=ee.sidePanel)?void 0:q.type)==="foreign-row-selector"?ee.sidePanel.foreignKey.foreignKey:void 0,closePanel:eS,onSelect:ev,"data-sentry-element":"ForeignRowSelector","data-sentry-source-file":"SidePanelEditor.tsx"}),(0,a.jsx)(nw,{visible:(null==(V=ee.sidePanel)?void 0:V.type)==="csv-import",selectedTable:J,saveContent:ej,closePanel:eS,updateEditorDirty:ei,"data-sentry-element":"SpreadsheetImport","data-sentry-source-file":"SidePanelEditor.tsx"}),(0,a.jsx)(z.A,{visible:eo,title:"Discard changes",confirmLabel:"Discard",onCancel:()=>ec(!1),onConfirm:()=>{ec(!1),ei(!1),ee.closeSidePanel()},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"SidePanelEditor.tsx",children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})]})}},88503:(e,t,n)=>{n.d(t,{AM:()=>N,I:()=>g,KV:()=>h,Lj:()=>r,_c:()=>m,ao:()=>o,cx:()=>d,e2:()=>S,hB:()=>x,n0:()=>l,th:()=>b,yB:()=>j});let a=["smallint","integer","bigint","decimal","numeric","real","double precision","serial","bigserial","int2","int4","int8","float4","float8","smallserial","serial2","serial4","serial8"];function l(e){return a.indexOf(e.toLowerCase())>-1}let s=["json","jsonb","array"];function r(e){return s.indexOf(e.toLowerCase())>-1}let i=["array"];function o(e){return i.indexOf(e.toLowerCase())>-1}let c=["uuid","text","character varying"];function d(e){return c.indexOf(e.toLowerCase())>-1}let u=["citext"];function m(e){return u.indexOf(e.toLowerCase())>-1}let p=["timestamp","timestamptz"];function h(e){return p.indexOf(e.toLowerCase())>-1}let f=["date"];function x(e){return f.indexOf(e.toLowerCase())>-1}let y=["time","timetz"];function g(e){return y.indexOf(e.toLowerCase())>-1}let v=["boolean","bool"];function b(e){return v.indexOf(e.toLowerCase())>-1}let _=["user-defined"];function N(e){return _.indexOf(e.toLowerCase())>-1}let E=["bytea"];function j(e){return E.indexOf(e.toLowerCase())>-1}function S(e){var t;let{targetTableSchema:n,targetTableName:a,targetColumnName:l}=null!=(t=null==e?void 0:e.foreignKey)?t:{};return!!n&&!!a&&!!l}},91998:(e,t,n)=>{n.d(t,{i:()=>a});let a={tableEditor:(e,t)=>["projects",e,"table-editor",t].filter(Boolean)}},94887:(e,t,n)=>{n.d(t,{F2:()=>w,Gk:()=>C,MG:()=>_,Mr:()=>T,ds:()=>A,jm:()=>b});var a=n(53434),l=n.n(a),s=n(93896),r=n.n(s),i=n(84305),o=n.n(i),c=n(70350),d=n.n(c),u=n(22442),m=n.n(u),p=n(31043),h=n.n(p),f=n(48177),x=n(46895),y=n(56230),g=n(15599).Buffer;let v=e=>{let{column:t,row:n}=e;if(void 0===n)if(y.AL.includes(t.format))return null;else if("bool"!==t.format)return"";else if(t.default_value)return t.default_value;else if(t.is_nullable)return"null";else return null;return"bool"===t.format&&null===n[t.name]?"null":y.mN.includes(t.format)?j(t.format,n[t.name]):N(n[t.name],t.format)},b=(e,t,n)=>{var a;let{primary_keys:l}=t,s=l.map(e=>e.name);return(null!=(a=t.columns)?a:[]).map(t=>{var a,l;let r=v({column:t,row:e}),i=n.find(e=>e.columns.map(e=>e.source).includes(t.name));return{value:r,foreignKey:void 0!==i?{id:i.id,constraint_name:i.name,source_schema:t.schema,source_table_name:t.table,source_column_name:t.name,target_table_schema:i.schema,target_table_name:i.table,target_column_name:null!=(l=null==(a=i.columns.find(e=>e.source===t.name))?void 0:a.target)?l:""}:void 0,id:t.id,name:t.name,comment:E(t.comment),format:t.format,enums:t.enums,defaultValue:null==t?void 0:t.default_value,isNullable:t.is_nullable,isIdentity:t.is_identity,isPrimaryKey:s.includes(t.name)}})},_=e=>{let t={};return e.forEach(e=>{var n,a,l;if(e.format.startsWith("_")&&e.value)try{JSON.parse(e.value)}catch(n){t[e.name]="Value is an invalid array"}if(e.format.includes("json")&&(null!=(a=null==(n=e.value)?void 0:n.length)?a:0)>0){if(T(e.value))return;try{(0,x.hC)(null!=(l=e.value)?l:"")}catch(n){t[e.name]="Value is invalid JSON"}}if(e.isIdentity||e.defaultValue)return}),t},N=(e,t)=>{try{if(null===e||"string"==typeof e&&0===e.length)return e;if("number"==typeof e||!t)return e;if("bytea"===t)return A(e);else if("object"==typeof e)return JSON.stringify(e);else if("boolean"==typeof e)return e.toString();else return e}catch(t){return e}},E=e=>{var t,n;if(!e)return"";let a=r()(e.split("\n"));return 1==a.length?e:2==a.length?"".concat(a[0]," ").concat(null==(t=a[1])?void 0:t.split(".<")[0]):a.length>2?"".concat(a[0]," (").concat(a[1]," ").concat(null==(n=a[2])?void 0:n.split(".<")[0],")"):""},j=(e,t)=>{if(!t||0==t.length)return"";if(y.aw.includes(e))return l()(t).format("YYYY-MM-DDTHH:mm:ss");if(!y.mL.includes(e))return t;{let e=t&&t.includes("+")?"HH:mm:ssZZ":"HH:mm:ss";return l()(t,e).format("HH:mm:ss")}},S=(e,t)=>{if(!t||0==t.length)return null;switch(e){case"timestamptz":return l()(t,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ssZ");case"timestamp":return l()(t,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ss");case"timetz":return l()(t,"HH:mm:ss").format("HH:mm:ssZZ");case"time":return l()(t,"HH:mm:ss").format("HH:mm:ss");default:return t}},C=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};return e.forEach(e=>{var t;let a=e.format.startsWith("_"),l=y.AL.includes(e.format)?e.value:0===(null!=(t=null==e?void 0:e.value)?t:"").length?null:e.value;if(a&&null!==l)n[e.name]=(0,x.Bl)(l);else if(e.format.includes("json"))"object"==typeof e.value?n[e.name]=l:m()(l)&&(n[e.name]=(0,x.Bl)(l));else if("bool"===e.format&&l)"null"===l?n[e.name]=null:n[e.name]="true"===l;else if(y.mN.includes(e.format)){let t=2===(l||"").split(":").length?"".concat(l,":00"):l;n[e.name]=S(e.format,t)}else n[e.name]=l}),t?n:h()(n,d())},w=(e,t)=>{let n=C(t,!0),a={};return Object.keys(n).forEach(l=>{let s=t.find(e=>e.name===l),r=null==s?void 0:s.format;if(void 0!==r&&y.mN.includes(r)){let t=j(r,e[l]);S(r,t)!==n[l]&&(a[l]=n[l])}else void 0!==r&&y.J_.includes(r)?T(null==s?void 0:s.value)||(a[l]=n[l]):o()(e[l],n[l])||(a[l]=n[l])}),a},T=e=>"string"==typeof e&&e.endsWith("...")&&e.length>f.SF||"string"==typeof e&&e.startsWith('["')&&e.endsWith(',"..."]')&&(e.match(/","/g)||[]).length===f.BA||"string"==typeof e&&e.startsWith('[["')||"string"==typeof e&&e.endsWith(',{"truncated":true}]'),A=e=>{try{return"\\x".concat(g.from(e.data).toString("hex"))}catch(t){return e}}},96777:(e,t,n)=>{n.d(t,{A:()=>c});var a=n(80263),l=n(32144),s=n(3049),r=n(46491),i=n(26010),o=n(22554);let c=e=>{let{tableId:t,isRefetching:n}=e,{ref:c}=(0,r.g)(),d=(0,l.jE)(),u=i.j.tableRowsAndCount(c,t);async function m(){await d.invalidateQueries(u)}return(0,a.jsx)(o.$,{type:"text",loading:n,icon:(0,a.jsx)(s.A,{className:"text-foreground-muted",strokeWidth:1.5}),onClick:()=>m(),"data-sentry-element":"Button","data-sentry-component":"RefreshButton","data-sentry-source-file":"RefreshButton.tsx",children:"Refresh"})}},98466:(e,t,n)=>{n.d(t,{M:()=>i});var a=n(53239),l=n(78741),s=n(34071),r=n(21941);function i(){let{filters:e,setParams:t}=(0,s.o)(),{saveFiltersAndTriggerSideEffects:n}=(0,r.F)();return{filters:(0,l.hl)(e),urlFilters:e,onApplyFilters:(0,a.useCallback)(e=>{let a=(0,l.E9)(e);t(e=>({...e,filter:a})),n(a)},[t,n])}}},99581:(e,t,n)=>{n.d(t,{A:()=>p,k:()=>m});var a=n(22990),l=n(32144),s=n(80251),r=n(73969),i=n(30021),o=n(20305),c=n(91998),d=n(8552),u=n(98587);async function m(e){let{projectRef:t,connectionString:n,id:l,name:s,schema:r,cascade:i=!1}=e,{sql:c}=a.A.tables.remove({name:s,schema:r},{cascade:i}),{result:d}=await (0,o.E)({projectRef:t,connectionString:n,sql:c,queryKey:["table","delete",l]});return d}let p=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,l.jE)();return(0,s.n)(e=>m(e),{async onSuccess(t,n,l){let{id:s,projectRef:r,schema:o}=n;await Promise.all([a.invalidateQueries(c.i.tableEditor(r,s)),a.invalidateQueries(u.v.list(r,o)),a.invalidateQueries(i.C.list(r)),a.invalidateQueries(d.k.listBySchema(r,o))]),await (null==e?void 0:e(t,n,l))},async onError(e,n,a){void 0===t?r.oR.error("Failed to delete database table: ".concat(e.message)):t(e,n,a)},...n})}}}]);
try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a5999d18-2643-46f6-9ae5-d761e392cadb",e._sentryDebugIdIdentifier="sentry-dbid-a5999d18-2643-46f6-9ae5-d761e392cadb")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6266,6377],{28242:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/logs/explorer",function(){return s(49513)}])},34106:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var n=s(80263),a=s(46115),l=s(53239),r=s(92413);let o=e=>{var t,s,o;let{defaultActiveId:i,activeId:d,type:c="pills",size:u="tiny",block:x,onChange:m,onClick:p,scrollable:y,wrappable:f,addOnBefore:h,addOnAfter:g,listClassNames:j,baseClassNames:b,refs:v,children:w}=e,S=l.Children.toArray(w),[P,_]=(0,l.useState)(null!=(o=null!=d?d:i)?o:null==S||null==(s=S[0])||null==(t=s.props)?void 0:t.id);(0,l.useMemo)(()=>{d&&d!==P&&_(d)},[d]);let N=(0,r.A)("tabs");function A(e){null==p||p(e),e!==P&&(null==m||m(e),_(e))}let L=[N[c].list];return y&&L.push(N.scrollable),f&&L.push(N.wrappable),j&&L.push(j),(0,n.jsxs)(a.bL,{value:P,className:[N.base,b].join(" "),ref:null==v?void 0:v.base,"data-sentry-element":"TabsPrimitive.Root","data-sentry-component":"Tabs","data-sentry-source-file":"Tabs.tsx",children:[(0,n.jsxs)(a.B8,{className:L.join(" "),ref:null==v?void 0:v.list,"data-sentry-element":"TabsPrimitive.List","data-sentry-source-file":"Tabs.tsx",children:[h,S.map(e=>{let t=P===e.props.id,s=[N[c].base,N.size[u]];return t?s.push(N[c].active):s.push(N[c].inactive),x&&s.push(N.block),(0,n.jsxs)(a.l9,{onKeyDown:t=>{"Enter"===t.key&&(t.preventDefault(),A(e.props.id))},onClick:()=>A(e.props.id),value:e.props.id,className:s.join(" "),children:[e.props.icon,(0,n.jsx)("span",{children:e.props.label}),e.props.iconRight]},"".concat(e.props.id,"-tab-button"))}),g]}),S]})};o.Panel=e=>{let{children:t,id:s,className:l}=e,o=(0,r.A)("tabs");return(0,n.jsx)(a.UC,{value:s,className:[o.content,l].join(" "),"data-sentry-element":"TabsPrimitive.Content","data-sentry-component":"Panel","data-sentry-source-file":"Tabs.tsx",children:t})};let i=o},49513:(e,t,s)=>{"use strict";s.r(t),s.d(t,{LogsExplorerPage:()=>es,default:()=>en});var n=s(80263),a=s(14360),l=s(56404),r=s(53434),o=s.n(r),i=s(67908),d=s(53239),c=s(73969),u=s(46491),x=s(56390),m=s(37578),p=s(83759),y=s(36839),f=s(44363),h=s(63121),g=s(24699),j=s(21329),b=s(93749),v=s.n(b),w=s(58633),S=s(64084),P=s(47507),_=s(64495),N=s(22554),A=s(35741),L=s(34531),C=s(80832),T=s(34106),E=s(70979),k=s(70603);function R(e){let{name:t,desc:s}=e;return(0,n.jsxs)("div",{className:"grid gap-1","data-sentry-component":"DropdownMenuItemContent","data-sentry-source-file":"LogsQueryPanel.tsx",children:[(0,n.jsx)("div",{className:"font-mono font-bold",children:t}),s&&(0,n.jsx)("div",{className:"text-foreground-light",children:s})]})}let Q=e=>{let{field:t}=e,[s,a]=(0,d.useState)(!1);return(0,n.jsxs)(w.A.tr,{"data-sentry-element":"Table.tr","data-sentry-component":"Field","data-sentry-source-file":"LogsQueryPanel.tsx",children:[(0,n.jsxs)(w.A.td,{className:"font-mono text-xs !p-2 cursor-pointer hover:text-foreground transition flex items-center space-x-2",onClick:()=>(0,E.l)(t.path,()=>{a(!0),setTimeout(()=>a(!1),3e3)}),"data-sentry-element":"Table.td","data-sentry-source-file":"LogsQueryPanel.tsx",children:[(0,n.jsx)("span",{children:t.path}),s?(0,n.jsxs)(A.m_,{children:[(0,n.jsx)(A.k$,{children:(0,n.jsx)(g.A,{size:14,strokeWidth:3,className:"text-brand"})}),(0,n.jsx)(A.ZI,{side:"bottom",children:"Copied"})]}):(0,n.jsxs)(A.m_,{children:[(0,n.jsx)(A.k$,{children:(0,n.jsx)(j.A,{size:14,strokeWidth:1.5})}),(0,n.jsx)(A.ZI,{side:"bottom",children:"Copy value"})]})]}),(0,n.jsx)(w.A.td,{className:"font-mono text-xs !p-2","data-sentry-element":"Table.td","data-sentry-source-file":"LogsQueryPanel.tsx",children:t.type})]})},q=e=>{let{templates:t=[],defaultFrom:s,defaultTo:a,warnings:l,onSelectTemplate:r,onSelectSource:i,onDateChange:c}=e,[m,g]=(0,d.useState)(!1),{logsTemplates:j}=(0,S.x)(["logs:templates"]),{projectAuthAll:b,projectStorageAll:E,projectEdgeFunctionAll:q}=(0,S.x)(["project_auth:all","project_storage:all","project_edge_function:all"]),I=Object.entries(x.le).filter(e=>{let[t]=e;return"AUTH"===t?b:"STORAGE"===t?E:"FN_EDGE"===t?q:"PG_CRON"!==t}).map(e=>{let[,t]=e;return t}),[M,D]=(0,d.useState)(s&&a?{to:a,from:s,text:"".concat(o()(s).format("DD MMM, HH:mm")," - ").concat(o()(a).format("DD MMM, HH:mm")),isHelper:!1}:{to:x.Po[0].calcTo(),from:x.Po[0].calcFrom(),text:x.Po[0].text,isHelper:!0});return(0,n.jsx)("div",{className:"border-b bg-surface-100","data-sentry-component":"LogsQueryPanel","data-sentry-source-file":"LogsQueryPanel.tsx",children:(0,n.jsx)("div",{className:"flex w-full items-center justify-between px-4 md:px-5 py-2 overflow-x-scroll no-scrollbar",children:(0,n.jsxs)("div",{className:"flex w-full flex-row items-center justify-between gap-x-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)(_.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"LogsQueryPanel.tsx",children:[(0,n.jsx)(_.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"LogsQueryPanel.tsx",children:(0,n.jsx)(N.$,{type:"default",iconRight:(0,n.jsx)(p.A,{}),"data-sentry-element":"Button","data-sentry-source-file":"LogsQueryPanel.tsx",children:"Insert source"})}),(0,n.jsx)(_.SQ,{side:"bottom",align:"start",className:"max-h-[70vh] overflow-auto","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"LogsQueryPanel.tsx",children:I.sort((e,t)=>e.localeCompare(t)).map(e=>(0,n.jsx)(_._2,{onClick:()=>i(e),children:(0,n.jsx)(R,{name:e,desc:x.fy[e]})},e))})]}),u.pe&&j&&(0,n.jsxs)(_.rI,{children:[(0,n.jsx)(_.ty,{asChild:!0,children:(0,n.jsx)(N.$,{type:"default",iconRight:(0,n.jsx)(p.A,{}),children:"Templates"})}),(0,n.jsx)(_.SQ,{side:"bottom",align:"start",children:t.sort((e,t)=>e.label.localeCompare(t.label)).map(e=>(0,n.jsx)(_._2,{onClick:()=>r(e),children:(0,n.jsx)("p",{children:e.label})},e.label))})]}),(0,n.jsx)(k.O,{value:M,onSubmit:e=>{D(e),c(e)},helpers:x.Po,"data-sentry-element":"LogsDatePicker","data-sentry-source-file":"LogsQueryPanel.tsx"}),(0,n.jsx)("div",{"data-testid":"log-explorer-warnings",className:"transition-all duration-300 h-full ".concat(l.length>0?"opacity-100":"invisible h-0 w-0 opacity-0"),children:(0,n.jsx)(A.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"LogsQueryPanel.tsx",children:(0,n.jsxs)(A.k$,{className:"flex items-start","data-sentry-element":"TooltipTrigger","data-sentry-source-file":"LogsQueryPanel.tsx",children:[(0,n.jsxs)(L.E,{variant:"warning","data-sentry-element":"Badge","data-sentry-source-file":"LogsQueryPanel.tsx",children:[l.length," ",l.length>1?"warnings":"warning"]}),(0,n.jsx)(A.ZI,{className:"p-0 divide-y max-w-xs",side:"bottom","data-sentry-element":"TooltipContent","data-sentry-source-file":"LogsQueryPanel.tsx",children:l.map((e,t)=>(0,n.jsxs)("p",{className:"px-3 py-1.5 text-xs text-foreground-light text-left",children:[e.text," ",e.link&&(0,n.jsx)(v(),{href:e.link,children:e.linkText||"View"})]},t))})]})})})]}),(0,n.jsxs)(C.Ay,{size:"large",header:(0,n.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,n.jsx)("h3",{children:"Field Reference"}),(0,n.jsx)(N.$,{type:"text",className:"px-1",onClick:()=>g(!1),icon:(0,n.jsx)(y.A,{})})]}),visible:m,cancelText:"Close",onCancel:()=>g(!1),hideFooter:!0,triggerElement:(0,n.jsx)(N.$,{asChild:!0,type:"text",onClick:()=>g(!0),icon:(0,n.jsx)(f.A,{}),className:"px-2",children:(0,n.jsx)("span",{children:"Field Reference"})}),"data-sentry-element":"SidePanel","data-sentry-source-file":"LogsQueryPanel.tsx",children:[(0,n.jsx)(C.Ay.Content,{"data-sentry-element":"SidePanel.Content","data-sentry-source-file":"LogsQueryPanel.tsx",children:(0,n.jsx)("div",{className:"pt-4 pb-2 space-y-1",children:(0,n.jsxs)("p",{className:"text-sm",children:["The following table shows all the available paths that can be queried from each respective source. Do note that to access nested keys, you would need to perform the necessary"," ",(0,n.jsxs)(v(),{href:"https://supabase.com/docs/guides/platform/logs#unnesting-arrays",target:"_blank",rel:"noreferrer",className:"text-brand","data-sentry-element":"Link","data-sentry-source-file":"LogsQueryPanel.tsx",children:["unnesting joins",(0,n.jsx)(h.A,{size:"14",className:"ml-1 inline -translate-y-[2px]",strokeWidth:1.5,"data-sentry-element":"ExternalLink","data-sentry-source-file":"LogsQueryPanel.tsx"})]})]})})}),(0,n.jsx)(C.Ay.Separator,{"data-sentry-element":"SidePanel.Separator","data-sentry-source-file":"LogsQueryPanel.tsx"}),(0,n.jsx)(T.A,{scrollable:!0,size:"small",type:"underlined",defaultActiveId:"edge_logs",listClassNames:"px-2","data-sentry-element":"Tabs","data-sentry-source-file":"LogsQueryPanel.tsx",children:P.go.schemas.map(e=>(0,n.jsx)(T.A.Panel,{id:e.reference,label:e.name,className:"px-4 pb-4",children:(0,n.jsx)(w.A,{head:[(0,n.jsx)(w.A.th,{className:"text-xs !p-2",children:"Path"},"path"),(0,n.jsx)(w.A.th,{className:"text-xs !p-2",children:"Type"},"type")],body:e.fields.sort((e,t)=>e.path-t.path).map(e=>(0,n.jsx)(Q,{field:e},e.path))})},e.reference))})]})]})})})};var I=s(26319),M=s(27937),D=s(78311),z=s(97383),F=s(12183),O=s(20550),H=s(61208),U=s(51251),$=s(26169),V=s(45845),Z=s(49300),G=s(64112),W=s(52445),B=s(57080),J=s(46895),X=s(67285),K=s(85469),Y=s(33924),ee=s(91982),et=s(48192);let es=()=>{(0,m.PJ)();let e=(0,a.useMonaco)(),t=(0,i.useRouter)(),{profile:s}=(0,X.xc)(),{ref:r,q:p,queryId:y}=(0,u.g)(),{data:f}=(0,W.s)(),h=(0,d.useRef)(),[g]=(0,d.useState)((0,J.gZ)()),{timestampStart:j,timestampEnd:b,setTimeRange:v}=(0,Z.B)(),{logsDefaultQuery:w}=(0,G.g)(["logs:default_query"]),S=u.pe?null!=w?w:"select\n  cast(timestamp as datetime) as timestamp,\n  event_message, metadata \nfrom edge_logs \nlimit 5":"select\n  timestamp, event_message, metadata\n  from edge_logs limit 5",[P,_]=(0,d.useState)(S),[A,L]=(0,d.useState)(!1),[C,T]=(0,d.useState)([]),[E,k]=(0,d.useState)(null),[R,Q]=(0,l.Mj)("project-content-".concat(r,"-recent-log-sql"),[]),{data:D}=(0,U.D)({projectRef:r,type:"log_sql"}),z=null==D?void 0:D.content.find(e=>e.id===y),{params:es,logData:en,error:ea,isLoading:el,changeQuery:er,runQuery:eo}=(0,V.A)(r,{iso_timestamp_start:j,iso_timestamp_end:b},!0),{mutate:ei,isLoading:ed}=(0,$.v)({onError:e=>{console.error(e),L(!1),y?c.oR.error("Failed to update query: ".concat(e.message)):c.oR.error("Failed to save query: ".concat(e.message))},onSuccess:(e,t)=>{L(!1),y?c.oR.success('Updated "'.concat(t.payload.name,'" log query')):c.oR.success('Saved "'.concat(t.payload.name,'" log query'))}}),ec=e=>{Q([...R,{schema_version:"1",favorite:!1,sql:"",content_id:"",...e}])},{showUpgradePrompt:eu,setShowUpgradePrompt:ex}=(0,B.g)(es.iso_timestamp_start),em=e=>{let s="string"==typeof e&&e||P;er(s),eo(),t.push({pathname:t.pathname,query:{...t.query,q:s}}),ec({sql:s})},ep=async(e,n)=>{let{setSubmitting:a}=n;if(!r)return console.error("Project ref is required");if(!s)return console.error("Profile is required");a(!0);let l=(0,J.gZ)();ei({projectRef:r,payload:{id:l,name:e.name,description:e.description||"",type:"log_sql",content:{content_id:g,sql:P,schema_version:"1",favorite:!1},owner_id:s.id,visibility:"user"}},{onSuccess:()=>t.push("/project/".concat(r,"/logs/explorer?queryId=").concat(l))})};return(0,d.useEffect)(()=>{p&&_(p)},[p]),(0,d.useEffect)(()=>{let e=[],t=j?o()(j):o()(),s=b?o()(b):o()();Math.abs(t.diff(s,"days"))>=x.VM&&e.push({text:"Querying large date ranges can be slow. Consider selecting a smaller date range."}),P&&!P.toLowerCase().includes("limit")&&e.push({text:"When querying large date ranges, include a LIMIT clause."}),T(e)},[P,j,b]),(0,d.useEffect)(()=>{if(j){var e;(0,m.eu)(j,null==f||null==(e=f.plan)?void 0:e.id)&&ex(!eu)}},[j,f]),(0,n.jsxs)("div",{className:"w-full h-full mx-auto","data-sentry-component":"LogsExplorerPage","data-sentry-source-file":"index.tsx",children:[(0,n.jsxs)(K.HK,{className:"w-full h-full max-h-screen",direction:"vertical",autoSaveId:u.rS.LOG_EXPLORER_SPLIT_SIZE,"data-sentry-element":"ResizablePanelGroup","data-sentry-source-file":"index.tsx",children:[(0,n.jsxs)(K.wV,{collapsible:!0,minSize:5,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"index.tsx",children:[(0,n.jsx)(q,{defaultFrom:j||"",defaultTo:b||"",onDateChange:e=>{var t;let{to:s,from:n}=e;(0,m.eu)(n,null==f||null==(t=f.plan)?void 0:t.id)?ex(!eu):v(n||"",s||"")},onSelectSource:t=>{if(h.current&&e){var s,n;let a=null==(s=h.current)?void 0:s.getModel(),l=h.current.getValue(),r=l.indexOf("from"),o=r<0?"".concat(l).concat(t):"".concat(l.substring(0,r+4)," ").concat(t," ").concat(l.substring(r+5));h.current.pushUndoStop(),h.current.executeEdits("insert-identifier",[{text:o,range:null!=(n=null==a?void 0:a.getFullModelRange())?n:new e.Range(1,1,1,1)}]),h.current.pushUndoStop(),h.current.focus()}},templates:x.QT.filter(e=>"custom"===e.mode),onSelectTemplate:t=>{if(h.current&&e){var s,n;let a=null==(s=h.current)?void 0:s.getModel();h.current.pushUndoStop(),h.current.executeEdits("insert-identifier",[{text:t.searchString,range:null!=(n=null==a?void 0:a.getFullModelRange())?n:new e.Range(1,1,1,1)}]),h.current.pushUndoStop(),h.current.focus()}ec({sql:t.searchString})},warnings:C,"data-sentry-element":"LogsQueryPanel","data-sentry-source-file":"index.tsx"}),(0,n.jsx)(H.A,{active:el,"data-sentry-element":"ShimmerLine","data-sentry-source-file":"index.tsx"}),(0,n.jsx)(F.A,{id:g,editorRef:h,language:"pgsql",defaultValue:P,onInputChange:e=>_(e||""),actions:{runQuery:{enabled:!0,callback:em}},"data-sentry-element":"CodeEditor","data-sentry-source-file":"index.tsx"})]}),(0,n.jsx)(K.WM,{withHandle:!0,"data-sentry-element":"ResizableHandle","data-sentry-source-file":"index.tsx"}),(0,n.jsx)(K.wV,{collapsible:!0,minSize:5,className:"overflow-auto","data-sentry-element":"ResizablePanel","data-sentry-source-file":"index.tsx",children:(0,n.jsxs)(O.A,{active:el,"data-sentry-element":"LoadingOpacity","data-sentry-source-file":"index.tsx",children:[(0,n.jsx)(I.A,{isSaving:ed,showHistogramToggle:!1,onRun:em,onSave:function(){return r?y&&z?void ei({projectRef:r,payload:{...z,content:{...z.content,sql:P}}}):void L(!A):console.error("Project ref is required")},hasEditorValue:!!P,data:en,error:ea,projectRef:r,onSelectedLogChange:k,selectedLog:E,"data-sentry-element":"LogTable","data-sentry-source-file":"index.tsx"}),(0,n.jsx)("div",{className:"flex flex-row justify-end mt-2",children:(0,n.jsx)(M.A,{show:eu,setShowUpgradePrompt:ex,"data-sentry-element":"UpgradePrompt","data-sentry-source-file":"index.tsx"})})]})})]}),(0,n.jsx)(Y.A,{size:"medium",onCancel:()=>L(!A),header:"Save log query",visible:A,hideFooter:!0,"data-sentry-element":"Modal","data-sentry-source-file":"index.tsx",children:(0,n.jsx)(ee.A,{initialValues:{name:"",desdcription:""},onSubmit:ep,"data-sentry-element":"Form","data-sentry-source-file":"index.tsx",children:()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(Y.A.Content,{className:"space-y-6",children:[(0,n.jsx)(et.A,{layout:"horizontal",label:"Name",id:"name"}),(0,n.jsx)("div",{className:"text-area-text-sm",children:(0,n.jsx)(et.A.TextArea,{layout:"horizontal",labelOptional:"Optional",label:"Description",id:"description",rows:2})})]}),(0,n.jsx)(Y.A.Separator,{}),(0,n.jsxs)(Y.A.Content,{className:"flex items-center justify-end gap-2",children:[(0,n.jsx)(N.$,{size:"tiny",type:"default",onClick:()=>L(!A),children:"Cancel"}),(0,n.jsx)(N.$,{size:"tiny",loading:ed,disabled:ed,htmlType:"submit",children:"Save"})]})]})})})]})};es.getLayout=e=>(0,n.jsx)(D.A,{children:(0,n.jsx)(z.A,{children:e})});let en=es},56404:(e,t,s)=>{"use strict";s.d(t,{Mj:()=>x,d7:()=>l});var n=s(53239);function a(e,t){window.dispatchEvent(new StorageEvent("storage",{key:e,newValue:t}))}function l(e,t){let[s,a]=n.useState(e);return n.useEffect(()=>{let s=setTimeout(()=>{a(e)},t);return()=>{clearTimeout(s)}},[e,t]),s}let r={past:[],present:null,future:[]},o=(e,t)=>{let s=JSON.stringify(t);window.localStorage.setItem(e,s),a(e,s)},i=e=>{window.localStorage.removeItem(e),a(e,null)},d=e=>window.localStorage.getItem(e),c=e=>(window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)),u=()=>{throw Error("useLocalStorage is a client-only hook")};function x(e,t){let s=n.useSyncExternalStore(c,()=>d(e),u),a=n.useCallback(t=>{try{let n="function"==typeof t?t(JSON.parse(s)):t;null==n?i(e):o(e,n)}catch(e){console.warn(e)}},[e,s]);return n.useEffect(()=>{null===d(e)&&void 0!==t&&o(e,t)},[e,t]),[s?JSON.parse(s):t,a]}let m=()=>navigator?.connection||navigator?.mozConnection||navigator?.webkitConnection}},e=>{var t=t=>e(e.s=t);e.O(0,[89,2313,673,7494,726,5476,4915,7074,4560,2735,8444,6110,3895,1168,7795,9587,5348,5175,4654,3258,3923,3013,9147,3144,1830,4844,985,4352,304,6416,8311,1041,5983,3444,7383,7291,636,6593,8792],()=>t(28242)),_N_E=e.O()}]);